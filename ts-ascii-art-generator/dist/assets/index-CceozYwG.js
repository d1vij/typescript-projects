var $t=Object.defineProperty;var At=e=>{throw TypeError(e)};var Nt=(e,r,t)=>r in e?$t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var Ze=(e,r,t)=>Nt(e,typeof r!="symbol"?r+"":r,t),vt=(e,r,t)=>r.has(e)||At("Cannot "+t);var mt=(e,r,t)=>(vt(e,r,"read from private field"),t?t.call(e):r.get(e)),Et=(e,r,t)=>r.has(e)?At("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,t),yt=(e,r,t,i)=>(vt(e,r,"write to private field"),i?i.call(e,t):r.set(e,t),t),Mt=(e,r,t)=>(vt(e,r,"access private method"),t);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const bitMethods={getBit(e){return this.data[getSlot(e)]&1<<getShift(e)?1:0},setBit(e){this.data[getSlot(e)]|=1<<getShift(e)},clearBit(e){this.data[getSlot(e)]&=~(1<<getShift(e))},toggleBit(e){this.data[getSlot(e)]^=1<<getShift(e)},getBitXY(e,r){return e>=this.width||r>=this.height?0:this.getBit(r*this.width+e)},setBitXY(e,r){this.setBit(r*this.width+e)},clearBitXY(e,r){this.clearBit(r*this.width+e)},toggleBitXY(e,r){this.toggleBit(r*this.width+e)}};function getSlot(e){return e>>3}function getShift(e){return 7-(e&7)}function setBitMethods(e){for(const r in bitMethods)e.prototype[r]=bitMethods[r]}function checkProcessable(e,r={}){let{bitDepth:t,alpha:i,colorModel:n,components:s,channels:a}=r;if(typeof e!="string"||e.length===0)throw new TypeError("processName must be a string");if(t&&(Array.isArray(t)||(t=[t]),!t.includes(this.bitDepth)))throw new TypeError(`The process: ${e} can only be applied if bit depth is in: ${t}`);if(i&&(Array.isArray(i)||(i=[i]),!i.includes(this.alpha)))throw new TypeError(`The process: ${e} can only be applied if alpha is in: ${i}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.colorModel)))throw new TypeError(`The process: ${e} can only be applied if color model is in: ${n}`);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.components))){let h=`The process: ${e} can only be applied if the number of components is in: ${s}`;throw s.length===1&&s[0]===1?new TypeError(`${h}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(h)}if(a&&(Array.isArray(a)||(a=[a]),!a.includes(this.channels)))throw new TypeError(`The process: ${e} can only be applied if the number of channels is in: ${a}`)}function createBlob(e,r){e=e||[],r=r||{},typeof r=="string"&&(r={type:r});try{return new Blob(e,r)}catch(s){if(s.name!=="TypeError")throw s;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,i=new t,n=0;n<e.length;n+=1)i.append(e[n]);return i.getBlob(r.type)}}function dataURLToBlob(e){var r=e.match(/data:([^;]+)/)[1],t=e.replace(/^[^,]+,/,""),i=binaryStringToArrayBuffer(atob(t));return createBlob([i],{type:r})}function canvasToBlob(e,r,t){return typeof e.toBlob=="function"?new Promise(function(i){e.toBlob(i,r,t)}):Promise.resolve(dataURLToBlob(e.toDataURL(r,t)))}function binaryStringToArrayBuffer(e){for(var r=e.length,t=new ArrayBuffer(r),i=new Uint8Array(t),n=-1;++n<r;)i[n]=e.charCodeAt(n);return t}function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var r=e.default;if(typeof r=="function"){var t=function i(){return this instanceof i?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};t.prototype=r.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}),t}var src$5={};function decode$2(e,r="utf8"){return new TextDecoder(r).decode(e)}const encoder$1=new TextEncoder;function encode$1(e){return encoder$1.encode(e)}const defaultByteLength=1024*8,hostBigEndian=(()=>{const e=new Uint8Array(4),r=new Uint32Array(e.buffer);return!((r[0]=1)&e[0])})(),typedArrays={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class IOBuffer{constructor(r=defaultByteLength,t={}){Ze(this,"buffer");Ze(this,"byteLength");Ze(this,"byteOffset");Ze(this,"length");Ze(this,"offset");Ze(this,"lastWrittenByte");Ze(this,"littleEndian");Ze(this,"_data");Ze(this,"_mark");Ze(this,"_marks");let i=!1;typeof r=="number"?r=new ArrayBuffer(r):(i=!0,this.lastWrittenByte=r.byteLength);const n=t.offset?t.offset>>>0:0,s=r.byteLength-n;let a=n;(ArrayBuffer.isView(r)||r instanceof IOBuffer)&&(r.byteLength!==r.buffer.byteLength&&(a=r.byteOffset+n),r=r.buffer),i?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=r,this.length=s,this.byteLength=s,this.byteOffset=a,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,a,s),this._mark=0,this._marks=[]}available(r=1){return this.offset+r<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(r=1){return this.offset+=r,this}back(r=1){return this.offset-=r,this}seek(r){return this.offset=r,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const r=this._marks.pop();if(r===void 0)throw new Error("Mark stack empty");return this.seek(r),this}rewind(){return this.offset=0,this}ensureAvailable(r=1){if(!this.available(r)){const i=(this.offset+r)*2,n=new Uint8Array(i);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=i,this.byteLength=i,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(r=1){return this.readArray(r,"uint8")}readArray(r,t){const i=typedArrays[t].BYTES_PER_ELEMENT*r,n=this.byteOffset+this.offset,s=this.buffer.slice(n,n+i);if(this.littleEndian===hostBigEndian&&t!=="uint8"&&t!=="int8"){const h=new Uint8Array(this.buffer.slice(n,n+i));h.reverse();const d=new typedArrays[t](h.buffer);return this.offset+=i,d.reverse(),d}const a=new typedArrays[t](s);return this.offset+=i,a}readInt16(){const r=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,r}readUint16(){const r=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,r}readInt32(){const r=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,r}readUint32(){const r=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,r}readFloat32(){const r=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,r}readFloat64(){const r=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,r}readBigInt64(){const r=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,r}readBigUint64(){const r=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,r}readChar(){return String.fromCharCode(this.readInt8())}readChars(r=1){let t="";for(let i=0;i<r;i++)t+=this.readChar();return t}readUtf8(r=1){return decode$2(this.readBytes(r))}decodeText(r=1,t="utf8"){return decode$2(this.readBytes(r),t)}writeBoolean(r){return this.writeUint8(r?255:0),this}writeInt8(r){return this.ensureAvailable(1),this._data.setInt8(this.offset++,r),this._updateLastWrittenByte(),this}writeUint8(r){return this.ensureAvailable(1),this._data.setUint8(this.offset++,r),this._updateLastWrittenByte(),this}writeByte(r){return this.writeUint8(r)}writeBytes(r){this.ensureAvailable(r.length);for(let t=0;t<r.length;t++)this._data.setUint8(this.offset++,r[t]);return this._updateLastWrittenByte(),this}writeInt16(r){return this.ensureAvailable(2),this._data.setInt16(this.offset,r,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(r){return this.ensureAvailable(2),this._data.setUint16(this.offset,r,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(r){return this.ensureAvailable(4),this._data.setInt32(this.offset,r,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(r){return this.ensureAvailable(4),this._data.setUint32(this.offset,r,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(r){return this.ensureAvailable(4),this._data.setFloat32(this.offset,r,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(r){return this.ensureAvailable(8),this._data.setFloat64(this.offset,r,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(r){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,r,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(r){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,r,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(r){return this.writeUint8(r.charCodeAt(0))}writeChars(r){for(let t=0;t<r.length;t++)this.writeUint8(r.charCodeAt(t));return this}writeUtf8(r){return this.writeBytes(encode$1(r))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}const IOBuffer$1=Object.freeze(Object.defineProperty({__proto__:null,IOBuffer},Symbol.toStringTag,{value:"Module"})),require$$0$3=getAugmentedNamespace(IOBuffer$1);var constants,hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,constants={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}}),constants}var BMPEncoder_1,hasRequiredBMPEncoder;function requireBMPEncoder(){if(hasRequiredBMPEncoder)return BMPEncoder_1;hasRequiredBMPEncoder=1;const{IOBuffer:e}=require$$0$3,r=requireConstants(),t=[];for(let n=0;n<=8;n++)t.push(255<<n);class i extends e{constructor(s){if(s.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!s.height||!s.width)throw new Error("ImageData width and height are required");super(s.data),this.width=s.width,this.height=s.height,this.bitDepth=s.bitDepth,this.channels=s.channels,this.components=s.components}encode(){this.encoded=new e,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const s=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(s),this.encoded.toArray()}writePixelArray(){let s=this.encoded;const a=Math.floor((this.bitDepth*this.width+31)/32)*4,h=Math.ceil(this.bitDepth*this.width/8),d=a-h,u=this.bitDepth*this.width%8,g=u===0?0:8-u,_=a*this.height;let w,p,b=0,y=0,M=8;s.mark(),p=this.readUint8();for(let A=this.height-1;A>=0;A--){const C=A===0;s.reset(),s.skip(A*a);for(let v=0;v<h;v++){const E=v===h-1;y<=g&&E?(s.writeByte(p<<y),(g===0||g===y)&&!C&&(w=p,p=this.readByte())):y===0?(w=p,p=this.readUint8(),s.writeByte(w)):(w=p,p=this.readUint8(),s.writeByte(w<<y&t[y]|p>>M)),E&&(b+=u||0,s.skip(d),y=b%8,M=8-y)}}a>h&&(s.reset(),s.skip(_-1),s.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(s){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(s)}writeBitmapV5Header(){const a=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(r.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(a).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(r.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(r.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}return BMPEncoder_1=i,BMPEncoder_1}var hasRequiredSrc$5;function requireSrc$5(){if(hasRequiredSrc$5)return src$5;hasRequiredSrc$5=1;const e=requireBMPEncoder();return src$5.encode=function(t){return new e(t).encode()},src$5}var srcExports$3=requireSrc$5();/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(e){let r=e.length;for(;--r>=0;)e[r]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(e,r,t,i,n){this.static_tree=e,this.extra_bits=r,this.extra_base=t,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}const d_code=e=>e<256?_dist_code[e]:_dist_code[256+(e>>>7)],put_short=(e,r)=>{e.pending_buf[e.pending++]=r&255,e.pending_buf[e.pending++]=r>>>8&255},send_bits=(e,r,t)=>{e.bi_valid>Buf_size-t?(e.bi_buf|=r<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=r>>Buf_size-e.bi_valid,e.bi_valid+=t-Buf_size):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=t)},send_code=(e,r,t)=>{send_bits(e,t[r*2],t[r*2+1])},bi_reverse=(e,r)=>{let t=0;do t|=e&1,e>>>=1,t<<=1;while(--r>0);return t>>>1},bi_flush=e=>{e.bi_valid===16?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},gen_bitlen=(e,r)=>{const t=r.dyn_tree,i=r.max_code,n=r.stat_desc.static_tree,s=r.stat_desc.has_stree,a=r.stat_desc.extra_bits,h=r.stat_desc.extra_base,d=r.stat_desc.max_length;let u,g,_,w,p,b,y=0;for(w=0;w<=MAX_BITS$1;w++)e.bl_count[w]=0;for(t[e.heap[e.heap_max]*2+1]=0,u=e.heap_max+1;u<HEAP_SIZE$1;u++)g=e.heap[u],w=t[t[g*2+1]*2+1]+1,w>d&&(w=d,y++),t[g*2+1]=w,!(g>i)&&(e.bl_count[w]++,p=0,g>=h&&(p=a[g-h]),b=t[g*2],e.opt_len+=b*(w+p),s&&(e.static_len+=b*(n[g*2+1]+p)));if(y!==0){do{for(w=d-1;e.bl_count[w]===0;)w--;e.bl_count[w]--,e.bl_count[w+1]+=2,e.bl_count[d]--,y-=2}while(y>0);for(w=d;w!==0;w--)for(g=e.bl_count[w];g!==0;)_=e.heap[--u],!(_>i)&&(t[_*2+1]!==w&&(e.opt_len+=(w-t[_*2+1])*t[_*2],t[_*2+1]=w),g--)}},gen_codes=(e,r,t)=>{const i=new Array(MAX_BITS$1+1);let n=0,s,a;for(s=1;s<=MAX_BITS$1;s++)n=n+t[s-1]<<1,i[s]=n;for(a=0;a<=r;a++){let h=e[a*2+1];h!==0&&(e[a*2]=bi_reverse(i[h]++,h))}},tr_static_init=()=>{let e,r,t,i,n;const s=new Array(MAX_BITS$1+1);for(t=0,i=0;i<LENGTH_CODES$1-1;i++)for(base_length[i]=t,e=0;e<1<<extra_lbits[i];e++)_length_code[t++]=i;for(_length_code[t-1]=i,n=0,i=0;i<16;i++)for(base_dist[i]=n,e=0;e<1<<extra_dbits[i];e++)_dist_code[n++]=i;for(n>>=7;i<D_CODES$1;i++)for(base_dist[i]=n<<7,e=0;e<1<<extra_dbits[i]-7;e++)_dist_code[256+n++]=i;for(r=0;r<=MAX_BITS$1;r++)s[r]=0;for(e=0;e<=143;)static_ltree[e*2+1]=8,e++,s[8]++;for(;e<=255;)static_ltree[e*2+1]=9,e++,s[9]++;for(;e<=279;)static_ltree[e*2+1]=7,e++,s[7]++;for(;e<=287;)static_ltree[e*2+1]=8,e++,s[8]++;for(gen_codes(static_ltree,L_CODES$1+1,s),e=0;e<D_CODES$1;e++)static_dtree[e*2+1]=5,static_dtree[e*2]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=e=>{let r;for(r=0;r<L_CODES$1;r++)e.dyn_ltree[r*2]=0;for(r=0;r<D_CODES$1;r++)e.dyn_dtree[r*2]=0;for(r=0;r<BL_CODES$1;r++)e.bl_tree[r*2]=0;e.dyn_ltree[END_BLOCK*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},bi_windup=e=>{e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},smaller=(e,r,t,i)=>{const n=r*2,s=t*2;return e[n]<e[s]||e[n]===e[s]&&i[r]<=i[t]},pqdownheap=(e,r,t)=>{const i=e.heap[t];let n=t<<1;for(;n<=e.heap_len&&(n<e.heap_len&&smaller(r,e.heap[n+1],e.heap[n],e.depth)&&n++,!smaller(r,i,e.heap[n],e.depth));)e.heap[t]=e.heap[n],t=n,n<<=1;e.heap[t]=i},compress_block=(e,r,t)=>{let i,n,s=0,a,h;if(e.sym_next!==0)do i=e.pending_buf[e.sym_buf+s++]&255,i+=(e.pending_buf[e.sym_buf+s++]&255)<<8,n=e.pending_buf[e.sym_buf+s++],i===0?send_code(e,n,r):(a=_length_code[n],send_code(e,a+LITERALS$1+1,r),h=extra_lbits[a],h!==0&&(n-=base_length[a],send_bits(e,n,h)),i--,a=d_code(i),send_code(e,a,t),h=extra_dbits[a],h!==0&&(i-=base_dist[a],send_bits(e,i,h)));while(s<e.sym_next);send_code(e,END_BLOCK,r)},build_tree=(e,r)=>{const t=r.dyn_tree,i=r.stat_desc.static_tree,n=r.stat_desc.has_stree,s=r.stat_desc.elems;let a,h,d=-1,u;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1,a=0;a<s;a++)t[a*2]!==0?(e.heap[++e.heap_len]=d=a,e.depth[a]=0):t[a*2+1]=0;for(;e.heap_len<2;)u=e.heap[++e.heap_len]=d<2?++d:0,t[u*2]=1,e.depth[u]=0,e.opt_len--,n&&(e.static_len-=i[u*2+1]);for(r.max_code=d,a=e.heap_len>>1;a>=1;a--)pqdownheap(e,t,a);u=s;do a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,t,1),h=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=h,t[u*2]=t[a*2]+t[h*2],e.depth[u]=(e.depth[a]>=e.depth[h]?e.depth[a]:e.depth[h])+1,t[a*2+1]=t[h*2+1]=u,e.heap[1]=u++,pqdownheap(e,t,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,r),gen_codes(t,d,e.bl_count)},scan_tree=(e,r,t)=>{let i,n=-1,s,a=r[0*2+1],h=0,d=7,u=4;for(a===0&&(d=138,u=3),r[(t+1)*2+1]=65535,i=0;i<=t;i++)s=a,a=r[(i+1)*2+1],!(++h<d&&s===a)&&(h<u?e.bl_tree[s*2]+=h:s!==0?(s!==n&&e.bl_tree[s*2]++,e.bl_tree[REP_3_6*2]++):h<=10?e.bl_tree[REPZ_3_10*2]++:e.bl_tree[REPZ_11_138*2]++,h=0,n=s,a===0?(d=138,u=3):s===a?(d=6,u=3):(d=7,u=4))},send_tree=(e,r,t)=>{let i,n=-1,s,a=r[0*2+1],h=0,d=7,u=4;for(a===0&&(d=138,u=3),i=0;i<=t;i++)if(s=a,a=r[(i+1)*2+1],!(++h<d&&s===a)){if(h<u)do send_code(e,s,e.bl_tree);while(--h!==0);else s!==0?(s!==n&&(send_code(e,s,e.bl_tree),h--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,h-3,2)):h<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,h-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,h-11,7));h=0,n=s,a===0?(d=138,u=3):s===a?(d=6,u=3):(d=7,u=4)}},build_bl_tree=e=>{let r;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),r=BL_CODES$1-1;r>=3&&e.bl_tree[bl_order[r]*2+1]===0;r--);return e.opt_len+=3*(r+1)+5+5+4,r},send_all_trees=(e,r,t,i)=>{let n;for(send_bits(e,r-257,5),send_bits(e,t-1,5),send_bits(e,i-4,4),n=0;n<i;n++)send_bits(e,e.bl_tree[bl_order[n]*2+1],3);send_tree(e,e.dyn_ltree,r-1),send_tree(e,e.dyn_dtree,t-1)},detect_data_type=e=>{let r=4093624447,t;for(t=0;t<=31;t++,r>>>=1)if(r&1&&e.dyn_ltree[t*2]!==0)return Z_BINARY;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return Z_TEXT;for(t=32;t<LITERALS$1;t++)if(e.dyn_ltree[t*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=e=>{static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)},_tr_stored_block$1=(e,r,t,i)=>{send_bits(e,(STORED_BLOCK<<1)+(i?1:0),3),bi_windup(e),put_short(e,t),put_short(e,~t),t&&e.pending_buf.set(e.window.subarray(r,r+t),e.pending),e.pending+=t},_tr_align$1=e=>{send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)},_tr_flush_block$1=(e,r,t,i)=>{let n,s,a=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),a=build_bl_tree(e),n=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=n&&(n=s)):n=s=t+5,t+4<=n&&r!==-1?_tr_stored_block$1(e,r,t,i):e.strategy===Z_FIXED$1||s===n?(send_bits(e,(STATIC_TREES<<1)+(i?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(i?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),i&&bi_windup(e)},_tr_tally$1=(e,r,t)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=t,r===0?e.dyn_ltree[t*2]++:(e.matches++,r--,e.dyn_ltree[(_length_code[t]+LITERALS$1+1)*2]++,e.dyn_dtree[d_code(r)*2]++),e.sym_next===e.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(e,r,t,i)=>{let n=e&65535|0,s=e>>>16&65535|0,a=0;for(;t!==0;){a=t>2e3?2e3:t,t-=a;do n=n+r[i++]|0,s=s+n|0;while(--a);n%=65521,s%=65521}return n|s<<16|0};var adler32_1=adler32;const makeTable=()=>{let e,r=[];for(var t=0;t<256;t++){e=t;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;r[t]=e}return r},crcTable$1=new Uint32Array(makeTable()),crc32=(e,r,t,i)=>{const n=crcTable$1,s=i+t;e^=-1;for(let a=i;a<s;a++)e=e>>>8^n[(e^r[a])&255];return e^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(e,r)=>(e.msg=messages[r],r),rank=e=>e*2-(e>4?9:0),zero=e=>{let r=e.length;for(;--r>=0;)e[r]=0},slide_hash=e=>{let r,t,i,n=e.w_size;r=e.hash_size,i=r;do t=e.head[--i],e.head[i]=t>=n?t-n:0;while(--r);r=n,i=r;do t=e.prev[--i],e.prev[i]=t>=n?t-n:0;while(--r)};let HASH_ZLIB=(e,r,t)=>(r<<e.hash_shift^t)&e.hash_mask,HASH=HASH_ZLIB;const flush_pending=e=>{const r=e.state;let t=r.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+t),e.next_out),e.next_out+=t,r.pending_out+=t,e.total_out+=t,e.avail_out-=t,r.pending-=t,r.pending===0&&(r.pending_out=0))},flush_block_only=(e,r)=>{_tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,flush_pending(e.strm)},put_byte=(e,r)=>{e.pending_buf[e.pending++]=r},putShortMSB=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=r&255},read_buf=(e,r,t,i)=>{let n=e.avail_in;return n>i&&(n=i),n===0?0:(e.avail_in-=n,r.set(e.input.subarray(e.next_in,e.next_in+n),t),e.state.wrap===1?e.adler=adler32_1(e.adler,r,n,t):e.state.wrap===2&&(e.adler=crc32_1(e.adler,r,n,t)),e.next_in+=n,e.total_in+=n,n)},longest_match=(e,r)=>{let t=e.max_chain_length,i=e.strstart,n,s,a=e.prev_length,h=e.nice_match;const d=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,u=e.window,g=e.w_mask,_=e.prev,w=e.strstart+MAX_MATCH;let p=u[i+a-1],b=u[i+a];e.prev_length>=e.good_match&&(t>>=2),h>e.lookahead&&(h=e.lookahead);do if(n=r,!(u[n+a]!==b||u[n+a-1]!==p||u[n]!==u[i]||u[++n]!==u[i+1])){i+=2,n++;do;while(u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&i<w);if(s=MAX_MATCH-(w-i),i=w-MAX_MATCH,s>a){if(e.match_start=r,a=s,s>=h)break;p=u[i+a-1],b=u[i+a]}}while((r=_[r&g])>d&&--t!==0);return a<=e.lookahead?a:e.lookahead},fill_window=e=>{const r=e.w_size;let t,i,n;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-MIN_LOOKAHEAD)&&(e.window.set(e.window.subarray(r,r+r-i),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),slide_hash(e),i+=r),e.strm.avail_in===0)break;if(t=read_buf(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=t,e.lookahead+e.insert>=MIN_MATCH)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=HASH(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=HASH(e,e.ins_h,e.window[n+MIN_MATCH-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH)););}while(e.lookahead<MIN_LOOKAHEAD&&e.strm.avail_in!==0)},deflate_stored=(e,r)=>{let t=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,i,n,s,a=0,h=e.strm.avail_in;do{if(i=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,n=e.strstart-e.block_start,i>n+e.strm.avail_in&&(i=n+e.strm.avail_in),i>s&&(i=s),i<t&&(i===0&&r!==Z_FINISH$3||r===Z_NO_FLUSH$2||i!==n+e.strm.avail_in)))break;a=r===Z_FINISH$3&&i===n+e.strm.avail_in?1:0,_tr_stored_block(e,0,0,a),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,flush_pending(e.strm),n&&(n>i&&(n=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,i-=n),i&&(read_buf(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(a===0);return h-=e.strm.avail_in,h&&(h>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=h&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-h,e.strm.next_in),e.strstart),e.strstart+=h,e.insert+=h>e.w_size-e.insert?e.w_size-e.insert:h),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?BS_FINISH_DONE:r!==Z_NO_FLUSH$2&&r!==Z_FINISH$3&&e.strm.avail_in===0&&e.strstart===e.block_start?BS_BLOCK_DONE:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(read_buf(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,t=s>e.w_size?e.w_size:s,n=e.strstart-e.block_start,(n>=t||(n||r===Z_FINISH$3)&&r!==Z_NO_FLUSH$2&&e.strm.avail_in===0&&n<=s)&&(i=n>s?s:n,a=r===Z_FINISH$3&&e.strm.avail_in===0&&i===n?1:0,_tr_stored_block(e,e.block_start,i,a),e.block_start+=i,flush_pending(e.strm)),a?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(e,r)=>{let t,i;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&r===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(t=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),t!==0&&e.strstart-t<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,t)),e.match_length>=MIN_MATCH)if(i=_tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH){e.match_length--;do e.strstart++,e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+1]);else i=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,r===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(e,r)=>{let t,i,n;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&r===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(t=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH-1,t!==0&&e.prev_length<e.max_lazy_match&&e.strstart-t<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,t),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH-1)),e.prev_length>=MIN_MATCH&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-MIN_MATCH,i=_tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=n&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=MIN_MATCH-1,e.strstart++,i&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}else if(e.match_available){if(i=_tr_tally(e,0,e.window[e.strstart-1]),i&&flush_block_only(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=_tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,r===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(e,r)=>{let t,i,n,s;const a=e.window;for(;;){if(e.lookahead<=MAX_MATCH){if(fill_window(e),e.lookahead<=MAX_MATCH&&r===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=MIN_MATCH&&e.strstart>0&&(n=e.strstart-1,i=a[n],i===a[++n]&&i===a[++n]&&i===a[++n])){s=e.strstart+MAX_MATCH;do;while(i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&n<s);e.match_length=MAX_MATCH-(s-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH?(t=_tr_tally(e,1,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(t=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),t&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,r===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(e,r)=>{let t;for(;;){if(e.lookahead===0&&(fill_window(e),e.lookahead===0)){if(r===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(e.match_length=0,t=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,t&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,r===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(e,r,t,i,n){this.good_length=e,this.max_lazy=r,this.nice_length=t,this.max_chain=i,this.func=n}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=e=>{e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH-1,e.match_available=0,e.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.status!==INIT_STATE&&r.status!==GZIP_STATE&&r.status!==EXTRA_STATE&&r.status!==NAME_STATE&&r.status!==COMMENT_STATE&&r.status!==HCRC_STATE&&r.status!==BUSY_STATE&&r.status!==FINISH_STATE?1:0},deflateResetKeep=e=>{if(deflateStateCheck(e))return err(e,Z_STREAM_ERROR$2);e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN;const r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?GZIP_STATE:r.wrap?INIT_STATE:BUSY_STATE,e.adler=r.wrap===2?0:1,r.last_flush=-2,_tr_init(r),Z_OK$3},deflateReset=e=>{const r=deflateResetKeep(e);return r===Z_OK$3&&lm_init(e.state),r},deflateSetHeader=(e,r)=>deflateStateCheck(e)||e.state.wrap!==2?Z_STREAM_ERROR$2:(e.state.gzhead=r,Z_OK$3),deflateInit2=(e,r,t,i,n,s)=>{if(!e)return Z_STREAM_ERROR$2;let a=1;if(r===Z_DEFAULT_COMPRESSION$1&&(r=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),n<1||n>MAX_MEM_LEVEL||t!==Z_DEFLATED$2||i<8||i>15||r<0||r>9||s<0||s>Z_FIXED||i===8&&a!==1)return err(e,Z_STREAM_ERROR$2);i===8&&(i=9);const h=new DeflateState;return e.state=h,h.strm=e,h.status=INIT_STATE,h.wrap=a,h.gzhead=null,h.w_bits=i,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=n+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+MIN_MATCH-1)/MIN_MATCH),h.window=new Uint8Array(h.w_size*2),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<n+6,h.pending_buf_size=h.lit_bufsize*4,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=(h.lit_bufsize-1)*3,h.level=r,h.strategy=s,h.method=t,deflateReset(e)},deflateInit=(e,r)=>deflateInit2(e,r,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(e,r)=>{if(deflateStateCheck(e)||r>Z_BLOCK$1||r<0)return e?err(e,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const t=e.state;if(!e.output||e.avail_in!==0&&!e.input||t.status===FINISH_STATE&&r!==Z_FINISH$3)return err(e,e.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const i=t.last_flush;if(t.last_flush=r,t.pending!==0){if(flush_pending(e),e.avail_out===0)return t.last_flush=-1,Z_OK$3}else if(e.avail_in===0&&rank(r)<=rank(i)&&r!==Z_FINISH$3)return err(e,Z_BUF_ERROR$1);if(t.status===FINISH_STATE&&e.avail_in!==0)return err(e,Z_BUF_ERROR$1);if(t.status===INIT_STATE&&t.wrap===0&&(t.status=BUSY_STATE),t.status===INIT_STATE){let n=Z_DEFLATED$2+(t.w_bits-8<<4)<<8,s=-1;if(t.strategy>=Z_HUFFMAN_ONLY||t.level<2?s=0:t.level<6?s=1:t.level===6?s=2:s=3,n|=s<<6,t.strstart!==0&&(n|=PRESET_DICT),n+=31-n%31,putShortMSB(t,n),t.strstart!==0&&(putShortMSB(t,e.adler>>>16),putShortMSB(t,e.adler&65535)),e.adler=1,t.status=BUSY_STATE,flush_pending(e),t.pending!==0)return t.last_flush=-1,Z_OK$3}if(t.status===GZIP_STATE){if(e.adler=0,put_byte(t,31),put_byte(t,139),put_byte(t,8),t.gzhead)put_byte(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),put_byte(t,t.gzhead.time&255),put_byte(t,t.gzhead.time>>8&255),put_byte(t,t.gzhead.time>>16&255),put_byte(t,t.gzhead.time>>24&255),put_byte(t,t.level===9?2:t.strategy>=Z_HUFFMAN_ONLY||t.level<2?4:0),put_byte(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(put_byte(t,t.gzhead.extra.length&255),put_byte(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=EXTRA_STATE;else if(put_byte(t,0),put_byte(t,0),put_byte(t,0),put_byte(t,0),put_byte(t,0),put_byte(t,t.level===9?2:t.strategy>=Z_HUFFMAN_ONLY||t.level<2?4:0),put_byte(t,OS_CODE),t.status=BUSY_STATE,flush_pending(e),t.pending!==0)return t.last_flush=-1,Z_OK$3}if(t.status===EXTRA_STATE){if(t.gzhead.extra){let n=t.pending,s=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+s>t.pending_buf_size;){let h=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+h),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>n&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending-n,n)),t.gzindex+=h,flush_pending(e),t.pending!==0)return t.last_flush=-1,Z_OK$3;n=0,s-=h}let a=new Uint8Array(t.gzhead.extra);t.pending_buf.set(a.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending+=s,t.gzhead.hcrc&&t.pending>n&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending-n,n)),t.gzindex=0}t.status=NAME_STATE}if(t.status===NAME_STATE){if(t.gzhead.name){let n=t.pending,s;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>n&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending-n,n)),flush_pending(e),t.pending!==0)return t.last_flush=-1,Z_OK$3;n=0}t.gzindex<t.gzhead.name.length?s=t.gzhead.name.charCodeAt(t.gzindex++)&255:s=0,put_byte(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>n&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending-n,n)),t.gzindex=0}t.status=COMMENT_STATE}if(t.status===COMMENT_STATE){if(t.gzhead.comment){let n=t.pending,s;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>n&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending-n,n)),flush_pending(e),t.pending!==0)return t.last_flush=-1,Z_OK$3;n=0}t.gzindex<t.gzhead.comment.length?s=t.gzhead.comment.charCodeAt(t.gzindex++)&255:s=0,put_byte(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>n&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending-n,n))}t.status=HCRC_STATE}if(t.status===HCRC_STATE){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(flush_pending(e),t.pending!==0))return t.last_flush=-1,Z_OK$3;put_byte(t,e.adler&255),put_byte(t,e.adler>>8&255),e.adler=0}if(t.status=BUSY_STATE,flush_pending(e),t.pending!==0)return t.last_flush=-1,Z_OK$3}if(e.avail_in!==0||t.lookahead!==0||r!==Z_NO_FLUSH$2&&t.status!==FINISH_STATE){let n=t.level===0?deflate_stored(t,r):t.strategy===Z_HUFFMAN_ONLY?deflate_huff(t,r):t.strategy===Z_RLE?deflate_rle(t,r):configuration_table[t.level].func(t,r);if((n===BS_FINISH_STARTED||n===BS_FINISH_DONE)&&(t.status=FINISH_STATE),n===BS_NEED_MORE||n===BS_FINISH_STARTED)return e.avail_out===0&&(t.last_flush=-1),Z_OK$3;if(n===BS_BLOCK_DONE&&(r===Z_PARTIAL_FLUSH?_tr_align(t):r!==Z_BLOCK$1&&(_tr_stored_block(t,0,0,!1),r===Z_FULL_FLUSH$1&&(zero(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),flush_pending(e),e.avail_out===0))return t.last_flush=-1,Z_OK$3}return r!==Z_FINISH$3?Z_OK$3:t.wrap<=0?Z_STREAM_END$3:(t.wrap===2?(put_byte(t,e.adler&255),put_byte(t,e.adler>>8&255),put_byte(t,e.adler>>16&255),put_byte(t,e.adler>>24&255),put_byte(t,e.total_in&255),put_byte(t,e.total_in>>8&255),put_byte(t,e.total_in>>16&255),put_byte(t,e.total_in>>24&255)):(putShortMSB(t,e.adler>>>16),putShortMSB(t,e.adler&65535)),flush_pending(e),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=e=>{if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const r=e.state.status;return e.state=null,r===BUSY_STATE?err(e,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(e,r)=>{let t=r.length;if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const i=e.state,n=i.wrap;if(n===2||n===1&&i.status!==INIT_STATE||i.lookahead)return Z_STREAM_ERROR$2;if(n===1&&(e.adler=adler32_1(e.adler,r,t,0)),i.wrap=0,t>=i.w_size){n===0&&(zero(i.head),i.strstart=0,i.block_start=0,i.insert=0);let d=new Uint8Array(i.w_size);d.set(r.subarray(t-i.w_size,t),0),r=d,t=i.w_size}const s=e.avail_in,a=e.next_in,h=e.input;for(e.avail_in=t,e.next_in=0,e.input=r,fill_window(i);i.lookahead>=MIN_MATCH;){let d=i.strstart,u=i.lookahead-(MIN_MATCH-1);do i.ins_h=HASH(i,i.ins_h,i.window[d+MIN_MATCH-1]),i.prev[d&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=d,d++;while(--u);i.strstart=d,i.lookahead=MIN_MATCH-1,fill_window(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=MIN_MATCH-1,i.match_available=0,e.next_in=a,e.input=h,e.avail_in=s,i.wrap=n,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var assign=function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const t=r.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)_has(t,i)&&(e[i]=t[i])}}return e},flattenChunks=e=>{let r=0;for(let i=0,n=e.length;i<n;i++)r+=e[i].length;const t=new Uint8Array(r);for(let i=0,n=0,s=e.length;i<s;i++){let a=e[i];t.set(a,n),n+=a.length}return t},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,t,i,n,s,a=e.length,h=0;for(n=0;n<a;n++)t=e.charCodeAt(n),(t&64512)===55296&&n+1<a&&(i=e.charCodeAt(n+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),n++)),h+=t<128?1:t<2048?2:t<65536?3:4;for(r=new Uint8Array(h),s=0,n=0;s<h;n++)t=e.charCodeAt(n),(t&64512)===55296&&n+1<a&&(i=e.charCodeAt(n+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),n++)),t<128?r[s++]=t:t<2048?(r[s++]=192|t>>>6,r[s++]=128|t&63):t<65536?(r[s++]=224|t>>>12,r[s++]=128|t>>>6&63,r[s++]=128|t&63):(r[s++]=240|t>>>18,r[s++]=128|t>>>12&63,r[s++]=128|t>>>6&63,r[s++]=128|t&63);return r};const buf2binstring=(e,r)=>{if(r<65534&&e.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,e.length===r?e:e.subarray(0,r));let t="";for(let i=0;i<r;i++)t+=String.fromCharCode(e[i]);return t};var buf2string=(e,r)=>{const t=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let i,n;const s=new Array(t*2);for(n=0,i=0;i<t;){let a=e[i++];if(a<128){s[n++]=a;continue}let h=_utf8len[a];if(h>4){s[n++]=65533,i+=h-1;continue}for(a&=h===2?31:h===3?15:7;h>1&&i<t;)a=a<<6|e[i++]&63,h--;if(h>1){s[n++]=65533;continue}a<65536?s[n++]=a:(a-=65536,s[n++]=55296|a>>10&1023,s[n++]=56320|a&1023)}return buf2binstring(s,n)},utf8border=(e,r)=>{r=r||e.length,r>e.length&&(r=e.length);let t=r-1;for(;t>=0&&(e[t]&192)===128;)t--;return t<0||t===0?r:t+_utf8len[e[t]]>r?t:r},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(e){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let t=deflate_1$2.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(t!==Z_OK$2)throw new Error(messages[t]);if(r.header&&deflate_1$2.deflateSetHeader(this.strm,r.header),r.dictionary){let i;if(typeof r.dictionary=="string"?i=strings.string2buf(r.dictionary):toString$1.call(r.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(r.dictionary):i=r.dictionary,t=deflate_1$2.deflateSetDictionary(this.strm,i),t!==Z_OK$2)throw new Error(messages[t]);this._dict_set=!0}}Deflate$1.prototype.push=function(e,r){const t=this.strm,i=this.options.chunkSize;let n,s;if(this.ended)return!1;for(r===~~r?s=r:s=r===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof e=="string"?t.input=strings.string2buf(e):toString$1.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),(s===Z_SYNC_FLUSH||s===Z_FULL_FLUSH)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(n=deflate_1$2.deflate(t,s),n===Z_STREAM_END$2)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),n=deflate_1$2.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Z_OK$2;if(t.avail_out===0){this.onData(t.output);continue}if(s>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(e){this.chunks.push(e)};Deflate$1.prototype.onEnd=function(e){e===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function deflate$1(e,r){const t=new Deflate$1(r);if(t.push(e,!0),t.err)throw t.msg||messages[t.err];return t.result}var deflate_2=deflate$1,deflate_1$1={deflate:deflate_2};const BAD$1=16209,TYPE$1=16191;var inffast=function(r,t){let i,n,s,a,h,d,u,g,_,w,p,b,y,M,A,C,v,E,R,$,L,D,B,P;const O=r.state;i=r.next_in,B=r.input,n=i+(r.avail_in-5),s=r.next_out,P=r.output,a=s-(t-r.avail_out),h=s+(r.avail_out-257),d=O.dmax,u=O.wsize,g=O.whave,_=O.wnext,w=O.window,p=O.hold,b=O.bits,y=O.lencode,M=O.distcode,A=(1<<O.lenbits)-1,C=(1<<O.distbits)-1;e:do{b<15&&(p+=B[i++]<<b,b+=8,p+=B[i++]<<b,b+=8),v=y[p&A];t:for(;;){if(E=v>>>24,p>>>=E,b-=E,E=v>>>16&255,E===0)P[s++]=v&65535;else if(E&16){R=v&65535,E&=15,E&&(b<E&&(p+=B[i++]<<b,b+=8),R+=p&(1<<E)-1,p>>>=E,b-=E),b<15&&(p+=B[i++]<<b,b+=8,p+=B[i++]<<b,b+=8),v=M[p&C];r:for(;;){if(E=v>>>24,p>>>=E,b-=E,E=v>>>16&255,E&16){if($=v&65535,E&=15,b<E&&(p+=B[i++]<<b,b+=8,b<E&&(p+=B[i++]<<b,b+=8)),$+=p&(1<<E)-1,$>d){r.msg="invalid distance too far back",O.mode=BAD$1;break e}if(p>>>=E,b-=E,E=s-a,$>E){if(E=$-E,E>g&&O.sane){r.msg="invalid distance too far back",O.mode=BAD$1;break e}if(L=0,D=w,_===0){if(L+=u-E,E<R){R-=E;do P[s++]=w[L++];while(--E);L=s-$,D=P}}else if(_<E){if(L+=u+_-E,E-=_,E<R){R-=E;do P[s++]=w[L++];while(--E);if(L=0,_<R){E=_,R-=E;do P[s++]=w[L++];while(--E);L=s-$,D=P}}}else if(L+=_-E,E<R){R-=E;do P[s++]=w[L++];while(--E);L=s-$,D=P}for(;R>2;)P[s++]=D[L++],P[s++]=D[L++],P[s++]=D[L++],R-=3;R&&(P[s++]=D[L++],R>1&&(P[s++]=D[L++]))}else{L=s-$;do P[s++]=P[L++],P[s++]=P[L++],P[s++]=P[L++],R-=3;while(R>2);R&&(P[s++]=P[L++],R>1&&(P[s++]=P[L++]))}}else if((E&64)===0){v=M[(v&65535)+(p&(1<<E)-1)];continue r}else{r.msg="invalid distance code",O.mode=BAD$1;break e}break}}else if((E&64)===0){v=y[(v&65535)+(p&(1<<E)-1)];continue t}else if(E&32){O.mode=TYPE$1;break e}else{r.msg="invalid literal/length code",O.mode=BAD$1;break e}break}}while(i<n&&s<h);R=b>>3,i-=R,b-=R<<3,p&=(1<<b)-1,r.next_in=i,r.next_out=s,r.avail_in=i<n?5+(n-i):5-(i-n),r.avail_out=s<h?257+(h-s):257-(s-h),O.hold=p,O.bits=b};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(e,r,t,i,n,s,a,h)=>{const d=h.bits;let u=0,g=0,_=0,w=0,p=0,b=0,y=0,M=0,A=0,C=0,v,E,R,$,L,D=null,B;const P=new Uint16Array(MAXBITS+1),O=new Uint16Array(MAXBITS+1);let Y=null,te,H,J;for(u=0;u<=MAXBITS;u++)P[u]=0;for(g=0;g<i;g++)P[r[t+g]]++;for(p=d,w=MAXBITS;w>=1&&P[w]===0;w--);if(p>w&&(p=w),w===0)return n[s++]=1<<24|64<<16|0,n[s++]=1<<24|64<<16|0,h.bits=1,0;for(_=1;_<w&&P[_]===0;_++);for(p<_&&(p=_),M=1,u=1;u<=MAXBITS;u++)if(M<<=1,M-=P[u],M<0)return-1;if(M>0&&(e===CODES$1||w!==1))return-1;for(O[1]=0,u=1;u<MAXBITS;u++)O[u+1]=O[u]+P[u];for(g=0;g<i;g++)r[t+g]!==0&&(a[O[r[t+g]]++]=g);if(e===CODES$1?(D=Y=a,B=20):e===LENS$1?(D=lbase,Y=lext,B=257):(D=dbase,Y=dext,B=0),C=0,g=0,u=_,L=s,b=p,y=0,R=-1,A=1<<p,$=A-1,e===LENS$1&&A>ENOUGH_LENS$1||e===DISTS$1&&A>ENOUGH_DISTS$1)return 1;for(;;){te=u-y,a[g]+1<B?(H=0,J=a[g]):a[g]>=B?(H=Y[a[g]-B],J=D[a[g]-B]):(H=96,J=0),v=1<<u-y,E=1<<b,_=E;do E-=v,n[L+(C>>y)+E]=te<<24|H<<16|J|0;while(E!==0);for(v=1<<u-1;C&v;)v>>=1;if(v!==0?(C&=v-1,C+=v):C=0,g++,--P[u]===0){if(u===w)break;u=r[t+a[g]]}if(u>p&&(C&$)!==R){for(y===0&&(y=p),L+=_,b=u-y,M=1<<b;b+y<w&&(M-=P[b+y],!(M<=0));)b++,M<<=1;if(A+=1<<b,e===LENS$1&&A>ENOUGH_LENS$1||e===DISTS$1&&A>ENOUGH_DISTS$1)return 1;R=C&$,n[R]=p<<24|b<<16|L-s|0}}return C!==0&&(n[L+C]=u-y<<24|64<<16|0),h.bits=p,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.mode<HEAD||r.mode>SYNC?1:0},inflateResetKeep=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=r.wrap&1),r.mode=HEAD,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(ENOUGH_LENS),r.distcode=r.distdyn=new Int32Array(ENOUGH_DISTS),r.sane=1,r.back=-1,Z_OK$1},inflateReset=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,inflateResetKeep(e)},inflateReset2=(e,r)=>{let t;if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const i=e.state;return r<0?(t=0,r=-r):(t=(r>>4)+5,r<48&&(r&=15)),r&&(r<8||r>15)?Z_STREAM_ERROR$1:(i.window!==null&&i.wbits!==r&&(i.window=null),i.wrap=t,i.wbits=r,inflateReset(e))},inflateInit2=(e,r)=>{if(!e)return Z_STREAM_ERROR$1;const t=new InflateState;e.state=t,t.strm=e,t.window=null,t.mode=HEAD;const i=inflateReset2(e,r);return i!==Z_OK$1&&(e.state=null),i},inflateInit=e=>inflateInit2(e,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=e=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(inftrees(LENS,e.lens,0,288,lenfix,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;inftrees(DISTS,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5},updatewindow=(e,r,t,i)=>{let n;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(r.subarray(t-s.wsize,t),0),s.wnext=0,s.whave=s.wsize):(n=s.wsize-s.wnext,n>i&&(n=i),s.window.set(r.subarray(t-i,t-i+n),s.wnext),i-=n,i?(s.window.set(r.subarray(t-i,t),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0},inflate$2=(e,r)=>{let t,i,n,s,a,h,d,u,g,_,w,p,b,y,M=0,A,C,v,E,R,$,L,D;const B=new Uint8Array(4);let P,O;const Y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(e)||!e.output||!e.input&&e.avail_in!==0)return Z_STREAM_ERROR$1;t=e.state,t.mode===TYPE&&(t.mode=TYPEDO),a=e.next_out,n=e.output,d=e.avail_out,s=e.next_in,i=e.input,h=e.avail_in,u=t.hold,g=t.bits,_=h,w=d,D=Z_OK$1;e:for(;;)switch(t.mode){case HEAD:if(t.wrap===0){t.mode=TYPEDO;break}for(;g<16;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}if(t.wrap&2&&u===35615){t.wbits===0&&(t.wbits=15),t.check=0,B[0]=u&255,B[1]=u>>>8&255,t.check=crc32_1(t.check,B,2,0),u=0,g=0,t.mode=FLAGS;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((u&255)<<8)+(u>>8))%31){e.msg="incorrect header check",t.mode=BAD;break}if((u&15)!==Z_DEFLATED){e.msg="unknown compression method",t.mode=BAD;break}if(u>>>=4,g-=4,L=(u&15)+8,t.wbits===0&&(t.wbits=L),L>15||L>t.wbits){e.msg="invalid window size",t.mode=BAD;break}t.dmax=1<<t.wbits,t.flags=0,e.adler=t.check=1,t.mode=u&512?DICTID:TYPE,u=0,g=0;break;case FLAGS:for(;g<16;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}if(t.flags=u,(t.flags&255)!==Z_DEFLATED){e.msg="unknown compression method",t.mode=BAD;break}if(t.flags&57344){e.msg="unknown header flags set",t.mode=BAD;break}t.head&&(t.head.text=u>>8&1),t.flags&512&&t.wrap&4&&(B[0]=u&255,B[1]=u>>>8&255,t.check=crc32_1(t.check,B,2,0)),u=0,g=0,t.mode=TIME;case TIME:for(;g<32;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}t.head&&(t.head.time=u),t.flags&512&&t.wrap&4&&(B[0]=u&255,B[1]=u>>>8&255,B[2]=u>>>16&255,B[3]=u>>>24&255,t.check=crc32_1(t.check,B,4,0)),u=0,g=0,t.mode=OS;case OS:for(;g<16;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}t.head&&(t.head.xflags=u&255,t.head.os=u>>8),t.flags&512&&t.wrap&4&&(B[0]=u&255,B[1]=u>>>8&255,t.check=crc32_1(t.check,B,2,0)),u=0,g=0,t.mode=EXLEN;case EXLEN:if(t.flags&1024){for(;g<16;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}t.length=u,t.head&&(t.head.extra_len=u),t.flags&512&&t.wrap&4&&(B[0]=u&255,B[1]=u>>>8&255,t.check=crc32_1(t.check,B,2,0)),u=0,g=0}else t.head&&(t.head.extra=null);t.mode=EXTRA;case EXTRA:if(t.flags&1024&&(p=t.length,p>h&&(p=h),p&&(t.head&&(L=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(s,s+p),L)),t.flags&512&&t.wrap&4&&(t.check=crc32_1(t.check,i,p,s)),h-=p,s+=p,t.length-=p),t.length))break e;t.length=0,t.mode=NAME;case NAME:if(t.flags&2048){if(h===0)break e;p=0;do L=i[s+p++],t.head&&L&&t.length<65536&&(t.head.name+=String.fromCharCode(L));while(L&&p<h);if(t.flags&512&&t.wrap&4&&(t.check=crc32_1(t.check,i,p,s)),h-=p,s+=p,L)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=COMMENT;case COMMENT:if(t.flags&4096){if(h===0)break e;p=0;do L=i[s+p++],t.head&&L&&t.length<65536&&(t.head.comment+=String.fromCharCode(L));while(L&&p<h);if(t.flags&512&&t.wrap&4&&(t.check=crc32_1(t.check,i,p,s)),h-=p,s+=p,L)break e}else t.head&&(t.head.comment=null);t.mode=HCRC;case HCRC:if(t.flags&512){for(;g<16;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}if(t.wrap&4&&u!==(t.check&65535)){e.msg="header crc mismatch",t.mode=BAD;break}u=0,g=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),e.adler=t.check=0,t.mode=TYPE;break;case DICTID:for(;g<32;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}e.adler=t.check=zswap32(u),u=0,g=0,t.mode=DICT;case DICT:if(t.havedict===0)return e.next_out=a,e.avail_out=d,e.next_in=s,e.avail_in=h,t.hold=u,t.bits=g,Z_NEED_DICT$1;e.adler=t.check=1,t.mode=TYPE;case TYPE:if(r===Z_BLOCK||r===Z_TREES)break e;case TYPEDO:if(t.last){u>>>=g&7,g-=g&7,t.mode=CHECK;break}for(;g<3;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}switch(t.last=u&1,u>>>=1,g-=1,u&3){case 0:t.mode=STORED;break;case 1:if(fixedtables(t),t.mode=LEN_,r===Z_TREES){u>>>=2,g-=2;break e}break;case 2:t.mode=TABLE;break;case 3:e.msg="invalid block type",t.mode=BAD}u>>>=2,g-=2;break;case STORED:for(u>>>=g&7,g-=g&7;g<32;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}if((u&65535)!==(u>>>16^65535)){e.msg="invalid stored block lengths",t.mode=BAD;break}if(t.length=u&65535,u=0,g=0,t.mode=COPY_,r===Z_TREES)break e;case COPY_:t.mode=COPY;case COPY:if(p=t.length,p){if(p>h&&(p=h),p>d&&(p=d),p===0)break e;n.set(i.subarray(s,s+p),a),h-=p,s+=p,d-=p,a+=p,t.length-=p;break}t.mode=TYPE;break;case TABLE:for(;g<14;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}if(t.nlen=(u&31)+257,u>>>=5,g-=5,t.ndist=(u&31)+1,u>>>=5,g-=5,t.ncode=(u&15)+4,u>>>=4,g-=4,t.nlen>286||t.ndist>30){e.msg="too many length or distance symbols",t.mode=BAD;break}t.have=0,t.mode=LENLENS;case LENLENS:for(;t.have<t.ncode;){for(;g<3;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}t.lens[Y[t.have++]]=u&7,u>>>=3,g-=3}for(;t.have<19;)t.lens[Y[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,P={bits:t.lenbits},D=inftrees(CODES,t.lens,0,19,t.lencode,0,t.work,P),t.lenbits=P.bits,D){e.msg="invalid code lengths set",t.mode=BAD;break}t.have=0,t.mode=CODELENS;case CODELENS:for(;t.have<t.nlen+t.ndist;){for(;M=t.lencode[u&(1<<t.lenbits)-1],A=M>>>24,C=M>>>16&255,v=M&65535,!(A<=g);){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}if(v<16)u>>>=A,g-=A,t.lens[t.have++]=v;else{if(v===16){for(O=A+2;g<O;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}if(u>>>=A,g-=A,t.have===0){e.msg="invalid bit length repeat",t.mode=BAD;break}L=t.lens[t.have-1],p=3+(u&3),u>>>=2,g-=2}else if(v===17){for(O=A+3;g<O;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}u>>>=A,g-=A,L=0,p=3+(u&7),u>>>=3,g-=3}else{for(O=A+7;g<O;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}u>>>=A,g-=A,L=0,p=11+(u&127),u>>>=7,g-=7}if(t.have+p>t.nlen+t.ndist){e.msg="invalid bit length repeat",t.mode=BAD;break}for(;p--;)t.lens[t.have++]=L}}if(t.mode===BAD)break;if(t.lens[256]===0){e.msg="invalid code -- missing end-of-block",t.mode=BAD;break}if(t.lenbits=9,P={bits:t.lenbits},D=inftrees(LENS,t.lens,0,t.nlen,t.lencode,0,t.work,P),t.lenbits=P.bits,D){e.msg="invalid literal/lengths set",t.mode=BAD;break}if(t.distbits=6,t.distcode=t.distdyn,P={bits:t.distbits},D=inftrees(DISTS,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,P),t.distbits=P.bits,D){e.msg="invalid distances set",t.mode=BAD;break}if(t.mode=LEN_,r===Z_TREES)break e;case LEN_:t.mode=LEN;case LEN:if(h>=6&&d>=258){e.next_out=a,e.avail_out=d,e.next_in=s,e.avail_in=h,t.hold=u,t.bits=g,inffast(e,w),a=e.next_out,n=e.output,d=e.avail_out,s=e.next_in,i=e.input,h=e.avail_in,u=t.hold,g=t.bits,t.mode===TYPE&&(t.back=-1);break}for(t.back=0;M=t.lencode[u&(1<<t.lenbits)-1],A=M>>>24,C=M>>>16&255,v=M&65535,!(A<=g);){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}if(C&&(C&240)===0){for(E=A,R=C,$=v;M=t.lencode[$+((u&(1<<E+R)-1)>>E)],A=M>>>24,C=M>>>16&255,v=M&65535,!(E+A<=g);){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}u>>>=E,g-=E,t.back+=E}if(u>>>=A,g-=A,t.back+=A,t.length=v,C===0){t.mode=LIT;break}if(C&32){t.back=-1,t.mode=TYPE;break}if(C&64){e.msg="invalid literal/length code",t.mode=BAD;break}t.extra=C&15,t.mode=LENEXT;case LENEXT:if(t.extra){for(O=t.extra;g<O;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}t.length+=u&(1<<t.extra)-1,u>>>=t.extra,g-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=DIST;case DIST:for(;M=t.distcode[u&(1<<t.distbits)-1],A=M>>>24,C=M>>>16&255,v=M&65535,!(A<=g);){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}if((C&240)===0){for(E=A,R=C,$=v;M=t.distcode[$+((u&(1<<E+R)-1)>>E)],A=M>>>24,C=M>>>16&255,v=M&65535,!(E+A<=g);){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}u>>>=E,g-=E,t.back+=E}if(u>>>=A,g-=A,t.back+=A,C&64){e.msg="invalid distance code",t.mode=BAD;break}t.offset=v,t.extra=C&15,t.mode=DISTEXT;case DISTEXT:if(t.extra){for(O=t.extra;g<O;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}t.offset+=u&(1<<t.extra)-1,u>>>=t.extra,g-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){e.msg="invalid distance too far back",t.mode=BAD;break}t.mode=MATCH;case MATCH:if(d===0)break e;if(p=w-d,t.offset>p){if(p=t.offset-p,p>t.whave&&t.sane){e.msg="invalid distance too far back",t.mode=BAD;break}p>t.wnext?(p-=t.wnext,b=t.wsize-p):b=t.wnext-p,p>t.length&&(p=t.length),y=t.window}else y=n,b=a-t.offset,p=t.length;p>d&&(p=d),d-=p,t.length-=p;do n[a++]=y[b++];while(--p);t.length===0&&(t.mode=LEN);break;case LIT:if(d===0)break e;n[a++]=t.length,d--,t.mode=LEN;break;case CHECK:if(t.wrap){for(;g<32;){if(h===0)break e;h--,u|=i[s++]<<g,g+=8}if(w-=d,e.total_out+=w,t.total+=w,t.wrap&4&&w&&(e.adler=t.check=t.flags?crc32_1(t.check,n,w,a-w):adler32_1(t.check,n,w,a-w)),w=d,t.wrap&4&&(t.flags?u:zswap32(u))!==t.check){e.msg="incorrect data check",t.mode=BAD;break}u=0,g=0}t.mode=LENGTH;case LENGTH:if(t.wrap&&t.flags){for(;g<32;){if(h===0)break e;h--,u+=i[s++]<<g,g+=8}if(t.wrap&4&&u!==(t.total&4294967295)){e.msg="incorrect length check",t.mode=BAD;break}u=0,g=0}t.mode=DONE;case DONE:D=Z_STREAM_END$1;break e;case BAD:D=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return e.next_out=a,e.avail_out=d,e.next_in=s,e.avail_in=h,t.hold=u,t.bits=g,(t.wsize||w!==e.avail_out&&t.mode<BAD&&(t.mode<CHECK||r!==Z_FINISH$1))&&updatewindow(e,e.output,e.next_out,w-e.avail_out),_-=e.avail_in,w-=e.avail_out,e.total_in+=_,e.total_out+=w,t.total+=w,t.wrap&4&&w&&(e.adler=t.check=t.flags?crc32_1(t.check,n,w,e.next_out-w):adler32_1(t.check,n,w,e.next_out-w)),e.data_type=t.bits+(t.last?64:0)+(t.mode===TYPE?128:0)+(t.mode===LEN_||t.mode===COPY_?256:0),(_===0&&w===0||r===Z_FINISH$1)&&D===Z_OK$1&&(D=Z_BUF_ERROR),D},inflateEnd=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;let r=e.state;return r.window&&(r.window=null),e.state=null,Z_OK$1},inflateGetHeader=(e,r)=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const t=e.state;return(t.wrap&2)===0?Z_STREAM_ERROR$1:(t.head=r,r.done=!1,Z_OK$1)},inflateSetDictionary=(e,r)=>{const t=r.length;let i,n,s;return inflateStateCheck(e)||(i=e.state,i.wrap!==0&&i.mode!==DICT)?Z_STREAM_ERROR$1:i.mode===DICT&&(n=1,n=adler32_1(n,r,t,0),n!==i.check)?Z_DATA_ERROR$1:(s=updatewindow(e,r,t,t),s?(i.mode=MEM,Z_MEM_ERROR$1):(i.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$2=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(e){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),r.windowBits>=0&&r.windowBits<16&&!(e&&e.windowBits)&&(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(r.windowBits&15)===0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let t=inflate_1$2.inflateInit2(this.strm,r.windowBits);if(t!==Z_OK)throw new Error(messages[t]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=strings.string2buf(r.dictionary):toString$2.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(t=inflate_1$2.inflateSetDictionary(this.strm,r.dictionary),t!==Z_OK)))throw new Error(messages[t])}Inflate$1.prototype.push=function(e,r){const t=this.strm,i=this.options.chunkSize,n=this.options.dictionary;let s,a,h;if(this.ended)return!1;for(r===~~r?a=r:a=r===!0?Z_FINISH:Z_NO_FLUSH,toString$2.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),s=inflate_1$2.inflate(t,a),s===Z_NEED_DICT&&n&&(s=inflate_1$2.inflateSetDictionary(t,n),s===Z_OK?s=inflate_1$2.inflate(t,a):s===Z_DATA_ERROR&&(s=Z_NEED_DICT));t.avail_in>0&&s===Z_STREAM_END&&t.state.wrap>0&&e[t.next_in]!==0;)inflate_1$2.inflateReset(t),s=inflate_1$2.inflate(t,a);switch(s){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(s),this.ended=!0,!1}if(h=t.avail_out,t.next_out&&(t.avail_out===0||s===Z_STREAM_END))if(this.options.to==="string"){let d=strings.utf8border(t.output,t.next_out),u=t.next_out-d,g=strings.buf2string(t.output,d);t.next_out=u,t.avail_out=i-u,u&&t.output.set(t.output.subarray(d,d+u),0),this.onData(g)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(s===Z_OK&&h===0)){if(s===Z_STREAM_END)return s=inflate_1$2.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(e){this.chunks.push(e)};Inflate$1.prototype.onEnd=function(e){e===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function inflate$1(e,r){const t=new Inflate$1(r);if(t.push(e),t.err)throw t.msg||messages[t.err];return t.result}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2};const{deflate}=deflate_1$1,{Inflate,inflate}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const crcTable=[];for(let e=0;e<256;e++){let r=e;for(let t=0;t<8;t++)r&1?r=3988292384^r>>>1:r=r>>>1;crcTable[e]=r}const initialCrc=4294967295;function updateCrc(e,r,t){let i=e;for(let n=0;n<t;n++)i=crcTable[(i^r[n])&255]^i>>>8;return i}function crc(e,r){return(updateCrc(initialCrc,e,r)^initialCrc)>>>0}function checkCrc(e,r,t){const i=e.readUint32(),n=crc(new Uint8Array(e.buffer,e.byteOffset+e.offset-r-4,r),r);if(n!==i)throw new Error(`CRC mismatch for chunk ${t}. Expected ${i}, found ${n}`)}function writeCrc(e,r){e.writeUint32(crc(new Uint8Array(e.buffer,e.byteOffset+e.offset-r,r),r))}function unfilterNone(e,r,t){for(let i=0;i<t;i++)r[i]=e[i]}function unfilterSub(e,r,t,i){let n=0;for(;n<i;n++)r[n]=e[n];for(;n<t;n++)r[n]=e[n]+r[n-i]&255}function unfilterUp(e,r,t,i){let n=0;if(t.length===0)for(;n<i;n++)r[n]=e[n];else for(;n<i;n++)r[n]=e[n]+t[n]&255}function unfilterAverage(e,r,t,i,n){let s=0;if(t.length===0){for(;s<n;s++)r[s]=e[s];for(;s<i;s++)r[s]=e[s]+(r[s-n]>>1)&255}else{for(;s<n;s++)r[s]=e[s]+(t[s]>>1)&255;for(;s<i;s++)r[s]=e[s]+(r[s-n]+t[s]>>1)&255}}function unfilterPaeth(e,r,t,i,n){let s=0;if(t.length===0){for(;s<n;s++)r[s]=e[s];for(;s<i;s++)r[s]=e[s]+r[s-n]&255}else{for(;s<n;s++)r[s]=e[s]+t[s]&255;for(;s<i;s++)r[s]=e[s]+paethPredictor(r[s-n],t[s],t[s-n])&255}}function paethPredictor(e,r,t){const i=e+r-t,n=Math.abs(i-e),s=Math.abs(i-r),a=Math.abs(i-t);return n<=s&&n<=a?e:s<=a?r:t}const uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255,empty=new Uint8Array(0);function decodeInterlaceNull(e){const{data:r,width:t,height:i,channels:n,depth:s}=e,a=n*s/8,h=t*a,d=new Uint8Array(i*h);let u=empty,g=0,_,w;for(let p=0;p<i;p++){switch(_=r.subarray(g+1,g+1+h),w=d.subarray(p*h,(p+1)*h),r[g]){case 0:unfilterNone(_,w,h);break;case 1:unfilterSub(_,w,h,a);break;case 2:unfilterUp(_,w,u,h);break;case 3:unfilterAverage(_,w,u,h,a);break;case 4:unfilterPaeth(_,w,u,h,a);break;default:throw new Error(`Unsupported filter: ${r[g]}`)}u=w,g+=h+1}if(s===16){const p=new Uint16Array(d.buffer);if(osIsLittleEndian)for(let b=0;b<p.length;b++)p[b]=swap16(p[b]);return p}else return d}function swap16(e){return(e&255)<<8|e>>8&255}const pngSignature=Uint8Array.of(137,80,78,71,13,10,26,10);function writeSignature(e){e.writeBytes(pngSignature)}function checkSignature(e){if(!hasPngSignature(e.readBytes(pngSignature.length)))throw new Error("wrong PNG signature")}function hasPngSignature(e){if(e.length<pngSignature.length)return!1;for(let r=0;r<pngSignature.length;r++)if(e[r]!==pngSignature[r])return!1;return!0}const textChunkName="tEXt",NULL=0,latin1Decoder=new TextDecoder("latin1");function validateKeyword(e){if(validateLatin1(e),e.length===0||e.length>79)throw new Error("keyword length must be between 1 and 79")}const latin1Regex=/^[\u0000-\u00FF]*$/;function validateLatin1(e){if(!latin1Regex.test(e))throw new Error("invalid latin1 text")}function decodetEXt(e,r,t){const i=readKeyword(r);e[i]=readLatin1(r,t-i.length-1)}function encodetEXt(e,r,t){validateKeyword(r),validateLatin1(t);const i=r.length+1+t.length;e.writeUint32(i),e.writeChars(textChunkName),e.writeChars(r),e.writeByte(NULL),e.writeChars(t),writeCrc(e,i+4)}function readKeyword(e){for(e.mark();e.readByte()!==NULL;);const r=e.offset;e.reset();const t=latin1Decoder.decode(e.readBytes(r-e.offset-1));return e.skip(1),validateKeyword(t),t}function readLatin1(e,r){return latin1Decoder.decode(e.readBytes(r))}const ColorType={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},CompressionMethod={UNKNOWN:-1,DEFLATE:0},FilterMethod={UNKNOWN:-1,ADAPTIVE:0},InterlaceMethod={UNKNOWN:-1,NO_INTERLACE:0};class PngDecoder extends IOBuffer{constructor(t,i={}){super(t);Ze(this,"_checkCrc");Ze(this,"_inflator");Ze(this,"_png");Ze(this,"_end");Ze(this,"_hasPalette");Ze(this,"_palette");Ze(this,"_hasTransparency");Ze(this,"_transparency");Ze(this,"_compressionMethod");Ze(this,"_filterMethod");Ze(this,"_interlaceMethod");Ze(this,"_colorType");const{checkCrc:n=!1}=i;this._checkCrc=n,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=ColorType.UNKNOWN,this.setBigEndian()}decode(){for(checkSignature(this);!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeChunk(){const t=this.readUint32(),i=this.readChars(4),n=this.offset;switch(i){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case textChunkName:decodetEXt(this._png.text,this,t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t);break}if(this.offset-n!==t)throw new Error(`Length mismatch while decoding chunk ${i}`);this._checkCrc?checkCrc(this,t+4,i):this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=checkBitDepth(this.readUint8());const i=this.readUint8();this._colorType=i;let n;switch(i){case ColorType.GREYSCALE:n=1;break;case ColorType.TRUECOLOUR:n=3;break;case ColorType.INDEXED_COLOUR:n=1;break;case ColorType.GREYSCALE_ALPHA:n=2;break;case ColorType.TRUECOLOUR_ALPHA:n=4;break;case ColorType.UNKNOWN:default:throw new Error(`Unknown color type: ${i}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const i=t/3;this._hasPalette=!0;const n=[];this._palette=n;for(let s=0;s<i;s++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t)),this.skip(t)}decodetRNS(t){switch(this._colorType){case ColorType.GREYSCALE:case ColorType.TRUECOLOUR:{if(t%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${t}`);if(t/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${t/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(t/2);for(let i=0;i<t/2;i++)this._transparency[i]=this.readUint16();break}case ColorType.INDEXED_COLOUR:{if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let i=0;for(;i<t;i++){const n=this.readByte();this._palette[i].push(n)}for(;i<this._palette.length;i++)this._palette[i].push(255);break}case ColorType.UNKNOWN:case ColorType.GREYSCALE_ALPHA:case ColorType.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(t){const i=readKeyword(this),n=this.readUint8();if(n!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${n}`);const s=this.readBytes(t-i.length-2);this._png.iccEmbeddedProfile={name:i,profile:inflate_1(s)}}decodepHYs(){const t=this.readUint32(),i=this.readUint32(),n=this.readByte();this._png.resolution={x:t,y:i,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this._png.data=decodeInterlaceNull({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}}function checkBitDepth(e){if(e!==1&&e!==2&&e!==4&&e!==8&&e!==16)throw new Error(`invalid bit depth: ${e}`);return e}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer{constructor(t,i={}){super();Ze(this,"_png");Ze(this,"_zlibOptions");Ze(this,"_colorType");this._colorType=ColorType.UNKNOWN,this._zlibOptions={...defaultZlibOptions,...i.zlib},this._png=this._checkData(t),this.setBigEndian()}encode(){if(writeSignature(this),this.encodeIHDR(),this.encodeData(),this._png.text)for(const[t,i]of Object.entries(this._png.text))encodetEXt(this,t,i);return this.encodeIEND(),this.toArray()}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),writeCrc(this,17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),writeCrc(this,4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),writeCrc(this,t.length+4)}encodeData(){const{width:t,height:i,channels:n,depth:s,data:a}=this._png,h=n*t,d=new IOBuffer().setBigEndian();let u=0;for(let w=0;w<i;w++)if(d.writeByte(0),s===8)u=writeDataBytes(a,d,h,u);else if(s===16)u=writeDataUint16(a,d,h,u);else throw new Error("unreachable");const g=d.toArray(),_=deflate_1(g,this._zlibOptions);this.encodeIDAT(_)}_checkData(t){const{colorType:i,channels:n,depth:s}=getColorType(t),a={width:checkInteger(t.width,"width"),height:checkInteger(t.height,"height"),channels:n,data:t.data,depth:s,text:t.text};this._colorType=i;const h=a.width*a.height*n;if(a.data.length!==h)throw new RangeError(`wrong data size. Found ${a.data.length}, expected ${h}`);return a}}function checkInteger(e,r){if(Number.isInteger(e)&&e>0)return e;throw new TypeError(`${r} must be a positive integer`)}function getColorType(e){const{channels:r=4,depth:t=8}=e;if(r!==4&&r!==3&&r!==2&&r!==1)throw new RangeError(`unsupported number of channels: ${r}`);if(t!==8&&t!==16)throw new RangeError(`unsupported bit depth: ${t}`);const i={channels:r,depth:t,colorType:ColorType.UNKNOWN};switch(r){case 4:i.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:i.colorType=ColorType.TRUECOLOUR;break;case 1:i.colorType=ColorType.GREYSCALE;break;case 2:i.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return i}function writeDataBytes(e,r,t,i){for(let n=0;n<t;n++)r.writeByte(e[i++]);return i}function writeDataUint16(e,r,t,i){for(let n=0;n<t;n++)r.writeUint16(e[i++]);return i}var ResolutionUnitSpecifier;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(e,r){return new PngDecoder(e,r).decode()}function encodePng$1(e,r){return new PngEncoder(e,r).encode()}var encoder={exports:{}},hasRequiredEncoder;function requireEncoder(){return hasRequiredEncoder||(hasRequiredEncoder=1,function(e){function r(i){var n=Math.floor,s=new Array(64),a=new Array(64),h=new Array(64),d=new Array(64),u,g,_,w,p=new Array(65535),b=new Array(65535),y=new Array(64),M=new Array(64),A=[],C=0,v=7,E=new Array(64),R=new Array(64),$=new Array(64),L=new Array(256),D=new Array(2048),B,P=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],O=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Y=[0,1,2,3,4,5,6,7,8,9,10,11],te=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],H=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],J=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Ce=[0,1,2,3,4,5,6,7,8,9,10,11],Pe=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],le=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ye(X){for(var me=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],ge=0;ge<64;ge++){var pe=n((me[ge]*X+50)/100);pe<1?pe=1:pe>255&&(pe=255),s[P[ge]]=pe}for(var Q=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Ne=0;Ne<64;Ne++){var Ue=n((Q[Ne]*X+50)/100);Ue<1?Ue=1:Ue>255&&(Ue=255),a[P[Ne]]=Ue}for(var oe=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ue=0,be=0;be<8;be++)for(var ce=0;ce<8;ce++)h[ue]=1/(s[P[ue]]*oe[be]*oe[ce]*8),d[ue]=1/(a[P[ue]]*oe[be]*oe[ce]*8),ue++}function xe(X,me){for(var ge=0,pe=0,Q=new Array,Ne=1;Ne<=16;Ne++){for(var Ue=1;Ue<=X[Ne];Ue++)Q[me[pe]]=[],Q[me[pe]][0]=ge,Q[me[pe]][1]=Ne,pe++,ge++;ge*=2}return Q}function Ie(){u=xe(O,Y),g=xe(J,Ce),_=xe(te,H),w=xe(Pe,le)}function ie(){for(var X=1,me=2,ge=1;ge<=15;ge++){for(var pe=X;pe<me;pe++)b[32767+pe]=ge,p[32767+pe]=[],p[32767+pe][1]=ge,p[32767+pe][0]=pe;for(var Q=-(me-1);Q<=-X;Q++)b[32767+Q]=ge,p[32767+Q]=[],p[32767+Q][1]=ge,p[32767+Q][0]=me-1+Q;X<<=1,me<<=1}}function Ee(){for(var X=0;X<256;X++)D[X]=19595*X,D[X+256>>0]=38470*X,D[X+512>>0]=7471*X+32768,D[X+768>>0]=-11059*X,D[X+1024>>0]=-21709*X,D[X+1280>>0]=32768*X+8421375,D[X+1536>>0]=-27439*X,D[X+1792>>0]=-5329*X}function he(X){for(var me=X[0],ge=X[1]-1;ge>=0;)me&1<<ge&&(C|=1<<v),ge--,v--,v<0&&(C==255?(z(255),z(0)):z(C),v=7,C=0)}function z(X){A.push(X)}function de(X){z(X>>8&255),z(X&255)}function ke(X,me){var ge,pe,Q,Ne,Ue,oe,ue,be,ce=0,Re,Ye=8,Ae=64;for(Re=0;Re<Ye;++Re){ge=X[ce],pe=X[ce+1],Q=X[ce+2],Ne=X[ce+3],Ue=X[ce+4],oe=X[ce+5],ue=X[ce+6],be=X[ce+7];var ze=ge+be,qe=ge-be,Ge=pe+ue,rt=pe-ue,Qe=Q+oe,st=Q-oe,gt=Ne+Ue,wt=Ne-Ue,lt=ze+gt,ft=ze-gt,_t=Ge+Qe,ht=Ge-Qe;X[ce]=lt+_t,X[ce+4]=lt-_t;var Je=(ht+ft)*.707106781;X[ce+2]=ft+Je,X[ce+6]=ft-Je,lt=wt+st,_t=st+rt,ht=rt+qe;var dt=(lt-ht)*.382683433,x=.5411961*lt+dt,f=1.306562965*ht+dt,l=_t*.707106781,o=qe+l,c=qe-l;X[ce+5]=c+x,X[ce+3]=c-x,X[ce+1]=o+f,X[ce+7]=o-f,ce+=8}for(ce=0,Re=0;Re<Ye;++Re){ge=X[ce],pe=X[ce+8],Q=X[ce+16],Ne=X[ce+24],Ue=X[ce+32],oe=X[ce+40],ue=X[ce+48],be=X[ce+56];var m=ge+be,S=ge-be,k=pe+ue,T=pe-ue,I=Q+oe,q=Q-oe,F=Ne+Ue,G=Ne-Ue,K=m+F,j=m-F,V=k+I,ne=k-I;X[ce]=K+V,X[ce+32]=K-V;var N=(ne+j)*.707106781;X[ce+16]=j+N,X[ce+48]=j-N,K=G+q,V=q+T,ne=T+S;var W=(K-ne)*.382683433,se=.5411961*K+W,De=1.306562965*ne+W,Be=V*.707106781,He=S+Be,we=S-Be;X[ce+40]=we+se,X[ce+24]=we-se,X[ce+8]=He+De,X[ce+56]=He-De,ce++}var _e;for(Re=0;Re<Ae;++Re)_e=X[Re]*me[Re],y[Re]=_e>0?_e+.5|0:_e-.5|0;return y}function ve(){de(65504),de(16),z(74),z(70),z(73),z(70),z(0),z(1),z(1),z(0),de(1),de(1),z(0),z(0)}function Me(X){if(X){de(65505),X[0]===69&&X[1]===120&&X[2]===105&&X[3]===102?de(X.length+2):(de(X.length+5+2),z(69),z(120),z(105),z(102),z(0));for(var me=0;me<X.length;me++)z(X[me])}}function Fe(X,me){de(65472),de(17),z(8),de(me),de(X),z(3),z(1),z(17),z(0),z(2),z(17),z(1),z(3),z(17),z(1)}function $e(){de(65499),de(132),z(0);for(var X=0;X<64;X++)z(s[X]);z(1);for(var me=0;me<64;me++)z(a[me])}function je(){de(65476),de(418),z(0);for(var X=0;X<16;X++)z(O[X+1]);for(var me=0;me<=11;me++)z(Y[me]);z(16);for(var ge=0;ge<16;ge++)z(te[ge+1]);for(var pe=0;pe<=161;pe++)z(H[pe]);z(1);for(var Q=0;Q<16;Q++)z(J[Q+1]);for(var Ne=0;Ne<=11;Ne++)z(Ce[Ne]);z(17);for(var Ue=0;Ue<16;Ue++)z(Pe[Ue+1]);for(var oe=0;oe<=161;oe++)z(le[oe])}function Oe(X){typeof X>"u"||X.constructor!==Array||X.forEach(me=>{if(typeof me=="string"){de(65534);var ge=me.length;de(ge+2);var pe;for(pe=0;pe<ge;pe++)z(me.charCodeAt(pe))}})}function fe(){de(65498),de(12),z(3),z(1),z(0),z(2),z(17),z(3),z(17),z(0),z(63),z(0)}function re(X,me,ge,pe,Q){for(var Ne=Q[0],Ue=Q[240],oe,ue=16,be=63,ce=64,Re=ke(X,me),Ye=0;Ye<ce;++Ye)M[P[Ye]]=Re[Ye];var Ae=M[0]-ge;ge=M[0],Ae==0?he(pe[0]):(oe=32767+Ae,he(pe[b[oe]]),he(p[oe]));for(var ze=63;ze>0&&M[ze]==0;ze--);if(ze==0)return he(Ne),ge;for(var qe=1,Ge;qe<=ze;){for(var rt=qe;M[qe]==0&&qe<=ze;++qe);var Qe=qe-rt;if(Qe>=ue){Ge=Qe>>4;for(var st=1;st<=Ge;++st)he(Ue);Qe=Qe&15}oe=32767+M[qe],he(Q[(Qe<<4)+b[oe]]),he(p[oe]),qe++}return ze!=be&&he(Ne),ge}function Le(){for(var X=String.fromCharCode,me=0;me<256;me++)L[me]=X(me)}this.encode=function(X,me){new Date().getTime(),me&&Se(me),A=new Array,C=0,v=7,de(65496),ve(),Oe(X.comments),Me(X.exifBuffer),$e(),Fe(X.width,X.height),je(),fe();var ge=0,pe=0,Q=0;C=0,v=7,this.encode.displayName="_encode_";for(var Ne=X.data,Ue=X.width,oe=X.height,ue=Ue*4,be,ce=0,Re,Ye,Ae,ze,qe,Ge,rt,Qe;ce<oe;){for(be=0;be<ue;){for(ze=ue*ce+be,qe=ze,Ge=-1,rt=0,Qe=0;Qe<64;Qe++)rt=Qe>>3,Ge=(Qe&7)*4,qe=ze+rt*ue+Ge,ce+rt>=oe&&(qe-=ue*(ce+1+rt-oe)),be+Ge>=ue&&(qe-=be+Ge-ue+4),Re=Ne[qe++],Ye=Ne[qe++],Ae=Ne[qe++],E[Qe]=(D[Re]+D[Ye+256>>0]+D[Ae+512>>0]>>16)-128,R[Qe]=(D[Re+768>>0]+D[Ye+1024>>0]+D[Ae+1280>>0]>>16)-128,$[Qe]=(D[Re+1280>>0]+D[Ye+1536>>0]+D[Ae+1792>>0]>>16)-128;ge=re(E,h,ge,u,_),pe=re(R,d,pe,g,w),Q=re($,d,Q,g,w),be+=32}ce+=8}if(v>=0){var st=[];st[1]=v+1,st[0]=(1<<v+1)-1,he(st)}return de(65497),Buffer.from(A)};function Se(X){if(X<=0&&(X=1),X>100&&(X=100),B!=X){var me=0;X<50?me=Math.floor(5e3/X):me=Math.floor(200-X*2),ye(me),B=X}}function Te(){var X=new Date().getTime();i||(i=50),Le(),Ie(),ie(),Ee(),Se(i),new Date().getTime()-X}Te()}e.exports=t;function t(i,n){typeof n>"u"&&(n=50);var s=new r(n),a=s.encode(i,n);return{data:a,width:i.width,height:i.height}}}(encoder)),encoder.exports}var decoder={exports:{}},hasRequiredDecoder;function requireDecoder(){return hasRequiredDecoder||(hasRequiredDecoder=1,function(e){var r=function(){var n=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),s=4017,a=799,h=3406,d=2276,u=1567,g=3784,_=5793,w=2896;function p(){}function b(R,$){for(var L=0,D=[],B,P,O=16;O>0&&!R[O-1];)O--;D.push({children:[],index:0});var Y=D[0],te;for(B=0;B<O;B++){for(P=0;P<R[B];P++){for(Y=D.pop(),Y.children[Y.index]=$[L];Y.index>0;){if(D.length===0)throw new Error("Could not recreate Huffman Table");Y=D.pop()}for(Y.index++,D.push(Y);D.length<=B;)D.push(te={children:[],index:0}),Y.children[Y.index]=te.children,Y=te;L++}B+1<O&&(D.push(te={children:[],index:0}),Y.children[Y.index]=te.children,Y=te)}return D[0].children}function y(R,$,L,D,B,P,O,Y,te,H){L.precision,L.samplesPerLine,L.scanLines;var J=L.mcusPerLine,Ce=L.progressive;L.maxH,L.maxV;var Pe=$,le=0,ye=0;function xe(){if(ye>0)return ye--,le>>ye&1;if(le=R[$++],le==255){var oe=R[$++];if(oe)throw new Error("unexpected marker: "+(le<<8|oe).toString(16))}return ye=7,le>>>7}function Ie(oe){for(var ue=oe,be;(be=xe())!==null;){if(ue=ue[be],typeof ue=="number")return ue;if(typeof ue!="object")throw new Error("invalid huffman sequence")}return null}function ie(oe){for(var ue=0;oe>0;){var be=xe();if(be===null)return;ue=ue<<1|be,oe--}return ue}function Ee(oe){var ue=ie(oe);return ue>=1<<oe-1?ue:ue+(-1<<oe)+1}function he(oe,ue){var be=Ie(oe.huffmanTableDC),ce=be===0?0:Ee(be);ue[0]=oe.pred+=ce;for(var Re=1;Re<64;){var Ye=Ie(oe.huffmanTableAC),Ae=Ye&15,ze=Ye>>4;if(Ae===0){if(ze<15)break;Re+=16;continue}Re+=ze;var qe=n[Re];ue[qe]=Ee(Ae),Re++}}function z(oe,ue){var be=Ie(oe.huffmanTableDC),ce=be===0?0:Ee(be)<<te;ue[0]=oe.pred+=ce}function de(oe,ue){ue[0]|=xe()<<te}var ke=0;function ve(oe,ue){if(ke>0){ke--;return}for(var be=P,ce=O;be<=ce;){var Re=Ie(oe.huffmanTableAC),Ye=Re&15,Ae=Re>>4;if(Ye===0){if(Ae<15){ke=ie(Ae)+(1<<Ae)-1;break}be+=16;continue}be+=Ae;var ze=n[be];ue[ze]=Ee(Ye)*(1<<te),be++}}var Me=0,Fe;function $e(oe,ue){for(var be=P,ce=O,Re=0;be<=ce;){var Ye=n[be],Ae=ue[Ye]<0?-1:1;switch(Me){case 0:var ze=Ie(oe.huffmanTableAC),qe=ze&15,Re=ze>>4;if(qe===0)Re<15?(ke=ie(Re)+(1<<Re),Me=4):(Re=16,Me=1);else{if(qe!==1)throw new Error("invalid ACn encoding");Fe=Ee(qe),Me=Re?2:3}continue;case 1:case 2:ue[Ye]?ue[Ye]+=(xe()<<te)*Ae:(Re--,Re===0&&(Me=Me==2?3:0));break;case 3:ue[Ye]?ue[Ye]+=(xe()<<te)*Ae:(ue[Ye]=Fe<<te,Me=0);break;case 4:ue[Ye]&&(ue[Ye]+=(xe()<<te)*Ae);break}be++}Me===4&&(ke--,ke===0&&(Me=0))}function je(oe,ue,be,ce,Re){var Ye=be/J|0,Ae=be%J,ze=Ye*oe.v+ce,qe=Ae*oe.h+Re;oe.blocks[ze]===void 0&&H.tolerantDecoding||ue(oe,oe.blocks[ze][qe])}function Oe(oe,ue,be){var ce=be/oe.blocksPerLine|0,Re=be%oe.blocksPerLine;oe.blocks[ce]===void 0&&H.tolerantDecoding||ue(oe,oe.blocks[ce][Re])}var fe=D.length,re,Le,Se,Te,X,me;Ce?P===0?me=Y===0?z:de:me=Y===0?ve:$e:me=he;var ge=0,pe,Q;fe==1?Q=D[0].blocksPerLine*D[0].blocksPerColumn:Q=J*L.mcusPerColumn,B||(B=Q);for(var Ne,Ue;ge<Q;){for(Le=0;Le<fe;Le++)D[Le].pred=0;if(ke=0,fe==1)for(re=D[0],X=0;X<B;X++)Oe(re,me,ge),ge++;else for(X=0;X<B;X++){for(Le=0;Le<fe;Le++)for(re=D[Le],Ne=re.h,Ue=re.v,Se=0;Se<Ue;Se++)for(Te=0;Te<Ne;Te++)je(re,me,ge,Se,Te);if(ge++,ge===Q)break}if(ge===Q)do{if(R[$]===255&&R[$+1]!==0)break;$+=1}while($<R.length-2);if(ye=0,pe=R[$]<<8|R[$+1],pe<65280)throw new Error("marker was not found");if(pe>=65488&&pe<=65495)$+=2;else break}return $-Pe}function M(R,$){var L=[],D=$.blocksPerLine,B=$.blocksPerColumn,P=D<<3,O=new Int32Array(64),Y=new Uint8Array(64);function te(ie,Ee,he){var z=$.quantizationTable,de,ke,ve,Me,Fe,$e,je,Oe,fe,re=he,Le;for(Le=0;Le<64;Le++)re[Le]=ie[Le]*z[Le];for(Le=0;Le<8;++Le){var Se=8*Le;if(re[1+Se]==0&&re[2+Se]==0&&re[3+Se]==0&&re[4+Se]==0&&re[5+Se]==0&&re[6+Se]==0&&re[7+Se]==0){fe=_*re[0+Se]+512>>10,re[0+Se]=fe,re[1+Se]=fe,re[2+Se]=fe,re[3+Se]=fe,re[4+Se]=fe,re[5+Se]=fe,re[6+Se]=fe,re[7+Se]=fe;continue}de=_*re[0+Se]+128>>8,ke=_*re[4+Se]+128>>8,ve=re[2+Se],Me=re[6+Se],Fe=w*(re[1+Se]-re[7+Se])+128>>8,Oe=w*(re[1+Se]+re[7+Se])+128>>8,$e=re[3+Se]<<4,je=re[5+Se]<<4,fe=de-ke+1>>1,de=de+ke+1>>1,ke=fe,fe=ve*g+Me*u+128>>8,ve=ve*u-Me*g+128>>8,Me=fe,fe=Fe-je+1>>1,Fe=Fe+je+1>>1,je=fe,fe=Oe+$e+1>>1,$e=Oe-$e+1>>1,Oe=fe,fe=de-Me+1>>1,de=de+Me+1>>1,Me=fe,fe=ke-ve+1>>1,ke=ke+ve+1>>1,ve=fe,fe=Fe*d+Oe*h+2048>>12,Fe=Fe*h-Oe*d+2048>>12,Oe=fe,fe=$e*a+je*s+2048>>12,$e=$e*s-je*a+2048>>12,je=fe,re[0+Se]=de+Oe,re[7+Se]=de-Oe,re[1+Se]=ke+je,re[6+Se]=ke-je,re[2+Se]=ve+$e,re[5+Se]=ve-$e,re[3+Se]=Me+Fe,re[4+Se]=Me-Fe}for(Le=0;Le<8;++Le){var Te=Le;if(re[8+Te]==0&&re[16+Te]==0&&re[24+Te]==0&&re[32+Te]==0&&re[40+Te]==0&&re[48+Te]==0&&re[56+Te]==0){fe=_*he[Le+0]+8192>>14,re[0+Te]=fe,re[8+Te]=fe,re[16+Te]=fe,re[24+Te]=fe,re[32+Te]=fe,re[40+Te]=fe,re[48+Te]=fe,re[56+Te]=fe;continue}de=_*re[0+Te]+2048>>12,ke=_*re[32+Te]+2048>>12,ve=re[16+Te],Me=re[48+Te],Fe=w*(re[8+Te]-re[56+Te])+2048>>12,Oe=w*(re[8+Te]+re[56+Te])+2048>>12,$e=re[24+Te],je=re[40+Te],fe=de-ke+1>>1,de=de+ke+1>>1,ke=fe,fe=ve*g+Me*u+2048>>12,ve=ve*u-Me*g+2048>>12,Me=fe,fe=Fe-je+1>>1,Fe=Fe+je+1>>1,je=fe,fe=Oe+$e+1>>1,$e=Oe-$e+1>>1,Oe=fe,fe=de-Me+1>>1,de=de+Me+1>>1,Me=fe,fe=ke-ve+1>>1,ke=ke+ve+1>>1,ve=fe,fe=Fe*d+Oe*h+2048>>12,Fe=Fe*h-Oe*d+2048>>12,Oe=fe,fe=$e*a+je*s+2048>>12,$e=$e*s-je*a+2048>>12,je=fe,re[0+Te]=de+Oe,re[56+Te]=de-Oe,re[8+Te]=ke+je,re[48+Te]=ke-je,re[16+Te]=ve+$e,re[40+Te]=ve-$e,re[24+Te]=Me+Fe,re[32+Te]=Me-Fe}for(Le=0;Le<64;++Le){var X=128+(re[Le]+8>>4);Ee[Le]=X<0?0:X>255?255:X}}E(P*B*8);for(var H,J,Ce=0;Ce<B;Ce++){var Pe=Ce<<3;for(H=0;H<8;H++)L.push(new Uint8Array(P));for(var le=0;le<D;le++){te($.blocks[Ce][le],Y,O);var ye=0,xe=le<<3;for(J=0;J<8;J++){var Ie=L[Pe+J];for(H=0;H<8;H++)Ie[xe+H]=Y[ye++]}}}return L}function A(R){return R<0?0:R>255?255:R}p.prototype={load:function($){var L=new XMLHttpRequest;L.open("GET",$,!0),L.responseType="arraybuffer",L.onload=(function(){var D=new Uint8Array(L.response||L.mozResponseArrayBuffer);this.parse(D),this.onload&&this.onload()}).bind(this),L.send(null)},parse:function($){var L=this.opts.maxResolutionInMP*1e3*1e3,D=0;$.length;function B(){var Ae=$[D]<<8|$[D+1];return D+=2,Ae}function P(){var Ae=B(),ze=$.subarray(D,D+Ae-2);return D+=ze.length,ze}function O(Ae){var ze=1,qe=1,Ge,rt;for(rt in Ae.components)Ae.components.hasOwnProperty(rt)&&(Ge=Ae.components[rt],ze<Ge.h&&(ze=Ge.h),qe<Ge.v&&(qe=Ge.v));var Qe=Math.ceil(Ae.samplesPerLine/8/ze),st=Math.ceil(Ae.scanLines/8/qe);for(rt in Ae.components)if(Ae.components.hasOwnProperty(rt)){Ge=Ae.components[rt];var gt=Math.ceil(Math.ceil(Ae.samplesPerLine/8)*Ge.h/ze),wt=Math.ceil(Math.ceil(Ae.scanLines/8)*Ge.v/qe),lt=Qe*Ge.h,ft=st*Ge.v,_t=ft*lt,ht=[];E(_t*256);for(var Je=0;Je<ft;Je++){for(var dt=[],x=0;x<lt;x++)dt.push(new Int32Array(64));ht.push(dt)}Ge.blocksPerLine=gt,Ge.blocksPerColumn=wt,Ge.blocks=ht}Ae.maxH=ze,Ae.maxV=qe,Ae.mcusPerLine=Qe,Ae.mcusPerColumn=st}var Y=null,te=null,H,J,Ce=[],Pe=[],le=[],ye=[],xe=B(),Ie=-1;if(this.comments=[],xe!=65496)throw new Error("SOI not found");for(xe=B();xe!=65497;){var ie,Ee;switch(xe){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var he=P();if(xe===65534){var z=String.fromCharCode.apply(null,he);this.comments.push(z)}xe===65504&&he[0]===74&&he[1]===70&&he[2]===73&&he[3]===70&&he[4]===0&&(Y={version:{major:he[5],minor:he[6]},densityUnits:he[7],xDensity:he[8]<<8|he[9],yDensity:he[10]<<8|he[11],thumbWidth:he[12],thumbHeight:he[13],thumbData:he.subarray(14,14+3*he[12]*he[13])}),xe===65505&&he[0]===69&&he[1]===120&&he[2]===105&&he[3]===102&&he[4]===0&&(this.exifBuffer=he.subarray(5,he.length)),xe===65518&&he[0]===65&&he[1]===100&&he[2]===111&&he[3]===98&&he[4]===101&&he[5]===0&&(te={version:he[6],flags0:he[7]<<8|he[8],flags1:he[9]<<8|he[10],transformCode:he[11]});break;case 65499:for(var de=B(),ke=de+D-2;D<ke;){var ve=$[D++];E(256);var Me=new Int32Array(64);if(ve>>4===0)for(Ee=0;Ee<64;Ee++){var Fe=n[Ee];Me[Fe]=$[D++]}else if(ve>>4===1)for(Ee=0;Ee<64;Ee++){var Fe=n[Ee];Me[Fe]=B()}else throw new Error("DQT: invalid table spec");Ce[ve&15]=Me}break;case 65472:case 65473:case 65474:B(),H={},H.extended=xe===65473,H.progressive=xe===65474,H.precision=$[D++],H.scanLines=B(),H.samplesPerLine=B(),H.components={},H.componentsOrder=[];var $e=H.scanLines*H.samplesPerLine;if($e>L){var je=Math.ceil(($e-L)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${je}MP`)}var Oe=$[D++],fe;for(ie=0;ie<Oe;ie++){fe=$[D];var re=$[D+1]>>4,Le=$[D+1]&15,Se=$[D+2];if(re<=0||Le<=0)throw new Error("Invalid sampling factor, expected values above 0");H.componentsOrder.push(fe),H.components[fe]={h:re,v:Le,quantizationIdx:Se},D+=3}O(H),Pe.push(H);break;case 65476:var Te=B();for(ie=2;ie<Te;){var X=$[D++],me=new Uint8Array(16),ge=0;for(Ee=0;Ee<16;Ee++,D++)ge+=me[Ee]=$[D];E(16+ge);var pe=new Uint8Array(ge);for(Ee=0;Ee<ge;Ee++,D++)pe[Ee]=$[D];ie+=17+ge,(X>>4===0?ye:le)[X&15]=b(me,pe)}break;case 65501:B(),J=B();break;case 65500:B(),B();break;case 65498:B();var Q=$[D++],Ne=[],Ue;for(ie=0;ie<Q;ie++){Ue=H.components[$[D++]];var oe=$[D++];Ue.huffmanTableDC=ye[oe>>4],Ue.huffmanTableAC=le[oe&15],Ne.push(Ue)}var ue=$[D++],be=$[D++],ce=$[D++],Re=y($,D,H,Ne,J,ue,be,ce>>4,ce&15,this.opts);D+=Re;break;case 65535:$[D]!==255&&D--;break;default:if($[D-3]==255&&$[D-2]>=192&&$[D-2]<=254){D-=3;break}else if(xe===224||xe==225){if(Ie!==-1)throw new Error(`first unknown JPEG marker at offset ${Ie.toString(16)}, second unknown JPEG marker ${xe.toString(16)} at offset ${(D-1).toString(16)}`);Ie=D-1;const Ae=B();if($[D+Ae-2]===255){D+=Ae-2;break}}throw new Error("unknown JPEG marker "+xe.toString(16))}xe=B()}if(Pe.length!=1)throw new Error("only single frame JPEGs supported");for(var ie=0;ie<Pe.length;ie++){var Ye=Pe[ie].components;for(var Ee in Ye)Ye[Ee].quantizationTable=Ce[Ye[Ee].quantizationIdx],delete Ye[Ee].quantizationIdx}this.width=H.samplesPerLine,this.height=H.scanLines,this.jfif=Y,this.adobe=te,this.components=[];for(var ie=0;ie<H.componentsOrder.length;ie++){var Ue=H.components[H.componentsOrder[ie]];this.components.push({lines:M(H,Ue),scaleX:Ue.h/H.maxH,scaleY:Ue.v/H.maxV})}},getData:function($,L){var D=this.width/$,B=this.height/L,P,O,Y,te,H,J,Ce,Pe,le,ye,xe=0,Ie,ie,Ee,he,z,de,ke,ve,Me,Fe,$e,je=$*L*this.components.length;E(je);var Oe=new Uint8Array(je);switch(this.components.length){case 1:for(P=this.components[0],ye=0;ye<L;ye++)for(H=P.lines[0|ye*P.scaleY*B],le=0;le<$;le++)Ie=H[0|le*P.scaleX*D],Oe[xe++]=Ie;break;case 2:for(P=this.components[0],O=this.components[1],ye=0;ye<L;ye++)for(H=P.lines[0|ye*P.scaleY*B],J=O.lines[0|ye*O.scaleY*B],le=0;le<$;le++)Ie=H[0|le*P.scaleX*D],Oe[xe++]=Ie,Ie=J[0|le*O.scaleX*D],Oe[xe++]=Ie;break;case 3:for($e=!0,this.adobe&&this.adobe.transformCode?$e=!0:typeof this.opts.colorTransform<"u"&&($e=!!this.opts.colorTransform),P=this.components[0],O=this.components[1],Y=this.components[2],ye=0;ye<L;ye++)for(H=P.lines[0|ye*P.scaleY*B],J=O.lines[0|ye*O.scaleY*B],Ce=Y.lines[0|ye*Y.scaleY*B],le=0;le<$;le++)$e?(Ie=H[0|le*P.scaleX*D],ie=J[0|le*O.scaleX*D],Ee=Ce[0|le*Y.scaleX*D],ve=A(Ie+1.402*(Ee-128)),Me=A(Ie-.3441363*(ie-128)-.71413636*(Ee-128)),Fe=A(Ie+1.772*(ie-128))):(ve=H[0|le*P.scaleX*D],Me=J[0|le*O.scaleX*D],Fe=Ce[0|le*Y.scaleX*D]),Oe[xe++]=ve,Oe[xe++]=Me,Oe[xe++]=Fe;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for($e=!1,this.adobe&&this.adobe.transformCode?$e=!0:typeof this.opts.colorTransform<"u"&&($e=!!this.opts.colorTransform),P=this.components[0],O=this.components[1],Y=this.components[2],te=this.components[3],ye=0;ye<L;ye++)for(H=P.lines[0|ye*P.scaleY*B],J=O.lines[0|ye*O.scaleY*B],Ce=Y.lines[0|ye*Y.scaleY*B],Pe=te.lines[0|ye*te.scaleY*B],le=0;le<$;le++)$e?(Ie=H[0|le*P.scaleX*D],ie=J[0|le*O.scaleX*D],Ee=Ce[0|le*Y.scaleX*D],he=Pe[0|le*te.scaleX*D],z=255-A(Ie+1.402*(Ee-128)),de=255-A(Ie-.3441363*(ie-128)-.71413636*(Ee-128)),ke=255-A(Ie+1.772*(ie-128))):(z=H[0|le*P.scaleX*D],de=J[0|le*O.scaleX*D],ke=Ce[0|le*Y.scaleX*D],he=Pe[0|le*te.scaleX*D]),Oe[xe++]=255-z,Oe[xe++]=255-de,Oe[xe++]=255-ke,Oe[xe++]=255-he;break;default:throw new Error("Unsupported color mode")}return Oe},copyToImageData:function($,L){var D=$.width,B=$.height,P=$.data,O=this.getData(D,B),Y=0,te=0,H,J,Ce,Pe,le,ye,xe,Ie,ie;switch(this.components.length){case 1:for(J=0;J<B;J++)for(H=0;H<D;H++)Ce=O[Y++],P[te++]=Ce,P[te++]=Ce,P[te++]=Ce,L&&(P[te++]=255);break;case 3:for(J=0;J<B;J++)for(H=0;H<D;H++)xe=O[Y++],Ie=O[Y++],ie=O[Y++],P[te++]=xe,P[te++]=Ie,P[te++]=ie,L&&(P[te++]=255);break;case 4:for(J=0;J<B;J++)for(H=0;H<D;H++)le=O[Y++],ye=O[Y++],Ce=O[Y++],Pe=O[Y++],xe=255-A(le*(1-Pe/255)+Pe),Ie=255-A(ye*(1-Pe/255)+Pe),ie=255-A(Ce*(1-Pe/255)+Pe),P[te++]=xe,P[te++]=Ie,P[te++]=ie,L&&(P[te++]=255);break;default:throw new Error("Unsupported color mode")}}};var C=0,v=0;function E(R=0){var $=C+R;if($>v){var L=Math.ceil(($-v)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${L}MB`)}C=$}return p.resetMaxMemoryUsage=function(R){C=0,v=R},p.getBytesAllocated=function(){return C},p.requestMemoryAllocation=E,p}();e.exports=t;function t(i,n={}){var s={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},a={...s,...n},h=new Uint8Array(i),d=new r;d.opts=a,r.resetMaxMemoryUsage(a.maxMemoryUsageInMB*1024*1024),d.parse(h);var u=a.formatAsRGBA?4:3,g=d.width*d.height*u;try{r.requestMemoryAllocation(g);var _={width:d.width,height:d.height,exifBuffer:d.exifBuffer,data:a.useTArray?new Uint8Array(g):Buffer.alloc(g)};d.comments.length>0&&(_.comments=d.comments)}catch(w){throw w instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+g):w instanceof ReferenceError&&w.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):w}return d.copyToImageData(_,a.formatAsRGBA),_}}(decoder)),decoder.exports}var jpegJs,hasRequiredJpegJs;function requireJpegJs(){if(hasRequiredJpegJs)return jpegJs;hasRequiredJpegJs=1;var e=requireEncoder(),r=requireDecoder();return jpegJs={encode:e,decode:r},jpegJs}var jpegJsExports=requireJpegJs();let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let e=0;e<chars.length;e++)lookup[chars.charCodeAt(e)]=e;function encode(e){let r,t=e.length,i="";for(r=0;r<t;r+=3)i+=chars[e[r]>>2],i+=chars[(e[r]&3)<<4|e[r+1]>>4],i+=chars[(e[r+1]&15)<<2|e[r+2]>>6],i+=chars[e[r+2]&63];return t%3===2?i=`${i.substring(0,i.length-1)}=`:t%3===1&&(i=`${i.substring(0,i.length-2)}==`),i}function decode$1(e){let r=e.length*.75,t=e.length,i=0,n,s,a,h;e[e.length-1]==="="&&(r--,e[e.length-2]==="="&&r--);const d=new Uint8Array(r);for(let u=0;u<t;u+=4)n=lookup[e.charCodeAt(u)],s=lookup[e.charCodeAt(u+1)],a=lookup[e.charCodeAt(u+2)],h=lookup[e.charCodeAt(u+3)],d[i++]=n<<2|s>>4,d[i++]=(s&15)<<4|a>>2,d[i++]=(a&3)<<6|h&63;return d}function toBase64URL(e,r){const t=encode(e);return`data:${r};base64,${t}`}const ImageData=self.ImageData,DOMImage=self.Image;function createCanvas(e,r){let t=self.document.createElement("canvas");return t.width=e,t.height=r,t}function fetchBinary(e,{withCredentials:r=!1}={}){return new Promise(function(t,i){let n=new self.XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.withCredentials=r,n.onload=function(s){this.status!==200?i(s):t(this.response)},n.onerror=i,n.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(e){return e.includes("/")||(e=`image/${e}`),e}function encodeJpeg(e,r={}){const t={width:e.width,height:e.height,data:e.getRGBAData()};return jpegJsExports.encode(t,r.quality).data}function encodePng(e,r){const t={width:e.width,height:e.height,channels:e.channels,depth:e.bitDepth,data:e.data};return(t.depth===1||t.depth===32)&&(t.depth=8,t.channels=4,t.data=e.getRGBAData()),encodePng$1(t,r)}const exportMethods={save(e,r={}){const{useCanvas:t=!1,encoder:i=void 0}=r;let{format:n}=r;if(!n){const s=/\.(?<format>[a-zA-Z]+)$/.exec(e);s&&(n=s.groups.format.toLowerCase())}if(!n)throw new Error("file format not provided");return new Promise((s,a)=>{let h,d;switch(n.toLowerCase()){case"png":{t?h=this.getCanvas().pngStream():d=encodePng(this,i);break}case"jpg":case"jpeg":t?h=this.getCanvas().jpegStream():d=encodeJpeg(this,i);break;case"bmp":d=srcExports$3.encode(this,i);break;default:throw new RangeError(`invalid output format: ${n}`)}if(h){let u=createWriteStream();u.on("finish",s),u.on("error",a),h.pipe(u)}else d&&writeFile()})},toDataURL(e="image/png",r={}){typeof e=="object"&&(r=e,e="image/png");const{useCanvas:t=!1,encoder:i=void 0}=r;e=getType(e);function n(s,a){const h=s(a,i);return toBase64URL(h,e)}return e==="image/bmp"?n(srcExports$3.encode,this):e==="image/png"&&!t?n(encodePng,this):e==="image/jpeg"&&!t?n(encodeJpeg,this):this.getCanvas().toDataURL(e)},toBuffer(e={}){const{format:r="png",encoder:t=void 0}=e;switch(r.toLowerCase()){case"png":return encodePng(this,t);case"jpeg":case"jpg":return encodeJpeg(this,t);case"bmp":return srcExports$3.encode(this,t);default:throw new RangeError(`invalid output format: ${r}`)}},toBase64(e="image/png",r={}){if(r.async)return this.toDataURL(e,r).then(function(t){return t.substring(t.indexOf(",")+1)});{const t=this.toDataURL(e,r);return t.substring(t.indexOf(",")+1)}},toBlob(e="image/png",r=.8){return canvasToBlob(this.getCanvas(),e,r)},getCanvas(){const e=new ImageData(this.getRGBAData({clamped:!0}),this.width,this.height);let r=createCanvas(this.width,this.height);return r.getContext("2d").putImageData(e,0,0),r}};function setExportMethods(e){for(const r in exportMethods)e.prototype[r]=exportMethods[r]}var hasOwn$1={exports:{}};const version="1.0.1",require$$0$2={version};var hasRequiredHasOwn;function requireHasOwn(){return hasRequiredHasOwn||(hasRequiredHasOwn=1,function(e,r){var t=Object.prototype.hasOwnProperty;e.exports=r=function(n,s){return t.call(s,n)},r.version=require$$0$2.version}(hasOwn$1,hasOwn$1.exports)),hasOwn$1.exports}var hasOwnExports=requireHasOwn();const hasOwn=getDefaultExportFromCjs(hasOwnExports);let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(e,r,t={}){let{inPlace:i=!1,returnThis:n=!0,partialArgs:s=[]}=t;return i?Image.prototype[e]=function(...a){this.computed=null;let h=r.apply(this,[...s,...a]);return n?this:h}:Image.prototype[e]=function(...a){return r.apply(this,[...s,...a])},Image}function extendProperty(e,r,t={}){let{partialArgs:i=[]}=t;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(e,this.computed))return this.computed[e];let n=r.apply(this,i);return this.computed[e]=n,n},Object.defineProperty(Image.prototype,e,computedPropertyDescriptor$1),Image}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK",ColorModel=Object.freeze(Object.defineProperty({__proto__:null,CMYK:CMYK$1,GREY:GREY$1,HSL,HSV,RGB:RGB$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(e={}){const{clamped:r}=e;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const t=this.width*this.height*4;let i=r?new Uint8ClampedArray(t):new Uint8Array(t);return this.bitDepth===1?fillDataFromBinary(this,i):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,i):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,i))):this.components===1?fillDataFromGrey(this,i):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,i)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,i)):fillAlpha(this,i),i}function fillDataFromBinary(e,r){for(let t=0;t<e.size;t++){const i=e.getBit(t);r[t*4]=i*255,r[t*4+1]=i*255,r[t*4+2]=i*255}}function fillDataFromGrey32(e,r){const t=e.min[0],n=e.max[0]-t;for(let s=0;s<e.size;s++){const a=Math.floor(255*(e.data[s]-t)/n);r[s*4]=a,r[s*4+1]=a,r[s*4+2]=a}}function fillDataFromRGB32(e,r){const t=Math.min(...e.min),n=Math.max(...e.max)-t;for(let s=0;s<e.size;s++){const a=Math.floor(255*(e.data[s*3]-t)/n),h=Math.floor(255*(e.data[s*3+1]-t)/n),d=Math.floor(255*(e.data[s*3+2]-t)/n);r[s*4]=a,r[s*4+1]=h,r[s*4+2]=d}}function fillDataFromGrey(e,r){for(let t=0;t<e.size;t++)r[t*4]=e.data[t*e.channels]>>>e.bitDepth-8,r[t*4+1]=e.data[t*e.channels]>>>e.bitDepth-8,r[t*4+2]=e.data[t*e.channels]>>>e.bitDepth-8}function fillDataFromRGB(e,r){for(let t=0;t<e.size;t++)r[t*4]=e.data[t*e.channels]>>>e.bitDepth-8,r[t*4+1]=e.data[t*e.channels+1]>>>e.bitDepth-8,r[t*4+2]=e.data[t*e.channels+2]>>>e.bitDepth-8}function copyAlpha(e,r){for(let t=0;t<e.size;t++)r[t*4+3]=e.data[t*e.channels+e.components]>>e.bitDepth-8}function fillAlpha(e,r){for(let t=0;t<e.size;t++)r[t*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(e){const r=kinds[e];if(!r)throw new RangeError(`invalid image kind: ${e}`);return r}const validBitDepth=[1,8,16,32];function verifyKindDefinition(e){const{components:r,alpha:t,bitDepth:i,colorModel:n}=e;if(!Number.isInteger(r)||r<=0)throw new RangeError(`invalid components: ${r}. Must be a positive integer`);if(t!==0&&t!==1&&typeof t!="boolean")throw new TypeError(`invalid alpha: ${t}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(i))throw new RangeError(`invalid bitDepth: ${i}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[n])throw new RangeError(`invalid colorModel: ${n}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(e,r,t){let i=r*e;return t===1&&(i=Math.ceil(i/8)),i}function createPixelArray(e,r,t,i,n,s){const a=i*e;let h;switch(n){case 1:h=new Uint8Array(Math.ceil(a/8));break;case 8:h=new Uint8Array(a);break;case 16:h=new Uint16Array(a);break;case 32:h=new Float32Array(a);break;default:throw new Error(`Cannot create pixel array for bit depth ${n}`)}if(t)for(let d=r;d<h.length;d+=i)h[d]=s;return h}var src$4={},IOBuffer_1,hasRequiredIOBuffer;function requireIOBuffer(){if(hasRequiredIOBuffer)return IOBuffer_1;hasRequiredIOBuffer=1;const e=1024*8,r=[];class t{constructor(n,s){s=s||{},n===void 0&&(n=e),typeof n=="number"&&(n=new ArrayBuffer(n));let a=n.byteLength;const h=s.offset?s.offset>>>0:0;n.buffer&&(a=n.byteLength-h,n.byteLength!==n.buffer.byteLength?n=n.buffer.slice(n.byteOffset+h,n.byteOffset+n.byteLength):h?n=n.buffer.slice(h):n=n.buffer),this.buffer=n,this.length=a,this.byteLength=a,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=a||e,this._mark=0}available(n){return n===void 0&&(n=1),this.offset+n<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(n){n===void 0&&(n=1),this.offset+=n}seek(n){this.offset=n}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(n){if(n===void 0&&(n=1),!this.available(n)){const s=this._increment+this._increment;this._increment=s;const a=this.length+s,h=new Uint8Array(a);h.set(new Uint8Array(this.buffer)),this.buffer=h.buffer,this.length=a,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(n){n===void 0&&(n=1);for(var s=new Uint8Array(n),a=0;a<n;a++)s[a]=this.readByte();return s}readInt16(){var n=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,n}readUint16(){var n=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,n}readInt32(){var n=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,n}readUint32(){var n=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,n}readFloat32(){var n=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,n}readFloat64(){var n=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,n}readChar(){return String.fromCharCode(this.readInt8())}readChars(n){n===void 0&&(n=1),r.length=n;for(var s=0;s<n;s++)r[s]=this.readChar();return r.join("")}writeBoolean(n){this.writeUint8(n?255:0)}writeInt8(n){this.ensureAvailable(1),this._data.setInt8(this.offset++,n)}writeUint8(n){this.ensureAvailable(1),this._data.setUint8(this.offset++,n)}writeByte(n){this.writeUint8(n)}writeBytes(n){this.ensureAvailable(n.length);for(var s=0;s<n.length;s++)this._data.setUint8(this.offset++,n[s])}writeInt16(n){this.ensureAvailable(2),this._data.setInt16(this.offset,n,this.littleEndian),this.offset+=2}writeUint16(n){this.ensureAvailable(2),this._data.setUint16(this.offset,n,this.littleEndian),this.offset+=2}writeInt32(n){this.ensureAvailable(4),this._data.setInt32(this.offset,n,this.littleEndian),this.offset+=4}writeUint32(n){this.ensureAvailable(4),this._data.setUint32(this.offset,n,this.littleEndian),this.offset+=4}writeFloat32(n){this.ensureAvailable(4),this._data.setFloat32(this.offset,n,this.littleEndian),this.offset+=4}writeFloat64(n){this.ensureAvailable(8),this._data.setFloat64(this.offset,n,this.littleEndian),this.offset+=8}writeChar(n){this.writeUint8(n.charCodeAt(0))}writeChars(n){for(var s=0;s<n.length;s++)this.writeUint8(n.charCodeAt(s))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}}return IOBuffer_1=t,IOBuffer_1}var src$3={},standard$1,hasRequiredStandard;function requireStandard(){if(hasRequiredStandard)return standard$1;hasRequiredStandard=1;const e={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},r={};for(var t in e)r[e[t]]=t;return standard$1={tagsById:e,tagsByName:r},standard$1}var exif$1,hasRequiredExif;function requireExif(){if(hasRequiredExif)return exif$1;hasRequiredExif=1;const e={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},r={};for(var t in e)r[e[t]]=t;return exif$1={tagsById:e,tagsByName:r},exif$1}var gps$1,hasRequiredGps;function requireGps(){if(hasRequiredGps)return gps$1;hasRequiredGps=1;const e={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},r={};for(var t in e)r[e[t]]=t;return gps$1={tagsById:e,tagsByName:r},gps$1}var ifd,hasRequiredIfd;function requireIfd(){if(hasRequiredIfd)return ifd;hasRequiredIfd=1;const e={standard:requireStandard(),exif:requireExif(),gps:requireGps()};class r{constructor(i){if(!i)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=i,this._map=null}get(i){if(typeof i=="number")return this.fields.get(i);if(typeof i=="string")return this.fields.get(e[this.kind].tagsByName[i]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const n=e[this.kind].tagsById;for(var i of this.fields.keys())n[i]&&(this._map[n[i]]=this.fields.get(i))}return this._map}}return ifd=r,ifd}var tiffIfd,hasRequiredTiffIfd;function requireTiffIfd(){if(hasRequiredTiffIfd)return tiffIfd;hasRequiredTiffIfd=1;const e=requireIfd(),r=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class t extends e{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var s=new Date,a=r.exec(this.dateTime);return s.setFullYear(a[1],a[2]-1,a[3]),s.setHours(a[4],a[5],a[6]),s}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return i(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return i(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}function i(n){return typeof n=="number"?[n]:n}return tiffIfd=t,tiffIfd}var ifdValue={},hasRequiredIfdValue;function requireIfdValue(){if(hasRequiredIfdValue)return ifdValue;hasRequiredIfdValue=1;var e=new Map([[1,[1,r]],[2,[1,t]],[3,[2,i]],[4,[4,n]],[5,[8,s]],[6,[1,a]],[7,[1,r]],[8,[2,h]],[9,[4,d]],[10,[8,u]],[11,[4,g]],[12,[8,_]]]);ifdValue.getByteLength=function(w,p){return e.get(w)[0]*p},ifdValue.readData=function(w,p,b){return e.get(p)[1](w,b)};function r(w,p){if(p===1)return w.readUint8();for(var b=new Uint8Array(p),y=0;y<p;y++)b[y]=w.readUint8();return b}function t(w,p){for(var b=[],y="",M=0;M<p;M++){var A=String.fromCharCode(w.readUint8());A==="\0"?(b.push(y),y=""):y+=A}return b.length===1?b[0]:b}function i(w,p){if(p===1)return w.readUint16();for(var b=new Uint16Array(p),y=0;y<p;y++)b[y]=w.readUint16();return b}function n(w,p){if(p===1)return w.readUint32();for(var b=new Uint32Array(p),y=0;y<p;y++)b[y]=w.readUint32();return b}function s(w,p){if(p===1)return w.readUint32()/w.readUint32();for(var b=new Array(p),y=0;y<p;y++)b[y]=w.readUint32()/w.readUint32();return b}function a(w,p){if(p===1)return w.readInt8();for(var b=new Int8Array(p),y=0;y<p;y++)b[y]=w.readInt8();return b}function h(w,p){if(p===1)return w.readInt16();for(var b=new Int16Array(p),y=0;y<p;y++)b[y]=w.readInt16();return b}function d(w,p){if(p===1)return w.readInt32();for(var b=new Int32Array(p),y=0;y<p;y++)b[y]=w.readInt32();return b}function u(w,p){if(p===1)return w.readInt32()/w.readInt32();for(var b=new Array(p),y=0;y<p;y++)b[y]=w.readInt32()/w.readInt32();return b}function g(w,p){if(p===1)return w.readFloat32();for(var b=new Float32Array(p),y=0;y<p;y++)b[y]=w.readFloat32();return b}function _(w,p){if(p===1)return w.readFloat64();for(var b=new Float64Array(p),y=0;y<p;y++)b[y]=w.readFloat64();return b}return ifdValue}var tiffDecoder,hasRequiredTiffDecoder;function requireTiffDecoder(){if(hasRequiredTiffDecoder)return tiffDecoder;hasRequiredTiffDecoder=1;const e=requireIOBuffer(),r=requireIfd(),t=requireTiffIfd(),i=requireIfdValue(),n={ignoreImageData:!1,onlyFirst:!1};class s extends e{constructor(p,b){super(p,b),this._nextIFD=0}decode(p){p=Object.assign({},n,p);const b=[];for(this.decodeHeader();this._nextIFD;)if(b.push(this.decodeIFD(p)),p.onlyFirst)return b[0];return b}decodeHeader(){let p=this.readUint16();if(p===18761)this.setLittleEndian();else if(p===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+p.toString(16));if(p=this.readUint16(),p!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(p){this.seek(this._nextIFD);var b;p.kind?b=new r(p.kind):b=new t;const y=this.readUint16();for(var M=0;M<y;M++)this.decodeIFDEntry(b);return p.ignoreImageData||this.decodeImageData(b),this._nextIFD=this.readUint32(),b}decodeIFDEntry(p){const b=this.offset,y=this.readUint16(),M=this.readUint16(),A=this.readUint32();if(M<1||M>12){this.skip(4);return}i.getByteLength(M,A)>4&&this.seek(this.readUint32());const v=i.readData(this,M,A);if(p.fields.set(y,v),y===34665||y===34853){let E=this.offset,R;y===34665?R="exif":y===34853&&(R="gps"),this._nextIFD=v,p[R]=this.decodeIFD({kind:R,ignoreImageData:!0}),this.offset=E}this.seek(b),this.skip(12)}decodeImageData(p){const b=p.orientation;switch(b&&b!==1&&g("orientation",b),p.type){case 1:case 2:this.readStripData(p);break;default:g("image type",p.type);break}}readStripData(p){const b=p.width,y=p.height,M=_(p.bitsPerSample),A=p.sampleFormat;let C=b*y;const v=a(C,1,M,A),E=p.compression,$=p.rowsPerStrip*b,L=p.stripOffsets,D=p.stripByteCounts;for(var B=0,P=0;P<L.length;P++){var O=this.getStripData(E,L[P],D[P]),Y=C>$?$:C;C-=Y,M===8?B=h(v,O,B,Y):M===16?B=d(v,O,B,Y,this.isLittleEndian()):M===32&&A===3?B=u(v,O,B,Y,this.isLittleEndian()):g("bitDepth",M)}p.data=v}getStripData(p,b,y){switch(p){case 1:return new DataView(this.buffer,b,y);case 2:case 32773:return g("Compression",p);default:throw new Error("invalid compression: "+p)}}}tiffDecoder=s;function a(w,p,b,y){return b===8?new Uint8Array(w*p):b===16?new Uint16Array(w*p):b===32&&y===3?new Float32Array(w*p):g("bit depth / sample format",b+" / "+y)}function h(w,p,b,y){for(var M=0;M<y;M++)w[b++]=p.getUint8(M);return b}function d(w,p,b,y,M){for(var A=0;A<y*2;A+=2)w[b++]=p.getUint16(A,M);return b}function u(w,p,b,y,M){for(var A=0;A<y*4;A+=4)w[b++]=p.getFloat32(A,M);return b}function g(w,p){throw new Error("Unsupported "+w+": "+p)}function _(w){if(w.length){const b=w;w=b[0];for(var p=0;p<b.length;p++)b[p]!==w&&g("bit depth",b)}return w}return tiffDecoder}var decode,hasRequiredDecode$1;function requireDecode$1(){if(hasRequiredDecode$1)return decode;hasRequiredDecode$1=1;const e=requireTiffDecoder();return decode=function(t,i){return new e(t,i).decode(i)},decode}var hasRequiredSrc$4;function requireSrc$4(){return hasRequiredSrc$4||(hasRequiredSrc$4=1,src$3.decode=requireDecode$1()),src$3}var decode_1,hasRequiredDecode;function requireDecode(){if(hasRequiredDecode)return decode_1;hasRequiredDecode=1;const e=requireIOBuffer(),r=requireSrc$4();function t(i){const n=new e(i),s={};if(n.setBigEndian(),n.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(n.readUint16()===65505){n.readUint16();const d=n.readBytes(6);if(d[0]===69&&d[1]===120&&d[2]===105&&d[3]===102&&d[4]===0&&d[5]===0){const u=r.decode(n,{onlyFirst:!0,ignoreImageData:!0,offset:n.offset});s.exif=u}}return s}return decode_1=t,decode_1}var hasRequiredSrc$3;function requireSrc$3(){return hasRequiredSrc$3||(hasRequiredSrc$3=1,src$4.decode=requireDecode()),src$4}var srcExports$2=requireSrc$3(),imageType$1={exports:{}},fileType={exports:{}},hasRequiredFileType;function requireFileType(){return hasRequiredFileType||(hasRequiredFileType=1,function(module){const toBytes=e=>[...e].map(r=>r.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(e,r=0){let t=e[r],i=1,n=0;for(;++n<8;)i*=256,t+=e[r+n]*i;return t}const fileType=e=>{if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Buffer.isBuffer(e)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const r=e instanceof Uint8Array?e:new Uint8Array(e);if(!(r&&r.length>1))return null;const t=(n,s)=>{s=Object.assign({offset:0},s);for(let a=0;a<n.length;a++)if(s.mask){if(n[a]!==(s.mask[a]&r[a+s.offset]))return!1}else if(n[a]!==r[a+s.offset])return!1;return!0},i=(n,s)=>t(toBytes(n),s);if(t([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(t([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(t([71,73,70]))return{ext:"gif",mime:"image/gif"};if(t([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(t([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((t([73,73,42,0])||t([77,77,0,42]))&&t([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(t([73,73,42,0])||t([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(t([66,77]))return{ext:"bmp",mime:"image/bmp"};if(t([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(t([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(t([80,75,3,4])){if(t([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(t(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(i("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(i("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(i("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const n=(d,u=0)=>d.findIndex((g,_,w)=>_>=u&&w[_]===80&&w[_+1]===75&&w[_+2]===3&&w[_+3]===4);let s=0,a=!1,h=null;do{const d=s+30;if(a||(a=t(oxmlContentTypes,{offset:d})||t(oxmlRels,{offset:d})),h||(i("word/",{offset:d})?h={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:i("ppt/",{offset:d})?h={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:i("xl/",{offset:d})&&(h={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),a&&h)return h;s=n(r,d)}while(s>=0);if(h)return h}if(t([80,75])&&(r[2]===3||r[2]===5||r[2]===7)&&(r[3]===4||r[3]===6||r[3]===8))return{ext:"zip",mime:"application/zip"};if(t([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(t([82,97,114,33,26,7])&&(r[6]===0||r[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(t([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(t([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(t([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(t([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(t([51,103,112,53])||t([0,0,0])&&t([102,116,121,112],{offset:4})&&(t([109,112,52,49],{offset:8})||t([109,112,52,50],{offset:8})||t([105,115,111,109],{offset:8})||t([105,115,111,50],{offset:8})||t([109,109,112,52],{offset:8})||t([77,52,86],{offset:8})||t([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(t([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(t([26,69,223,163])){const n=r.subarray(4,4100),s=n.findIndex((a,h,d)=>d[h]===66&&d[h+1]===130);if(s!==-1){const a=s+3,h=d=>[...d].every((u,g)=>n[a+g]===u.charCodeAt(0));if(h("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(h("webm"))return{ext:"webm",mime:"video/webm"}}}if(t([0,0,0,20,102,116,121,112,113,116,32,32])||t([102,114,101,101],{offset:4})||t([102,116,121,112,113,116,32,32],{offset:4})||t([109,100,97,116],{offset:4})||t([109,111,111,118],{offset:4})||t([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(t([82,73,70,70])){if(t([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(t([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(t([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(t([48,38,178,117,142,102,207,17,166,217])){let n=30;do{const s=readUInt64LE(r,n+16);if(t([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:n})){if(t([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:n+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(t([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:n+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}n+=s}while(n+24<=r.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(t([0,0,1,186])||t([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(t([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let n=0;n<2&&n<r.length-16;n++){if(t([73,68,51],{offset:n})||t([255,226],{offset:n,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(t([255,228],{offset:n,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(t([255,248],{offset:n,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(t([255,240],{offset:n,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(t([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(t([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(t([79,103,103,83]))return t([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:t([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:t([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:t([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:t([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(t([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(t([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(t([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(t([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(t([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(t([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((r[0]===67||r[0]===70)&&t([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(t([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(t([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(t([119,79,70,70])&&(t([0,1,0,0],{offset:4})||t([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(t([119,79,70,50])&&(t([0,1,0,0],{offset:4})||t([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(t([76,80],{offset:34})&&(t([0,0,1],{offset:8})||t([1,0,2],{offset:8})||t([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(t([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(t([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(t([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(t([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(t([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(t([37,33]))return{ext:"ps",mime:"application/postscript"};if(t([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(t([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(t([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(t([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(t([77,83,67,70])||t([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(t([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(t([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(t([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(t([31,160])||t([31,157]))return{ext:"Z",mime:"application/x-compress"};if(t([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(t([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(t([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(t([71],{offset:4})&&(t([71],{offset:192})||t([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(t([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(t([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(t([0,0,0,12,106,80,32,32,13,10,135,10])){if(t([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(t([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(t([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(t([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(t([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(i("<?xml "))return{ext:"xml",mime:"application/xml"};if(t([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(t([102,116,121,112],{offset:4})){if(t([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(t([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(t([104,101,105,99],{offset:8})||t([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(t([104,101,118,99],{offset:8})||t([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return t([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:t([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:t([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:t([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:t([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:t([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:t([212,195,178,161])||t([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const e=new stream.PassThrough,r=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{e.fileType=fileType(r)}catch(t){reject(t)}readableStream.unshift(r),stream.pipeline?resolve(stream.pipeline(readableStream,e,()=>{})):resolve(readableStream.pipe(e))})})}(fileType)),fileType.exports}var hasRequiredImageType;function requireImageType(){if(hasRequiredImageType)return imageType$1.exports;hasRequiredImageType=1;const e=requireFileType(),r=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),t=i=>{const n=e(i);return r.has(n&&n.ext)?n:null};return imageType$1.exports=t,imageType$1.exports.default=t,Object.defineProperty(t,"minimumBytes",{value:e.minimumBytes}),imageType$1.exports}var imageTypeExports=requireImageType();const imageType=getDefaultExportFromCjs(imageTypeExports);function guessStripByteCounts(e){if(e.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const r=e.rowsPerStrip*e.width*e.samplesPerPixel*(e.bitsPerSample/8);return new Array(e.stripOffsets.length).fill(r)}function applyHorizontalDifferencing8Bit(e,r,t){let i=0;for(;i<e.length;){for(let n=t;n<r*t;n+=t)for(let s=0;s<t;s++)e[i+n+s]=e[i+n+s]+e[i+n-(t-s)]&255;i+=r*t}}function applyHorizontalDifferencing16Bit(e,r,t){let i=0;for(;i<e.length;){for(let n=t;n<r*t;n+=t)for(let s=0;s<t;s++)e[i+n+s]=e[i+n+s]+e[i+n-(t-s)]&65535;i+=r*t}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let e in tagsById$2)tagsByName$2[tagsById$2[e]]=Number(e);const exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"})),tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let e in tagsById$1)tagsByName$1[tagsById$1[e]]=Number(e);const gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"})),tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let e in tagsById)tagsByName[tagsById[e]]=Number(e);const standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"})),tags={standard,exif,gps};class IFD{constructor(r){if(!r)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=r,this._hasMap=!1,this._map={}}get(r){if(typeof r=="number")return this.fields.get(r);if(typeof r=="string")return this.fields.get(tags[this.kind].tagsByName[r]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const r=tags[this.kind].tagsById;for(let t of this.fields.keys())r[t]&&(this._map[r[t]]=this.fields.get(t));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(e,r){const t=types.get(e);if(!t)throw new Error(`type not found: ${e}`);return t[0]*r}function readData(e,r,t){const i=types.get(r);if(!i)throw new Error(`type not found: ${r}`);return i[1](e,t)}function readByte(e,r){if(r===1)return e.readUint8();let t=new Uint8Array(r);for(let i=0;i<r;i++)t[i]=e.readUint8();return t}function readASCII(e,r){let t=[],i="";for(let n=0;n<r;n++){let s=String.fromCharCode(e.readUint8());s==="\0"?(t.push(i),i=""):i+=s}return t.length===1?t[0]:t}function readShort(e,r){if(r===1)return e.readUint16();let t=new Uint16Array(r);for(let i=0;i<r;i++)t[i]=e.readUint16();return t}function readLong(e,r){if(r===1)return e.readUint32();let t=new Uint32Array(r);for(let i=0;i<r;i++)t[i]=e.readUint32();return t}function readRational(e,r){if(r===1)return e.readUint32()/e.readUint32();let t=new Array(r);for(let i=0;i<r;i++)t[i]=e.readUint32()/e.readUint32();return t}function readSByte(e,r){if(r===1)return e.readInt8();let t=new Int8Array(r);for(let i=0;i<r;i++)t[i]=e.readInt8();return t}function readSShort(e,r){if(r===1)return e.readInt16();let t=new Int16Array(r);for(let i=0;i<r;i++)t[i]=e.readInt16();return t}function readSLong(e,r){if(r===1)return e.readInt32();let t=new Int32Array(r);for(let i=0;i<r;i++)t[i]=e.readInt32();return t}function readSRational(e,r){if(r===1)return e.readInt32()/e.readInt32();let t=new Array(r);for(let i=0;i<r;i++)t[i]=e.readInt32()/e.readInt32();return t}function readFloat(e,r){if(r===1)return e.readFloat32();let t=new Float32Array(r);for(let i=0;i<r;i++)t[i]=e.readFloat32();return t}function readDouble(e,r){if(r===1)return e.readFloat64();let t=new Float64Array(r);for(let i=0;i<r;i++)t[i]=e.readFloat64();return t}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let r=0;r<256;r++)stringTable.push([r]);const e=[];for(let r=256;r<4096;r++)stringTable.push(e)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(r){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),this.outData=new IOBuffer(r.byteLength),this.initializeTable()}decode(){let r=0,t=0;for(;(r=this.getNextCode())!==EOI_CODE;)if(r===CLEAR_CODE){if(this.initializeTable(),r=this.getNextCode(),r===EOI_CODE)break;this.writeString(this.stringFromCode(r)),t=r}else if(this.isInTable(r))this.writeString(this.stringFromCode(r)),this.addStringToTable(this.stringFromCode(t).concat(this.stringFromCode(r)[0])),t=r;else{const n=this.stringFromCode(t).concat(this.stringFromCode(t)[0]);this.writeString(n),this.addStringToTable(n),t=r}const i=this.outData.toArray();return new DataView(i.buffer,i.byteOffset,i.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(r){this.outData.writeBytes(r)}stringFromCode(r){return stringTable[r]}isInTable(r){return r<this.tableLength}addStringToTable(r){if(stringTable[this.tableLength++]=r,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const r=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:r}}function decompressLzw(e){return new LzwDecoder(e).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let r=new Date,t=dateTimeRegex.exec(this.dateTime);if(t===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return r.setFullYear(Number(t[1]),Number(t[2])-1,Number(t[3])),r.setHours(Number(t[4]),Number(t[5]),Number(t[6])),r}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const r=this.get("BitsPerSample");return r&&typeof r!="number"?r[0]:r}get alpha(){const r=this.extraSamples;return r?r[0]!==0:!1}get associatedAlpha(){const r=this.extraSamples;return r?r[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const r=2**this.bitsPerSample,t=this.get("ColorMap");if(!t)return;if(t.length!==3*r)throw new Error(`ColorMap size must be ${r}`);const i=[];for(let n=0;n<r;n++)i.push([t[n],t[n+r],t[n+2*r]]);return i}}function alwaysArray(e){return typeof e=="number"?[e]:e}function decompressZlib(e){const r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),t=inflate_1(r);return new DataView(t.buffer,t.byteOffset,t.byteLength)}const defaultOptions$3={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer{constructor(r){super(r),this._nextIFD=0}get isMultiPage(){let r=0;for(this.decodeHeader();this._nextIFD;)if(r++,this.decodeIFD({ignoreImageData:!0},!0),r===2)return!0;if(r===1)return!1;throw unsupported("ifdCount",r)}get pageCount(){let r=0;for(this.decodeHeader();this._nextIFD;)r++,this.decodeIFD({ignoreImageData:!0},!0);if(r>0)return r;throw unsupported("ifdCount",r)}decode(r={}){r=Object.assign({},defaultOptions$3,r);const t=[];for(this.decodeHeader();this._nextIFD;)if(t.push(this.decodeIFD(r,!0)),r.onlyFirst)return[t[0]];return t}decodeHeader(){const r=this.readUint16();if(r===18761)this.setLittleEndian();else if(r===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${r.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(r,t){this.seek(this._nextIFD);let i;if(t)i=new TiffIfd;else{if(!r.kind)throw new Error("kind is missing");i=new IFD(r.kind)}const n=this.readUint16();for(let s=0;s<n;s++)this.decodeIFDEntry(i);if(!r.ignoreImageData){if(!(i instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(i)}return this._nextIFD=this.readUint32(),i}decodeIFDEntry(r){const t=this.offset,i=this.readUint16(),n=this.readUint16(),s=this.readUint32();if(n<1||n>12){this.skip(4);return}getByteLength(n,s)>4&&this.seek(this.readUint32());const h=readData(this,n,s);if(r.fields.set(i,h),i===34665||i===34853){let d=this.offset,u="exif";i===34665?u="exif":i===34853&&(u="gps"),this._nextIFD=h,r[u]=this.decodeIFD({kind:u,ignoreImageData:!0},!1),this.offset=d}this.seek(t),this.skip(12)}decodeImageData(r){const t=r.orientation;if(t&&t!==1)throw unsupported("orientation",t);switch(r.type){case 0:case 1:case 2:case 3:this.readStripData(r);break;default:throw unsupported("image type",r.type)}if(this.applyPredictor(r),this.convertAlpha(r),r.type===0){const i=r.bitsPerSample,n=Math.pow(2,i)-1;for(let s=0;s<r.data.length;s++)r.data[s]=n-r.data[s]}}readStripData(r){const t=r.width,i=r.height,n=r.bitsPerSample,s=r.sampleFormat,a=t*i*r.samplesPerPixel,h=getDataArray(a,n,s),u=r.rowsPerStrip*t*r.samplesPerPixel,g=r.stripOffsets,_=r.stripByteCounts||guessStripByteCounts(r);let w=a,p=0;for(let b=0;b<g.length;b++){let y=new DataView(this.buffer,this.byteOffset+g[b],_[b]),M=w>u?u:w;w-=M;let A=y;switch(r.compression){case 1:break;case 5:{A=decompressLzw(y);break}case 8:{A=decompressZlib(y);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",r.compression)}p=this.fillUncompressed(n,s,h,A,p,M)}r.data=h}fillUncompressed(r,t,i,n,s,a){if(r===8)return fill8bit(i,n,s,a);if(r===16)return fill16bit(i,n,s,a,this.isLittleEndian());if(r===32&&t===3)return fillFloat32(i,n,s,a,this.isLittleEndian());throw unsupported("bitDepth",r)}applyPredictor(r){const t=r.bitsPerSample;switch(r.predictor){case 1:break;case 2:{if(t===8)applyHorizontalDifferencing8Bit(r.data,r.width,r.components);else if(t===16)applyHorizontalDifferencing16Bit(r.data,r.width,r.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${t}`);break}default:throw new Error(`invalid predictor: ${r.predictor}`)}}convertAlpha(r){if(r.alpha&&r.associatedAlpha){const{data:t,components:i,maxSampleValue:n}=r;for(let s=0;s<t.length;s+=i){const a=t[s+i-1];for(let h=0;h<i-1;h++)t[s+h]=Math.round(t[s+h]*n/a)}}}}function getDataArray(e,r,t){if(r===8)return new Uint8Array(e);if(r===16)return new Uint16Array(e);if(r===32&&t===3)return new Float32Array(e);throw unsupported("bit depth / sample format",`${r} / ${t}`)}function fill8bit(e,r,t,i){for(let n=0;n<i;n++)e[t++]=r.getUint8(n);return t}function fill16bit(e,r,t,i,n){for(let s=0;s<i*2;s+=2)e[t++]=r.getUint16(s,n);return t}function fillFloat32(e,r,t,i,n){for(let s=0;s<i*4;s+=4)e[t++]=r.getFloat32(s,n);return t}function unsupported(e,r){return new Error(`Unsupported ${e}: ${r}`)}function decodeTIFF(e,r){return new TIFFDecoder(e).decode(r)}function matchAndCrop(e={}){let{algorithm:r="matchToPrevious",ignoreBorder:t=[0,0]}=e;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let i=r==="matchToPrevious",n=this[0],s=[];s[0]={position:[0,0],image:this[0]};let a=[0,0];for(let w=1;w<this.length;w++){let p=n.getBestMatch(this[w],{border:t});s[w]={position:[p[0]+a[0],p[1]+a[1]],image:this[w]},i&&(a[0]+=p[0],a[1]+=p[1],n=this[w])}let h=0,d=0,u=0,g=0;for(let w=0;w<s.length;w++){let p=s[w];p.position[0]>h&&(h=p.position[0]),p.position[0]<d&&(d=p.position[0]),p.position[1]>u&&(u=p.position[1]),p.position[1]<g&&(g=p.position[1])}d=0-d,g=0-g;for(let w=0;w<s.length;w++){let p=s[w];p.crop=p.image.crop({x:h-p.position[0],y:u-p.position[1],width:n.width-d-h,height:n.height-g-u})}let _=[];for(let w=0;w<s.length;w++)_[w]=s[w].crop;return new Stack(_)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].min;for(let r=1;r<this.length;r++)for(let t=0;t<e.length;t++)e[t]=Math.min(e[t],this[r].min[t]);return e}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].max;for(let r=1;r<this.length;r++)for(let t=0;t<e.length;t++)e[t]=Math.max(e[t],this[r].max[t]);return e}function median$2(e){let r=e.reduce((a,h)=>a+h);if(r===0)throw new Error("unreachable");let t=0,i=0,n=r/2,s;for(;;){if(e[t]>0){if(s!==void 0)return(s+t)/2;if(i+=e[t],i>n)return t;i===n&&(s=t)}t++}}function mean$2(e){let r=0,t=0;for(let i=0;i<e.length;i++)r+=e[i],t+=e[i]*i;return r===0?0:t/r}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let e=this.getHistograms({maxSlots:this[0].maxValue+1}),r=new Array(e.length);for(let t=0;t<e.length;t++){let i=e[t];r[t]=median$2(i)}return r}function histogram(e){this.checkProcessable("min",{bitDepth:[8,16]});let r=this[0].getHistogram(e);for(let t=1;t<this.length;t++){let i=this[t].getHistogram(e);for(let n=0;n<r.length;n++)r[n]+=i[n]}return r}function histograms(e){this.checkProcessable("min",{bitDepth:[8,16]});let r=this[0].getHistograms(e),t=r[0].length;for(let i=1;i<this.length;i++){let n=this[i].getHistograms(e);for(let s=0;s<r.length;s++)for(let a=0;a<t;a++)r[s][a]+=n[s][a]}return r}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let e=new Uint32Array(this[0].data.length);for(let i=0;i<this.length;i++){let n=this[i];for(let s=0;s<this[0].data.length;s++)e[s]+=n.data[s]}let r=Image.createFrom(this[0]),t=r.data;for(let i=0;i<this[0].data.length;i++)t[i]=e[i]/this.length;return r}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image.createFrom(this[0]);e.data.fill(0);for(const r of this)for(let t=0;t<e.data.length;t++)e.data[t]=Math.max(r.data[t],e.data[t]);return e}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image.createFrom(this[0]);e.data.fill(e.maxValue);for(const r of this)for(let t=0;t<e.data.length;t++)e.data[t]=Math.min(r.data[t],e.data[t]);return e}function extend$2(e){e.extendMethod("matchAndCrop",matchAndCrop),e.extendMethod("getMin",min$2),e.extendMethod("getMax",max$2),e.extendMethod("getMedian",median$1),e.extendMethod("getHistogram",histogram),e.extendMethod("getHistograms",histograms),e.extendMethod("getAverage",averageImage),e.extendMethod("getAverageImage",averageImage),e.extendMethod("getMaxImage",maxImage),e.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(r){if(Array.isArray(r)){super(r.length);for(let t=0;t<r.length;t++)this[t]=r[t]}else typeof r=="number"?super(r):super();this.computed=null}static load(r){return Promise.all(r.map(Image.load)).then(t=>new Stack(t))}static extendMethod(r,t,i={}){let{inPlace:n=!1,returnThis:s=!0,partialArgs:a=[]}=i;return n?Stack.prototype[r]=function(...h){this.computed=null;let d=t.apply(this,[...a,...h]);return s?this:d}:Stack.prototype[r]=function(...h){return t.apply(this,[...a,...h])},Stack}static extendProperty(r,t,i={}){let{partialArgs:n=[]}=i;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(r,this.computed))return this.computed[r];let s=t.apply(this,n);return this.computed[r]=s,s},Object.defineProperty(Stack.prototype,r,computedPropertyDescriptor),Stack}checkProcessable(r,t={}){if(typeof r!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${r} can not be applied on an empty stack`);this[0].checkProcessable(r,t);for(let i=1;i<this.length;i++){if((t.sameSize===void 0||t.sameSize)&&this[0].width!==this[i].width)throw new TypeError(`The process: ${r} can not be applied if width is not identical in all images`);if((t.sameSize===void 0||t.sameSize)&&this[0].height!==this[i].height)throw new TypeError(`The process: ${r} can not be applied if height is not identical in all images`);if((t.sameAlpha===void 0||t.sameAlpha)&&this[0].alpha!==this[i].alpha)throw new TypeError(`The process: ${r} can not be applied if alpha is not identical in all images`);if((t.sameBitDepth===void 0||t.sameBitDepth)&&this[0].bitDepth!==this[i].bitDepth)throw new TypeError(`The process: ${r} can not be applied if bitDepth is not identical in all images`);if((t.sameColorModel===void 0||t.sameColorModel)&&this[0].colorModel!==this[i].colorModel)throw new TypeError(`The process: ${r} can not be applied if colorModel is not identical in all images`);if((t.sameNumberChannels===void 0||t.sameNumberChannels)&&this[0].channels!==this[i].channels)throw new TypeError(`The process: ${r} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(e,r){if(typeof e!="function")throw new TypeError(`${e} is not a function`);let t=new Stack(this.length);for(let i=0;i<this.length;i++)t[i]=e.call(r,this[i],i,this);return t});extend$2(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(e,r){if(typeof e=="string")return loadURL(e,r);if(e instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(e),void 0,r&&r.ignorePalette));if(e.buffer)return Promise.resolve(loadBinary(e,void 0,r&&r.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(e,r,t){const i=imageType(e);if(i)switch(i.mime){case"image/png":return loadPNG(e);case"image/jpeg":return loadJPEG(e);case"image/tiff":return loadTIFF(e,t);default:return loadGeneric(n(i.mime))}return loadGeneric(n("application/octet-stream"));function n(s){return r||toBase64URL(e,s)}}function loadURL(e,r){const t=e.slice(0,64).match(isDataURL);let i;return t!==null?i=Promise.resolve(decode$1(e.slice(t[0].length))):i=fetchBinary(e,r),i.then(n=>{const s=new Uint8Array(n);return loadBinary(s,t?e:void 0,r&&r.ignorePalette)})}function loadPNG(e){const r=decodePng(e);let t=r.channels,i,n=0;return t===2||t===4?(i=t-1,n=1):i=t,r.palette?loadPNGFromPalette(r):new Image(r.width,r.height,r.data,{components:i,alpha:n,bitDepth:r.depth,meta:{text:r.text}})}function loadPNGFromPalette(e){const r=e.width*e.height,t=e.palette[0].length,i=new Uint8Array(r*t),n=8/e.depth,s=e.depth<8?n:1,a=parseInt("1".repeat(e.depth),2),h=t===4;let d=0;for(let u=0;u<r;u++){const g=Math.floor(u/s);let _=e.data[g];e.depth<8&&(_=_>>>e.depth*(n-1-u%n)&a);const w=e.palette[_];i[d++]=w[0],i[d++]=w[1],i[d++]=w[2],h&&(i[d++]=w[3])}return new Image(e.width,e.height,i,{components:3,alpha:h,bitDepth:8})}function loadJPEG(e){const r=srcExports$2.decode(e);let t;r.exif&&(t=getMetadata(r.exif));const i=jpegJsExports.decode(e,{useTArray:!0,maxMemoryUsageInMB:1024});let n=new Image(i.width,i.height,i.data,{meta:t});if(t&&t.tiff.tags.Orientation){const s=t.tiff.tags.Orientation;s>2&&(n=n.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[s])),[2,4,5,7].includes(s)&&(n=n.flipX())}return n}function loadTIFF(e,r){let t=decodeTIFF(e);return t.length===1?getImageFromIFD(t[0],r):new Stack(t.map(function(i){return getImageFromIFD(i,r)}))}function getMetadata(e){const r={tiff:{fields:e.fields,tags:e.map}};return e.exif&&(r.exif=e.exif),e.gps&&(r.gps=e.gps),r}function getImageFromIFD(e,r){if(!r&&e.type===3){const t=new Uint16Array(3*e.width*e.height),i=e.palette;let n=0;for(let s=0;s<e.data.length;s++){const a=e.data[s],h=i[a];t[n++]=h[0],t[n++]=h[1],t[n++]=h[2]}return new Image(e.width,e.height,t,{components:3,alpha:e.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(e)})}else return new Image(e.width,e.height,e.data,{components:e.type===2?3:1,alpha:e.alpha,colorModel:e.type===2?RGB$1:GREY$1,bitDepth:e.bitsPerSample.length?e.bitsPerSample[0]:e.bitsPerSample,meta:getMetadata(e)})}function loadGeneric(e,r){return r=r||{},new Promise(function(t,i){let n=new DOMImage;n.onload=function(){let s=n.width,a=n.height,d=createCanvas(s,a).getContext("2d");d.drawImage(n,0,0,s,a);let u=d.getImageData(0,0,s,a).data;t(new Image(s,a,u,r))},n.onerror=function(){i(new Error(`Could not load ${e}`))},n.src=e})}const valueMethods={getValueXY(e,r,t){return this.data[(r*this.width+e)*this.channels+t]},setValueXY(e,r,t,i){return this.data[(r*this.width+e)*this.channels+t]=i,this.computed=null,this},getValue(e,r){return this.data[e*this.channels+r]},setValue(e,r,t){return this.data[e*this.channels+r]=t,this.computed=null,this},getPixelXY(e,r){return this.getPixel(r*this.width+e)},setPixelXY(e,r,t){return this.setPixel(r*this.width+e,t)},getPixel(e){const r=new Array(this.channels),t=e*this.channels;for(let i=0;i<this.channels;i++)r[i]=this.data[t+i];return r},setPixel(e,r){const t=e*this.channels;for(let i=0;i<r.length;i++)this.data[t+i]=r[i];return this.computed=null,this}};function setValueMethods(e){for(const r in valueMethods)e.prototype[r]=valueMethods[r]}function getImageParameters(e){return{width:e.width,height:e.height,components:e.components,alpha:e.alpha,colorModel:e.colorModel,bitDepth:e.bitDepth}}function getOutputImage(e,r,t,i={}){const{out:n}=r;if(n===void 0)return i.copy?e.clone():Image.createFrom(e,t);{if(!Image.isImage(n))throw new TypeError("out must be an Image object");const s=Object.assign(getImageParameters(e),t);for(const a in s)if(n[a]!==s[a])throw new RangeError(`cannot use out. Its ${a} must be "${s[a]}" (found "${n[a]}")`);return n}}function getOutputImageOrInPlace(e,r,t){if(r.inPlace!==void 0&&typeof r.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(r.inPlace){if(r.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return e}return getOutputImage(e,r,null,t)}function abs(e={}){this.checkProcessable("abs",{bitDepth:[32]});const r=getOutputImageOrInPlace(this,e);return absolute(this,r),r}function absolute(e,r){for(let t=0;t<e.data.length;t++)r.data[t]=Math.abs(e.data[t])}function copyAlphaChannel(e,r){if(e.alpha===1&&r.alpha===1)for(let t=0;t<e.size;t++)r.data[t*r.channels+r.components]=e.data[t*e.channels+e.components]}function invert(e={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const r=getOutputImageOrInPlace(this,e);return this.bitDepth===1?invertBinary(this,r):(invertColor(this,r),this!==r&&copyAlphaChannel(this,r)),r}function invertBinary(e,r){for(let t=0;t<e.data.length;t++)r.data[t]=~e.data[t]}function invertColor(e,r){for(let t=0;t<e.data.length;t+=e.channels)for(let i=0;i<e.components;i++)r.data[t+i]=e.maxValue-e.data[t+i]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let e=0;e<this.height;e++){let r=e*this.width*this.channels;for(let t=0;t<Math.floor(this.width/2);t++){let i=t*this.channels+r,n=(this.width-t-1)*this.channels+r;for(let s=0;s<this.channels;s++){let a=this.data[i+s];this.data[i+s]=this.data[n+s],this.data[n+s]=a}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let e=0;e<Math.floor(this.height/2);e++)for(let r=0;r<this.width;r++){let t=r*this.channels+e*this.width*this.channels,i=r*this.channels+(this.height-1-e)*this.channels*this.width;for(let n=0;n<this.channels;n++){let s=this.data[t+n];this.data[t+n]=this.data[i+n],this.data[i+n]=s}}return this}function blurFilter(e={}){const{radius:r=1}=e;if(r<1)throw new Error("radius must be greater than 1");const t=2*r+1,i=new Array(t);for(let n=0;n<t;n++){i[n]=new Array(t);for(let s=0;s<t;s++)i[n][s]=1/(t*t)}return this.convolution(i)}var medianQuickselect_min={exports:{}},hasRequiredMedianQuickselect_min;function requireMedianQuickselect_min(){return hasRequiredMedianQuickselect_min||(hasRequiredMedianQuickselect_min=1,function(e){(function(){function r(n){for(var s=0,a=n.length-1,h=void 0,d=void 0,u=void 0,g=i(s,a);;){if(a<=s)return n[g];if(a==s+1)return n[s]>n[a]&&t(n,s,a),n[g];for(h=i(s,a),n[h]>n[a]&&t(n,h,a),n[s]>n[a]&&t(n,s,a),n[h]>n[s]&&t(n,h,s),t(n,h,s+1),d=s+1,u=a;;){do d++;while(n[s]>n[d]);do u--;while(n[u]>n[s]);if(u<d)break;t(n,d,u)}t(n,s,u),u<=g&&(s=d),u>=g&&(a=u-1)}}var t=function(s,a,h){var d;return d=[s[h],s[a]],s[a]=d[0],s[h]=d[1],d},i=function(s,a){return~~((s+a)/2)};e.exports?e.exports=r:window.median=r})()}(medianQuickselect_min)),medianQuickselect_min.exports}var medianQuickselect_minExports=requireMedianQuickselect_min();const quickSelectMedian=getDefaultExportFromCjs(medianQuickselect_minExports);function validateArrayOfChannels(e,r={}){let{channels:t,allowAlpha:i,defaultAlpha:n}=r;return typeof i!="boolean"&&(i=!0),typeof t>"u"?allChannels(e,n):validateChannels(e,t,i)}function allChannels(e,r){let t=r?e.channels:e.components,i=new Array(t);for(let n=0;n<t;n++)i[n]=n;return i}function validateChannels(e,r,t){Array.isArray(r)||(r=[r]);for(let i=0;i<r.length;i++)r[i]=validateChannel(e,r[i],t);return r}function validateChannel(e,r,t=!0){if(r===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(typeof r=="string"){switch(e.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(r))switch(r){case"r":r=0;break;case"g":r=1;break;case"b":r=2;break}break;case HSL:if("hsl".includes(r))switch(r){case"h":r=0;break;case"s":r=1;break;case"l":r=2;break}break;case HSV:if("hsv".includes(r))switch(r){case"h":r=0;break;case"s":r=1;break;case"v":r=2;break}break;case CMYK$1:if("cmyk".includes(r))switch(r){case"c":r=0;break;case"m":r=1;break;case"y":r=2;break;case"k":r=3;break}break;default:throw new Error(`Unexpected color model: ${e.colorModel}`)}if(r==="a"){if(!e.alpha)throw new Error("validateChannel : the image does not contain alpha channel");r=e.components}if(typeof r=="string")throw new Error(`validateChannel : undefined channel: ${r}`)}if(r>=e.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(!t&&r>=e.components)throw new RangeError("validateChannel : alpha channel may not be selected");return r}function medianFilter(e={}){let{radius:r=1,border:t="copy",channels:i}=e;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),r<1)throw new Error("radius must be greater than 0");i=validateArrayOfChannels(this,i);let n=r,s=r,a=Image.createFrom(this),h=(n*2+1)*(s*2+1),d=new Array(h);for(let u=0;u<i.length;u++){let g=i[u];for(let _=s;_<this.height-s;_++)for(let w=n;w<this.width-n;w++){let p=0;for(let y=-s;y<=s;y++)for(let M=-n;M<=n;M++){let A=((_+y)*this.width+w+M)*this.channels+g;d[p++]=this.data[A]}let b=(_*this.width+w)*this.channels+g;a.data[b]=quickSelectMedian(d)}}if(this.alpha&&!i.includes(this.channels))for(let u=this.components;u<this.data.length;u=u+this.channels)a.data[u]=this.data[u];return a.setBorder({size:[n,s],algorithm:t}),a}function gaussianFilter(e={}){let{radius:r=1,sigma:t,channels:i,border:n="copy"}=e;this.checkProcessable("gaussian",{bitDepth:[8,16]});const s=getKernel(r,t);return this.convolution([s,s],{border:n,channels:i,algorithm:"separable"})}function getKernel(e,r){const t=e*2+1,i=new Array(t),n=r||((t-1)*.5-1)*.3+.8,s=-.5/(n*n);let a=0;for(let h=0;h<t;h++){const d=h-e,u=Math.exp(s*d*d);i[h]=u,a+=u}for(let h=0;h<t;h++)i[h]/=a;return i}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$2={},fftlib={},hasRequiredFftlib;function requireFftlib(){return hasRequiredFftlib||(hasRequiredFftlib=1,function(e){(function(){var r;r=e;var t={release:"0.3.0",date:"2013-03"};r.toString=function(){return"version "+t.release+", released "+t.date};for(var i=0,n=null,s=null,a={init:function(u){if(u!==0&&(u&u-1)===0)i=u,a._initArray(),a._makeBitReversalTable(),a._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(u,g){a.fft(u,g,1)},ifft1d:function(u,g){var _=1/i;a.fft(u,g,-1);for(var w=0;w<i;w++)u[w]*=_,g[w]*=_},bt1d:function(u,g){a.fft(u,g,-1)},fft2d:function(u,g){for(var _=[],w=[],p=0,b=0;b<i;b++){p=b*i;for(var y=0;y<i;y++)_[y]=u[y+p],w[y]=g[y+p];a.fft1d(_,w);for(var M=0;M<i;M++)u[M+p]=_[M],g[M+p]=w[M]}for(var A=0;A<i;A++){for(var C=0;C<i;C++)p=A+C*i,_[C]=u[p],w[C]=g[p];a.fft1d(_,w);for(var v=0;v<i;v++)p=A+v*i,u[p]=_[v],g[p]=w[v]}},ifft2d:function(u,g){for(var _=[],w=[],p=0,b=0;b<i;b++){p=b*i;for(var y=0;y<i;y++)_[y]=u[y+p],w[y]=g[y+p];a.ifft1d(_,w);for(var M=0;M<i;M++)u[M+p]=_[M],g[M+p]=w[M]}for(var A=0;A<i;A++){for(var C=0;C<i;C++)p=A+C*i,_[C]=u[p],w[C]=g[p];a.ifft1d(_,w);for(var v=0;v<i;v++)p=A+v*i,u[p]=_[v],g[p]=w[v]}},fft:function(u,g,_){for(var w,p,b,y,M,A,C,v,E,R=i>>2,$=0;$<i;$++)y=n[$],$<y&&(M=u[$],u[$]=u[y],u[y]=M,M=g[$],g[$]=g[y],g[y]=M);for(var L=1;L<i;L<<=1){p=0,w=i/(L<<1);for(var D=0;D<L;D++){A=s[p+R],C=_*s[p];for(var B=D;B<i;B+=L<<1)b=B+L,v=A*u[b]+C*g[b],E=A*g[b]-C*u[b],u[b]=u[B]-v,u[B]+=v,g[b]=g[B]-E,g[B]+=E;p+=w}}},_initArray:function(){typeof Uint32Array<"u"?n=new Uint32Array(i):n=[],typeof Float64Array<"u"?s=new Float64Array(i*1.25):s=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var u=0,g=0,_=0;for(n[0]=0;++u<i;){for(_=i>>1;_<=g;)g-=_,_>>=1;g+=_,n[u]=g}},_makeCosSinTable:function(){var u=i>>1,g=i>>2,_=i>>3,w=u+g,p=Math.sin(Math.PI/i),b=2*p*p,y=Math.sqrt(b*(2-b)),M=s[g]=1,A=s[0]=0;p=2*b;for(var C=1;C<_;C++)M-=b,b+=p*M,A+=y,y-=p*A,s[C]=A,s[g-C]=M;_!==0&&(s[_]=Math.sqrt(.5));for(var v=0;v<g;v++)s[u-v]=s[v];for(var E=0;E<w;E++)s[E+u]=-s[E]}},h=["init","fft1d","ifft1d","fft2d","ifft2d"],d=0;d<h.length;d++)r[h[d]]=a[h[d]];return r.bt=a.bt1d,r.fft=a.fft1d,r.ifft=a.ifft1d,r}).call(fftlib)}(fftlib)),fftlib}var FFTUtils_1,hasRequiredFFTUtils;function requireFFTUtils(){if(hasRequiredFFTUtils)return FFTUtils_1;hasRequiredFFTUtils=1;var e=requireFftlib(),r={DEBUG:!1,ifft2DArray:function(t,i,n){var s=new Array(i*n),a=i/2,h=(n-1)*2;e.init(a);for(var d={re:new Array(a),im:new Array(a)},u=0;u<n;u++){for(var g=a-1;g>=0;g--)d.re[g]=t[g*2*n+u],d.im[g]=t[(g*2+1)*n+u];e.bt(d.re,d.im);for(var g=a-1;g>=0;g--)s[g*2*n+u]=d.re[g],s[(g*2+1)*n+u]=d.im[g]}var _=new Array(a*h);e.init(h);for(var w={re:new Array(h),im:new Array(h)},p=h*a,g=0;g<i;g+=2){w.re[0]=s[g*n],w.im[0]=s[(g+1)*n];for(var u=1;u<n;u++)w.re[u]=s[g*n+u],w.im[u]=s[(g+1)*n+u],w.re[h-u]=s[g*n+u],w.im[h-u]=-s[(g+1)*n+u];e.bt(w.re,w.im);for(var b=g/2*h,u=h-1;u>=0;u--)_[b+u]=w.re[u]/p}return _},fft2DArray:function(t,i,n,s){Object.assign({},{inplace:!0});var a=n/2+1,h=i*2,d=new Array(h*a);e.init(n);for(var u={re:new Array(n),im:new Array(n)},g={re:new Array(n),im:new Array(n)},_={re:new Array(n),im:new Array(n)},w,p,b,y,M,A=0;A<i/2;A++){w=A*2*n,u.re=t.slice(w,w+n),w=(A*2+1)*n,u.im=t.slice(w,w+n),e.fft1d(u.re,u.im),this.reconstructTwoRealFFT(u,g,_),p=A*4*a,b=(A*4+1)*a,y=(A*4+2)*a,M=(A*4+3)*a;for(var C=a-1;C>=0;C--)d[p+C]=g.re[C],d[b+C]=g.im[C],d[y+C]=_.re[C],d[M+C]=_.im[C]}g=null,_=null;var v=new Array(h*a);e.init(i);for(var E={re:new Array(i),im:new Array(i)},R=a-1;R>=0;R--){for(var A=i-1;A>=0;A--)E.re[A]=d[A*2*a+R],E.im[A]=d[(A*2+1)*a+R],isNaN(E.re[A])&&(E.re[A]=0),isNaN(E.im[A])&&(E.im[A]=0);e.fft1d(E.re,E.im);for(var A=i-1;A>=0;A--)v[A*2*a+R]=E.re[A],v[(A*2+1)*a+R]=E.im[A]}return v},reconstructTwoRealFFT:function(t,i,n){var s=t.re.length;i.re[0]=t.re[0],i.im[0]=0,n.re[0]=t.im[0],n.im[0]=0;for(var a,h,d,u,g,_=s/2;_>0;_--)g=s-_,a=.5*(t.re[_]-t.re[g]),h=.5*(t.re[_]+t.re[g]),d=.5*(t.im[_]-t.im[g]),u=.5*(t.im[_]+t.im[g]),i.re[_]=h,i.im[_]=d,i.re[g]=h,i.im[g]=-d,n.re[_]=u,n.im[_]=-a,n.re[g]=u,n.im[g]=a},convolute2DI:function(t,i,n,s){for(var a,h,d=0;d<n/2;d++)for(var u=0;u<s;u++)a=t[d*2*s+u]*i[d*2*s+u]-t[(d*2+1)*s+u]*i[(d*2+1)*s+u],h=t[d*2*s+u]*i[(d*2+1)*s+u]+t[(d*2+1)*s+u]*i[d*2*s+u],t[d*2*s+u]=a,t[(d*2+1)*s+u]=h},convolute:function(t,i,n,s,a){for(var h=new Array(s*n),d=0;d<n*s;d++)h[d]=t[d];h=this.fft2DArray(h,n,s);for(var u=i.length,g=i[0].length,_=new Array(s*n),d=0;d<s*n;d++)_[d]=0;for(var w,p,b=Math.floor((u-1)/2),y=Math.floor((g-1)/2),M=0;M<u;M++){w=(M-b+n)%n;for(var A=0;A<g;A++)p=(A-y+s)%s,_[w*s+p]=i[M][A]}_=this.fft2DArray(_,n,s);var C=n*2,v=s/2+1;return this.convolute2DI(h,_,C,v),this.ifft2DArray(h,C,v)},toRadix2:function(t,i,n){var s,a,h,d,u=n,g=i;if(!(n!==0&&(n&n-1)===0)){for(u=0;n>>++u!=0;);u=1<<u}if(!(i!==0&&(i&i-1)===0)){for(g=0;i>>++g!=0;);g=1<<g}if(g==i&&u==n)return{data:t,rows:i,cols:n};var _=new Array(g*u),w=Math.floor((g-i)/2)-i,p=Math.floor((u-n)/2)-n;for(s=0;s<g;s++)for(h=s*u,d=(s-w)%i*n,a=0;a<u;a++)_[h+a]=t[d+(a-p)%n];return{data:_,rows:g,cols:u}},crop:function(t,i,n,s,a,h){if(i==s&&n==a)return t;Object.assign({},h);var d=new Array(a*s),u=Math.floor((i-s)/2),g=Math.floor((n-a)/2),_,w,p,b;for(p=0;p<s;p++)for(_=p*a,w=(p+u)*n,b=0;b<a;b++)d[_+b]=t[w+(b+g)];return d}};return FFTUtils_1=r,FFTUtils_1}var hasRequiredSrc$2;function requireSrc$2(){return hasRequiredSrc$2||(hasRequiredSrc$2=1,src$2.FFTUtils=requireFFTUtils(),src$2.FFT=requireFftlib()),src$2}var src$1,hasRequiredSrc$1;function requireSrc$1(){if(hasRequiredSrc$1)return src$1;hasRequiredSrc$1=1;var e=requireSrc$2().FFTUtils;function r(s,a,h){var d=n(s),u=d.data,g=Object.assign({normalize:!1,divisor:1,rows:d.rows,cols:d.cols},h),_,w;if(g.rows&&g.cols)_=g.rows,w=g.cols;else throw new Error("Invalid number of rows or columns "+_+" "+w);var p=g.divisor,b,y,M=a.length,A=a[0].length;if(g.normalize)for(p=0,b=0;b<M;b++)for(y=0;y<A;y++)p+=a[b][y];if(p===0)throw new RangeError("convolution: The divisor is equal to zero");var C=e.toRadix2(u,_,w),v=e.convolute(C.data,a,C.rows,C.cols);if(v=e.crop(v,C.rows,C.cols,_,w),p!=0&&p!=1)for(b=0;b<v.length;b++)v[b]/=p;return v}function t(s,a,h){var d=n(s),u=d.data,g=Object.assign({normalize:!1,divisor:1,rows:d.rows,cols:d.cols},h),_,w;if(g.rows&&g.cols)_=g.rows,w=g.cols;else throw new Error("Invalid number of rows or columns "+_+" "+w);var p=g.divisor,b=a.length,y=a[0].length,M,A,C,v,E,R,$,L,D;if(g.normalize)for(p=0,M=0;M<b;M++)for(A=0;A<y;A++)p+=a[M][A];if(p===0)throw new RangeError("convolution: The divisor is equal to zero");var B=new Array(_*w),P=Math.floor(b/2),O=Math.floor(y/2);for(v=0;v<_;v++)for(C=0;C<w;C++){for(R=0,A=0;A<b;A++)for(M=0;M<y;M++)$=a[b-A-1][y-M-1],L=(v+A-P+_)%_,D=(C+M-O+w)%w,E=L*w+D,R+=u[E]*$;E=v*w+C,B[E]=R/p}return B}function i(s,a,h){var d=1e3;h&&h.factor&&(d=h.factor);var u=new Array(a),g,_,w,p;d*=-1;var b=(a-1)/2,y=2*s*s;for(g=0;g<a;g++)for(u[g]=new Array(a),p=(g-b)*(g-b),_=0;_<a;_++)w=-((_-b)*(_-b)+p)/y,u[g][_]=Math.round(d*(1+w)*Math.exp(w));return u}function n(s){var a=s,h,d;if(typeof s[0]!="number"){h=s.length,d=s[0].length,a=new Array(h*d);for(var u=0;u<h;u++)for(var g=0;g<d;g++)a[u*d+g]=s[u][g]}else{var _=Math.sqrt(s.length);Number.isInteger(_)&&(h=_,d=_)}return{data:a,rows:h,cols:d}}return src$1={fft:r,direct:t,kernelFactory:{LoG:i},matrix2Array:n},src$1}var srcExports$1=requireSrc$1(),_isFinite,hasRequired_isFinite;function require_isFinite(){return hasRequired_isFinite||(hasRequired_isFinite=1,_isFinite=Number.isFinite||function(e){return!(typeof e!="number"||e!==e||e===1/0||e===-1/0)}),_isFinite}var isInteger$1,hasRequiredIsInteger;function requireIsInteger(){if(hasRequiredIsInteger)return isInteger$1;hasRequiredIsInteger=1;var e=require_isFinite();return isInteger$1=Number.isInteger||function(r){return typeof r=="number"&&e(r)&&Math.floor(r)===r},isInteger$1}var isIntegerExports=requireIsInteger();const isInteger=getDefaultExportFromCjs(isIntegerExports);function validateKernel(e){let r,t;if(Array.isArray(e))if(Array.isArray(e[0])){if((e.length&1)===0||(e[0].length&1)===0)throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");r=Math.floor(e.length/2),t=Math.floor(e[0].length/2)}else{let i=Math.sqrt(e.length);if(isInteger(i))t=r=Math.floor(Math.sqrt(e.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let n=new Array(i);for(let s=0;s<i;s++){n[s]=new Array(i);for(let a=0;a<i;a++)n[s][a]=e[s*i+a]}e=n}else throw new Error(`validateKernel: Invalid Kernel: ${e}`);return{kernel:e,kWidth:t,kHeight:r}}function clamp(e,r){return Math.round(Math.min(Math.max(e,0),r.maxValue))}function directConvolution(e,r,t){if(t===void 0){const s=e.length+r.length-1;t=new Array(s)}fill(t);for(var i=0;i<e.length;i++)for(var n=0;n<r.length;n++)t[i+n]+=e[i]*r[n];return t}function fill(e){for(var r=0;r<e.length;r++)e[r]=0}var fft,hasRequiredFft;function requireFft(){if(hasRequiredFft)return fft;hasRequiredFft=1;function e(r){if(this.size=r|0,this.size<=1||(this.size&this.size-1)!==0)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=r<<1;for(var t=new Array(this.size*2),i=0;i<t.length;i+=2){const u=Math.PI*i/this.size;t[i]=Math.cos(u),t[i+1]=-Math.sin(u)}this.table=t;for(var n=0,s=1;this.size>s;s<<=1)n++;this._width=n%2===0?n-1:n,this._bitrev=new Array(1<<this._width);for(var a=0;a<this._bitrev.length;a++){this._bitrev[a]=0;for(var h=0;h<this._width;h+=2){var d=this._width-h-2;this._bitrev[a]|=(a>>>h&3)<<d}}this._out=null,this._data=null,this._inv=0}return fft=e,e.prototype.fromComplexArray=function(t,i){for(var n=i||new Array(t.length>>>1),s=0;s<t.length;s+=2)n[s>>>1]=t[s];return n},e.prototype.createComplexArray=function(){const t=new Array(this._csize);for(var i=0;i<t.length;i++)t[i]=0;return t},e.prototype.toComplexArray=function(t,i){for(var n=i||this.createComplexArray(),s=0;s<n.length;s+=2)n[s]=t[s>>>1],n[s+1]=0;return n},e.prototype.completeSpectrum=function(t){for(var i=this._csize,n=i>>>1,s=2;s<n;s+=2)t[i-s]=t[s],t[i-s+1]=-t[s+1]},e.prototype.transform=function(t,i){if(t===i)throw new Error("Input and output buffers must be different");this._out=t,this._data=i,this._inv=0,this._transform4(),this._out=null,this._data=null},e.prototype.realTransform=function(t,i){if(t===i)throw new Error("Input and output buffers must be different");this._out=t,this._data=i,this._inv=0,this._realTransform4(),this._out=null,this._data=null},e.prototype.inverseTransform=function(t,i){if(t===i)throw new Error("Input and output buffers must be different");this._out=t,this._data=i,this._inv=1,this._transform4();for(var n=0;n<t.length;n++)t[n]/=this.size;this._out=null,this._data=null},e.prototype._transform4=function(){var t=this._out,i=this._csize,n=this._width,s=1<<n,a=i/s<<1,h,d,u=this._bitrev;if(a===4)for(h=0,d=0;h<i;h+=a,d++){const M=u[d];this._singleTransform2(h,M,s)}else for(h=0,d=0;h<i;h+=a,d++){const M=u[d];this._singleTransform4(h,M,s)}var g=this._inv?-1:1,_=this.table;for(s>>=2;s>=2;s>>=2){a=i/s<<1;var w=a>>>2;for(h=0;h<i;h+=a)for(var p=h+w,b=h,y=0;b<p;b+=2,y+=s){const M=b,A=M+w,C=A+w,v=C+w,E=t[M],R=t[M+1],$=t[A],L=t[A+1],D=t[C],B=t[C+1],P=t[v],O=t[v+1],Y=E,te=R,H=_[y],J=g*_[y+1],Ce=$*H-L*J,Pe=$*J+L*H,le=_[2*y],ye=g*_[2*y+1],xe=D*le-B*ye,Ie=D*ye+B*le,ie=_[3*y],Ee=g*_[3*y+1],he=P*ie-O*Ee,z=P*Ee+O*ie,de=Y+xe,ke=te+Ie,ve=Y-xe,Me=te-Ie,Fe=Ce+he,$e=Pe+z,je=g*(Ce-he),Oe=g*(Pe-z),fe=de+Fe,re=ke+$e,Le=de-Fe,Se=ke-$e,Te=ve+Oe,X=Me-je,me=ve-Oe,ge=Me+je;t[M]=fe,t[M+1]=re,t[A]=Te,t[A+1]=X,t[C]=Le,t[C+1]=Se,t[v]=me,t[v+1]=ge}}},e.prototype._singleTransform2=function(t,i,n){const s=this._out,a=this._data,h=a[i],d=a[i+1],u=a[i+n],g=a[i+n+1],_=h+u,w=d+g,p=h-u,b=d-g;s[t]=_,s[t+1]=w,s[t+2]=p,s[t+3]=b},e.prototype._singleTransform4=function(t,i,n){const s=this._out,a=this._data,h=this._inv?-1:1,d=n*2,u=n*3,g=a[i],_=a[i+1],w=a[i+n],p=a[i+n+1],b=a[i+d],y=a[i+d+1],M=a[i+u],A=a[i+u+1],C=g+b,v=_+y,E=g-b,R=_-y,$=w+M,L=p+A,D=h*(w-M),B=h*(p-A),P=C+$,O=v+L,Y=E+B,te=R-D,H=C-$,J=v-L,Ce=E-B,Pe=R+D;s[t]=P,s[t+1]=O,s[t+2]=Y,s[t+3]=te,s[t+4]=H,s[t+5]=J,s[t+6]=Ce,s[t+7]=Pe},e.prototype._realTransform4=function(){var t=this._out,i=this._csize,n=this._width,s=1<<n,a=i/s<<1,h,d,u=this._bitrev;if(a===4)for(h=0,d=0;h<i;h+=a,d++){const Ge=u[d];this._singleRealTransform2(h,Ge>>>1,s>>>1)}else for(h=0,d=0;h<i;h+=a,d++){const Ge=u[d];this._singleRealTransform4(h,Ge>>>1,s>>>1)}var g=this._inv?-1:1,_=this.table;for(s>>=2;s>=2;s>>=2){a=i/s<<1;var w=a>>>1,p=w>>>1,b=p>>>1;for(h=0;h<i;h+=a)for(var y=0,M=0;y<=b;y+=2,M+=s){var A=h+y,C=A+p,v=C+p,E=v+p,R=t[A],$=t[A+1],L=t[C],D=t[C+1],B=t[v],P=t[v+1],O=t[E],Y=t[E+1],te=R,H=$,J=_[M],Ce=g*_[M+1],Pe=L*J-D*Ce,le=L*Ce+D*J,ye=_[2*M],xe=g*_[2*M+1],Ie=B*ye-P*xe,ie=B*xe+P*ye,Ee=_[3*M],he=g*_[3*M+1],z=O*Ee-Y*he,de=O*he+Y*Ee,ke=te+Ie,ve=H+ie,Me=te-Ie,Fe=H-ie,$e=Pe+z,je=le+de,Oe=g*(Pe-z),fe=g*(le-de),re=ke+$e,Le=ve+je,Se=Me+fe,Te=Fe-Oe;if(t[A]=re,t[A+1]=Le,t[C]=Se,t[C+1]=Te,y===0){var X=ke-$e,me=ve-je;t[v]=X,t[v+1]=me;continue}if(y!==b){var ge=Me,pe=-Fe,Q=ke,Ne=-ve,Ue=-g*fe,oe=-g*Oe,ue=-g*je,be=-g*$e,ce=ge+Ue,Re=pe+oe,Ye=Q+be,Ae=Ne-ue,ze=h+p-y,qe=h+w-y;t[ze]=ce,t[ze+1]=Re,t[qe]=Ye,t[qe+1]=Ae}}}},e.prototype._singleRealTransform2=function(t,i,n){const s=this._out,a=this._data,h=a[i],d=a[i+n],u=h+d,g=h-d;s[t]=u,s[t+1]=0,s[t+2]=g,s[t+3]=0},e.prototype._singleRealTransform4=function(t,i,n){const s=this._out,a=this._data,h=this._inv?-1:1,d=n*2,u=n*3,g=a[i],_=a[i+n],w=a[i+d],p=a[i+u],b=g+w,y=g-w,M=_+p,A=h*(_-p),C=b+M,v=y,E=-A,R=b-M,$=y,L=A;s[t]=C,s[t+1]=0,s[t+2]=v,s[t+3]=E,s[t+4]=R,s[t+5]=0,s[t+6]=$,s[t+7]=L},fft}requireFft();function convolutionSeparable(e,r,t,i){const n=new Array(e.length);let s,a,h,d;d=r[1],h=(d.length-1)/2,a=new Array(t+d.length-1),s=new Array(t);for(let u=0;u<i;u++){for(let g=0;g<t;g++)s[g]=e[u*t+g];directConvolution(s,d,a);for(let g=0;g<t;g++)n[u*t+g]=a[h+g]}d=r[0],h=(d.length-1)/2,a=new Array(i+d.length-1),s=new Array(i);for(let u=0;u<t;u++){for(let g=0;g<i;g++)s[g]=n[g*t+u];directConvolution(s,d,a);for(let g=0;g<i;g++)n[g*t+u]=a[h+g]}return n}var matrix$1={};const toString=Object.prototype.toString;function isAnyArray(e){const r=toString.call(e);return r.endsWith("Array]")&&!r.includes("Big")}const libEsm=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(libEsm);function max$1(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var t=r.fromIndex,i=t===void 0?0:t,n=r.toIndex,s=n===void 0?e.length:n;if(i<0||i>=e.length||!Number.isInteger(i))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=i||s>e.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=e[i],h=i+1;h<s;h++)e[h]>a&&(a=e[h]);return a}function min$1(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var t=r.fromIndex,i=t===void 0?0:t,n=r.toIndex,s=n===void 0?e.length:n;if(i<0||i>=e.length||!Number.isInteger(i))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=i||s>e.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=e[i],h=i+1;h<s;h++)e[h]<a&&(a=e[h]);return a}function rescale(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(e)){if(e.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var t;if(r.output!==void 0){if(!isAnyArray(r.output))throw new TypeError("output option must be an array if specified");t=r.output}else t=new Array(e.length);var i=min$1(e),n=max$1(e);if(i===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=r.min,a=s===void 0?r.autoMinMax?i:0:s,h=r.max,d=h===void 0?r.autoMinMax?n:1:h;if(a>=d)throw new RangeError("min option must be smaller than max option");for(var u=(d-a)/(n-i),g=0;g<e.length;g++)t[g]=(e[g]-i)*u+a;return t}const libEs6=Object.freeze(Object.defineProperty({__proto__:null,default:rescale},Symbol.toStringTag,{value:"Module"})),require$$1=getAugmentedNamespace(libEs6);var hasRequiredMatrix;function requireMatrix(){var ft,St,Je;if(hasRequiredMatrix)return matrix$1;hasRequiredMatrix=1,Object.defineProperty(matrix$1,"__esModule",{value:!0});var e=require$$0$1,r=require$$1;const t=" ".repeat(2),i=" ".repeat(4);function n(){return s(this)}function s(x,f={}){const{maxRows:l=15,maxColumns:o=10,maxNumSize:c=8,padMinus:m="auto"}=f;return`${x.constructor.name} {
${t}[
${i}${a(x,l,o,c,m)}
${t}]
${t}rows: ${x.rows}
${t}columns: ${x.columns}
}`}function a(x,f,l,o,c){const{rows:m,columns:S}=x,k=Math.min(m,f),T=Math.min(S,l),I=[];if(c==="auto"){c=!1;e:for(let q=0;q<k;q++)for(let F=0;F<T;F++)if(x.get(q,F)<0){c=!0;break e}}for(let q=0;q<k;q++){let F=[];for(let G=0;G<T;G++)F.push(h(x.get(q,G),o,c));I.push(`${F.join(" ")}`)}return T!==S&&(I[I.length-1]+=` ... ${S-l} more columns`),k!==m&&I.push(`... ${m-f} more rows`),I.join(`
${i}`)}function h(x,f,l){return(x>=0&&l?` ${d(x,f-1)}`:d(x,f)).padEnd(f)}function d(x,f){let l=x.toString();if(l.length<=f)return l;let o=x.toFixed(f);if(o.length>f&&(o=x.toFixed(Math.max(0,f-(o.length-f)))),o.length<=f&&!o.startsWith("0.000")&&!o.startsWith("-0.000"))return o;let c=x.toExponential(f);return c.length>f&&(c=x.toExponential(Math.max(0,f-(c.length-f)))),c.slice(0)}function u(x,f){x.prototype.add=function(o){return typeof o=="number"?this.addS(o):this.addM(o)},x.prototype.addS=function(o){for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)+o);return this},x.prototype.addM=function(o){if(o=f.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)+o.get(c,m));return this},x.add=function(o,c){return new f(o).add(c)},x.prototype.sub=function(o){return typeof o=="number"?this.subS(o):this.subM(o)},x.prototype.subS=function(o){for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)-o);return this},x.prototype.subM=function(o){if(o=f.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)-o.get(c,m));return this},x.sub=function(o,c){return new f(o).sub(c)},x.prototype.subtract=x.prototype.sub,x.prototype.subtractS=x.prototype.subS,x.prototype.subtractM=x.prototype.subM,x.subtract=x.sub,x.prototype.mul=function(o){return typeof o=="number"?this.mulS(o):this.mulM(o)},x.prototype.mulS=function(o){for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)*o);return this},x.prototype.mulM=function(o){if(o=f.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)*o.get(c,m));return this},x.mul=function(o,c){return new f(o).mul(c)},x.prototype.multiply=x.prototype.mul,x.prototype.multiplyS=x.prototype.mulS,x.prototype.multiplyM=x.prototype.mulM,x.multiply=x.mul,x.prototype.div=function(o){return typeof o=="number"?this.divS(o):this.divM(o)},x.prototype.divS=function(o){for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)/o);return this},x.prototype.divM=function(o){if(o=f.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)/o.get(c,m));return this},x.div=function(o,c){return new f(o).div(c)},x.prototype.divide=x.prototype.div,x.prototype.divideS=x.prototype.divS,x.prototype.divideM=x.prototype.divM,x.divide=x.div,x.prototype.mod=function(o){return typeof o=="number"?this.modS(o):this.modM(o)},x.prototype.modS=function(o){for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)%o);return this},x.prototype.modM=function(o){if(o=f.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)%o.get(c,m));return this},x.mod=function(o,c){return new f(o).mod(c)},x.prototype.modulus=x.prototype.mod,x.prototype.modulusS=x.prototype.modS,x.prototype.modulusM=x.prototype.modM,x.modulus=x.mod,x.prototype.and=function(o){return typeof o=="number"?this.andS(o):this.andM(o)},x.prototype.andS=function(o){for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)&o);return this},x.prototype.andM=function(o){if(o=f.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)&o.get(c,m));return this},x.and=function(o,c){return new f(o).and(c)},x.prototype.or=function(o){return typeof o=="number"?this.orS(o):this.orM(o)},x.prototype.orS=function(o){for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)|o);return this},x.prototype.orM=function(o){if(o=f.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)|o.get(c,m));return this},x.or=function(o,c){return new f(o).or(c)},x.prototype.xor=function(o){return typeof o=="number"?this.xorS(o):this.xorM(o)},x.prototype.xorS=function(o){for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)^o);return this},x.prototype.xorM=function(o){if(o=f.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)^o.get(c,m));return this},x.xor=function(o,c){return new f(o).xor(c)},x.prototype.leftShift=function(o){return typeof o=="number"?this.leftShiftS(o):this.leftShiftM(o)},x.prototype.leftShiftS=function(o){for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)<<o);return this},x.prototype.leftShiftM=function(o){if(o=f.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)<<o.get(c,m));return this},x.leftShift=function(o,c){return new f(o).leftShift(c)},x.prototype.signPropagatingRightShift=function(o){return typeof o=="number"?this.signPropagatingRightShiftS(o):this.signPropagatingRightShiftM(o)},x.prototype.signPropagatingRightShiftS=function(o){for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)>>o);return this},x.prototype.signPropagatingRightShiftM=function(o){if(o=f.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)>>o.get(c,m));return this},x.signPropagatingRightShift=function(o,c){return new f(o).signPropagatingRightShift(c)},x.prototype.rightShift=function(o){return typeof o=="number"?this.rightShiftS(o):this.rightShiftM(o)},x.prototype.rightShiftS=function(o){for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)>>>o);return this},x.prototype.rightShiftM=function(o){if(o=f.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)>>>o.get(c,m));return this},x.rightShift=function(o,c){return new f(o).rightShift(c)},x.prototype.zeroFillRightShift=x.prototype.rightShift,x.prototype.zeroFillRightShiftS=x.prototype.rightShiftS,x.prototype.zeroFillRightShiftM=x.prototype.rightShiftM,x.zeroFillRightShift=x.rightShift,x.prototype.not=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,~this.get(o,c));return this},x.not=function(o){return new f(o).not()},x.prototype.abs=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.abs(this.get(o,c)));return this},x.abs=function(o){return new f(o).abs()},x.prototype.acos=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.acos(this.get(o,c)));return this},x.acos=function(o){return new f(o).acos()},x.prototype.acosh=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.acosh(this.get(o,c)));return this},x.acosh=function(o){return new f(o).acosh()},x.prototype.asin=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.asin(this.get(o,c)));return this},x.asin=function(o){return new f(o).asin()},x.prototype.asinh=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.asinh(this.get(o,c)));return this},x.asinh=function(o){return new f(o).asinh()},x.prototype.atan=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.atan(this.get(o,c)));return this},x.atan=function(o){return new f(o).atan()},x.prototype.atanh=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.atanh(this.get(o,c)));return this},x.atanh=function(o){return new f(o).atanh()},x.prototype.cbrt=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.cbrt(this.get(o,c)));return this},x.cbrt=function(o){return new f(o).cbrt()},x.prototype.ceil=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.ceil(this.get(o,c)));return this},x.ceil=function(o){return new f(o).ceil()},x.prototype.clz32=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.clz32(this.get(o,c)));return this},x.clz32=function(o){return new f(o).clz32()},x.prototype.cos=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.cos(this.get(o,c)));return this},x.cos=function(o){return new f(o).cos()},x.prototype.cosh=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.cosh(this.get(o,c)));return this},x.cosh=function(o){return new f(o).cosh()},x.prototype.exp=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.exp(this.get(o,c)));return this},x.exp=function(o){return new f(o).exp()},x.prototype.expm1=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.expm1(this.get(o,c)));return this},x.expm1=function(o){return new f(o).expm1()},x.prototype.floor=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.floor(this.get(o,c)));return this},x.floor=function(o){return new f(o).floor()},x.prototype.fround=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.fround(this.get(o,c)));return this},x.fround=function(o){return new f(o).fround()},x.prototype.log=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.log(this.get(o,c)));return this},x.log=function(o){return new f(o).log()},x.prototype.log1p=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.log1p(this.get(o,c)));return this},x.log1p=function(o){return new f(o).log1p()},x.prototype.log10=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.log10(this.get(o,c)));return this},x.log10=function(o){return new f(o).log10()},x.prototype.log2=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.log2(this.get(o,c)));return this},x.log2=function(o){return new f(o).log2()},x.prototype.round=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.round(this.get(o,c)));return this},x.round=function(o){return new f(o).round()},x.prototype.sign=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.sign(this.get(o,c)));return this},x.sign=function(o){return new f(o).sign()},x.prototype.sin=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.sin(this.get(o,c)));return this},x.sin=function(o){return new f(o).sin()},x.prototype.sinh=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.sinh(this.get(o,c)));return this},x.sinh=function(o){return new f(o).sinh()},x.prototype.sqrt=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.sqrt(this.get(o,c)));return this},x.sqrt=function(o){return new f(o).sqrt()},x.prototype.tan=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.tan(this.get(o,c)));return this},x.tan=function(o){return new f(o).tan()},x.prototype.tanh=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.tanh(this.get(o,c)));return this},x.tanh=function(o){return new f(o).tanh()},x.prototype.trunc=function(){for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.set(o,c,Math.trunc(this.get(o,c)));return this},x.trunc=function(o){return new f(o).trunc()},x.pow=function(o,c){return new f(o).pow(c)},x.prototype.pow=function(o){return typeof o=="number"?this.powS(o):this.powM(o)},x.prototype.powS=function(o){for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)**o);return this},x.prototype.powM=function(o){if(o=f.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let c=0;c<this.rows;c++)for(let m=0;m<this.columns;m++)this.set(c,m,this.get(c,m)**o.get(c,m));return this}}function g(x,f,l){let o=l?x.rows:x.rows-1;if(f<0||f>o)throw new RangeError("Row index out of range")}function _(x,f,l){let o=l?x.columns:x.columns-1;if(f<0||f>o)throw new RangeError("Column index out of range")}function w(x,f){if(f.to1DArray&&(f=f.to1DArray()),f.length!==x.columns)throw new RangeError("vector size must be the same as the number of columns");return f}function p(x,f){if(f.to1DArray&&(f=f.to1DArray()),f.length!==x.rows)throw new RangeError("vector size must be the same as the number of rows");return f}function b(x,f){if(!e.isAnyArray(f))throw new TypeError("row indices must be an array");for(let l=0;l<f.length;l++)if(f[l]<0||f[l]>=x.rows)throw new RangeError("row indices are out of range")}function y(x,f){if(!e.isAnyArray(f))throw new TypeError("column indices must be an array");for(let l=0;l<f.length;l++)if(f[l]<0||f[l]>=x.columns)throw new RangeError("column indices are out of range")}function M(x,f,l,o,c){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(C("startRow",f),C("endRow",l),C("startColumn",o),C("endColumn",c),f>l||o>c||f<0||f>=x.rows||l<0||l>=x.rows||o<0||o>=x.columns||c<0||c>=x.columns)throw new RangeError("Submatrix indices are out of range")}function A(x,f=0){let l=[];for(let o=0;o<x;o++)l.push(f);return l}function C(x,f){if(typeof f!="number")throw new TypeError(`${x} must be a number`)}function v(x){if(x.isEmpty())throw new Error("Empty matrix has no elements to index")}function E(x){let f=A(x.rows);for(let l=0;l<x.rows;++l)for(let o=0;o<x.columns;++o)f[l]+=x.get(l,o);return f}function R(x){let f=A(x.columns);for(let l=0;l<x.rows;++l)for(let o=0;o<x.columns;++o)f[o]+=x.get(l,o);return f}function $(x){let f=0;for(let l=0;l<x.rows;l++)for(let o=0;o<x.columns;o++)f+=x.get(l,o);return f}function L(x){let f=A(x.rows,1);for(let l=0;l<x.rows;++l)for(let o=0;o<x.columns;++o)f[l]*=x.get(l,o);return f}function D(x){let f=A(x.columns,1);for(let l=0;l<x.rows;++l)for(let o=0;o<x.columns;++o)f[o]*=x.get(l,o);return f}function B(x){let f=1;for(let l=0;l<x.rows;l++)for(let o=0;o<x.columns;o++)f*=x.get(l,o);return f}function P(x,f,l){const o=x.rows,c=x.columns,m=[];for(let S=0;S<o;S++){let k=0,T=0,I=0;for(let q=0;q<c;q++)I=x.get(S,q)-l[S],k+=I,T+=I*I;f?m.push((T-k*k/c)/(c-1)):m.push((T-k*k/c)/c)}return m}function O(x,f,l){const o=x.rows,c=x.columns,m=[];for(let S=0;S<c;S++){let k=0,T=0,I=0;for(let q=0;q<o;q++)I=x.get(q,S)-l[S],k+=I,T+=I*I;f?m.push((T-k*k/o)/(o-1)):m.push((T-k*k/o)/o)}return m}function Y(x,f,l){const o=x.rows,c=x.columns,m=o*c;let S=0,k=0,T=0;for(let I=0;I<o;I++)for(let q=0;q<c;q++)T=x.get(I,q)-l,S+=T,k+=T*T;return f?(k-S*S/m)/(m-1):(k-S*S/m)/m}function te(x,f){for(let l=0;l<x.rows;l++)for(let o=0;o<x.columns;o++)x.set(l,o,x.get(l,o)-f[l])}function H(x,f){for(let l=0;l<x.rows;l++)for(let o=0;o<x.columns;o++)x.set(l,o,x.get(l,o)-f[o])}function J(x,f){for(let l=0;l<x.rows;l++)for(let o=0;o<x.columns;o++)x.set(l,o,x.get(l,o)-f)}function Ce(x){const f=[];for(let l=0;l<x.rows;l++){let o=0;for(let c=0;c<x.columns;c++)o+=x.get(l,c)**2/(x.columns-1);f.push(Math.sqrt(o))}return f}function Pe(x,f){for(let l=0;l<x.rows;l++)for(let o=0;o<x.columns;o++)x.set(l,o,x.get(l,o)/f[l])}function le(x){const f=[];for(let l=0;l<x.columns;l++){let o=0;for(let c=0;c<x.rows;c++)o+=x.get(c,l)**2/(x.rows-1);f.push(Math.sqrt(o))}return f}function ye(x,f){for(let l=0;l<x.rows;l++)for(let o=0;o<x.columns;o++)x.set(l,o,x.get(l,o)/f[o])}function xe(x){const f=x.size-1;let l=0;for(let o=0;o<x.columns;o++)for(let c=0;c<x.rows;c++)l+=x.get(c,o)**2/f;return Math.sqrt(l)}function Ie(x,f){for(let l=0;l<x.rows;l++)for(let o=0;o<x.columns;o++)x.set(l,o,x.get(l,o)/f)}class ie{static from1DArray(f,l,o){if(f*l!==o.length)throw new RangeError("data length does not match given dimensions");let m=new z(f,l);for(let S=0;S<f;S++)for(let k=0;k<l;k++)m.set(S,k,o[S*l+k]);return m}static rowVector(f){let l=new z(1,f.length);for(let o=0;o<f.length;o++)l.set(0,o,f[o]);return l}static columnVector(f){let l=new z(f.length,1);for(let o=0;o<f.length;o++)l.set(o,0,f[o]);return l}static zeros(f,l){return new z(f,l)}static ones(f,l){return new z(f,l).fill(1)}static rand(f,l,o={}){if(typeof o!="object")throw new TypeError("options must be an object");const{random:c=Math.random}=o;let m=new z(f,l);for(let S=0;S<f;S++)for(let k=0;k<l;k++)m.set(S,k,c());return m}static randInt(f,l,o={}){if(typeof o!="object")throw new TypeError("options must be an object");const{min:c=0,max:m=1e3,random:S=Math.random}=o;if(!Number.isInteger(c))throw new TypeError("min must be an integer");if(!Number.isInteger(m))throw new TypeError("max must be an integer");if(c>=m)throw new RangeError("min must be smaller than max");let k=m-c,T=new z(f,l);for(let I=0;I<f;I++)for(let q=0;q<l;q++){let F=c+Math.round(S()*k);T.set(I,q,F)}return T}static eye(f,l,o){l===void 0&&(l=f),o===void 0&&(o=1);let c=Math.min(f,l),m=this.zeros(f,l);for(let S=0;S<c;S++)m.set(S,S,o);return m}static diag(f,l,o){let c=f.length;l===void 0&&(l=c),o===void 0&&(o=l);let m=Math.min(c,l,o),S=this.zeros(l,o);for(let k=0;k<m;k++)S.set(k,k,f[k]);return S}static min(f,l){f=this.checkMatrix(f),l=this.checkMatrix(l);let o=f.rows,c=f.columns,m=new z(o,c);for(let S=0;S<o;S++)for(let k=0;k<c;k++)m.set(S,k,Math.min(f.get(S,k),l.get(S,k)));return m}static max(f,l){f=this.checkMatrix(f),l=this.checkMatrix(l);let o=f.rows,c=f.columns,m=new this(o,c);for(let S=0;S<o;S++)for(let k=0;k<c;k++)m.set(S,k,Math.max(f.get(S,k),l.get(S,k)));return m}static checkMatrix(f){return ie.isMatrix(f)?f:new z(f)}static isMatrix(f){return f!=null&&f.klass==="Matrix"}get size(){return this.rows*this.columns}apply(f){if(typeof f!="function")throw new TypeError("callback must be a function");for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)f.call(this,l,o);return this}to1DArray(){let f=[];for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)f.push(this.get(l,o));return f}to2DArray(){let f=[];for(let l=0;l<this.rows;l++){f.push([]);for(let o=0;o<this.columns;o++)f[l].push(this.get(l,o))}return f}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let f=0;f<this.rows;f++)for(let l=0;l<=f;l++)if(this.get(f,l)!==this.get(l,f))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let f=0;f<this.rows;f++)if(this.get(f,f)!==0)return!1;return!0}isEchelonForm(){let f=0,l=0,o=-1,c=!0,m=!1;for(;f<this.rows&&c;){for(l=0,m=!1;l<this.columns&&m===!1;)this.get(f,l)===0?l++:this.get(f,l)===1&&l>o?(m=!0,o=l):(c=!1,m=!0);f++}return c}isReducedEchelonForm(){let f=0,l=0,o=-1,c=!0,m=!1;for(;f<this.rows&&c;){for(l=0,m=!1;l<this.columns&&m===!1;)this.get(f,l)===0?l++:this.get(f,l)===1&&l>o?(m=!0,o=l):(c=!1,m=!0);for(let S=l+1;S<this.rows;S++)this.get(f,S)!==0&&(c=!1);f++}return c}echelonForm(){let f=this.clone(),l=0,o=0;for(;l<f.rows&&o<f.columns;){let c=l;for(let m=l;m<f.rows;m++)f.get(m,o)>f.get(c,o)&&(c=m);if(f.get(c,o)===0)o++;else{f.swapRows(l,c);let m=f.get(l,o);for(let S=o;S<f.columns;S++)f.set(l,S,f.get(l,S)/m);for(let S=l+1;S<f.rows;S++){let k=f.get(S,o)/f.get(l,o);f.set(S,o,0);for(let T=o+1;T<f.columns;T++)f.set(S,T,f.get(S,T)-f.get(l,T)*k)}l++,o++}}return f}reducedEchelonForm(){let f=this.echelonForm(),l=f.columns,o=f.rows,c=o-1;for(;c>=0;)if(f.maxRow(c)===0)c--;else{let m=0,S=!1;for(;m<o&&S===!1;)f.get(c,m)===1?S=!0:m++;for(let k=0;k<c;k++){let T=f.get(k,m);for(let I=m;I<l;I++){let q=f.get(k,I)-T*f.get(c,I);f.set(k,I,q)}}c--}return f}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(f={}){if(typeof f!="object")throw new TypeError("options must be an object");const{rows:l=1,columns:o=1}=f;if(!Number.isInteger(l)||l<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(o)||o<=0)throw new TypeError("columns must be a positive integer");let c=new z(this.rows*l,this.columns*o);for(let m=0;m<l;m++)for(let S=0;S<o;S++)c.setSubMatrix(this,this.rows*m,this.columns*S);return c}fill(f){for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)this.set(l,o,f);return this}neg(){return this.mulS(-1)}getRow(f){g(this,f);let l=[];for(let o=0;o<this.columns;o++)l.push(this.get(f,o));return l}getRowVector(f){return z.rowVector(this.getRow(f))}setRow(f,l){g(this,f),l=w(this,l);for(let o=0;o<this.columns;o++)this.set(f,o,l[o]);return this}swapRows(f,l){g(this,f),g(this,l);for(let o=0;o<this.columns;o++){let c=this.get(f,o);this.set(f,o,this.get(l,o)),this.set(l,o,c)}return this}getColumn(f){_(this,f);let l=[];for(let o=0;o<this.rows;o++)l.push(this.get(o,f));return l}getColumnVector(f){return z.columnVector(this.getColumn(f))}setColumn(f,l){_(this,f),l=p(this,l);for(let o=0;o<this.rows;o++)this.set(o,f,l[o]);return this}swapColumns(f,l){_(this,f),_(this,l);for(let o=0;o<this.rows;o++){let c=this.get(o,f);this.set(o,f,this.get(o,l)),this.set(o,l,c)}return this}addRowVector(f){f=w(this,f);for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)this.set(l,o,this.get(l,o)+f[o]);return this}subRowVector(f){f=w(this,f);for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)this.set(l,o,this.get(l,o)-f[o]);return this}mulRowVector(f){f=w(this,f);for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)this.set(l,o,this.get(l,o)*f[o]);return this}divRowVector(f){f=w(this,f);for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)this.set(l,o,this.get(l,o)/f[o]);return this}addColumnVector(f){f=p(this,f);for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)this.set(l,o,this.get(l,o)+f[l]);return this}subColumnVector(f){f=p(this,f);for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)this.set(l,o,this.get(l,o)-f[l]);return this}mulColumnVector(f){f=p(this,f);for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)this.set(l,o,this.get(l,o)*f[l]);return this}divColumnVector(f){f=p(this,f);for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)this.set(l,o,this.get(l,o)/f[l]);return this}mulRow(f,l){g(this,f);for(let o=0;o<this.columns;o++)this.set(f,o,this.get(f,o)*l);return this}mulColumn(f,l){_(this,f);for(let o=0;o<this.rows;o++)this.set(o,f,this.get(o,f)*l);return this}max(f){if(this.isEmpty())return NaN;switch(f){case"row":{const l=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.get(o,c)>l[o]&&(l[o]=this.get(o,c));return l}case"column":{const l=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.get(o,c)>l[c]&&(l[c]=this.get(o,c));return l}case void 0:{let l=this.get(0,0);for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.get(o,c)>l&&(l=this.get(o,c));return l}default:throw new Error(`invalid option: ${f}`)}}maxIndex(){v(this);let f=this.get(0,0),l=[0,0];for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.get(o,c)>f&&(f=this.get(o,c),l[0]=o,l[1]=c);return l}min(f){if(this.isEmpty())return NaN;switch(f){case"row":{const l=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.get(o,c)<l[o]&&(l[o]=this.get(o,c));return l}case"column":{const l=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.get(o,c)<l[c]&&(l[c]=this.get(o,c));return l}case void 0:{let l=this.get(0,0);for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.get(o,c)<l&&(l=this.get(o,c));return l}default:throw new Error(`invalid option: ${f}`)}}minIndex(){v(this);let f=this.get(0,0),l=[0,0];for(let o=0;o<this.rows;o++)for(let c=0;c<this.columns;c++)this.get(o,c)<f&&(f=this.get(o,c),l[0]=o,l[1]=c);return l}maxRow(f){if(g(this,f),this.isEmpty())return NaN;let l=this.get(f,0);for(let o=1;o<this.columns;o++)this.get(f,o)>l&&(l=this.get(f,o));return l}maxRowIndex(f){g(this,f),v(this);let l=this.get(f,0),o=[f,0];for(let c=1;c<this.columns;c++)this.get(f,c)>l&&(l=this.get(f,c),o[1]=c);return o}minRow(f){if(g(this,f),this.isEmpty())return NaN;let l=this.get(f,0);for(let o=1;o<this.columns;o++)this.get(f,o)<l&&(l=this.get(f,o));return l}minRowIndex(f){g(this,f),v(this);let l=this.get(f,0),o=[f,0];for(let c=1;c<this.columns;c++)this.get(f,c)<l&&(l=this.get(f,c),o[1]=c);return o}maxColumn(f){if(_(this,f),this.isEmpty())return NaN;let l=this.get(0,f);for(let o=1;o<this.rows;o++)this.get(o,f)>l&&(l=this.get(o,f));return l}maxColumnIndex(f){_(this,f),v(this);let l=this.get(0,f),o=[0,f];for(let c=1;c<this.rows;c++)this.get(c,f)>l&&(l=this.get(c,f),o[0]=c);return o}minColumn(f){if(_(this,f),this.isEmpty())return NaN;let l=this.get(0,f);for(let o=1;o<this.rows;o++)this.get(o,f)<l&&(l=this.get(o,f));return l}minColumnIndex(f){_(this,f),v(this);let l=this.get(0,f),o=[0,f];for(let c=1;c<this.rows;c++)this.get(c,f)<l&&(l=this.get(c,f),o[0]=c);return o}diag(){let f=Math.min(this.rows,this.columns),l=[];for(let o=0;o<f;o++)l.push(this.get(o,o));return l}norm(f="frobenius"){switch(f){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${f}`)}}cumulativeSum(){let f=0;for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)f+=this.get(l,o),this.set(l,o,f);return this}dot(f){ie.isMatrix(f)&&(f=f.to1DArray());let l=this.to1DArray();if(l.length!==f.length)throw new RangeError("vectors do not have the same size");let o=0;for(let c=0;c<l.length;c++)o+=l[c]*f[c];return o}mmul(f){f=z.checkMatrix(f);let l=this.rows,o=this.columns,c=f.columns,m=new z(l,c),S=new Float64Array(o);for(let k=0;k<c;k++){for(let T=0;T<o;T++)S[T]=f.get(T,k);for(let T=0;T<l;T++){let I=0;for(let q=0;q<o;q++)I+=this.get(T,q)*S[q];m.set(T,k,I)}}return m}mpow(f){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(f)||f<0)throw new RangeError("Exponent must be a non-negative integer");let l=z.eye(this.rows),o=this;for(let c=f;c>=1;c/=2)(c&1)!==0&&(l=l.mmul(o)),o=o.mmul(o);return l}strassen2x2(f){f=z.checkMatrix(f);let l=new z(2,2);const o=this.get(0,0),c=f.get(0,0),m=this.get(0,1),S=f.get(0,1),k=this.get(1,0),T=f.get(1,0),I=this.get(1,1),q=f.get(1,1),F=(o+I)*(c+q),G=(k+I)*c,K=o*(S-q),j=I*(T-c),V=(o+m)*q,ne=(k-o)*(c+S),N=(m-I)*(T+q),W=F+j-V+N,se=K+V,De=G+j,Be=F-G+K+ne;return l.set(0,0,W),l.set(0,1,se),l.set(1,0,De),l.set(1,1,Be),l}strassen3x3(f){f=z.checkMatrix(f);let l=new z(3,3);const o=this.get(0,0),c=this.get(0,1),m=this.get(0,2),S=this.get(1,0),k=this.get(1,1),T=this.get(1,2),I=this.get(2,0),q=this.get(2,1),F=this.get(2,2),G=f.get(0,0),K=f.get(0,1),j=f.get(0,2),V=f.get(1,0),ne=f.get(1,1),N=f.get(1,2),W=f.get(2,0),se=f.get(2,1),De=f.get(2,2),Be=(o+c+m-S-k-q-F)*ne,He=(o-S)*(-K+ne),we=k*(-G+K+V-ne-N-W+De),_e=(-o+S+k)*(G-K+ne),Ke=(S+k)*(-G+K),U=o*G,Z=(-o+I+q)*(G-j+N),ae=(-o+I)*(j-N),ee=(I+q)*(-G+j),et=(o+c+m-k-T-I-q)*N,Ve=q*(-G+j+V-ne-N-W+se),We=(-m+q+F)*(ne+W-se),tt=(m-F)*(ne-se),at=m*W,pt=(q+F)*(-W+se),it=(-m+k+T)*(N+W-De),xt=(m-T)*(N-De),bt=(k+T)*(-W+De),Xe=c*V,ot=T*se,ut=S*j,ct=I*K,nt=F*De,Tt=U+at+Xe,Dt=Be+_e+Ke+U+We+at+pt,It=U+Z+ee+et+at+it+bt,Rt=He+we+_e+U+at+it+xt,Ct=He+_e+Ke+U+ot,Bt=at+it+xt+bt+ut,Pt=U+Z+ae+Ve+We+tt+at,Ft=We+tt+at+pt+ct,Ot=U+Z+ae+ee+nt;return l.set(0,0,Tt),l.set(0,1,Dt),l.set(0,2,It),l.set(1,0,Rt),l.set(1,1,Ct),l.set(1,2,Bt),l.set(2,0,Pt),l.set(2,1,Ft),l.set(2,2,Ot),l}mmulStrassen(f){f=z.checkMatrix(f);let l=this.clone(),o=l.rows,c=l.columns,m=f.rows,S=f.columns;c!==m&&console.warn(`Multiplying ${o} x ${c} and ${m} x ${S} matrix: dimensions do not match.`);function k(F,G,K){let j=F.rows,V=F.columns;if(j===G&&V===K)return F;{let ne=ie.zeros(G,K);return ne=ne.setSubMatrix(F,0,0),ne}}let T=Math.max(o,m),I=Math.max(c,S);l=k(l,T,I),f=k(f,T,I);function q(F,G,K,j){if(K<=512||j<=512)return F.mmul(G);K%2===1&&j%2===1?(F=k(F,K+1,j+1),G=k(G,K+1,j+1)):K%2===1?(F=k(F,K+1,j),G=k(G,K+1,j)):j%2===1&&(F=k(F,K,j+1),G=k(G,K,j+1));let V=parseInt(F.rows/2,10),ne=parseInt(F.columns/2,10),N=F.subMatrix(0,V-1,0,ne-1),W=G.subMatrix(0,V-1,0,ne-1),se=F.subMatrix(0,V-1,ne,F.columns-1),De=G.subMatrix(0,V-1,ne,G.columns-1),Be=F.subMatrix(V,F.rows-1,0,ne-1),He=G.subMatrix(V,G.rows-1,0,ne-1),we=F.subMatrix(V,F.rows-1,ne,F.columns-1),_e=G.subMatrix(V,G.rows-1,ne,G.columns-1),Ke=q(ie.add(N,we),ie.add(W,_e),V,ne),U=q(ie.add(Be,we),W,V,ne),Z=q(N,ie.sub(De,_e),V,ne),ae=q(we,ie.sub(He,W),V,ne),ee=q(ie.add(N,se),_e,V,ne),et=q(ie.sub(Be,N),ie.add(W,De),V,ne),Ve=q(ie.sub(se,we),ie.add(He,_e),V,ne),We=ie.add(Ke,ae);We.sub(ee),We.add(Ve);let tt=ie.add(Z,ee),at=ie.add(U,ae),pt=ie.sub(Ke,U);pt.add(Z),pt.add(et);let it=ie.zeros(2*We.rows,2*We.columns);return it=it.setSubMatrix(We,0,0),it=it.setSubMatrix(tt,We.rows,0),it=it.setSubMatrix(at,0,We.columns),it=it.setSubMatrix(pt,We.rows,We.columns),it.subMatrix(0,K-1,0,j-1)}return q(l,f,T,I)}scaleRows(f={}){if(typeof f!="object")throw new TypeError("options must be an object");const{min:l=0,max:o=1}=f;if(!Number.isFinite(l))throw new TypeError("min must be a number");if(!Number.isFinite(o))throw new TypeError("max must be a number");if(l>=o)throw new RangeError("min must be smaller than max");let c=new z(this.rows,this.columns);for(let m=0;m<this.rows;m++){const S=this.getRow(m);S.length>0&&r(S,{min:l,max:o,output:S}),c.setRow(m,S)}return c}scaleColumns(f={}){if(typeof f!="object")throw new TypeError("options must be an object");const{min:l=0,max:o=1}=f;if(!Number.isFinite(l))throw new TypeError("min must be a number");if(!Number.isFinite(o))throw new TypeError("max must be a number");if(l>=o)throw new RangeError("min must be smaller than max");let c=new z(this.rows,this.columns);for(let m=0;m<this.columns;m++){const S=this.getColumn(m);S.length&&r(S,{min:l,max:o,output:S}),c.setColumn(m,S)}return c}flipRows(){const f=Math.ceil(this.columns/2);for(let l=0;l<this.rows;l++)for(let o=0;o<f;o++){let c=this.get(l,o),m=this.get(l,this.columns-1-o);this.set(l,o,m),this.set(l,this.columns-1-o,c)}return this}flipColumns(){const f=Math.ceil(this.rows/2);for(let l=0;l<this.columns;l++)for(let o=0;o<f;o++){let c=this.get(o,l),m=this.get(this.rows-1-o,l);this.set(o,l,m),this.set(this.rows-1-o,l,c)}return this}kroneckerProduct(f){f=z.checkMatrix(f);let l=this.rows,o=this.columns,c=f.rows,m=f.columns,S=new z(l*c,o*m);for(let k=0;k<l;k++)for(let T=0;T<o;T++)for(let I=0;I<c;I++)for(let q=0;q<m;q++)S.set(c*k+I,m*T+q,this.get(k,T)*f.get(I,q));return S}kroneckerSum(f){if(f=z.checkMatrix(f),!this.isSquare()||!f.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let l=this.rows,o=f.rows,c=this.kroneckerProduct(z.eye(o,o)),m=z.eye(l,l).kroneckerProduct(f);return c.add(m)}transpose(){let f=new z(this.columns,this.rows);for(let l=0;l<this.rows;l++)for(let o=0;o<this.columns;o++)f.set(o,l,this.get(l,o));return f}sortRows(f=Ee){for(let l=0;l<this.rows;l++)this.setRow(l,this.getRow(l).sort(f));return this}sortColumns(f=Ee){for(let l=0;l<this.columns;l++)this.setColumn(l,this.getColumn(l).sort(f));return this}subMatrix(f,l,o,c){M(this,f,l,o,c);let m=new z(l-f+1,c-o+1);for(let S=f;S<=l;S++)for(let k=o;k<=c;k++)m.set(S-f,k-o,this.get(S,k));return m}subMatrixRow(f,l,o){if(l===void 0&&(l=0),o===void 0&&(o=this.columns-1),l>o||l<0||l>=this.columns||o<0||o>=this.columns)throw new RangeError("Argument out of range");let c=new z(f.length,o-l+1);for(let m=0;m<f.length;m++)for(let S=l;S<=o;S++){if(f[m]<0||f[m]>=this.rows)throw new RangeError(`Row index out of range: ${f[m]}`);c.set(m,S-l,this.get(f[m],S))}return c}subMatrixColumn(f,l,o){if(l===void 0&&(l=0),o===void 0&&(o=this.rows-1),l>o||l<0||l>=this.rows||o<0||o>=this.rows)throw new RangeError("Argument out of range");let c=new z(o-l+1,f.length);for(let m=0;m<f.length;m++)for(let S=l;S<=o;S++){if(f[m]<0||f[m]>=this.columns)throw new RangeError(`Column index out of range: ${f[m]}`);c.set(S-l,m,this.get(S,f[m]))}return c}setSubMatrix(f,l,o){if(f=z.checkMatrix(f),f.isEmpty())return this;let c=l+f.rows-1,m=o+f.columns-1;M(this,l,c,o,m);for(let S=0;S<f.rows;S++)for(let k=0;k<f.columns;k++)this.set(l+S,o+k,f.get(S,k));return this}selection(f,l){b(this,f),y(this,l);let o=new z(f.length,l.length);for(let c=0;c<f.length;c++){let m=f[c];for(let S=0;S<l.length;S++){let k=l[S];o.set(c,S,this.get(m,k))}}return o}trace(){let f=Math.min(this.rows,this.columns),l=0;for(let o=0;o<f;o++)l+=this.get(o,o);return l}clone(){return this.constructor.copy(this,new z(this.rows,this.columns))}static copy(f,l){for(const[o,c,m]of f.entries())l.set(o,c,m);return l}sum(f){switch(f){case"row":return E(this);case"column":return R(this);case void 0:return $(this);default:throw new Error(`invalid option: ${f}`)}}product(f){switch(f){case"row":return L(this);case"column":return D(this);case void 0:return B(this);default:throw new Error(`invalid option: ${f}`)}}mean(f){const l=this.sum(f);switch(f){case"row":{for(let o=0;o<this.rows;o++)l[o]/=this.columns;return l}case"column":{for(let o=0;o<this.columns;o++)l[o]/=this.rows;return l}case void 0:return l/this.size;default:throw new Error(`invalid option: ${f}`)}}variance(f,l={}){if(typeof f=="object"&&(l=f,f=void 0),typeof l!="object")throw new TypeError("options must be an object");const{unbiased:o=!0,mean:c=this.mean(f)}=l;if(typeof o!="boolean")throw new TypeError("unbiased must be a boolean");switch(f){case"row":{if(!e.isAnyArray(c))throw new TypeError("mean must be an array");return P(this,o,c)}case"column":{if(!e.isAnyArray(c))throw new TypeError("mean must be an array");return O(this,o,c)}case void 0:{if(typeof c!="number")throw new TypeError("mean must be a number");return Y(this,o,c)}default:throw new Error(`invalid option: ${f}`)}}standardDeviation(f,l){typeof f=="object"&&(l=f,f=void 0);const o=this.variance(f,l);if(f===void 0)return Math.sqrt(o);for(let c=0;c<o.length;c++)o[c]=Math.sqrt(o[c]);return o}center(f,l={}){if(typeof f=="object"&&(l=f,f=void 0),typeof l!="object")throw new TypeError("options must be an object");const{center:o=this.mean(f)}=l;switch(f){case"row":{if(!e.isAnyArray(o))throw new TypeError("center must be an array");return te(this,o),this}case"column":{if(!e.isAnyArray(o))throw new TypeError("center must be an array");return H(this,o),this}case void 0:{if(typeof o!="number")throw new TypeError("center must be a number");return J(this,o),this}default:throw new Error(`invalid option: ${f}`)}}scale(f,l={}){if(typeof f=="object"&&(l=f,f=void 0),typeof l!="object")throw new TypeError("options must be an object");let o=l.scale;switch(f){case"row":{if(o===void 0)o=Ce(this);else if(!e.isAnyArray(o))throw new TypeError("scale must be an array");return Pe(this,o),this}case"column":{if(o===void 0)o=le(this);else if(!e.isAnyArray(o))throw new TypeError("scale must be an array");return ye(this,o),this}case void 0:{if(o===void 0)o=xe(this);else if(typeof o!="number")throw new TypeError("scale must be a number");return Ie(this,o),this}default:throw new Error(`invalid option: ${f}`)}}toString(f){return s(this,f)}[Symbol.iterator](){return this.entries()}*entries(){for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)yield[f,l,this.get(f,l)]}*values(){for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)yield this.get(f,l)}}ie.prototype.klass="Matrix",typeof Symbol<"u"&&(ie.prototype[Symbol.for("nodejs.util.inspect.custom")]=n);function Ee(x,f){return x-f}function he(x){return x.every(f=>typeof f=="number")}ie.random=ie.rand,ie.randomInt=ie.randInt,ie.diagonal=ie.diag,ie.prototype.diagonal=ie.prototype.diag,ie.identity=ie.eye,ie.prototype.negate=ie.prototype.neg,ie.prototype.tensorProduct=ie.prototype.kroneckerProduct;const ht=class ht extends ie{constructor(l,o){super();Et(this,ft);Ze(this,"data");if(ht.isMatrix(l))Mt(this,ft,St).call(this,l.rows,l.columns),ht.copy(l,this);else if(Number.isInteger(l)&&l>=0)Mt(this,ft,St).call(this,l,o);else if(e.isAnyArray(l)){const c=l;if(l=c.length,o=l?c[0].length:0,typeof o!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let m=0;m<l;m++){if(c[m].length!==o)throw new RangeError("Inconsistent array dimensions");if(!he(c[m]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(c[m]))}this.rows=l,this.columns=o}else throw new TypeError("First argument must be a positive number or an array")}set(l,o,c){return this.data[l][o]=c,this}get(l,o){return this.data[l][o]}removeRow(l){return g(this,l),this.data.splice(l,1),this.rows-=1,this}addRow(l,o){return o===void 0&&(o=l,l=this.rows),g(this,l,!0),o=Float64Array.from(w(this,o)),this.data.splice(l,0,o),this.rows+=1,this}removeColumn(l){_(this,l);for(let o=0;o<this.rows;o++){const c=new Float64Array(this.columns-1);for(let m=0;m<l;m++)c[m]=this.data[o][m];for(let m=l+1;m<this.columns;m++)c[m-1]=this.data[o][m];this.data[o]=c}return this.columns-=1,this}addColumn(l,o){typeof o>"u"&&(o=l,l=this.columns),_(this,l,!0),o=p(this,o);for(let c=0;c<this.rows;c++){const m=new Float64Array(this.columns+1);let S=0;for(;S<l;S++)m[S]=this.data[c][S];for(m[S++]=o[c];S<this.columns+1;S++)m[S]=this.data[c][S-1];this.data[c]=m}return this.columns+=1,this}};ft=new WeakSet,St=function(l,o){if(this.data=[],Number.isInteger(o)&&o>=0)for(let c=0;c<l;c++)this.data.push(new Float64Array(o));else throw new TypeError("nColumns must be a positive integer");this.rows=l,this.columns=o};let z=ht;u(ie,z);const dt=class dt extends ie{constructor(l){super();Et(this,Je);if(z.isMatrix(l)){if(!l.isSymmetric())throw new TypeError("not symmetric data");yt(this,Je,z.copy(l,new z(l.rows,l.rows)))}else if(Number.isInteger(l)&&l>=0)yt(this,Je,new z(l,l));else if(yt(this,Je,new z(l)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return mt(this,Je).size}get rows(){return mt(this,Je).rows}get columns(){return mt(this,Je).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(l){return z.isMatrix(l)&&l.klassType==="SymmetricMatrix"}static zeros(l){return new this(l)}static ones(l){return new this(l).fill(1)}clone(){const l=new dt(this.diagonalSize);for(const[o,c,m]of this.upperRightEntries())l.set(o,c,m);return l}toMatrix(){return new z(this)}get(l,o){return mt(this,Je).get(l,o)}set(l,o,c){return mt(this,Je).set(l,o,c),mt(this,Je).set(o,l,c),this}removeCross(l){return mt(this,Je).removeRow(l),mt(this,Je).removeColumn(l),this}addCross(l,o){o===void 0&&(o=l,l=this.diagonalSize);const c=o.slice();return c.splice(l,1),mt(this,Je).addRow(l,c),mt(this,Je).addColumn(l,o),this}applyMask(l){if(l.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const o=[];for(const[c,m]of l.entries())m||o.push(c);o.reverse();for(const c of o)this.removeCross(c);return this}toCompact(){const{diagonalSize:l}=this,o=new Array(l*(l+1)/2);for(let c=0,m=0,S=0;S<o.length;S++)o[S]=this.get(m,c),++c>=l&&(c=++m);return o}static fromCompact(l){const o=l.length,c=(Math.sqrt(8*o+1)-1)/2;if(!Number.isInteger(c))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(l)}`);const m=new dt(c);for(let S=0,k=0,T=0;T<o;T++)m.set(S,k,l[T]),++S>=c&&(S=++k);return m}*upperRightEntries(){for(let l=0,o=0;l<this.diagonalSize;void 0){const c=this.get(l,o);yield[l,o,c],++o>=this.diagonalSize&&(o=++l)}}*upperRightValues(){for(let l=0,o=0;l<this.diagonalSize;void 0)yield this.get(l,o),++o>=this.diagonalSize&&(o=++l)}};Je=new WeakMap;let de=dt;de.prototype.klassType="SymmetricMatrix";class ke extends de{static isDistanceMatrix(f){return de.isSymmetricMatrix(f)&&f.klassSubType==="DistanceMatrix"}constructor(f){if(super(f),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(f,l,o){return f===l&&(o=0),super.set(f,l,o)}addCross(f,l){return l===void 0&&(l=f,f=this.diagonalSize),l=l.slice(),l[f]=0,super.addCross(f,l)}toSymmetricMatrix(){return new de(this)}clone(){const f=new ke(this.diagonalSize);for(const[l,o,c]of this.upperRightEntries())l!==o&&f.set(l,o,c);return f}toCompact(){const{diagonalSize:f}=this,l=(f-1)*f/2,o=new Array(l);for(let c=1,m=0,S=0;S<o.length;S++)o[S]=this.get(m,c),++c>=f&&(c=++m+1);return o}static fromCompact(f){const l=f.length;if(l===0)return new this(0);const o=(Math.sqrt(8*l+1)+1)/2;if(!Number.isInteger(o))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(f)}`);const c=new this(o);for(let m=1,S=0,k=0;k<l;k++)c.set(m,S,f[k]),++m>=o&&(m=++S+1);return c}}ke.prototype.klassSubType="DistanceMatrix";class ve extends ie{constructor(f,l,o){super(),this.matrix=f,this.rows=l,this.columns=o}}class Me extends ve{constructor(f,l){_(f,l),super(f,f.rows,1),this.column=l}set(f,l,o){return this.matrix.set(f,this.column,o),this}get(f){return this.matrix.get(f,this.column)}}class Fe extends ve{constructor(f,l){y(f,l),super(f,f.rows,l.length),this.columnIndices=l}set(f,l,o){return this.matrix.set(f,this.columnIndices[l],o),this}get(f,l){return this.matrix.get(f,this.columnIndices[l])}}class $e extends ve{constructor(f){super(f,f.rows,f.columns)}set(f,l,o){return this.matrix.set(f,this.columns-l-1,o),this}get(f,l){return this.matrix.get(f,this.columns-l-1)}}class je extends ve{constructor(f){super(f,f.rows,f.columns)}set(f,l,o){return this.matrix.set(this.rows-f-1,l,o),this}get(f,l){return this.matrix.get(this.rows-f-1,l)}}class Oe extends ve{constructor(f,l){g(f,l),super(f,1,f.columns),this.row=l}set(f,l,o){return this.matrix.set(this.row,l,o),this}get(f,l){return this.matrix.get(this.row,l)}}class fe extends ve{constructor(f,l){b(f,l),super(f,l.length,f.columns),this.rowIndices=l}set(f,l,o){return this.matrix.set(this.rowIndices[f],l,o),this}get(f,l){return this.matrix.get(this.rowIndices[f],l)}}class re extends ve{constructor(f,l,o){b(f,l),y(f,o),super(f,l.length,o.length),this.rowIndices=l,this.columnIndices=o}set(f,l,o){return this.matrix.set(this.rowIndices[f],this.columnIndices[l],o),this}get(f,l){return this.matrix.get(this.rowIndices[f],this.columnIndices[l])}}class Le extends ve{constructor(f,l,o,c,m){M(f,l,o,c,m),super(f,o-l+1,m-c+1),this.startRow=l,this.startColumn=c}set(f,l,o){return this.matrix.set(this.startRow+f,this.startColumn+l,o),this}get(f,l){return this.matrix.get(this.startRow+f,this.startColumn+l)}}class Se extends ve{constructor(f){super(f,f.columns,f.rows)}set(f,l,o){return this.matrix.set(l,f,o),this}get(f,l){return this.matrix.get(l,f)}}class Te extends ie{constructor(f,l={}){const{rows:o=1}=l;if(f.length%o!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=o,this.columns=f.length/o,this.data=f}set(f,l,o){let c=this._calculateIndex(f,l);return this.data[c]=o,this}get(f,l){let o=this._calculateIndex(f,l);return this.data[o]}_calculateIndex(f,l){return f*this.columns+l}}class X extends ie{constructor(f){super(),this.data=f,this.rows=f.length,this.columns=f[0].length}set(f,l,o){return this.data[f][l]=o,this}get(f,l){return this.data[f][l]}}function me(x,f){if(e.isAnyArray(x))return x[0]&&e.isAnyArray(x[0])?new X(x):new Te(x,f);throw new Error("the argument is not an array")}class ge{constructor(f){f=X.checkMatrix(f);let l=f.clone(),o=l.rows,c=l.columns,m=new Float64Array(o),S=1,k,T,I,q,F,G,K,j,V;for(k=0;k<o;k++)m[k]=k;for(j=new Float64Array(o),T=0;T<c;T++){for(k=0;k<o;k++)j[k]=l.get(k,T);for(k=0;k<o;k++){for(V=Math.min(k,T),F=0,I=0;I<V;I++)F+=l.get(k,I)*j[I];j[k]-=F,l.set(k,T,j[k])}for(q=T,k=T+1;k<o;k++)Math.abs(j[k])>Math.abs(j[q])&&(q=k);if(q!==T){for(I=0;I<c;I++)G=l.get(q,I),l.set(q,I,l.get(T,I)),l.set(T,I,G);K=m[q],m[q]=m[T],m[T]=K,S=-S}if(T<o&&l.get(T,T)!==0)for(k=T+1;k<o;k++)l.set(k,T,l.get(k,T)/l.get(T,T))}this.LU=l,this.pivotVector=m,this.pivotSign=S}isSingular(){let f=this.LU,l=f.columns;for(let o=0;o<l;o++)if(f.get(o,o)===0)return!0;return!1}solve(f){f=z.checkMatrix(f);let l=this.LU;if(l.rows!==f.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let c=f.columns,m=f.subMatrixRow(this.pivotVector,0,c-1),S=l.columns,k,T,I;for(I=0;I<S;I++)for(k=I+1;k<S;k++)for(T=0;T<c;T++)m.set(k,T,m.get(k,T)-m.get(I,T)*l.get(k,I));for(I=S-1;I>=0;I--){for(T=0;T<c;T++)m.set(I,T,m.get(I,T)/l.get(I,I));for(k=0;k<I;k++)for(T=0;T<c;T++)m.set(k,T,m.get(k,T)-m.get(I,T)*l.get(k,I))}return m}get determinant(){let f=this.LU;if(!f.isSquare())throw new Error("Matrix must be square");let l=this.pivotSign,o=f.columns;for(let c=0;c<o;c++)l*=f.get(c,c);return l}get lowerTriangularMatrix(){let f=this.LU,l=f.rows,o=f.columns,c=new z(l,o);for(let m=0;m<l;m++)for(let S=0;S<o;S++)m>S?c.set(m,S,f.get(m,S)):m===S?c.set(m,S,1):c.set(m,S,0);return c}get upperTriangularMatrix(){let f=this.LU,l=f.rows,o=f.columns,c=new z(l,o);for(let m=0;m<l;m++)for(let S=0;S<o;S++)m<=S?c.set(m,S,f.get(m,S)):c.set(m,S,0);return c}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function pe(x,f){let l=0;return Math.abs(x)>Math.abs(f)?(l=f/x,Math.abs(x)*Math.sqrt(1+l*l)):f!==0?(l=x/f,Math.abs(f)*Math.sqrt(1+l*l)):0}class Q{constructor(f){f=X.checkMatrix(f);let l=f.clone(),o=f.rows,c=f.columns,m=new Float64Array(c),S,k,T,I;for(T=0;T<c;T++){let q=0;for(S=T;S<o;S++)q=pe(q,l.get(S,T));if(q!==0){for(l.get(T,T)<0&&(q=-q),S=T;S<o;S++)l.set(S,T,l.get(S,T)/q);for(l.set(T,T,l.get(T,T)+1),k=T+1;k<c;k++){for(I=0,S=T;S<o;S++)I+=l.get(S,T)*l.get(S,k);for(I=-I/l.get(T,T),S=T;S<o;S++)l.set(S,k,l.get(S,k)+I*l.get(S,T))}}m[T]=-q}this.QR=l,this.Rdiag=m}solve(f){f=z.checkMatrix(f);let l=this.QR,o=l.rows;if(f.rows!==o)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let c=f.columns,m=f.clone(),S=l.columns,k,T,I,q;for(I=0;I<S;I++)for(T=0;T<c;T++){for(q=0,k=I;k<o;k++)q+=l.get(k,I)*m.get(k,T);for(q=-q/l.get(I,I),k=I;k<o;k++)m.set(k,T,m.get(k,T)+q*l.get(k,I))}for(I=S-1;I>=0;I--){for(T=0;T<c;T++)m.set(I,T,m.get(I,T)/this.Rdiag[I]);for(k=0;k<I;k++)for(T=0;T<c;T++)m.set(k,T,m.get(k,T)-m.get(I,T)*l.get(k,I))}return m.subMatrix(0,S-1,0,c-1)}isFullRank(){let f=this.QR.columns;for(let l=0;l<f;l++)if(this.Rdiag[l]===0)return!1;return!0}get upperTriangularMatrix(){let f=this.QR,l=f.columns,o=new z(l,l),c,m;for(c=0;c<l;c++)for(m=0;m<l;m++)c<m?o.set(c,m,f.get(c,m)):c===m?o.set(c,m,this.Rdiag[c]):o.set(c,m,0);return o}get orthogonalMatrix(){let f=this.QR,l=f.rows,o=f.columns,c=new z(l,o),m,S,k,T;for(k=o-1;k>=0;k--){for(m=0;m<l;m++)c.set(m,k,0);for(c.set(k,k,1),S=k;S<o;S++)if(f.get(k,k)!==0){for(T=0,m=k;m<l;m++)T+=f.get(m,k)*c.get(m,S);for(T=-T/f.get(k,k),m=k;m<l;m++)c.set(m,S,c.get(m,S)+T*f.get(m,k))}}return c}}class Ne{constructor(f,l={}){if(f=X.checkMatrix(f),f.isEmpty())throw new Error("Matrix must be non-empty");let o=f.rows,c=f.columns;const{computeLeftSingularVectors:m=!0,computeRightSingularVectors:S=!0,autoTranspose:k=!1}=l;let T=!!m,I=!!S,q=!1,F;if(o<c)if(!k)F=f.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{F=f.transpose(),o=F.rows,c=F.columns,q=!0;let U=T;T=I,I=U}else F=f.clone();let G=Math.min(o,c),K=Math.min(o+1,c),j=new Float64Array(K),V=new z(o,G),ne=new z(c,c),N=new Float64Array(c),W=new Float64Array(o),se=new Float64Array(K);for(let U=0;U<K;U++)se[U]=U;let De=Math.min(o-1,c),Be=Math.max(0,Math.min(c-2,o)),He=Math.max(De,Be);for(let U=0;U<He;U++){if(U<De){j[U]=0;for(let Z=U;Z<o;Z++)j[U]=pe(j[U],F.get(Z,U));if(j[U]!==0){F.get(U,U)<0&&(j[U]=-j[U]);for(let Z=U;Z<o;Z++)F.set(Z,U,F.get(Z,U)/j[U]);F.set(U,U,F.get(U,U)+1)}j[U]=-j[U]}for(let Z=U+1;Z<c;Z++){if(U<De&&j[U]!==0){let ae=0;for(let ee=U;ee<o;ee++)ae+=F.get(ee,U)*F.get(ee,Z);ae=-ae/F.get(U,U);for(let ee=U;ee<o;ee++)F.set(ee,Z,F.get(ee,Z)+ae*F.get(ee,U))}N[Z]=F.get(U,Z)}if(T&&U<De)for(let Z=U;Z<o;Z++)V.set(Z,U,F.get(Z,U));if(U<Be){N[U]=0;for(let Z=U+1;Z<c;Z++)N[U]=pe(N[U],N[Z]);if(N[U]!==0){N[U+1]<0&&(N[U]=0-N[U]);for(let Z=U+1;Z<c;Z++)N[Z]/=N[U];N[U+1]+=1}if(N[U]=-N[U],U+1<o&&N[U]!==0){for(let Z=U+1;Z<o;Z++)W[Z]=0;for(let Z=U+1;Z<o;Z++)for(let ae=U+1;ae<c;ae++)W[Z]+=N[ae]*F.get(Z,ae);for(let Z=U+1;Z<c;Z++){let ae=-N[Z]/N[U+1];for(let ee=U+1;ee<o;ee++)F.set(ee,Z,F.get(ee,Z)+ae*W[ee])}}if(I)for(let Z=U+1;Z<c;Z++)ne.set(Z,U,N[Z])}}let we=Math.min(c,o+1);if(De<c&&(j[De]=F.get(De,De)),o<we&&(j[we-1]=0),Be+1<we&&(N[Be]=F.get(Be,we-1)),N[we-1]=0,T){for(let U=De;U<G;U++){for(let Z=0;Z<o;Z++)V.set(Z,U,0);V.set(U,U,1)}for(let U=De-1;U>=0;U--)if(j[U]!==0){for(let Z=U+1;Z<G;Z++){let ae=0;for(let ee=U;ee<o;ee++)ae+=V.get(ee,U)*V.get(ee,Z);ae=-ae/V.get(U,U);for(let ee=U;ee<o;ee++)V.set(ee,Z,V.get(ee,Z)+ae*V.get(ee,U))}for(let Z=U;Z<o;Z++)V.set(Z,U,-V.get(Z,U));V.set(U,U,1+V.get(U,U));for(let Z=0;Z<U-1;Z++)V.set(Z,U,0)}else{for(let Z=0;Z<o;Z++)V.set(Z,U,0);V.set(U,U,1)}}if(I)for(let U=c-1;U>=0;U--){if(U<Be&&N[U]!==0)for(let Z=U+1;Z<c;Z++){let ae=0;for(let ee=U+1;ee<c;ee++)ae+=ne.get(ee,U)*ne.get(ee,Z);ae=-ae/ne.get(U+1,U);for(let ee=U+1;ee<c;ee++)ne.set(ee,Z,ne.get(ee,Z)+ae*ne.get(ee,U))}for(let Z=0;Z<c;Z++)ne.set(Z,U,0);ne.set(U,U,1)}let _e=we-1,Ke=Number.EPSILON;for(;we>0;){let U,Z;for(U=we-2;U>=-1&&U!==-1;U--){const ae=Number.MIN_VALUE+Ke*Math.abs(j[U]+Math.abs(j[U+1]));if(Math.abs(N[U])<=ae||Number.isNaN(N[U])){N[U]=0;break}}if(U===we-2)Z=4;else{let ae;for(ae=we-1;ae>=U&&ae!==U;ae--){let ee=(ae!==we?Math.abs(N[ae]):0)+(ae!==U+1?Math.abs(N[ae-1]):0);if(Math.abs(j[ae])<=Ke*ee){j[ae]=0;break}}ae===U?Z=3:ae===we-1?Z=1:(Z=2,U=ae)}switch(U++,Z){case 1:{let ae=N[we-2];N[we-2]=0;for(let ee=we-2;ee>=U;ee--){let et=pe(j[ee],ae),Ve=j[ee]/et,We=ae/et;if(j[ee]=et,ee!==U&&(ae=-We*N[ee-1],N[ee-1]=Ve*N[ee-1]),I)for(let tt=0;tt<c;tt++)et=Ve*ne.get(tt,ee)+We*ne.get(tt,we-1),ne.set(tt,we-1,-We*ne.get(tt,ee)+Ve*ne.get(tt,we-1)),ne.set(tt,ee,et)}break}case 2:{let ae=N[U-1];N[U-1]=0;for(let ee=U;ee<we;ee++){let et=pe(j[ee],ae),Ve=j[ee]/et,We=ae/et;if(j[ee]=et,ae=-We*N[ee],N[ee]=Ve*N[ee],T)for(let tt=0;tt<o;tt++)et=Ve*V.get(tt,ee)+We*V.get(tt,U-1),V.set(tt,U-1,-We*V.get(tt,ee)+Ve*V.get(tt,U-1)),V.set(tt,ee,et)}break}case 3:{const ae=Math.max(Math.abs(j[we-1]),Math.abs(j[we-2]),Math.abs(N[we-2]),Math.abs(j[U]),Math.abs(N[U])),ee=j[we-1]/ae,et=j[we-2]/ae,Ve=N[we-2]/ae,We=j[U]/ae,tt=N[U]/ae,at=((et+ee)*(et-ee)+Ve*Ve)/2,pt=ee*Ve*(ee*Ve);let it=0;(at!==0||pt!==0)&&(at<0?it=0-Math.sqrt(at*at+pt):it=Math.sqrt(at*at+pt),it=pt/(at+it));let xt=(We+ee)*(We-ee)+it,bt=We*tt;for(let Xe=U;Xe<we-1;Xe++){let ot=pe(xt,bt);ot===0&&(ot=Number.MIN_VALUE);let ut=xt/ot,ct=bt/ot;if(Xe!==U&&(N[Xe-1]=ot),xt=ut*j[Xe]+ct*N[Xe],N[Xe]=ut*N[Xe]-ct*j[Xe],bt=ct*j[Xe+1],j[Xe+1]=ut*j[Xe+1],I)for(let nt=0;nt<c;nt++)ot=ut*ne.get(nt,Xe)+ct*ne.get(nt,Xe+1),ne.set(nt,Xe+1,-ct*ne.get(nt,Xe)+ut*ne.get(nt,Xe+1)),ne.set(nt,Xe,ot);if(ot=pe(xt,bt),ot===0&&(ot=Number.MIN_VALUE),ut=xt/ot,ct=bt/ot,j[Xe]=ot,xt=ut*N[Xe]+ct*j[Xe+1],j[Xe+1]=-ct*N[Xe]+ut*j[Xe+1],bt=ct*N[Xe+1],N[Xe+1]=ut*N[Xe+1],T&&Xe<o-1)for(let nt=0;nt<o;nt++)ot=ut*V.get(nt,Xe)+ct*V.get(nt,Xe+1),V.set(nt,Xe+1,-ct*V.get(nt,Xe)+ut*V.get(nt,Xe+1)),V.set(nt,Xe,ot)}N[we-2]=xt;break}case 4:{if(j[U]<=0&&(j[U]=j[U]<0?-j[U]:0,I))for(let ae=0;ae<=_e;ae++)ne.set(ae,U,-ne.get(ae,U));for(;U<_e&&!(j[U]>=j[U+1]);){let ae=j[U];if(j[U]=j[U+1],j[U+1]=ae,I&&U<c-1)for(let ee=0;ee<c;ee++)ae=ne.get(ee,U+1),ne.set(ee,U+1,ne.get(ee,U)),ne.set(ee,U,ae);if(T&&U<o-1)for(let ee=0;ee<o;ee++)ae=V.get(ee,U+1),V.set(ee,U+1,V.get(ee,U)),V.set(ee,U,ae);U++}we--;break}}}if(q){let U=ne;ne=V,V=U}this.m=o,this.n=c,this.s=j,this.U=V,this.V=ne}solve(f){let l=f,o=this.threshold,c=this.s.length,m=z.zeros(c,c);for(let G=0;G<c;G++)Math.abs(this.s[G])<=o?m.set(G,G,0):m.set(G,G,1/this.s[G]);let S=this.U,k=this.rightSingularVectors,T=k.mmul(m),I=k.rows,q=S.rows,F=z.zeros(I,q);for(let G=0;G<I;G++)for(let K=0;K<q;K++){let j=0;for(let V=0;V<c;V++)j+=T.get(G,V)*S.get(K,V);F.set(G,K,j)}return F.mmul(l)}solveForDiagonal(f){return this.solve(z.diag(f))}inverse(){let f=this.V,l=this.threshold,o=f.rows,c=f.columns,m=new z(o,this.s.length);for(let q=0;q<o;q++)for(let F=0;F<c;F++)Math.abs(this.s[F])>l&&m.set(q,F,f.get(q,F)/this.s[F]);let S=this.U,k=S.rows,T=S.columns,I=new z(o,k);for(let q=0;q<o;q++)for(let F=0;F<k;F++){let G=0;for(let K=0;K<T;K++)G+=m.get(q,K)*S.get(F,K);I.set(q,F,G)}return I}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let f=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,l=0,o=this.s;for(let c=0,m=o.length;c<m;c++)o[c]>f&&l++;return l}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return z.diag(this.s)}}function Ue(x,f=!1){return x=X.checkMatrix(x),f?new Ne(x).inverse():oe(x,z.eye(x.rows))}function oe(x,f,l=!1){return x=X.checkMatrix(x),f=X.checkMatrix(f),l?new Ne(x).solve(f):x.isSquare()?new ge(x).solve(f):new Q(x).solve(f)}function ue(x){if(x=z.checkMatrix(x),x.isSquare()){if(x.columns===0)return 1;let f,l,o,c;if(x.columns===2)return f=x.get(0,0),l=x.get(0,1),o=x.get(1,0),c=x.get(1,1),f*c-l*o;if(x.columns===3){let m,S,k;return m=new re(x,[1,2],[1,2]),S=new re(x,[1,2],[0,2]),k=new re(x,[1,2],[0,1]),f=x.get(0,0),l=x.get(0,1),o=x.get(0,2),f*ue(m)-l*ue(S)+o*ue(k)}else return new ge(x).determinant}else throw Error("determinant can only be calculated for a square matrix")}function be(x,f){let l=[];for(let o=0;o<x;o++)o!==f&&l.push(o);return l}function ce(x,f,l,o=1e-9,c=1e-9){if(x>c)return new Array(f.rows+1).fill(0);{let m=f.addRow(l,[0]);for(let S=0;S<m.rows;S++)Math.abs(m.get(S,0))<o&&m.set(S,0,0);return m.to1DArray()}}function Re(x,f={}){const{thresholdValue:l=1e-9,thresholdError:o=1e-9}=f;x=z.checkMatrix(x);let c=x.rows,m=new z(c,c);for(let S=0;S<c;S++){let k=z.columnVector(x.getRow(S)),T=x.subMatrixRow(be(c,S)).transpose(),q=new Ne(T).solve(k),F=z.sub(k,T.mmul(q)).abs().max();m.setRow(S,ce(F,q,S,l,o))}return m}function Ye(x,f=Number.EPSILON){if(x=z.checkMatrix(x),x.isEmpty())return x.transpose();let l=new Ne(x,{autoTranspose:!0}),o=l.leftSingularVectors,c=l.rightSingularVectors,m=l.diagonal;for(let S=0;S<m.length;S++)Math.abs(m[S])>f?m[S]=1/m[S]:m[S]=0;return c.mmul(z.diag(m).mmul(o.transpose()))}function Ae(x,f=x,l={}){x=new z(x);let o=!1;if(typeof f=="object"&&!z.isMatrix(f)&&!e.isAnyArray(f)?(l=f,f=x,o=!0):f=new z(f),x.rows!==f.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:c=!0}=l;c&&(x=x.center("column"),o||(f=f.center("column")));const m=x.transpose().mmul(f);for(let S=0;S<m.rows;S++)for(let k=0;k<m.columns;k++)m.set(S,k,m.get(S,k)*(1/(x.rows-1)));return m}function ze(x,f=x,l={}){x=new z(x);let o=!1;if(typeof f=="object"&&!z.isMatrix(f)&&!e.isAnyArray(f)?(l=f,f=x,o=!0):f=new z(f),x.rows!==f.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:c=!0,scale:m=!0}=l;c&&(x.center("column"),o||f.center("column")),m&&(x.scale("column"),o||f.scale("column"));const S=x.standardDeviation("column",{unbiased:!0}),k=o?S:f.standardDeviation("column",{unbiased:!0}),T=x.transpose().mmul(f);for(let I=0;I<T.rows;I++)for(let q=0;q<T.columns;q++)T.set(I,q,T.get(I,q)*(1/(S[I]*k[q]))*(1/(x.rows-1)));return T}class qe{constructor(f,l={}){const{assumeSymmetric:o=!1}=l;if(f=X.checkMatrix(f),!f.isSquare())throw new Error("Matrix is not a square matrix");if(f.isEmpty())throw new Error("Matrix must be non-empty");let c=f.columns,m=new z(c,c),S=new Float64Array(c),k=new Float64Array(c),T=f,I,q,F=!1;if(o?F=!0:F=f.isSymmetric(),F){for(I=0;I<c;I++)for(q=0;q<c;q++)m.set(I,q,T.get(I,q));Ge(c,k,S,m),rt(c,k,S,m)}else{let G=new z(c,c),K=new Float64Array(c);for(q=0;q<c;q++)for(I=0;I<c;I++)G.set(I,q,T.get(I,q));Qe(c,G,K,m),st(c,k,S,m,G)}this.n=c,this.e=k,this.d=S,this.V=m}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let f=this.n,l=this.e,o=this.d,c=new z(f,f),m,S;for(m=0;m<f;m++){for(S=0;S<f;S++)c.set(m,S,0);c.set(m,m,o[m]),l[m]>0?c.set(m,m+1,l[m]):l[m]<0&&c.set(m,m-1,l[m])}return c}}function Ge(x,f,l,o){let c,m,S,k,T,I,q,F;for(T=0;T<x;T++)l[T]=o.get(x-1,T);for(k=x-1;k>0;k--){for(F=0,S=0,I=0;I<k;I++)F=F+Math.abs(l[I]);if(F===0)for(f[k]=l[k-1],T=0;T<k;T++)l[T]=o.get(k-1,T),o.set(k,T,0),o.set(T,k,0);else{for(I=0;I<k;I++)l[I]/=F,S+=l[I]*l[I];for(c=l[k-1],m=Math.sqrt(S),c>0&&(m=-m),f[k]=F*m,S=S-c*m,l[k-1]=c-m,T=0;T<k;T++)f[T]=0;for(T=0;T<k;T++){for(c=l[T],o.set(T,k,c),m=f[T]+o.get(T,T)*c,I=T+1;I<=k-1;I++)m+=o.get(I,T)*l[I],f[I]+=o.get(I,T)*c;f[T]=m}for(c=0,T=0;T<k;T++)f[T]/=S,c+=f[T]*l[T];for(q=c/(S+S),T=0;T<k;T++)f[T]-=q*l[T];for(T=0;T<k;T++){for(c=l[T],m=f[T],I=T;I<=k-1;I++)o.set(I,T,o.get(I,T)-(c*f[I]+m*l[I]));l[T]=o.get(k-1,T),o.set(k,T,0)}}l[k]=S}for(k=0;k<x-1;k++){if(o.set(x-1,k,o.get(k,k)),o.set(k,k,1),S=l[k+1],S!==0){for(I=0;I<=k;I++)l[I]=o.get(I,k+1)/S;for(T=0;T<=k;T++){for(m=0,I=0;I<=k;I++)m+=o.get(I,k+1)*o.get(I,T);for(I=0;I<=k;I++)o.set(I,T,o.get(I,T)-m*l[I])}}for(I=0;I<=k;I++)o.set(I,k+1,0)}for(T=0;T<x;T++)l[T]=o.get(x-1,T),o.set(x-1,T,0);o.set(x-1,x-1,1),f[0]=0}function rt(x,f,l,o){let c,m,S,k,T,I,q,F,G,K,j,V,ne,N,W,se;for(S=1;S<x;S++)f[S-1]=f[S];f[x-1]=0;let De=0,Be=0,He=Number.EPSILON;for(I=0;I<x;I++){for(Be=Math.max(Be,Math.abs(l[I])+Math.abs(f[I])),q=I;q<x&&!(Math.abs(f[q])<=He*Be);)q++;if(q>I)do{for(c=l[I],F=(l[I+1]-c)/(2*f[I]),G=pe(F,1),F<0&&(G=-G),l[I]=f[I]/(F+G),l[I+1]=f[I]*(F+G),K=l[I+1],m=c-l[I],S=I+2;S<x;S++)l[S]-=m;for(De=De+m,F=l[q],j=1,V=j,ne=j,N=f[I+1],W=0,se=0,S=q-1;S>=I;S--)for(ne=V,V=j,se=W,c=j*f[S],m=j*F,G=pe(F,f[S]),f[S+1]=W*G,W=f[S]/G,j=F/G,F=j*l[S]-W*c,l[S+1]=m+W*(j*c+W*l[S]),T=0;T<x;T++)m=o.get(T,S+1),o.set(T,S+1,W*o.get(T,S)+j*m),o.set(T,S,j*o.get(T,S)-W*m);F=-W*se*ne*N*f[I]/K,f[I]=W*F,l[I]=j*F}while(Math.abs(f[I])>He*Be);l[I]=l[I]+De,f[I]=0}for(S=0;S<x-1;S++){for(T=S,F=l[S],k=S+1;k<x;k++)l[k]<F&&(T=k,F=l[k]);if(T!==S)for(l[T]=l[S],l[S]=F,k=0;k<x;k++)F=o.get(k,S),o.set(k,S,o.get(k,T)),o.set(k,T,F)}}function Qe(x,f,l,o){let c=0,m=x-1,S,k,T,I,q,F,G;for(F=c+1;F<=m-1;F++){for(G=0,I=F;I<=m;I++)G=G+Math.abs(f.get(I,F-1));if(G!==0){for(T=0,I=m;I>=F;I--)l[I]=f.get(I,F-1)/G,T+=l[I]*l[I];for(k=Math.sqrt(T),l[F]>0&&(k=-k),T=T-l[F]*k,l[F]=l[F]-k,q=F;q<x;q++){for(S=0,I=m;I>=F;I--)S+=l[I]*f.get(I,q);for(S=S/T,I=F;I<=m;I++)f.set(I,q,f.get(I,q)-S*l[I])}for(I=0;I<=m;I++){for(S=0,q=m;q>=F;q--)S+=l[q]*f.get(I,q);for(S=S/T,q=F;q<=m;q++)f.set(I,q,f.get(I,q)-S*l[q])}l[F]=G*l[F],f.set(F,F-1,G*k)}}for(I=0;I<x;I++)for(q=0;q<x;q++)o.set(I,q,I===q?1:0);for(F=m-1;F>=c+1;F--)if(f.get(F,F-1)!==0){for(I=F+1;I<=m;I++)l[I]=f.get(I,F-1);for(q=F;q<=m;q++){for(k=0,I=F;I<=m;I++)k+=l[I]*o.get(I,q);for(k=k/l[F]/f.get(F,F-1),I=F;I<=m;I++)o.set(I,q,o.get(I,q)+k*l[I])}}}function st(x,f,l,o,c){let m=x-1,S=0,k=x-1,T=Number.EPSILON,I=0,q=0,F=0,G=0,K=0,j=0,V=0,ne=0,N,W,se,De,Be,He,we,_e,Ke,U,Z,ae,ee,et,Ve;for(N=0;N<x;N++)for((N<S||N>k)&&(l[N]=c.get(N,N),f[N]=0),W=Math.max(N-1,0);W<x;W++)q=q+Math.abs(c.get(N,W));for(;m>=S;){for(De=m;De>S&&(j=Math.abs(c.get(De-1,De-1))+Math.abs(c.get(De,De)),j===0&&(j=q),!(Math.abs(c.get(De,De-1))<T*j));)De--;if(De===m)c.set(m,m,c.get(m,m)+I),l[m]=c.get(m,m),f[m]=0,m--,ne=0;else if(De===m-1){if(we=c.get(m,m-1)*c.get(m-1,m),F=(c.get(m-1,m-1)-c.get(m,m))/2,G=F*F+we,V=Math.sqrt(Math.abs(G)),c.set(m,m,c.get(m,m)+I),c.set(m-1,m-1,c.get(m-1,m-1)+I),_e=c.get(m,m),G>=0){for(V=F>=0?F+V:F-V,l[m-1]=_e+V,l[m]=l[m-1],V!==0&&(l[m]=_e-we/V),f[m-1]=0,f[m]=0,_e=c.get(m,m-1),j=Math.abs(_e)+Math.abs(V),F=_e/j,G=V/j,K=Math.sqrt(F*F+G*G),F=F/K,G=G/K,W=m-1;W<x;W++)V=c.get(m-1,W),c.set(m-1,W,G*V+F*c.get(m,W)),c.set(m,W,G*c.get(m,W)-F*V);for(N=0;N<=m;N++)V=c.get(N,m-1),c.set(N,m-1,G*V+F*c.get(N,m)),c.set(N,m,G*c.get(N,m)-F*V);for(N=S;N<=k;N++)V=o.get(N,m-1),o.set(N,m-1,G*V+F*o.get(N,m)),o.set(N,m,G*o.get(N,m)-F*V)}else l[m-1]=_e+F,l[m]=_e+F,f[m-1]=V,f[m]=-V;m=m-2,ne=0}else{if(_e=c.get(m,m),Ke=0,we=0,De<m&&(Ke=c.get(m-1,m-1),we=c.get(m,m-1)*c.get(m-1,m)),ne===10){for(I+=_e,N=S;N<=m;N++)c.set(N,N,c.get(N,N)-_e);j=Math.abs(c.get(m,m-1))+Math.abs(c.get(m-1,m-2)),_e=Ke=.75*j,we=-.4375*j*j}if(ne===30&&(j=(Ke-_e)/2,j=j*j+we,j>0)){for(j=Math.sqrt(j),Ke<_e&&(j=-j),j=_e-we/((Ke-_e)/2+j),N=S;N<=m;N++)c.set(N,N,c.get(N,N)-j);I+=j,_e=Ke=we=.964}for(ne=ne+1,Be=m-2;Be>=De&&(V=c.get(Be,Be),K=_e-V,j=Ke-V,F=(K*j-we)/c.get(Be+1,Be)+c.get(Be,Be+1),G=c.get(Be+1,Be+1)-V-K-j,K=c.get(Be+2,Be+1),j=Math.abs(F)+Math.abs(G)+Math.abs(K),F=F/j,G=G/j,K=K/j,!(Be===De||Math.abs(c.get(Be,Be-1))*(Math.abs(G)+Math.abs(K))<T*(Math.abs(F)*(Math.abs(c.get(Be-1,Be-1))+Math.abs(V)+Math.abs(c.get(Be+1,Be+1))))));)Be--;for(N=Be+2;N<=m;N++)c.set(N,N-2,0),N>Be+2&&c.set(N,N-3,0);for(se=Be;se<=m-1&&(et=se!==m-1,se!==Be&&(F=c.get(se,se-1),G=c.get(se+1,se-1),K=et?c.get(se+2,se-1):0,_e=Math.abs(F)+Math.abs(G)+Math.abs(K),_e!==0&&(F=F/_e,G=G/_e,K=K/_e)),_e!==0);se++)if(j=Math.sqrt(F*F+G*G+K*K),F<0&&(j=-j),j!==0){for(se!==Be?c.set(se,se-1,-j*_e):De!==Be&&c.set(se,se-1,-c.get(se,se-1)),F=F+j,_e=F/j,Ke=G/j,V=K/j,G=G/F,K=K/F,W=se;W<x;W++)F=c.get(se,W)+G*c.get(se+1,W),et&&(F=F+K*c.get(se+2,W),c.set(se+2,W,c.get(se+2,W)-F*V)),c.set(se,W,c.get(se,W)-F*_e),c.set(se+1,W,c.get(se+1,W)-F*Ke);for(N=0;N<=Math.min(m,se+3);N++)F=_e*c.get(N,se)+Ke*c.get(N,se+1),et&&(F=F+V*c.get(N,se+2),c.set(N,se+2,c.get(N,se+2)-F*K)),c.set(N,se,c.get(N,se)-F),c.set(N,se+1,c.get(N,se+1)-F*G);for(N=S;N<=k;N++)F=_e*o.get(N,se)+Ke*o.get(N,se+1),et&&(F=F+V*o.get(N,se+2),o.set(N,se+2,o.get(N,se+2)-F*K)),o.set(N,se,o.get(N,se)-F),o.set(N,se+1,o.get(N,se+1)-F*G)}}}if(q!==0){for(m=x-1;m>=0;m--)if(F=l[m],G=f[m],G===0)for(De=m,c.set(m,m,1),N=m-1;N>=0;N--){for(we=c.get(N,N)-F,K=0,W=De;W<=m;W++)K=K+c.get(N,W)*c.get(W,m);if(f[N]<0)V=we,j=K;else if(De=N,f[N]===0?c.set(N,m,we!==0?-K/we:-K/(T*q)):(_e=c.get(N,N+1),Ke=c.get(N+1,N),G=(l[N]-F)*(l[N]-F)+f[N]*f[N],He=(_e*j-V*K)/G,c.set(N,m,He),c.set(N+1,m,Math.abs(_e)>Math.abs(V)?(-K-we*He)/_e:(-j-Ke*He)/V)),He=Math.abs(c.get(N,m)),T*He*He>1)for(W=N;W<=m;W++)c.set(W,m,c.get(W,m)/He)}else if(G<0)for(De=m-1,Math.abs(c.get(m,m-1))>Math.abs(c.get(m-1,m))?(c.set(m-1,m-1,G/c.get(m,m-1)),c.set(m-1,m,-(c.get(m,m)-F)/c.get(m,m-1))):(Ve=gt(0,-c.get(m-1,m),c.get(m-1,m-1)-F,G),c.set(m-1,m-1,Ve[0]),c.set(m-1,m,Ve[1])),c.set(m,m-1,0),c.set(m,m,1),N=m-2;N>=0;N--){for(U=0,Z=0,W=De;W<=m;W++)U=U+c.get(N,W)*c.get(W,m-1),Z=Z+c.get(N,W)*c.get(W,m);if(we=c.get(N,N)-F,f[N]<0)V=we,K=U,j=Z;else if(De=N,f[N]===0?(Ve=gt(-U,-Z,we,G),c.set(N,m-1,Ve[0]),c.set(N,m,Ve[1])):(_e=c.get(N,N+1),Ke=c.get(N+1,N),ae=(l[N]-F)*(l[N]-F)+f[N]*f[N]-G*G,ee=(l[N]-F)*2*G,ae===0&&ee===0&&(ae=T*q*(Math.abs(we)+Math.abs(G)+Math.abs(_e)+Math.abs(Ke)+Math.abs(V))),Ve=gt(_e*K-V*U+G*Z,_e*j-V*Z-G*U,ae,ee),c.set(N,m-1,Ve[0]),c.set(N,m,Ve[1]),Math.abs(_e)>Math.abs(V)+Math.abs(G)?(c.set(N+1,m-1,(-U-we*c.get(N,m-1)+G*c.get(N,m))/_e),c.set(N+1,m,(-Z-we*c.get(N,m)-G*c.get(N,m-1))/_e)):(Ve=gt(-K-Ke*c.get(N,m-1),-j-Ke*c.get(N,m),V,G),c.set(N+1,m-1,Ve[0]),c.set(N+1,m,Ve[1]))),He=Math.max(Math.abs(c.get(N,m-1)),Math.abs(c.get(N,m))),T*He*He>1)for(W=N;W<=m;W++)c.set(W,m-1,c.get(W,m-1)/He),c.set(W,m,c.get(W,m)/He)}for(N=0;N<x;N++)if(N<S||N>k)for(W=N;W<x;W++)o.set(N,W,c.get(N,W));for(W=x-1;W>=S;W--)for(N=S;N<=k;N++){for(V=0,se=S;se<=Math.min(W,k);se++)V=V+o.get(N,se)*c.get(se,W);o.set(N,W,V)}}}function gt(x,f,l,o){let c,m;return Math.abs(l)>Math.abs(o)?(c=o/l,m=l+c*o,[(x+c*f)/m,(f-c*x)/m]):(c=l/o,m=o+c*l,[(c*x+f)/m,(c*f-x)/m])}class wt{constructor(f){if(f=X.checkMatrix(f),!f.isSymmetric())throw new Error("Matrix is not symmetric");let l=f,o=l.rows,c=new z(o,o),m=!0,S,k,T;for(k=0;k<o;k++){let I=0;for(T=0;T<k;T++){let q=0;for(S=0;S<T;S++)q+=c.get(T,S)*c.get(k,S);q=(l.get(k,T)-q)/c.get(T,T),c.set(k,T,q),I=I+q*q}for(I=l.get(k,k)-I,m&&(m=I>0),c.set(k,k,Math.sqrt(Math.max(I,0))),T=k+1;T<o;T++)c.set(k,T,0)}this.L=c,this.positiveDefinite=m}isPositiveDefinite(){return this.positiveDefinite}solve(f){f=X.checkMatrix(f);let l=this.L,o=l.rows;if(f.rows!==o)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let c=f.columns,m=f.clone(),S,k,T;for(T=0;T<o;T++)for(k=0;k<c;k++){for(S=0;S<T;S++)m.set(T,k,m.get(T,k)-m.get(S,k)*l.get(T,S));m.set(T,k,m.get(T,k)/l.get(T,T))}for(T=o-1;T>=0;T--)for(k=0;k<c;k++){for(S=T+1;S<o;S++)m.set(T,k,m.get(T,k)-m.get(S,k)*l.get(S,T));m.set(T,k,m.get(T,k)/l.get(T,T))}return m}get lowerTriangularMatrix(){return this.L}}class lt{constructor(f,l={}){f=X.checkMatrix(f);let{Y:o}=l;const{scaleScores:c=!1,maxIterations:m=1e3,terminationCriteria:S=1e-10}=l;let k;if(o){if(e.isAnyArray(o)&&typeof o[0]=="number"?o=z.columnVector(o):o=X.checkMatrix(o),o.rows!==f.rows)throw new Error("Y should have the same number of rows as X");k=o.getColumnVector(0)}else k=f.getColumnVector(0);let T=1,I,q,F,G;for(let K=0;K<m&&T>S;K++)F=f.transpose().mmul(k).div(k.transpose().mmul(k).get(0,0)),F=F.div(F.norm()),I=f.mmul(F).div(F.transpose().mmul(F).get(0,0)),K>0&&(T=I.clone().sub(G).pow(2).sum()),G=I.clone(),o?(q=o.transpose().mmul(I).div(I.transpose().mmul(I).get(0,0)),q=q.div(q.norm()),k=o.mmul(q).div(q.transpose().mmul(q).get(0,0))):k=I;if(o){let K=f.transpose().mmul(I).div(I.transpose().mmul(I).get(0,0));K=K.div(K.norm());let j=f.clone().sub(I.clone().mmul(K.transpose())),V=k.transpose().mmul(I).div(I.transpose().mmul(I).get(0,0)),ne=o.clone().sub(I.clone().mulS(V.get(0,0)).mmul(q.transpose()));this.t=I,this.p=K.transpose(),this.w=F.transpose(),this.q=q,this.u=k,this.s=I.transpose().mmul(I),this.xResidual=j,this.yResidual=ne,this.betas=V}else this.w=F.transpose(),this.s=I.transpose().mmul(I).sqrt(),c?this.t=I.clone().div(this.s.get(0,0)):this.t=I,this.xResidual=f.sub(I.mmul(F.transpose()))}}return matrix$1.AbstractMatrix=ie,matrix$1.CHO=wt,matrix$1.CholeskyDecomposition=wt,matrix$1.DistanceMatrix=ke,matrix$1.EVD=qe,matrix$1.EigenvalueDecomposition=qe,matrix$1.LU=ge,matrix$1.LuDecomposition=ge,matrix$1.Matrix=z,matrix$1.MatrixColumnSelectionView=Fe,matrix$1.MatrixColumnView=Me,matrix$1.MatrixFlipColumnView=$e,matrix$1.MatrixFlipRowView=je,matrix$1.MatrixRowSelectionView=fe,matrix$1.MatrixRowView=Oe,matrix$1.MatrixSelectionView=re,matrix$1.MatrixSubView=Le,matrix$1.MatrixTransposeView=Se,matrix$1.NIPALS=lt,matrix$1.Nipals=lt,matrix$1.QR=Q,matrix$1.QrDecomposition=Q,matrix$1.SVD=Ne,matrix$1.SingularValueDecomposition=Ne,matrix$1.SymmetricMatrix=de,matrix$1.WrapperMatrix1D=Te,matrix$1.WrapperMatrix2D=X,matrix$1.correlation=ze,matrix$1.covariance=Ae,matrix$1.default=z,matrix$1.determinant=ue,matrix$1.inverse=Ue,matrix$1.linearDependencies=Re,matrix$1.pseudoInverse=Ye,matrix$1.solve=oe,matrix$1.wrap=me,matrix$1}var matrixExports=requireMatrix();const matrix=getDefaultExportFromCjs(matrixExports),Matrix$1=matrixExports.Matrix,SVD=matrixExports.SVD,SingularValueDecomposition=matrixExports.SingularValueDecomposition;matrix.Matrix?matrix.Matrix:matrixExports.Matrix;const inverse=matrixExports.inverse,solve=matrixExports.solve;function getSeparatedKernel(e){const r=new SVD(e,{autoTranspose:!0});if(r.rank!==1)return null;const t=Math.sqrt(r.s[0]),i=r.U.to2DArray().map(s=>s[0]*t),n=r.V.to2DArray().map(s=>s[0]*t);return[i,n]}function convolution(e,r={}){let{channels:t,bitDepth:i,normalize:n=!1,divisor:s=1,border:a="copy",algorithm:h="auto"}=r,d={};i&&(d.bitDepth=i);let u=Image.createFrom(this,d);if(t=validateArrayOfChannels(this,t),h!=="separable")({kernel:e}=validateKernel(e));else if(!Array.isArray(e)||e.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(h==="auto"){let E=getSeparatedKernel(e);E!==null?(h="separable",e=E):(e.length>9||e[0].length>9)&&this.width<=4096&&this.height<=4096?h="fft":h="direct"}let g,_;h==="separable"?(g=Math.floor(e[0].length/2),_=Math.floor(e[1].length/2)):(g=Math.floor(e.length/2),_=Math.floor(e[0].length/2));let w=u.isClamped,p=new Array(this.height*this.width),b,y,M,A,C,v;for(A=0;A<t.length;A++){for(C=t[A],M=0;M<this.height;M++)for(y=0;y<this.width;y++)b=M*this.width+y,p[b]=this.data[b*this.channels+C];if(h==="direct")v=srcExports$1.direct(p,e,{rows:this.height,cols:this.width,normalize:n,divisor:s});else if(h==="separable"){if(v=convolutionSeparable(p,e,this.width,this.height),n){s=0;for(let E=0;E<e[0].length;E++)for(let R=0;R<e[1].length;R++)s+=e[0][E]*e[1][R]}if(s!==1)for(let E=0;E<v.length;E++)v[E]/=s}else v=srcExports$1.fft(p,e,{rows:this.height,cols:this.width,normalize:n,divisor:s});for(M=0;M<this.height;M++)for(y=0;y<this.width;y++)b=M*this.width+y,w?u.data[b*this.channels+C]=clamp(v[b],u):u.data[b*this.channels+C]=v[b]}if(this.alpha&&!t.includes(this.channels))for(y=this.components;y<this.data.length;y=y+this.channels)u.data[y]=this.data[y];return a!=="periodic"&&u.setBorder({size:[_,g],algorithm:a}),u}function gradientFilter(e={}){let{direction:r="xy",border:t="copy",kernelX:i,kernelY:n,channels:s,bitDepth:a=this.bitDepth}=e;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),r){case"x":if(!i)throw new Error("kernelX option is missing");return convolution.call(this,i,{channels:s,border:t,bitDepth:a});case"y":if(!n)throw new Error("kernelY option is missing");return convolution.call(this,n,{channels:s,border:t,bitDepth:a});case"xy":{if(!i)throw new Error("kernelX option is missing");if(!n)throw new Error("kernelY option is missing");const h=convolution.call(this,i,{channels:s,border:t,bitDepth:32}),d=convolution.call(this,n,{channels:s,border:t,bitDepth:32});return h.hypotenuse(d,{bitDepth:a,channels:s})}default:throw new Error(`Unknown parameter direction: ${r}`)}}function sobelFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1,hasRequiredNewArray;function requireNewArray(){if(hasRequiredNewArray)return newArray_1;hasRequiredNewArray=1,newArray_1=e;function e(r,t){r=r||0;for(var i=new Array(r),n=0;n<r;n++)i[n]=t;return i}return newArray_1}var newArrayExports=requireNewArray();const newArray=getDefaultExportFromCjs(newArrayExports);function level(e={}){let{algorithm:r="range",channels:t,min:i=this.min,max:n=this.max}=e;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),t=validateArrayOfChannels(this,{channels:t}),t.length!==this.channel&&(Array.isArray(i)&&i.length===this.channels&&(i=i.filter((s,a)=>t.includes(a))),Array.isArray(n)&&n.length===this.channels&&(n=n.filter((s,a)=>t.includes(a)))),r){case"range":i<0&&(i=0),n>this.maxValue&&(n=this.maxValue),Array.isArray(i)||(i=newArray(t.length,i)),Array.isArray(n)||(n=newArray(t.length,n)),processImage(this,i,n,t);break;default:throw new Error(`level: algorithm not implement: ${r}`)}return this}function processImage(e,r,t,i){let n=1e-5,s=new Array(i.length);for(let a=0;a<i.length;a++)r[a]===0&&t[a]===e.maxValue||t[a]===r[a]?s[a]=0:s[a]=(e.maxValue+1-n)/(t[a]-r[a]),r[a]+=(.5-n/2)/s[a];for(let a=0;a<i.length;a++){let h=i[a];if(s[a]!==0)for(let d=0;d<e.data.length;d+=e.channels)e.data[d+h]=Math.min(Math.max(0,(e.data[d+h]-r[a])*s[a]+.5|0),e.maxValue)}}var isArrayType,hasRequiredIsArrayType;function requireIsArrayType(){if(hasRequiredIsArrayType)return isArrayType;hasRequiredIsArrayType=1;var e=Object.prototype.toString;return isArrayType=function(t){return e.call(t).substr(-6,5)==="Array"},isArrayType}var isArrayTypeExports=requireIsArrayType();const isArray=getDefaultExportFromCjs(isArrayTypeExports);function checkNumberArray(e){if(isNaN(e)){if(e instanceof Image)return e.data;if(!isArray(e))throw new Error("checkNumberArray: the value should be either a number, array or Image");return e}else{if(e<=0)throw new Error("checkNumberArray: the value must be greater than 0");return e}}function add(e,r={}){let{channels:t}=r;if(this.checkProcessable("add",{bitDepth:[8,16]}),t=validateArrayOfChannels(this,{channels:t}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("add: the data size is different");for(let i=0;i<t.length;i++){let n=t[i];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+n]=Math.max(0,Math.min(this.maxValue,this.data[s+n]+e[s+n]>>0))}}else for(let i=0;i<t.length;i++){let n=t[i];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+n]=Math.min(this.maxValue,this.data[s+n]+e>>0)}return this}function subtract(e,r={}){let{channels:t}=r;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),t=validateArrayOfChannels(this,{channels:t}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("subtract: the data size is different");for(let i=0;i<t.length;i++){let n=t[i];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+n]=Math.max(0,Math.min(this.maxValue,this.data[s+n]-e[s+n]>>0))}}else for(let i=0;i<t.length;i++){let n=t[i];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+n]=Math.max(0,this.data[s+n]-e>>0)}return this}function subtractImage(e,r={}){let{channels:t,absolute:i=!1}=r;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==e.width||this.height!==e.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("subtractImage: both images must have the same number of channels");let n=this.clone();t=validateArrayOfChannels(this,{channels:t});for(let s=0;s<t.length;s++){let a=t[s];for(let h=a;h<this.data.length;h+=this.channels){let d=this.data[h]-e.data[h];i?n.data[h]=Math.abs(d):n.data[h]=Math.max(d,0)}}return n}function hypotenuse(e,r={}){let{bitDepth:t=this.bitDepth,channels:i}=r;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==e.width||this.height!==e.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("hypotenuse: both images must have the same number of channels");let n=Image.createFrom(this,{bitDepth:t});i=validateArrayOfChannels(this,{channels:i});let s=n.isClamped;for(let a=0;a<i.length;a++){let h=i[a];for(let d=h;d<this.data.length;d+=this.channels){let u=Math.hypot(this.data[d],e.data[d]);s?n.data[d]=Math.min(Math.max(Math.round(u),0),n.maxValue):n.data[d]=u}}return n}function multiply(e,r={}){let{channels:t}=r;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),e<=0)throw new Error("multiply: the value must be greater than 0");if(t=validateArrayOfChannels(this,{channels:t}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("multiply: the data size is different");for(let i=0;i<t.length;i++){let n=t[i];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+n]=Math.max(0,Math.min(this.maxValue,this.data[s+n]*e[s+n]>>0))}}else for(let i=0;i<t.length;i++){let n=t[i];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+n]=Math.min(this.maxValue,this.data[s+n]*e>>0)}return this}function divide(e,r={}){let{channels:t}=r;if(this.checkProcessable("divide",{bitDepth:[8,16]}),t=validateArrayOfChannels(this,{channels:t}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("divide: the: the data size is different");for(let i=0;i<t.length;i++){let n=t[i];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+n]=Math.max(0,Math.min(this.maxValue,this.data[s+n]/e[s+n]>>0))}}else for(let i=0;i<t.length;i++){let n=t[i];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+n]=Math.min(this.maxValue,this.data[s+n]/e>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(r){if(typeof r=="number")return this._predict(r);if(isAnyArray(r)){const t=[];for(let i=0;i<r.length;i++)t.push(this._predict(r[i]));return t}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(r,t){if(!isAnyArray(r)||!isAnyArray(t)||r.length!==t.length)throw new Error("x and y must be arrays of the same length");const i=r.length,n=new Array(i);for(let p=0;p<i;p++)n[p]=this._predict(r[p]);let s=0,a=0,h=0,d=0,u=0,g=0,_=0;for(let p=0;p<i;p++)s+=n[p],a+=t[p],u+=n[p]*n[p],g+=t[p]*t[p],_+=n[p]*t[p],t[p]!==0&&(h+=(t[p]-n[p])*(t[p]-n[p])/t[p]),d+=(t[p]-n[p])*(t[p]-n[p]);const w=(i*_-s*a)/Math.sqrt((i*u-s*s)*(i*g-a*a));return{r:w,r2:w*w,chi2:h,rmsd:Math.sqrt(d/i)}}}function squaredEuclidean(e,r){let t=0;for(let i=0;i<e.length;i++)t+=(e[i]-r[i])*(e[i]-r[i]);return t}function euclidean(e,r){return Math.sqrt(squaredEuclidean(e,r))}const euclidean$1=Object.freeze(Object.defineProperty({__proto__:null,euclidean,squaredEuclidean},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(euclidean$1);var gaussianKernel,hasRequiredGaussianKernel;function requireGaussianKernel(){if(hasRequiredGaussianKernel)return gaussianKernel;hasRequiredGaussianKernel=1;const{squaredEuclidean:e}=require$$0,r={sigma:1};class t{constructor(n){n=Object.assign({},r,n),this.sigma=n.sigma,this.divisor=2*n.sigma*n.sigma}compute(n,s){const a=e(n,s);return Math.exp(-a/this.divisor)}}return gaussianKernel=t,gaussianKernel}var polynomialKernel,hasRequiredPolynomialKernel;function requirePolynomialKernel(){if(hasRequiredPolynomialKernel)return polynomialKernel;hasRequiredPolynomialKernel=1;const e={degree:1,constant:1,scale:1};class r{constructor(i){i=Object.assign({},e,i),this.degree=i.degree,this.constant=i.constant,this.scale=i.scale}compute(i,n){for(var s=0,a=0;a<i.length;a++)s+=i[a]*n[a];return Math.pow(this.scale*s+this.constant,this.degree)}}return polynomialKernel=r,polynomialKernel}var sigmoidKernel,hasRequiredSigmoidKernel;function requireSigmoidKernel(){if(hasRequiredSigmoidKernel)return sigmoidKernel;hasRequiredSigmoidKernel=1;const e={alpha:.01,constant:-Math.E};class r{constructor(i){i=Object.assign({},e,i),this.alpha=i.alpha,this.constant=i.constant}compute(i,n){for(var s=0,a=0;a<i.length;a++)s+=i[a]*n[a];return Math.tanh(this.alpha*s+this.constant)}}return sigmoidKernel=r,sigmoidKernel}var anovaKernel,hasRequiredAnovaKernel;function requireAnovaKernel(){if(hasRequiredAnovaKernel)return anovaKernel;hasRequiredAnovaKernel=1;const e={sigma:1,degree:1};class r{constructor(i){i=Object.assign({},e,i),this.sigma=i.sigma,this.degree=i.degree}compute(i,n){for(var s=0,a=Math.min(i.length,n.length),h=1;h<=a;++h)s+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(i[h-1],h)-Math.pow(n[h-1],h),2)),this.degree);return s}}return anovaKernel=r,anovaKernel}var cauchyKernel,hasRequiredCauchyKernel;function requireCauchyKernel(){if(hasRequiredCauchyKernel)return cauchyKernel;hasRequiredCauchyKernel=1;const{squaredEuclidean:e}=require$$0,r={sigma:1};class t{constructor(n){n=Object.assign({},r,n),this.sigma=n.sigma}compute(n,s){return 1/(1+e(n,s)/(this.sigma*this.sigma))}}return cauchyKernel=t,cauchyKernel}var exponentialKernel,hasRequiredExponentialKernel;function requireExponentialKernel(){if(hasRequiredExponentialKernel)return exponentialKernel;hasRequiredExponentialKernel=1;const{euclidean:e}=require$$0,r={sigma:1};class t{constructor(n){n=Object.assign({},r,n),this.sigma=n.sigma,this.divisor=2*n.sigma*n.sigma}compute(n,s){const a=e(n,s);return Math.exp(-a/this.divisor)}}return exponentialKernel=t,exponentialKernel}var histogramIntersectionKernel,hasRequiredHistogramIntersectionKernel;function requireHistogramIntersectionKernel(){if(hasRequiredHistogramIntersectionKernel)return histogramIntersectionKernel;hasRequiredHistogramIntersectionKernel=1;class e{compute(t,i){for(var n=Math.min(t.length,i.length),s=0,a=0;a<n;++a)s+=Math.min(t[a],i[a]);return s}}return histogramIntersectionKernel=e,histogramIntersectionKernel}var laplacianKernel,hasRequiredLaplacianKernel;function requireLaplacianKernel(){if(hasRequiredLaplacianKernel)return laplacianKernel;hasRequiredLaplacianKernel=1;const{euclidean:e}=require$$0,r={sigma:1};class t{constructor(n){n=Object.assign({},r,n),this.sigma=n.sigma}compute(n,s){const a=e(n,s);return Math.exp(-a/this.sigma)}}return laplacianKernel=t,laplacianKernel}var multiquadraticKernel,hasRequiredMultiquadraticKernel;function requireMultiquadraticKernel(){if(hasRequiredMultiquadraticKernel)return multiquadraticKernel;hasRequiredMultiquadraticKernel=1;const{squaredEuclidean:e}=require$$0,r={constant:1};class t{constructor(n){n=Object.assign({},r,n),this.constant=n.constant}compute(n,s){return Math.sqrt(e(n,s)+this.constant*this.constant)}}return multiquadraticKernel=t,multiquadraticKernel}var rationalQuadraticKernel,hasRequiredRationalQuadraticKernel;function requireRationalQuadraticKernel(){if(hasRequiredRationalQuadraticKernel)return rationalQuadraticKernel;hasRequiredRationalQuadraticKernel=1;const{squaredEuclidean:e}=require$$0,r={constant:1};class t{constructor(n){n=Object.assign({},r,n),this.constant=n.constant}compute(n,s){const a=e(n,s);return 1-a/(a+this.constant)}}return rationalQuadraticKernel=t,rationalQuadraticKernel}var kernel,hasRequiredKernel;function requireKernel(){if(hasRequiredKernel)return kernel;hasRequiredKernel=1;const{Matrix:e,MatrixTransposeView:r}=requireMatrix(),t=requireGaussianKernel(),i=requirePolynomialKernel(),n=requireSigmoidKernel(),s=requireAnovaKernel(),a=requireCauchyKernel(),h=requireExponentialKernel(),d=requireHistogramIntersectionKernel(),u=requireLaplacianKernel(),g=requireMultiquadraticKernel(),_=requireRationalQuadraticKernel(),w={gaussian:t,rbf:t,polynomial:i,poly:i,anova:s,cauchy:a,exponential:h,histogram:d,min:d,laplacian:u,multiquadratic:g,rational:_,sigmoid:n,mlp:n};class p{constructor(y,M){if(this.kernelType=y,y!=="linear")if(typeof y=="string"){y=y.toLowerCase();var A=w[y];if(A)this.kernelFunction=new A(M);else throw new Error(`unsupported kernel type: ${y}`)}else if(typeof y=="object"&&typeof y.compute=="function")this.kernelFunction=y;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(y,M){if(y=e.checkMatrix(y),M===void 0?M=y:M=e.checkMatrix(M),this.kernelType==="linear")return y.mmul(new r(M));const A=new e(y.rows,M.rows);if(y===M)for(let C=0;C<y.rows;C++)for(let v=C;v<y.rows;v++){const E=this.kernelFunction.compute(y.getRow(C),y.getRow(v));A.set(C,v,E),A.set(v,C,E)}else for(let C=0;C<y.rows;C++)for(let v=0;v<M.rows;v++)A.set(C,v,this.kernelFunction.compute(y.getRow(C),M.getRow(v)));return A}}return kernel=p,kernel}var kernelExports=requireKernel();const Kernel=getDefaultExportFromCjs(kernelExports),defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(r,t,i){if(super(),r===!0)this.alpha=t.alpha,this.inputs=t.inputs,this.kernelType=t.kernelType,this.kernelOptions=t.kernelOptions,this.kernel=new Kernel(t.kernelType,t.kernelOptions);else{r=Matrix$1.checkMatrix(r),i=Object.assign({},defaultOptions$2,i);const n=new Kernel(i.kernelType,i.kernelOptions),s=n.compute(r),a=r.rows;s.add(Matrix$1.eye(a,a).mul(i.lambda)),this.alpha=solve(s,t),this.inputs=r,this.kernelType=i.kernelType,this.kernelOptions=i.kernelOptions,this.kernel=n}}_predict(r){return this.kernel.compute([r],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(r){if(r.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,r)}}function background$1(e,r,t){const i=new KernelRidgeRegression(e,r,t),n=new Array(this.size);for(let h=0;h<this.width;h++)for(let d=0;d<this.height;d++)n[d*this.width+h]=[h,d];const s=i.predict(n),a=Image.createFrom(this);for(let h=0;h<this.size;h++)a.data[h]=Math.min(this.maxValue,Math.max(0,s[h][0]));return a}function dilate(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let i=!0;e:for(const s of r)for(const a of s)if(a!==1){i=!1;break e}let n=this;for(let s=0;s<t;s++)if(this.bitDepth===1)if(i){const a=n.clone();n=dilateOnceBinaryOnlyOnes(n,a,r.length,r[0].length)}else{const a=Image.createFrom(n);n=dilateOnceBinary(n,a,r)}else if(i){const a=Image.createFrom(n);n=dilateOnceGreyOnlyOnes(n,a,r.length,r[0].length)}else{const a=Image.createFrom(n);n=dilateOnceGrey(n,a,r)}return n}function dilateOnceGrey(e,r,t){const i=t.length,n=t[0].length;let s=(i-1)/2,a=(n-1)/2;for(let h=0;h<e.height;h++)for(let d=0;d<e.width;d++){let u=0;for(let g=0;g<n;g++)for(let _=0;_<i;_++){if(t[_][g]!==1)continue;let w=_-s+d,p=g-a+h;if(w<0||p<0||w>=e.width||p>=e.height)continue;const b=e.getValueXY(w,p,0);b>u&&(u=b)}r.setValueXY(d,h,0,u)}return r}function dilateOnceGreyOnlyOnes(e,r,t,i){const n=(t-1)/2,s=(i-1)/2,a=[];for(let h=0;h<e.width;h++)a.push(0);for(let h=0;h<e.height;h++){for(let d=0;d<e.width;d++){let u=0;for(let g=Math.max(0,h-s);g<Math.min(e.height,h+s+1);g++){const _=e.getValueXY(d,g,0);_>u&&(u=_)}a[d]=u}for(let d=0;d<e.width;d++){let u=0;for(let g=Math.max(0,d-n);g<Math.min(e.width,d+n+1);g++)a[g]>u&&(u=a[g]);r.setValueXY(d,h,0,u)}}return r}function dilateOnceBinary(e,r,t){const i=t.length,n=t[0].length;let s=(i-1)/2,a=(n-1)/2;for(let h=0;h<e.height;h++)for(let d=0;d<e.width;d++){let u=0;e:for(let g=0;g<n;g++)for(let _=0;_<i;_++){if(t[_][g]!==1)continue;let w=_-s+d,p=g-a+h;if(p<0||w<0||w>=e.width||p>=e.height)continue;if(e.getBitXY(w,p)===1){u=1;break e}}u===1&&r.setBitXY(d,h)}return r}function dilateOnceBinaryOnlyOnes(e,r,t,i){const n=(t-1)/2,s=(i-1)/2,a=[];for(let h=0;h<e.width;h++)a.push(1);for(let h=0;h<e.height;h++){for(let d=0;d<e.width;d++){a[d]=0;for(let u=Math.max(0,h-s);u<Math.min(e.height,h+s+1);u++)if(e.getBitXY(d,u)===1){a[d]=1;break}}for(let d=0;d<e.width;d++)if(r.getBitXY(d,h)!==1){for(let u=Math.max(0,d-n);u<Math.min(e.width,d+n+1);u++)if(a[u]===1){r.setBitXY(d,h);break}}}return r}function erode(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let i=!0;e:for(const s of r)for(const a of s)if(a!==1){i=!1;break e}let n=this;for(let s=0;s<t;s++)if(this.bitDepth===1)if(i){const a=n.clone();n=erodeOnceBinaryOnlyOnes(n,a,r.length,r[0].length)}else{const a=Image.createFrom(n);n=erodeOnceBinary(n,a,r)}else if(i){const a=Image.createFrom(n);n=erodeOnceGreyOnlyOnes(n,a,r.length,r[0].length)}else{const a=Image.createFrom(n);n=erodeOnceGrey(n,a,r)}return n}function erodeOnceGrey(e,r,t){const i=t.length,n=t[0].length;let s=(i-1)/2,a=(n-1)/2;for(let h=0;h<e.height;h++)for(let d=0;d<e.width;d++){let u=e.maxValue;for(let g=0;g<n;g++)for(let _=0;_<i;_++){if(t[_][g]!==1)continue;let w=_-s+d,p=g-a+h;if(w<0||p<0||w>=e.width||p>=e.height)continue;const b=e.getValueXY(w,p,0);b<u&&(u=b)}r.setValueXY(d,h,0,u)}return r}function erodeOnceGreyOnlyOnes(e,r,t,i){const n=(t-1)/2,s=(i-1)/2,a=[];for(let h=0;h<e.width;h++)a.push(0);for(let h=0;h<e.height;h++){for(let d=0;d<e.width;d++){let u=e.maxValue;for(let g=Math.max(0,h-s);g<Math.min(e.height,h+s+1);g++){const _=e.getValueXY(d,g,0);_<u&&(u=_)}a[d]=u}for(let d=0;d<e.width;d++){let u=e.maxValue;for(let g=Math.max(0,d-n);g<Math.min(e.width,d+n+1);g++)a[g]<u&&(u=a[g]);r.setValueXY(d,h,0,u)}}return r}function erodeOnceBinary(e,r,t){const i=t.length,n=t[0].length;let s=(i-1)/2,a=(n-1)/2;for(let h=0;h<e.height;h++)for(let d=0;d<e.width;d++){let u=1;e:for(let g=0;g<n;g++)for(let _=0;_<i;_++){if(t[_][g]!==1)continue;let w=_-s+d,p=g-a+h;if(p<0||w<0||w>=e.width||p>=e.height)continue;if(e.getBitXY(w,p)===0){u=0;break e}}u===1&&r.setBitXY(d,h)}return r}function erodeOnceBinaryOnlyOnes(e,r,t,i){const n=(t-1)/2,s=(i-1)/2,a=[];for(let h=0;h<e.width;h++)a.push(0);for(let h=0;h<e.height;h++){for(let d=0;d<e.width;d++){a[d]=1;for(let u=Math.max(0,h-s);u<Math.min(e.height,h+s+1);u++)if(e.getBitXY(d,u)===0){a[d]=0;break}}for(let d=0;d<e.width;d++)if(r.getBitXY(d,h)!==0){for(let u=Math.max(0,d-n);u<Math.min(e.width,d+n+1);u++)if(a[u]===0){r.clearBitXY(d,h);break}}}return r}function open(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let i=this;for(let n=0;n<t;n++)i=i.erode({kernel:r}),i=i.dilate({kernel:r});return i}function close(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let i=this;for(let n=0;n<t;n++)i=i.dilate({kernel:r}).erode({kernel:r});return i}function topHat(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),r.length%2===0||r[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let i=this;for(let n=0;n<t;n++)i=i.open({kernel:r}).subtractImage(i,{absolute:!0});return i}function blackHat(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let i=this;for(let n=0;n<t;n++)i=i.close({kernel:r}).subtractImage(i,{absolute:!0});return i}function morphologicalGradient(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let i=this;for(let n=0;n<t;n++){let s=i.dilate({kernel:r}),a=i.erode({kernel:r});i=s.subtractImage(a,{absolute:!0})}return i}function order4Points(e){let r=0,t=0,i=0,n=0,s=e[0][0],a=0;for(let u=1;u<e.length;u++)e[u][0]<s&&(s=e[u][0],a=u);let h=e[(a+1)%e.length][0],d=(a+1)%e.length;for(let u=1;u<e.length;u++)e[u][0]<h&&u!==a&&(h=e[u][0],d=u);return e[d][1]<e[a][1]?(r=e[d],n=e[a],a!==(d+1)%4?(t=e[(d+1)%4],i=e[(d+2)%4]):(t=e[(d+2)%4],i=e[(d+3)%4])):(n=e[d],r=e[a],d!==(a+1)%4?(t=e[(a+1)%4],i=e[(a+2)%4]):(t=e[(a+2)%4],i=e[(a+3)%4])),[r,t,i,n]}function distance2Points(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function crossVect(e,r){return[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]}function dotVect(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function computeWidthAndHeigth(e,r,t,i,n,s){let a=Math.max(distance2Points(e,r),distance2Points(i,t)),h=Math.max(distance2Points(e,i),distance2Points(r,t)),d=0,u=0,g=Math.ceil(n/2),_=Math.ceil(s/2),w=a/h,p=[e[0],e[1],1],b=[r[0],r[1],1],y=[i[0],i[1],1],M=[t[0],t[1],1],A=dotVect(crossVect(p,M),y)/dotVect(crossVect(b,M),y),C=dotVect(crossVect(p,M),b)/dotVect(crossVect(y,M),b),v=[A*b[0]-p[0],A*b[1]-p[1],A*b[2]-p[2]],E=[C*y[0]-p[0],C*y[1]-p[1],C*y[2]-p[2]],R=v[0],$=v[1],L=v[2],D=E[0],B=E[1],P=E[2],O=1/(L*P)*(R*D-(R*P+L*D)*g+L*P*g*g+($*B-($*P+L*B)*_+L*P*_*_));O>=0?O=Math.sqrt(O):O=Math.sqrt(-O);let Y=new Matrix$1([[O,0,g],[0,O,_],[0,0,1]]),te=Y.transpose(),H=inverse(te),J=inverse(Y),Ce=Matrix$1.rowVector(v),Pe=Matrix$1.rowVector(E),le=Math.sqrt(dotVect(Ce.mmul(H).mmul(J).to1DArray(),v)/dotVect(Pe.mmul(H).mmul(J).to1DArray(),E));return le===0||w===0?(d=Math.ceil(a),u=Math.ceil(h)):le<w?(d=Math.ceil(a),u=Math.ceil(d/le)):(u=Math.ceil(h),d=Math.ceil(le*u)),[d,u]}function projectionPoint(e,r,t,i,n,s,a,h,d,u,g,_){let[w,p]=[(t*e+i*r+n)/(d*e+u*r+1),(s*e+a*r+h)/(d*e+u*r+1)];return g.getValueXY(Math.floor(w),Math.floor(p),_)}function warpingFourPoints(e,r={}){let{calculateRatio:t=!0}=r;if(e.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${e.length} elements`);let[i,n,s,a]=e,h=[i,n,s,a],[d,u,g,_]=order4Points(h),w,p;t?[w,p]=computeWidthAndHeigth(d,u,g,_,this.width,this.height):(w=Math.ceil(Math.max(distance2Points(d,u),distance2Points(_,g))),p=Math.ceil(Math.max(distance2Points(d,_),distance2Points(u,g))));let b=Image.createFrom(this,{width:w,height:p}),[y,M]=d,[A,C]=u,[v,E]=g,[R,$]=_,[L,D]=[0,0],[B,P]=[0,w-1],[O,Y]=[p-1,w-1],[te,H]=[p-1,0],J=new Matrix$1([[L,D,1,0,0,0,-L*y,-D*y],[B,P,1,0,0,0,-B*A,-P*A],[O,Y,1,0,0,0,-O*v,-D*v],[te,H,1,0,0,0,-te*R,-H*R],[0,0,0,L,D,1,-L*M,-D*M],[0,0,0,B,P,1,-B*C,-P*C],[0,0,0,O,Y,1,-O*E,-Y*E],[0,0,0,te,H,1,-te*$,-H*$]]),Ce=Matrix$1.columnVector([y,A,v,R,M,C,E,$]),le=new SingularValueDecomposition(J).solve(Ce),[ye,xe,Ie,ie,Ee,he,z,de]=le.to1DArray(),ke=new Matrix$1(p,w);for(let ve=0;ve<this.channels;ve++){for(let Me=0;Me<p;Me++)for(let Fe=0;Fe<w;Fe++)ke.set(Me,Fe,projectionPoint(Me,Fe,ye,xe,Ie,ie,Ee,he,z,de,this,ve));b.setMatrix(ke,{channel:ve})}return b}function crop(e={}){let{x:r=0,y:t=0,width:i=this.width-r,height:n=this.height-t}=e;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),r=Math.round(r),t=Math.round(t),i=Math.round(i),n=Math.round(n),r>this.width-1||t>this.height-1)throw new RangeError(`crop: origin (x:${r}, y:${t}) out of range (${this.width-1}; ${this.height-1})`);if(i<=0||n<=0)throw new RangeError(`crop: width and height (width:${i}; height:${n}) must be positive numbers`);if(r<0||t<0)throw new RangeError(`crop: x and y (x:${r}, y:${t}) must be positive numbers`);if(i>this.width-r||n>this.height-t)throw new RangeError(`crop: (x: ${r}, y:${t}, width:${i}, height:${n}) size is out of range`);let s=this;if(this.bitDepth===1){const a=new Image(i,n,{kind:"BINARY",parent:this});s=cropBinary(this,a,r,t,i,n)}else{const a=Image.createFrom(this,{width:i,height:n,position:[r,t]});s=cropDefault(this,a,r,t,i,n)}return s}function cropDefault(e,r,t,i,n,s){let a=n*e.channels,h=i+s,d=0,u=t*e.channels;for(let g=i;g<h;g++){let _=g*e.width*e.channels+u,w=_+a;for(;_<w;_++)r.data[d++]=e.data[_]}return r}function cropBinary(e,r,t,i,n,s){let a=n*e.channels,h=i+s,d=0,u=t*e.channels;for(let g=i;g<h;g++){let _=g*e.width*e.channels+u,w=_+a;for(;_<w;_++)e.getBit(_)&&r.setBit(d),++d}return r}function cropAlpha(e={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:r=this.maxValue}=e;let t=findLeft(this,r,this.components);if(t===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let i=findTop(this,r,this.components,t),n=findBottom(this,r,this.components,t),s=findRight(this,r,this.components,t,i,n);return this.crop({x:t,y:i,width:s-t+1,height:n-i+1})}function findLeft(e,r,t){for(let i=0;i<e.width;i++)for(let n=0;n<e.height;n++)if(e.getValueXY(i,n,t)>=r)return i;return-1}function findTop(e,r,t,i){for(let n=0;n<e.height;n++)for(let s=i;s<e.width;s++)if(e.getValueXY(s,n,t)>=r)return n;return-1}function findBottom(e,r,t,i){for(let n=e.height-1;n>=0;n--)for(let s=i;s<e.width;s++)if(e.getValueXY(s,n,t)>=r)return n;return-1}function findRight(e,r,t,i,n,s){for(let a=e.width-1;a>=i;a--)for(let h=n;h<=s;h++)if(e.getValueXY(a,h,t)>=r)return a;return-1}function getFactor(e){if(typeof e=="string"){const r=e[e.length-1];e=parseFloat(e),r==="%"&&(e/=100)}return e}function getThreshold$1(e,r){if(!r)throw Error("getThreshold : the maxValue should be specified");if(typeof e=="string"){if(e[e.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(e)/100*r}else{if(typeof e=="number")return e<1?e*r:e;throw Error("getThreshold : the value is not valid")}}function factorDimensions(e,r,t){e=getFactor(e);let i=Math.round(e*r),n=Math.round(e*t);return i<=0&&(i=1),n<=0&&(n=1),{width:i,height:n}}function checkRow(e,r){if(r<0||r>=e.height)throw new RangeError(`row must be included between 0 and ${e.height-1}. Current value: ${r}`)}function checkColumn(e,r){if(r<0||r>=e.width)throw new RangeError(`column must be included between 0 and ${e.width-1}. Current value: ${r}`)}function checkChannel(e,r){if(r<0||r>=e.channels)throw new RangeError(`channel must be included between 0 and ${e.channels-1}. Current value: ${r}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(e){if(typeof e!="string")throw new TypeError("interpolation must be a string");if(e=e.toLowerCase(),!validInterpolations[e])throw new RangeError(`invalid interpolation algorithm: ${e}`);return validInterpolations[e]}function nearestNeighbor(e,r,t){const i=this.width/r,n=this.height/t;if(this.bitDepth>1)for(let s=0;s<r;s++){const a=Math.floor((s+.5)*i);for(let h=0;h<t;h++){const d=Math.floor((h+.5)*n);for(let u=0;u<this.channels;u++)e.setValueXY(s,h,u,this.getValueXY(a,d,u))}}else for(let s=0;s<r;s++){const a=Math.floor((s+.5)*i);for(let h=0;h<t;h++){const d=Math.floor((h+.5)*n);this.getBitXY(a,d)&&e.setBitXY(s,h)}}}function resize(e={}){const{factor:r=1,interpolation:t=validInterpolations.nearestneighbor,preserveAspectRatio:i=!0}=e,n=checkInterpolation(t);let s=e.width,a=e.height;if(s||(a&&i?s=Math.round(a*(this.width/this.height)):s=this.width),a||(i?a=Math.round(s*(this.height/this.width)):a=this.height),{width:s,height:a}=factorDimensions(r,s,a),s===this.width&&a===this.height){const g=this.clone();return g.position=[0,0],g}let h=Math.round((this.width-s)/2),d=Math.round((this.height-a)/2);const u=Image.createFrom(this,{width:s,height:a,position:[h,d]});switch(n){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,u,s,a);break;default:throw new Error(`unsupported resize interpolation: ${n}`)}return u}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image.createFrom(this,{colorModel:HSV}),r=0,t=this.data;for(let i=0;i<t.length;i+=this.channels){let n=t[i],s=t[i+1],a=t[i+2],h=Math.min(n,s,a),d=Math.max(n,s,a),u=d-h,g=0,_=d===0?0:u/d,w=d;if(d!==h){switch(d){case n:g=(s-a)/u+(s<a?6:0);break;case s:g=(a-n)/u+2;break;case a:g=(n-s)/u+4;break;default:throw new Error("unreachable")}g/=6}e.data[r++]=g*this.maxValue,e.data[r++]=_*this.maxValue,e.data[r++]=w,this.alpha&&(e.data[r++]=t[i+3])}return e}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image.createFrom(this,{colorModel:HSL}),r=Math.floor(this.maxValue/2),t=0,i=this.data;for(let n=0;n<i.length;n+=this.channels){let s=i[n],a=i[n+1],h=i[n+2],d=Math.max(s,a,h),u=Math.min(s,a,h),g=0,_=0,w=(d+u)/2;if(d!==u){let p=d-u;switch(_=w>r?p/(2-d-u):p/(d+u),d){case s:g=(a-h)/p+(a<h?6:0);break;case a:g=(h-s)/p+2;break;case h:g=(s-a)/p+4;break;default:throw new Error("unreachable")}g/=6}e.data[t++]=g*this.maxValue,e.data[t++]=_*this.maxValue,e.data[t++]=w,this.alpha&&(e.data[t++]=i[n+3])}return e}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image.createFrom(this,{components:4,colorModel:CMYK$1}),r=0,t=this.data;for(let i=0;i<t.length;i+=this.channels){let n=t[i],s=t[i+1],a=t[i+2],h=Math.min(this.maxValue-n,this.maxValue-s,this.maxValue-a),d=(this.maxValue-n-h)/(1-h/this.maxValue),u=(this.maxValue-s-h)/(1-h/this.maxValue),g=(this.maxValue-a-h)/(1-h/this.maxValue);e.data[r++]=Math.round(d),e.data[r++]=Math.round(u),e.data[r++]=Math.round(g),e.data[r++]=Math.round(h),this.alpha&&(e.data[r++]=t[i+3])}return e}function rgba8(){return new Image(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(e,r,t){return e*6966+r*23436+t*2366>>15},luma601(e,r,t){return e*9798+r*19235+t*3735>>15},maximum(e,r,t){return Math.max(e,r,t)},minimum(e,r,t){return Math.min(e,r,t)},average(e,r,t){return(e+r+t)/3>>0},minmax(e,r,t){return(Math.max(e,r,t)+Math.min(e,r,t))/2},red(e){return e},green(e,r){return r},blue(e,r,t){return t},cyan(e,r,t,i){let n=methods$1.black(e,r,t,i);return(i.maxValue-e-n)/(1-n/i.maxValue)>>0},magenta(e,r,t,i){let n=methods$1.black(e,r,t,i);return(i.maxValue-r-n)/(1-n/i.maxValue)>>0},yellow(e,r,t,i){let n=methods$1.black(e,r,t,i);return(i.maxValue-t-n)/(1-n/i.maxValue)>>0},black(e,r,t,i){return Math.min(i.maxValue-e,i.maxValue-r,i.maxValue-t)},hue(e,r,t,i){let n=methods$1.min(e,r,t),s=methods$1.max(e,r,t);if(s===n)return 0;let a=0,h=s-n;switch(s){case e:a=(r-t)/h+(r<t?6:0);break;case r:a=(t-e)/h+2;break;case t:a=(e-r)/h+4;break;default:throw new Error("unreachable")}return a/6*i.maxValue>>0},saturation(e,r,t,i){let n=methods$1.min(e,r,t),s=methods$1.max(e,r,t),a=s-n;return s===0?0:a/s*i.maxValue},lightness(e,r,t){let i=methods$1.min(e,r,t);return(methods$1.max(e,r,t)+i)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});Object.keys(methods$1).forEach(e=>{});function grey(e={}){let{algorithm:r="luma709",keepAlpha:t=!1,mergeAlpha:i=!0}=e;if(typeof r!="string"&&typeof r!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(r="red"),t&=this.alpha,i&=this.alpha,t&&(i=!1);let n=getOutputImage(this,e,{components:1,alpha:t,colorModel:GREY$1}),s;if(typeof r=="function")s=r;else if(s=methods$1[r.toLowerCase()],!s)throw new Error(`unsupported grey algorithm: ${r}`);let a=0;for(let h=0;h<this.data.length;h+=this.channels)i?n.data[a++]=clamp(s(this.data[h],this.data[h+1],this.data[h+2],this)*this.data[h+this.components]/this.maxValue,this):(n.data[a++]=clamp(s(this.data[h],this.data[h+1],this.data[h+2],this),this),n.alpha&&(n.data[a++]=this.data[h+this.components]));return n}function huang(e){let r=0;for(let g=0;g<e.length;g++)if(e[g]!==0){r=g;break}let t=e.length-1;for(let g=e.length-1;g>=r;g--)if(e[g]!==0){t=g;break}let i=1/(t-r),n=new Array(e.length),s=0,a=0;for(let g=r;g<e.length;g++)s+=g*e[g],a+=e[g],n[g]=s/a;let h=new Array(e.length);s=a=0;for(let g=t;g>0;g--)s+=g*e[g],a+=e[g],h[g-1]=s/a;let d=-1,u=Number.MAX_VALUE;for(let g=0;g<e.length;g++){let _=0,w;for(let p=0;p<=g;p++)w=1/(1+i*Math.abs(p-n[g])),w<1e-6||w>.999999||(_+=e[p]*(-w*Math.log(w)-(1-w)*Math.log(1-w)));for(let p=g+1;p<e.length;p++)w=1/(1+i*Math.abs(p-h[g])),w<1e-6||w>.999999||(_+=e[p]*(-w*Math.log(w)-(1-w)*Math.log(1-w)));_<u&&(u=_,d=g)}return d}function intermodes(e){let r=e.slice(),t=0;for(;!bimodalTest$1(r);){let n=0,s=0,a=r[0];for(let h=0;h<e.length-1;h++)n=s,s=a,a=r[h+1],r[h]=(n+s+a)/3;if(r[e.length-1]=(s+a)/3,t++,t>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let i=0;for(let n=1;n<e.length-1;n++)r[n-1]<r[n]&&r[n+1]<r[n]&&(i+=n);return Math.floor(i/2)}function bimodalTest$1(e){let r=!1,t=0;for(let i=1;i<e.length-1;i++)if(e[i-1]<e[i]&&e[i+1]<e[i]&&(t++,t>2))return!1;return t===2&&(r=!0),r}function isodata(e){let r,t,i,n,s=0;for(let a=1;a<e.length;a++)if(e[a]>0){s=a+1;break}for(;;){r=0,i=0;for(let a=0;a<s;a++)i=i+e[a],r=r+e[a]*a;n=0,t=0;for(let a=s+1;a<e.length;a++)t+=e[a],n+=e[a]*a;if(i>0&&t>0&&(r/=i,n/=t,s===Math.round((r+n)/2)))break;if(s++,s>e.length-2)throw new Error("Threshold not found")}return s}function li(e,r){let t,i,n,s,a,h,d,u,g,_,w,p;w=.5,_=0;for(let b=0;b<e.length;b++)_+=b*e[b];_/=r,d=_;do{h=d,t=h+.5|0,i=0,s=0;for(let b=0;b<=t;b++)i+=b*e[b],s+=e[b];u=s===0?0:i/s,n=0,a=0;for(let b=t+1;b<e.length;b++)n+=b*e[b],a+=e[b];g=a===0?0:n/a,p=(u-g)/(Math.log(u)-Math.log(g)),p<-Number.EPSILON?d=p-.5|0:d=p+.5|0}while(Math.abs(d-h)>w);return t}function maxEntropy(e,r){let t=new Array(e.length);for(let w=0;w<e.length;w++)t[w]=e[w]/r;let i=new Array(e.length),n=new Array(e.length);i[0]=t[0],n[0]=1-i[0];for(let w=1;w<e.length;w++)i[w]=i[w-1]+t[w],n[w]=1-i[w];let s=0;for(let w=0;w<e.length;w++)if(Math.abs(i[w])>=Number.EPSILON){s=w;break}let a=e.length-1;for(let w=e.length-1;w>=s;w--)if(Math.abs(n[w])>=Number.EPSILON){a=w;break}let h=-1,d,u=Number.MIN_VALUE,g,_;for(let w=s;w<=a;w++){g=0;for(let p=0;p<=w;p++)e[p]!==0&&(g-=t[p]/i[w]*Math.log(t[p]/i[w]));_=0;for(let p=w+1;p<e.length;p++)e[p]!==0&&(_-=t[p]/n[w]*Math.log(t[p]/n[w]));d=g+_,u<d&&(u=d,h=w)}return h}function mean$1(e,r){let t=0;for(let i=0;i<e.length;i++)t+=i*e[i];return Math.floor(t/r)}function minError(e,r){let t,i=-2,n,s,a,h,d,u,g,_,w,p,b,y=0;for(let M=0;M<e.length;M++)y+=M*e[M];for(y/=r,t=y;t!==i;){let M=sumA(e,t),A=sumA(e,e.length-1),C=sumB(e,t),v=sumB(e,e.length-1),E=sumC(e,t),R=sumC(e,e.length-1);if(n=C/M,s=(v-C)/(A-M),a=M/A,h=(A-M)/A,d=E/M-n*n,u=(R-E)/(A-M)-s*s,g=1/d-1/u,_=n/d-s/u,w=n*n/d-s*s/u+Math.log10(d*(h*h)/(u*(a*a))),p=_*_-g*w,p<0)return t;i=t,b=(_+Math.sqrt(p))/g,isNaN(b)?t=i:t=Math.floor(b)}return t}function sumA(e,r){let t=0;for(let i=0;i<=r;i++)t+=e[i];return t}function sumB(e,r){let t=0;for(let i=0;i<=r;i++)t+=i*e[i];return t}function sumC(e,r){let t=0;for(let i=0;i<=r;i++)t+=i*i*e[i];return t}function minimum(e){if(e.length<2)return 0;let r=0,t=-1,i=-1,n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=e[s],e[s]>0&&(i=s);for(;!bimodalTest(n);)if(n=smoothed(n),r++,r>1e4)return t;return t=minimumBetweenPeeks(n,i),t}function smoothed(e){let r=new Array(e.length);for(let t=1;t<e.length-1;t++)r[t]=(e[t-1]+e[t]+e[t+1])/3;return r[0]=(e[0]+e[1])/3,r[e.length-1]=(e[e.length-2]+e[e.length-1])/3,r}function minimumBetweenPeeks(e,r){let t;for(let i=1;i<r;i++)if(e[i-1]>e[i]&&e[i+1]>=e[i]){t=i;break}return t}function bimodalTest(e){let r=e.length,t=!1,i=0;for(let n=1;n<r-1;n++)if(e[n-1]<e[n]&&e[n+1]<e[n]&&(i++,i>2))return!1;return i===2&&(t=!0),t}function moments(e,r){let t=1,i=0,n=0,s=0,a=0,h,d,u,g,_,w,p=-1,b=e.length,y=new Array(b);for(let M=0;M<b;M++)y[M]=e[M]/r;for(let M=0;M<b;M++)i+=M*y[M],n+=M*M*y[M],s+=M*M*M*y[M];d=t*n-i*i,u=(-n*n+i*s)/d,g=(t*-s+n*i)/d,_=.5*(-g-Math.sqrt(g*g-4*u)),w=.5*(-g+Math.sqrt(g*g-4*u)),h=(w-i)/(w-_);for(let M=0;M<b;M++)if(a+=y[M],a>h){p=M;break}return p}function otsu(e,r){let t=0,i=0,n=0,s=0,a=0;for(let h=0;h<e.length;h++)a+=h*e[h];for(let h=0;h<e.length;h++){i=i+e[h];const d=r-i;if(i===0||d===0)continue;t=t+h*e[h];const u=(a-t)/d,g=i*d*(t/i-u)*(t/i-u);g>=n&&(s=h,n=g)}return s}function percentile(e){let r=-1,t=.5,i=new Array(e.length),n=partialSum(e,e.length-1),s=1;for(let a=0;a<e.length;a++)i[a]=Math.abs(partialSum(e,a)/n-t),i[a]<s&&(s=i[a],r=a);return r}function partialSum(e,r){let t=0;for(let i=0;i<=r;i++)t+=e[i];return t}function renyiEntropy(e,r){let t,i,n,s=new Array(e.length),a=new Array(e.length),h=new Array(e.length),d=0,u=0,g=0,_=0,w=0,p=0,y=1/(1-.5),A=1/(1-2);for(let R=0;R<e.length;R++)s[R]=e[R]/r;a[0]=s[0],h[0]=1-a[0];for(let R=1;R<e.length;R++)a[R]=a[R-1]+s[R],h[R]=1-a[R];i=0;for(let R=0;R<e.length;R++)if(Math.abs(a[R])>=Number.EPSILON){i=R;break}n=e.length-1;for(let R=e.length-1;R>=i;R--)if(Math.abs(h[R])>=Number.EPSILON){n=R;break}for(let R=i;R<=n;R++){let $=0,L=0,D=0;for(let J=0;J<=R;J++)e[J]!==0&&($-=s[J]/a[R]*Math.log(s[J]/a[R])),L+=Math.sqrt(s[J]/a[R]),D+=s[J]*s[J]/(a[R]*a[R]);let B=0,P=0,O=0;for(let J=R+1;J<e.length;J++)e[J]!==0&&(B-=s[J]/h[R]*Math.log(s[J]/h[R])),P+=Math.sqrt(s[J]/h[R]),O+=s[J]*s[J]/(h[R]*h[R]);let Y=$+B,te=y*(L*P>0?Math.log(L*P):0),H=A*(D*O>0?Math.log(D*O):0);Y>_&&(_=Y,d=R),te>w&&(w=te,u=R),H>p&&(p=H,g=R)}let C=[d,u,g];C.sort((R,$)=>R-$);let v;Math.abs(C[0]-C[1])<=5?Math.abs(C[1]-C[2])<=5?v=[1,2,1]:v=[0,1,3]:Math.abs(C[1]-C[2])<=5?v=[3,1,0]:v=[1,2,1];let E=a[C[2]]-a[C[0]];return t=Math.round(C[0]*(a[C[0]]+.25*E*v[0])+.25*C[1]*E*v[1]+C[2]*(h[C[2]]+.25*E*v[2])),t}function shanbhag(e,r){let t=new Array(e.length);for(let p=0;p<e.length;p++)t[p]=e[p]/r;let i=new Array(e.length),n=new Array(e.length);i[0]=t[0],n[0]=1-i[0];for(let p=1;p<e.length;p++)i[p]=i[p-1]+t[p],n[p]=1-i[p];let s=0;for(let p=0;p<e.length;p++)if(Math.abs(i[p])>=Number.EPSILON){s=p;break}let a=e.length-1;for(let p=e.length-1;p>=s;p--)if(Math.abs(n[p])>=Number.EPSILON){a=p;break}let h=-1,d=Number.MAX_VALUE,u,g,_,w;for(let p=s;p<=a;p++){_=0,u=.5/i[p];for(let b=1;b<=p;b++)_-=t[b]*Math.log(1-u*i[b-1]);_*=u,w=0,u=.5/n[p];for(let b=p+1;b<e.length;b++)w-=t[b]*Math.log(1-u*n[b]);w*=u,g=Math.abs(_-w),g<d&&(d=g,h=p)}return h}function triangle$1(e){let r=0,t=0,i=0,n=0;for(let _=0;_<e.length;_++)if(e[_]>0){r=_;break}r>0&&r--;for(let _=e.length-1;_>0;_--)if(e[_]>0){n=_;break}n<e.length-1&&n++;for(let _=0;_<e.length;_++)e[_]>t&&(i=_,t=e[_]);let s=!1;if(i-r<n-i){s=!0;let _=0,w=e.length-1;for(;_<w;){let p=e[_];e[_]=e[w],e[w]=p,_++,w--}r=e.length-1-n,i=e.length-1-i}if(r===i)return r;let a,h,d;a=e[i],h=r-i,d=Math.sqrt(a*a+h*h),a/=d,h/=d,d=a*r+h*e[r];let u=r,g=0;for(let _=r+1;_<=i;_++){let w=a*_+h*e[_]-d;w>g&&(u=_,g=w)}if(u--,s){let _=0,w=e.length-1;for(;_<w;){let p=e[_];e[_]=e[w],e[w]=p,_++,w--}return e.length-1-u}else return u}function yen(e,r){let t=new Array(e.length);for(let u=0;u<e.length;u++)t[u]=e[u]/r;let i=new Array(e.length);i[0]=t[0];for(let u=1;u<e.length;u++)i[u]=i[u-1]+t[u];let n=new Array(e.length);n[0]=t[0]*t[0];for(let u=1;u<e.length;u++)n[u]=n[u-1]+t[u]*t[u];let s=new Array(e.length);s[e.length-1]=0;for(let u=e.length-2;u>=0;u--)s[u]=s[u+1]+t[u+1]*t[u+1];let a=-1,h=Number.MIN_VALUE,d;for(let u=0;u<e.length;u++)d=-1*(n[u]*s[u]>0?Math.log(n[u]*s[u]):0)+2*(i[u]*(1-i[u])>0?Math.log(i[u]*(1-i[u])):0),d>h&&(h=d,a=u);return a}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(e=>{names[e]=e});function getThreshold(e={}){let{algorithm:r=names.otsu}=e;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let t=methods[r.toLowerCase()];if(t){let i=this.getHistogram();return t(i,this.size)}else throw new Error(`unknown thresholding algorithm: ${r}`)}const THRESHOLD="threshold";function mask(e={}){let{algorithm:r=THRESHOLD,threshold:t=.5,useAlpha:i=!0,invert:n=!1}=e;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),r===THRESHOLD?t=getThreshold$1(t,this.maxValue):t=getThreshold.call(this,e);let s=new Image(this.width,this.height,{kind:"BINARY",parent:this}),a=0;if(this.alpha&&i)for(let h=0;h<this.data.length;h+=this.channels){let d=this.data[h]+(this.maxValue-this.data[h])*(this.maxValue-this.data[h+1])/this.maxValue;(n&&d<=t||!n&&d>=t)&&s.setBit(a),a++}else for(let h=0;h<this.data.length;h+=this.channels)(n&&this.data[h]<=t||!n&&this.data[h]>=t)&&s.setBit(a),a++;return s}function copyImage(e,r,t,i){let n=e.width,s=e.height,a=r.width,h=e.channels;for(let d=0;d<n;d++)for(let u=0;u<s;u++)for(let g=0;g<h;g++){let _=(u*n+d)*h+g,w=((i+u)*a+t+d)*h+g;r.data[w]=e.data[_]}}function pad(e={}){let{size:r=0,algorithm:t="copy",color:i}=e;if(this.checkProcessable("pad",{bitDepth:[8,16]}),t==="set"){if(i.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let d=0;d<i.length;d++)i[d]===0&&(i[d]=.001)}else i=newArray(this.channels,null);Array.isArray(r)||(r=[r,r]);let n=this.width+r[0]*2,s=this.height+r[1]*2,a=this.channels,h=Image.createFrom(this,{width:n,height:s});copyImage(this,h,r[0],r[1]);for(let d=r[0];d<n-r[0];d++)for(let u=0;u<a;u++){let g=i[u]||h.data[(r[1]*n+d)*a+u];for(let _=0;_<r[1];_++)h.data[(_*n+d)*a+u]=g;g=i[u]||h.data[((s-r[1]-1)*n+d)*a+u];for(let _=s-r[1];_<s;_++)h.data[(_*n+d)*a+u]=g}for(let d=0;d<s;d++)for(let u=0;u<a;u++){let g=i[u]||h.data[(d*n+r[0])*a+u];for(let _=0;_<r[0];_++)h.data[(d*n+_)*a+u]=g;g=i[u]||h.data[(d*n+n-r[0]-1)*a+u];for(let _=n-r[0];_<n;_++)h.data[(d*n+_)*a+u]=g}return h}function colorDepth(e=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(e))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===e)return this.clone();let r=Image.createFrom(this,{bitDepth:e});switch(e){case 8:if(this.bitDepth===1)for(let t=0;t<this.size;t++)this.getBit(t)&&(r.data[t]=255);else for(let t=0;t<this.data.length;t++)r.data[t]=this.data[t]>>8;break;case 16:if(this.bitDepth===1)for(let t=0;t<this.size;t++)this.getBit(t)&&(r.data[t]=65535);else for(let t=0;t<this.data.length;t++)r.data[t]=this.data[t]<<8|this.data[t];break;default:throw new Error("colorDepth conversion unexpected case")}return r}function rotateFree(e,r={}){const{interpolation:t=validInterpolations.nearestneighbor,width:i=this.width,height:n=this.height}=r;if(typeof e!="number")throw new TypeError("degrees must be a number");const s=checkInterpolation(t),a=e*Math.PI/180,h=Math.floor(Math.abs(i*Math.cos(a))+Math.abs(n*Math.sin(a))),d=Math.floor(Math.abs(n*Math.cos(a))+Math.abs(i*Math.sin(a))),u=Math.cos(-a),g=Math.sin(-a);let _=h/2,w=d/2;h%2===0?(_=_-.5,d%2===0?w=w-.5:w=Math.floor(w)):(_=Math.floor(_),d%2===0?w=w-.5:w=Math.floor(w));const p=Math.floor(i/2-_),b=Math.floor(n/2-w);if(this.bitDepth===1){const y=new Image(h,d,{kind:"BINARY",parent:this});switch(s){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,y,p,b,_,w,u,g);case validInterpolations.bilinear:return rotateBinaryBilinear(this,y,p,b,_,w,u,g);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}else{const y=Image.createFrom(this,{width:h,height:d});switch(s){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,y,p,b,_,w,u,g);case validInterpolations.bilinear:return rotateBilinear(this,y,p,b,_,w,u,g);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}}function rotateNearestNeighbor(e,r,t,i,n,s,a,h){for(let d=0;d<r.width;d+=1)for(let u=0;u<r.height;u+=1)for(let g=0;g<e.channels;g++){let _=Math.round((d-n)*a-(u-s)*h+n)+t,w=Math.round((u-s)*a+(d-n)*h+s)+i;_<0||_>=e.width||w<0||w>=e.height?e.alpha===1&&g===e.channels-1?r.setValueXY(d,u,g,0):r.setValueXY(d,u,g,e.maxValue):r.setValueXY(d,u,g,e.getValueXY(_,w,g))}return r}function rotateBinaryNearestNeighbor(e,r,t,i,n,s,a,h){for(let d=0;d<r.width;d+=1)for(let u=0;u<r.height;u+=1){let g=Math.round((d-n)*a-(u-s)*h+n)+t,_=Math.round((u-s)*a+(d-n)*h+s)+i;(g<0||g>=e.width||_<0||_>=e.height||e.getBitXY(g,_))&&r.setBitXY(d,u)}return r}function rotateBilinear(e,r,t,i,n,s,a,h){let d=e.width*e.channels;for(let u=0;u<r.height;u++)for(let g=0;g<r.width;g++){let _=(g-n)*a-(u-s)*h+n+t,w=(u-s)*a+(g-n)*h+s+i,p=_|0,b=w|0,y=_-p,M=w-b;for(let A=0;A<e.channels;A++)if(_<0||_>=e.width||w<0||w>=e.height)e.alpha===1&&A===e.channels-1?r.setValueXY(g,u,A,0):r.setValueXY(g,u,A,e.maxValue);else{let C=(b*e.width+p)*e.channels+A,v=e.data[C],E=e.data[C+e.channels],R=e.data[C+d],$=e.data[C+d+e.channels],L=v+y*(E-v)+M*(R-v)+y*M*(v-E-R+$)|0;r.setValueXY(g,u,A,L)}}return r}function rotateBinaryBilinear(e,r,t,i,n,s,a,h){let d=e.width;for(let u=0;u<r.height;u++)for(let g=0;g<r.width;g++){let _=(g-n)*a-(u-s)*h+n+t,w=(u-s)*a+(g-n)*h+s+i,p=_|0,b=w|0,y=_-p,M=w-b;if(_<0||_>=e.width||w<0||w>=e.height)r.setBitXY(g,u);else{let A=b*e.width+p,C=e.getBit(A),v=e.getBit(A+1),E=e.getBit(A+d),R=e.getBit(A+1+d);(C|y&v-C|M&E-C|y&M&C-v-E+R)>0&&r.setBitXY(g,u)}}return r}function rotate$1(e,r){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof e!="number")throw new TypeError("angle must be a number");switch(e<0&&(e=Math.ceil(-e/360)*360+e),e%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,e,r)}}function rotateLeft(){if(this.bitDepth===1){const e=new Image(this.height,this.width,{kind:"BINARY",parent:this}),r=e.height-1;for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)this.getBitXY(i,t)&&e.setBitXY(t,r-i);return e}else{const e=Image.createFrom(this,{width:this.height,height:this.width}),r=e.height-1;for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)for(let n=0;n<this.channels;n++)e.setValueXY(t,r-i,n,this.getValueXY(i,t,n));return e}}function rotateRight(){if(this.bitDepth===1){const e=new Image(this.height,this.width,{kind:"BINARY",parent:this}),r=e.width-1;for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)this.getBitXY(i,t)&&e.setBitXY(r-t,i);return e}else{const e=Image.createFrom(this,{width:this.height,height:this.width}),r=e.width-1;for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)for(let n=0;n<this.channels;n++)e.setValueXY(r-t,i,n,this.getValueXY(i,t,n));return e}}function rotate180(){if(this.bitDepth===1){const e=new Image(this.width,this.height,{kind:"BINARY",parent:this}),r=e.width-1,t=e.height-1;for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)this.getBitXY(n,i)&&e.setBitXY(r-n,t-i);return e}else{const e=Image.createFrom(this),r=e.width-1,t=e.height-1;for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)for(let s=0;s<this.channels;s++)e.setValueXY(r-n,t-i,s,this.getValueXY(n,i,s));return e}}function insert(e,r={}){const t=getImageParameters(e);this.checkProcessable("insert",t);let{x:i=0,y:n=0}=r;const s=getOutputImageOrInPlace(this,r,{copy:!0}),a=Math.min(s.height,n+e.height),h=Math.min(s.width,i+e.width);if(s.bitDepth===1)for(let d=n;d<a;d++)for(let u=i;u<h;u++)e.getBitXY(u-i,d-n)?s.setBitXY(u,d):s.clearBitXY(u,d);else for(let d=n;d<a;d++)for(let u=i;u<h;u++)s.setPixelXY(u,d,e.getPixelXY(u-i,d-n));return s}function setBorder(e={}){let{size:r=0,algorithm:t="copy",color:i}=e;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),t==="set"){if(i.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let h=0;h<i.length;h++)i[h]===0&&(i[h]=.001)}else i=newArray(this.channels,null);Array.isArray(r)||(r=[r,r]);let n=r[0],s=r[1],a=this.channels;for(let h=n;h<this.width-n;h++)for(let d=0;d<a;d++){let u=i[d]||this.data[(h+this.width*s)*a+d];for(let g=0;g<s;g++)this.data[(g*this.width+h)*a+d]=u;u=i[d]||this.data[(h+this.width*(this.height-s-1))*a+d];for(let g=this.height-s;g<this.height;g++)this.data[(g*this.width+h)*a+d]=u}for(let h=0;h<this.height;h++)for(let d=0;d<a;d++){let u=i[d]||this.data[(h*this.width+n)*a+d];for(let g=0;g<n;g++)this.data[(h*this.width+g)*a+d]=u;u=i[d]||this.data[(h*this.width+this.width-n-1)*a+d];for(let g=this.width-n;g<this.width;g++)this.data[(h*this.width+g)*a+d]=u}return this}function split(e={}){let{preserveAlpha:r=!0}=e;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let t=new Stack,i=this.data;if(this.alpha&&r)for(let n=0;n<this.components;n++){let s=Image.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),a=0;for(let h=0;h<i.length;h+=this.channels)s.data[a++]=i[h+n],s.data[a++]=i[h+this.components];t.push(s)}else for(let n=0;n<this.channels;n++){let s=Image.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),a=0;for(let h=0;h<i.length;h+=this.channels)s.data[a++]=i[h+n];t.push(s)}return t}function getChannel(e,r={}){let{keepAlpha:t=!1,mergeAlpha:i=!1}=r;t&=this.alpha,i&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),e=validateChannel(this,e);let n=Image.createFrom(this,{components:1,alpha:t,colorModel:GREY$1}),s=0;for(let a=0;a<this.data.length;a+=this.channels)i?n.data[s++]=this.data[a+e]*this.data[a+this.components]/this.maxValue:(n.data[s++]=this.data[a+e],t&&(n.data[s++]=this.data[a+this.components]));return n}function combineChannels(e=defaultCombineMethod,r={}){let{mergeAlpha:t=!1,keepAlpha:i=!1}=r;t&=this.alpha,i&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let n=Image.createFrom(this,{components:1,alpha:i,colorModel:GREY$1}),s=0;for(let a=0;a<this.size;a++){let h=e(this.getPixel(a));t?n.data[s++]=h*this.data[a*this.channels+this.components]/this.maxValue:(n.data[s++]=h,i&&(n.data[s++]=this.data[a*this.channels+this.components]))}return n}function defaultCombineMethod(e){return(e[0]+e[1]+e[2])/3}function setChannel(e,r){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),r.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),r.width!==this.width||r.height!==this.height)throw new Error("Images must have exactly the same width and height");e=validateChannel(this,e);let t=e;for(let i=0;i<r.data.length;i++)this.data[t]=r.data[i],t+=this.channels;return this}function getSimilarity(e,r={}){let{shift:t=[0,0],average:i,channels:n,defaultAlpha:s,normalize:a,border:h=[0,0]}=r;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(h)||(h=[h,h]),n=validateArrayOfChannels(this,{channels:n,defaultAlpha:s}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");typeof i>"u"&&(i=!0);let d=Math.max(h[0],-t[0]),u=Math.min(this.width-h[0],this.width-t[0]),g=Math.max(h[1],-t[1]),_=Math.min(this.height-h[1],this.height-t[1]),w=newArray(n.length,0);for(let p=0;p<n.length;p++){let b=n[p],y=a?this.sum[b]:Math.max(this.sum[b],e.sum[b]),M=a?e.sum[b]:Math.max(this.sum[b],e.sum[b]);if(y!==0&&M!==0)for(let A=d;A<u;A++)for(let C=g;C<_;C++){let v=A*this.multiplierX+C*this.multiplierY+b,E=v+t[0]*this.multiplierX+t[1]*this.multiplierY;w[p]+=Math.min(this.data[v]/y,e.data[E]/M)}}return i?w.reduce((p,b)=>p+b)/w.length:w}function getPixelsGrid(e={}){let{sampling:r=[10,10],painted:t=!1,mask:i}=e;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(r)||(r=[r,r]);const n=r[0],s=r[1],a=[],h=[],d=this.width/n,u=this.height/s;let g=Math.floor(d/2);for(let w=0;w<n;w++){let p=Math.floor(u/2);for(let b=0;b<s;b++){let y=Math.round(g),M=Math.round(p);(!i||i.getBitXY(y,M))&&(a.push([y,M]),h.push(this.getPixelXY(y,M))),p+=u}g+=d}const _={xyS:a,zS:h};return t&&(_.painted=this.rgba8().paintPoints(a)),_}function Matrix(e,r,t){const i=new Array(e);for(let n=0;n<e;n++)i[n]=new Array(r);if(t)for(let n=0;n<e;n++)for(let s=0;s<r;s++)i[n][s]=t;return i.width=e,i.height=r,Object.setPrototypeOf(i,Matrix.prototype),i}Matrix.prototype.localMin=function(e,r){let t=this[e][r],i=[e,r];for(let n=Math.max(0,e-1);n<Math.min(this.length,e+2);n++)for(let s=Math.max(0,r-1);s<Math.min(this[0].length,r+2);s++)this[n][s]<t&&(t=this[n][s],i=[n,s]);return{position:i,value:t}};Matrix.prototype.localMax=function(e,r){let t=this[e][r],i=[e,r];for(let n=Math.max(0,e-1);n<Math.min(this.length,e+2);n++)for(let s=Math.max(0,r-1);s<Math.min(this[0].length,r+2);s++)this[n][s]>t&&(t=this[n][s],i=[n,s]);return{position:i,value:t}};Matrix.prototype.localSearch=function(e,r,t){let i=[];for(let n=Math.max(0,e-1);n<Math.min(this.length,e+2);n++)for(let s=Math.max(0,r-1);s<Math.min(this[0].length,r+2);s++)this[n][s]===t&&i.push([n,s]);return i};function getBestMatch(e,r={}){let{border:t}=r;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");let i=new Matrix(e.width,e.height,-1/0),n=Math.floor(e.width/2),s=Math.floor(e.height/2),a=n,h=s,d=!1;for(;!d;){let u=i.localSearch(n,s,-1/0);for(let _=0;_<u.length;_++){let w=u[_],p=this.getSimilarity(e,{border:t,shift:[a-w[0],h-w[1]]});i[w[0]][w[1]]=p}let g=i.localMax(n,s);g.position[0]!==n||g.position[1]!==s?(n=g.position[0],s=g.position[1]):d=!0}return[n-a,s-h]}function getRow(e,r=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,e),checkChannel(this,r);let t=new Array(this.width),i=0,n=e*this.width*this.channels+r,s=n+this.width*this.channels;for(let a=n;a<s;a+=this.channels)t[i++]=this.data[a];return t}function getColumn(e,r=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,e),checkChannel(this,r);let t=new Array(this.height),i=0,n=this.width*this.channels;for(let s=r+e*this.channels;s<this.data.length;s+=n)t[i++]=this.data[s];return t}function getMatrix(e={}){let{channel:r}=e;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}let t=new Matrix$1(this.height,this.width);for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)t.set(i,n,this.getValueXY(n,i,r));return t}function setMatrix(e,r={}){e=new Matrix$1(e);let{channel:t}=r;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}if(this.width!==e.columns||this.height!==e.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)this.setValueXY(n,i,t,e.get(i,n));return this}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let e=new Array(this.size),r=0;for(let t=0;t<this.data.length;t+=this.channels){let i=new Array(this.components);for(let n=0;n<this.components;n++)i[n]=this.data[t+n];e[r++]=i}return e}function getIntersection(e){let r=this,t=r.getClosestCommonParent(e),i=r.getRelativePosition(t,{defaultFurther:!0}),n=getRelativePositionForAllPixels(r,i),s=e.getRelativePosition(t,{defaultFurther:!0}),a=getRelativePositionForAllPixels(e,s),h=getCommonSurface(n,a),d={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let u=0;u<h.length;u++){let g=h[u],_=[g[0]-i[0],g[1]-i[1]],w=[g[0]-s[0],g[1]-s[1]],p=r.getBitXY(_[0],_[1]),b=e.getBitXY(w[0],w[1]);p===1&&b===1&&d.commonWhitePixels.push(g)}for(let u=0;u<n.length;u++){let g,_;u!==0&&(g=Math.floor(u/r.width),_=u%r.width),r.getBitXY(g,_)===1&&d.whitePixelsMask1.push(n[u])}for(let u=0;u<a.length;u++){let g=0,_=0;u!==0&&(g=Math.floor(u/e.width),_=u%e.width),e.getBitXY(g,_)===1&&d.whitePixelsMask2.push(a[u])}return d}function getRelativePositionForAllPixels(e,r){let t=[];for(let i=0;i<e.height;i++)for(let n=0;n<e.width;n++){let s=[i,n];t.push([s[0]+r[0],s[1]+r[1]])}return t}function getCommonSurface(e,r){let t=0,i=0,n=[];for(;t<e.length&&i<r.length;)e[t][0]===r[i][0]&&e[t][1]===r[i][1]?(n.push(e[t]),t++,i++):e[t][0]<r[i][0]||e[t][0]===r[i][0]&&e[t][1]<r[i][1]?t++:i++;return n}function getClosestCommonParent(e){let r=getDepth(this),t=getDepth(e),i;if(r>=t?i=getFurthestParent(this,r):i=getFurthestParent(e,t),r===0||t===0)return i;let n=this,s=e;for(;r!==t;)if(r>t){if(n=n.parent,n===null)return i;r=r-1}else{if(s=s.parent,s===null)return i;t=t-1}for(;n!==s&&n!==null&&s!==null;)if(n=n.parent,s=s.parent,n===null||s===null)return i;return n!==s?i:n}function getDepth(e){let r=0,t=e;for(;t.parent!=null;)t=t.parent,r++;return r}function getFurthestParent(e,r){let t=e;for(;r>0;)t=t.parent,r=r-1;return t}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(e,r){e.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),r=Object.assign({},defaultOptions$1,r);const t=e.width,i=e.height,n=e.maxValue,s={sigma:r.gaussianBlur,radius:3},a=e.gaussianFilter(s),h=a.convolution(Gy,convOptions),d=a.convolution(Gx,convOptions),u=d.hypotenuse(h),g=e.constructor,_=new g(t,i,{kind:"GREY",bitDepth:32}),w=new g(t,i,{kind:"GREY",bitDepth:32}),p=new g(t,i,{kind:"GREY"});for(var b=1;b<t-1;b++)for(var y=1;y<i-1;y++){var M=(Math.round(Math.atan2(d.getValueXY(b,y,0),h.getValueXY(b,y,0))*(5/Math.PI))+5)%5;M===0&&(u.getValueXY(b,y,0)<=u.getValueXY(b,y-1,0)||u.getValueXY(b,y,0)<=u.getValueXY(b,y+1,0))||M===1&&(u.getValueXY(b,y,0)<=u.getValueXY(b-1,y+1,0)||u.getValueXY(b,y,0)<=u.getValueXY(b+1,y-1,0))||M===2&&(u.getValueXY(b,y,0)<=u.getValueXY(b-1,y,0)||u.getValueXY(b,y,0)<=u.getValueXY(b+1,y,0))||M===3&&(u.getValueXY(b,y,0)<=u.getValueXY(b-1,y-1,0)||u.getValueXY(b,y,0)<=u.getValueXY(b+1,y+1,0))||_.setValueXY(b,y,0,u.getValueXY(b,y,0))}for(b=0;b<t*i;++b){var A=_.data[b],C=0;A>r.highThreshold&&(C++,p.data[b]=n),A>r.lowThreshold&&C++,w.data[b]=C}var v=[];for(b=1;b<t-1;++b)for(y=1;y<i-1;++y)if(w.getValueXY(b,y,0)===1){e:for(var E=b-1;E<b+2;++E)for(var R=y-1;R<y+2;++R)if(w.getValueXY(E,R,0)===2){v.push([b,y]),p.setValueXY(b,y,0,n);break e}}for(;v.length>0;){var $=[];for(b=0;b<v.length;++b)for(y=-1;y<2;++y)for(E=-1;E<2;++E)if(!(y===0&&E===0)){var L=v[b][0]+y,D=v[b][1]+E;w.getValueXY(L,D,0)===1&&p.getValueXY(L,D,0)===0&&($.push([L,D]),p.setValueXY(L,D,0,n))}v=$}return p}function cannyEdge(e){return cannyEdgeDetector(this,e)}function extract(e,r={}){let{position:t}=r;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!t&&(t=e.getRelativePosition(this),!t))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let i=Image.createFrom(this,{width:e.width,height:e.height,alpha:1,position:t,parent:this});for(let n=0;n<e.width;n++)for(let s=0;s<e.height;s++){for(let a=0;a<this.channels;a++){let h=this.getValueXY(n+t[0],s+t[1],a);i.setValueXY(n,s,a,h)}e.getBitXY(n,s)||i.setValueXY(n,s,this.components,0)}return i}else{let i=Image.createFrom(this,{width:e.width,height:e.height,position:t,parent:this});for(let n=0;n<e.height;n++)for(let s=0;s<e.width;s++)e.getBitXY(s,n)&&this.getBitXY(s+t[0],n+t[1])&&i.setBitXY(s,n);return i}}var fastList={exports:{}},hasRequiredFastList;function requireFastList(){return hasRequiredFastList||(hasRequiredFastList=1,function(e,r){(function(){function t(n,s,a){this.next=a,a&&(a.prev=this),this.prev=s,s&&(s.next=this),this.data=n}function i(){if(!(this instanceof i))return new i;this._head=null,this._tail=null,this.length=0}i.prototype={push:function(n){this._tail=new t(n,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var n=this._tail;return this._tail=n.prev,n.prev&&(n.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),n.data}},unshift:function(n){this._head=new t(n,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var n=this._head;return this._head=n.next,n.next&&(n.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),n.data}},item:function(n){n<0&&(n=this.length+n);for(var s=this._head;n-- >0&&s;)s=s.next;return s?s.data:void 0},slice:function(n,s){if(n||(n=0),s||(s=this.length),s<0&&(s=this.length+s),n<0&&(n=this.length+n),s===n)return[];if(s<n)throw new Error("invalid offset: "+n+","+s+" (length="+this.length+")");for(var a=s-n,h=new Array(a),d=0,u=this._head;n-- >0&&u;)u=u.next;for(;d<a&&u;)h[d++]=u.data,u=u.next;return h},drop:function(){i.call(this)},forEach:function(n,s){for(var a=this._head,h=0,d=this.length;h<d&&a;)n.call(s||this,a.data,h,this),a=a.next,h++},map:function(n,s){var a=new i;return this.forEach(function(h,d,u){a.push(n.call(s||u,h,d,u))}),a},filter:function(n,s){var a=new i;return this.forEach(function(h,d,u){n.call(s||u,h,d,u)&&a.push(h)}),a},reduce:function(n,s,a){var h=0,d=this._head,u=this.length;for(s||(h=1,s=d&&d.data,d=d&&d.next);h<u&&d;)s=n.call(a||this,s,d.data,this),h++,d=d.next;return s}},e.exports=i})()}(fastList)),fastList.exports}var fastListExports=requireFastList();const LinkedList=getDefaultExportFromCjs(fastListExports);function floodFill(e={}){const{x:r=0,y:t=0,inPlace:i=!0}=e,n=i?this:Image.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(r,t))return n;const a=new LinkedList;for(a.push(new Node(r,t));a.length>0;){const h=a.shift();n.setBitXY(h.x,h.y);for(let d=h.x+1;d<this.width&&(!n.getBitXY(d,h.y)&&!this.getBitXY(d,h.y));d++)n.setBitXY(d,h.y),h.y+1<this.height&&!this.getBitXY(d,h.y+1)&&a.push(new Node(d,h.y+1)),h.y-1>=0&&!this.getBitXY(d,h.y-1)&&a.push(new Node(d,h.y-1));for(let d=h.x-1;d>=0&&(!n.getBitXY(d,h.y)&&!this.getBitXY(d,h.y));d++)n.setBitXY(d,h.y),h.y+1<this.height&&!this.getBitXY(d,h.y+1)&&a.push(new Node(d,h.y+1)),h.y-1>=0&&!this.getBitXY(d,h.y-1)&&a.push(new Node(d,h.y-1))}return n}function Node(e,r){this.x=e,this.y=r}function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var i in t)({}).hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},_extends.apply(null,arguments)}function hsv2rgb(e,r,t){r=r/100,t=t/100;var i=[],n=t*r,s=e/60,a=n*(1-Math.abs(s%2-1)),h=t-n;return s>=0&&s<1?i=[n,a,0]:s>=1&&s<2?i=[a,n,0]:s>=2&&s<3?i=[0,n,a]:e>=3&&s<4?i=[0,a,n]:e>=4&&s<5?i=[a,0,n]:e>=5&&s<=6?i=[n,0,a]:i=[0,0,0],{r:Math.round(255*(i[0]+h)),g:Math.round(255*(i[1]+h)),b:Math.round(255*(i[2]+h))}}function hsl2hsv(e,r,t){return r*=(t<50?t:100-t)/100,{h:e,s:2*r/(t+r)*100,v:t+r}}function hsl2rgb$1(e,r,t){var i=hsl2hsv(e,r,t);return hsv2rgb(i.h,i.s,i.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(e){return named(e)||hex3(e)||hex6(e)||rgb(e)||rgba$1(e)||hsl(e)||hsla(e)}function named(e){var r=colors[e.toLowerCase()];if(r)return{r:r[0],g:r[1],b:r[2],a:100}}function rgb(e){var r=e.match(/rgb\(([^)]+)\)/);if(r){var t=r[1].split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:100}}}function rgba$1(e){var r=e.match(/rgba\(([^)]+)\)/);if(r){var t=r[1].split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:t[3]*100}}}function hex6(e){if(e[0]==="#"&&e.length===7)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:100}}function hex3(e){if(e[0]==="#"&&e.length===4)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:100}}function hsl(e){var r=e.match(/hsl\(([^)]+)\)/);if(r){var t=r[1].split(/ *, */),i=parseInt(t[0],10),n=parseInt(t[1],10),s=parseInt(t[2],10),a=hsl2rgb$1(i,n,s);return _extends({},a,{a:100})}}function hsla(e){var r=e.match(/hsla\(([^)]+)\)/);if(r){var t=r[1].split(/ *, */),i=parseInt(t[0],10),n=parseInt(t[1],10),s=parseInt(t[2],10),a=parseInt(parseFloat(t[3])*100,10),h=hsl2rgb$1(i,n,s);return _extends({},h,{a})}}function css2array(e){let r=parse(e);return[r.r,r.g,r.b,Math.round(r.a*255/100)]}function hue2rgb(e,r,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?e+(r-e)*6*t:t<1/2?r:t<2/3?e+(r-e)*(2/3-t)*6:e}function hsl2rgb(e,r,t){let i,n,s,a,h,d;return r/=100,t/=100,r===0?a=h=d=t*255:(t<=.5?n=t*(r+1):n=t+r-t*r,i=t*2-n,s=e/360,a=hue2rgb(i,n,s+1/3),h=hue2rgb(i,n,s),d=hue2rgb(i,n,s-1/3)),{r:a,g:h,b:d}}function getDistinctColors(e){let r=new Array(e),t=0;for(let i=0;i<360;i+=360/e){t++;let n=hsl2rgb(i,100,30+t%4*15);r[t-1]=[Math.round(n.r*255),Math.round(n.g*255),Math.round(n.b*255)]}return r}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(e){let{color:r,colors:t,randomColors:i,numberColors:n=50}=e;if(r&&!Array.isArray(r)&&(r=css2array(r)),r)return[r];if(t)return t=t.map(function(s){return Array.isArray(s)?s:css2array(s)}),t;if(i){t=new Array(n);for(let s=0;s<n;s++)t[s]=getRandomColor()}return getDistinctColors(n)}function paintLabels(e,r,t={}){let{color:i="blue",colors:n,font:s="12px Helvetica",rotate:a=0}=t;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(e))throw Error("paintLabels: labels must be an array");if(!Array.isArray(r))throw Error("paintLabels: positions must be an array");if(i&&!Array.isArray(i)&&(i=css2array(i)),n?n=n.map(function(u){return Array.isArray(u)?u:css2array(u)}):n=[i],e.length!==r.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(s)||(s=[s]),Array.isArray(a)||(a=[a]);let d=this.getCanvas().getContext("2d");for(let u=0;u<e.length;u++){d.save();let g=n[u%n.length];d.fillStyle=`rgba(${g[0]},${g[1]},${g[2]},${g[3]/this.maxValue})`,d.font=s[u%s.length];let _=r[u];d.translate(_[0],_[1]),d.rotate(a[u%a.length]/180*Math.PI),d.fillText(e[u],0,0),d.restore()}return this.data=Uint8Array.from(d.getImageData(0,0,this.width,this.height).data),this}function paintMasks(e,r={}){let{alpha:t=255,labels:i=[],labelsPosition:n=[],labelColor:s="blue",labelFont:a="12px Helvetica"}=r;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let h=getColors(Object.assign({},r,{numberColors:e.length}));Array.isArray(e)||(e=[e]);for(let d=0;d<e.length;d++){let u=e[d],g=h[d%h.length];for(let _=0;_<u.width;_++)for(let w=0;w<u.height;w++)if(u.getBitXY(_,w))for(let p=0;p<Math.min(this.components,g.length);p++)if(t===255)this.setValueXY(_+u.position[0],w+u.position[1],p,g[p]);else{let b=this.getValueXY(_+u.position[0],w+u.position[1],p);b=Math.round((b*(255-t)+g[p]*t)/255),this.setValueXY(_+u.position[0],w+u.position[1],p,b)}}if(Array.isArray(i)&&i.length>0){let u=this.getCanvas().getContext("2d");u.fillStyle=s,u.font=a;for(let g=0;g<Math.min(e.length,i.length);g++){let _=n[g]?n[g]:e[g].position;u.fillText(i[g],_[0],_[1])}this.data=Uint8Array.from(u.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(e,r){let t=new Array(e);for(let i=0;i<e;i++)t[i]=new Array(r).fill(0);return t}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(r={}){let{kind:t="cross",shape:i,size:n,width:s,height:a,filled:h=!0}=r;if(n&&(s=n,a=n),i)switch(i.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(s,a,{filled:h});break;case"circle":case"ellipse":this.matrix=ellipse(s,a,{filled:h});break;case"triangle":this.matrix=triangle(s,a,{filled:h});break;default:throw new Error(`Shape: unexpected shape: ${i}`)}else if(t)switch(t.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${t}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let r=this.matrix,t=[];for(let i=0;i<r.length;i++)for(let n=0;n<r[0].length;n++)r[i][n]&&t.push([n-this.halfWidth,i-this.halfHeight]);return t}getMask(){let r=new Image(this.width,this.height,{kind:BINARY});for(let t=0;t<this.matrix.length;t++)for(let i=0;i<this.matrix[0].length;i++)this.matrix[t][i]&&r.setBitXY(i,t);return r}}function rectangle(e,r,t){const i=zerosMatrix(r,e);if(t.filled)for(let n=0;n<r;n++)for(let s=0;s<e;s++)i[n][s]=1;else{for(let n of[0,r-1])for(let s=0;s<e;s++)i[n][s]=1;for(let n=0;n<r;n++)for(let s of[0,e-1])i[n][s]=1}return i}function ellipse(e,r,t){const i=zerosMatrix(r,e);let n=1-r%2,s=1-e%2,a=Math.floor((e-1)/2),h=Math.floor((r-1)/2),d=a*a,u=h*h;if(t.filled)for(let g=0;g<=h;g++){let _=Math.floor(Math.sqrt(d-d*g*g/u));for(let w=a-_;w<=a;w++)i[h-g][w]=1,i[h+g+n][w]=1,i[h-g][e-w-1]=1,i[h+g+n][e-w-1]=1}else{for(let g=0;g<=h;g++){let _=Math.floor(Math.sqrt(d-d*g*g/u)),w=a-_;i[h-g][w]=1,i[h+g+n][w]=1,i[h-g][e-w-1]=1,i[h+g+n][e-w-1]=1}for(let g=0;g<=a;g++){let _=Math.floor(Math.sqrt(u-u*g*g/d)),w=h-_;i[w][a-g]=1,i[w][a+g+s]=1,i[r-w-1][a-g]=1,i[r-w-1][a+g+s]=1}}return i}function triangle(e,r,t){if(!t.filled)throw new Error("Non filled triangle is not implemented");const i=zerosMatrix(r,e);for(let n=0;n<r;n++){let s=Math.floor((1-n/r)*e/2);for(let a=s;a<e-s;a++)i[n][a]=1}return i}function paintPoints(e,r={}){let{shape:t}=r;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let i=getColors(Object.assign({},r,{numberColors:e.length})),n=new Shape(t).getPoints(),s=Math.min(this.channels,i[0].length);for(let a=0;a<e.length;a++){let h=i[a%i.length],d=e[a][0],u=e[a][1];for(let g=0;g<n.length;g++){let _=n[g][0],w=n[g][1];if(d+_>=0&&u+w>=0&&d+_<this.width&&u+w<this.height){let p=(d+_+(u+w)*this.width)*this.channels;for(let b=0;b<s;b++)this.data[p+b]=h[b]}}}return this}function paintPolyline(e,r={}){let{color:t=[this.maxValue,0,0],closed:i=!1}=r;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let n=Math.min(this.channels,t.length);for(let s=0;s<e.length-1+i;s++){let a=e[s],h=e[(s+1)%e.length],d=h[0]-a[0],u=h[1]-a[1],g=Math.max(Math.abs(d),Math.abs(u)),_=d/g,w=u/g,p=a[0],b=a[1];for(let y=0;y<=g;y++){let M=Math.round(p),A=Math.round(b);if(M>=0&&A>=0&&M<this.width&&A<this.height)if(this.bitDepth===1)this.setBitXY(M,A);else{let C=(M+A*this.width)*this.channels;for(let v=0;v<n;v++)this.data[C+v]=t[v]}p=p+_,b=b+w}}return this}function paintPolylines(e,r={}){let t=Object.assign({},r);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let i=getColors(Object.assign({},r,{numberColors:e.length}));for(let n=0;n<e.length;n++)t.color=i[n%i.length],this.paintPolyline(e[n],t);return this}function paintPolygon(e,r={}){let{color:t=[this.maxValue,0,0],filled:i=!1}=r;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),r.closed=!0;let n=deleteDouble(e);if(i===!1)return this.paintPolyline(e,r);{let s=Array(this.height);for(let a=0;a<this.height;a++){s[a]=[];for(let h=0;h<this.width;h++)s[a].push(0)}for(let a=0;a<n.length;a++){const h=lineBetweenTwoPoints(n[a],n[(a+1)%n.length]);for(let d=0;d<this.height;d++)for(let u=0;u<this.width;u++)isAtTheRightOfTheLine(u,d,h,this.height)&&(s[d][u]=s[d][u]===0?1:0)}for(let a=0;a<this.height;a++)for(let h=0;h<this.width;h++)if(s[a][h]===1)if(this.bitDepth===1)this.setBitXY(h,a);else{let d=Math.min(this.channels,t.length),u=(h+a*this.width)*this.channels;for(let g=0;g<d;g++)this.data[u+g]=t[g]}return this.paintPolyline(e,r)}}function deleteDouble(e){let r=[];for(let t=0;t<e.length;t++)if(!(e[t][0]===e[(t+1)%e.length][0]&&e[t][1]===e[(t+1)%e.length][1])){if(e[t][0]===e[(t-1+e.length)%e.length][0]&&e[t][1]===e[(t-1+e.length)%e.length][1])continue;if(e[(t+1)%e.length][0]===e[(t-1+e.length)%e.length][0]&&e[(t-1+e.length)%e.length][1]===e[(t+1)%e.length][1])continue;r.push(e[t])}return r}function lineBetweenTwoPoints(e,r){if(e[0]===r[0])return{a:0,b:e[0],vertical:!0};{const t=(r[1]-e[1])/(r[0]-e[0]),i=e[1]-t*e[0];return{a:t,b:i,vertical:!1}}}function isAtTheRightOfTheLine(e,r,t,i){if(t.vertical===!0)return t.b<=e;if(t.a===0)return!1;{const n=(r-t.b)/t.a;return n<e&&n>=0&&n<=i}}function paintPolygons(e,r={}){let t=Object.assign({},r);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let i=getColors(Object.assign({},r,{numberColors:e.length}));for(let n=0;n<e.length;n++)t.color=i[n%i.length],this.paintPolygon(e[n],t);return this}function getHistogram(e={}){let{maxSlots:r=256,channel:t,useAlpha:i=!0}=e;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}return getChannelHistogram.call(this,t,{useAlpha:i,maxSlots:r})}function getHistograms(e={}){const{maxSlots:r=256,useAlpha:t=!0}=e;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let i=new Array(t?this.components:this.channels);for(let n=0;n<i.length;n++)i[n]=getChannelHistogram.call(this,n,{useAlpha:t,maxSlots:r});return i}function getChannelHistogram(e,r){let{useAlpha:t,maxSlots:i}=r;if(this.bitDepth===1){let d=[0,0];for(let u=0;u<this.height;u++)for(let g=0;g<this.width;g++){let _=this.getBitXY(u,g);_===0?d[0]+=1:_===1&&(d[1]+=1)}return d}let n=Math.log2(i);if(!isInteger(n))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let s=0;this.bitDepth>n&&(s=this.bitDepth-n);let a=this.data,h=newArray(Math.pow(2,Math.min(this.bitDepth,n)),0);if(t&&this.alpha){let d=this.channels-e-1;for(let u=e;u<a.length;u+=this.channels)h[a[u]>>s]+=a[u+d]/this.maxValue}else for(let d=e;d<a.length;d+=this.channels)h[a[d]>>s]++;return h}function getColorHistogram(e={}){let{useAlpha:r=!0,nbSlots:t=512}=e;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let i=Math.log(t)/Math.log(8);if(i!==Math.floor(i))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let n=this.bitDepth-i,s=this.data,a=newArray(Math.pow(8,i),0),h=Math.pow(2,i*2),d=Math.pow(2,i);for(let u=0;u<s.length;u+=this.channels){let g=(s[u]>>n)*h+(s[u+1]>>n)*d+(s[u+2]>>n);r&&this.alpha?a[g]+=s[u+this.channels-1]/this.maxValue:a[g]++}return a}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let e=newArray(this.channels,1/0);for(let r=0;r<this.data.length;r+=this.channels)for(let t=0;t<this.channels;t++)this.data[r+t]<e[t]&&(e[t]=this.data[r+t]);return e}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let e=newArray(this.channels,-1/0);for(let r=0;r<this.data.length;r+=this.channels)for(let t=0;t<this.channels;t++)this.data[r+t]>e[t]&&(e[t]=this.data[r+t]);return e}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let e=newArray(this.channels,0);for(let r=0;r<this.data.length;r+=this.channels)for(let t=0;t<this.channels;t++)e[t]+=this.data[r+t];return e}function getMoment(e=0,r=0){this.checkProcessable("getMoment",{bitDepth:[1]});let t=0;for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++)this.getBitXY(i,n)===1&&(t+=i**e*n**r);return t}function localMaxima(e={}){let{mask:r,region:t=3,removeClosePoints:i=0,invert:n=!1,maxEquals:s=2}=e,a=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),t*=4;let h=n?0:1,d=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],u=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],g=t<=8?1:2,_=[];for(let w=g;w<a.height-g;w++)for(let p=g;p<a.width-g;p++){if(r&&r.getBitXY(p,w)!==h)continue;let b=0,y=0,M=a.data[p+w*a.width];for(let A=0;A<t;A++)n?a.data[p+d[A]+(w+u[A])*a.width]>M&&b++:a.data[p+d[A]+(w+u[A])*a.width]<M&&b++,a.data[p+d[A]+(w+u[A])*a.width]===M&&y++;b+y===t&&y<=s&&_.push([p,w])}if(i>0)for(let w=0;w<_.length;w++)for(let p=w+1;p<_.length;p++)Math.sqrt(Math.pow(_[w][0]-_[p][0],2)+Math.pow(_[w][1]-_[p][1],2))<i&&(_[w][0]=_[w][0]+_[p][0]>>1,_[w][1]=_[w][1]+_[p][1]>>1,_.splice(p,1),p--);return _}function mean(){let e=this.getHistograms({maxSlots:this.maxValue+1}),r=new Array(e.length);for(let t=0;t<e.length;t++){let i=e[t];r[t]=mean$2(i)}return r}function median(){let e=this.getHistograms({maxSlots:this.maxValue+1}),r=new Array(e.length);for(let t=0;t<e.length;t++){let i=e[t];r[t]=median$2(i)}return r}function points(){this.checkProcessable("points",{bitDepth:[1]});const e=[];for(let r=0;r<this.width;r++)for(let t=0;t<this.height;t++)this.getBitXY(r,t)===1&&e.push([r,t]);return e}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const e=[];for(let r=0;r<this.height;r++)for(let t=0;t<this.width;t++)if(this.getBitXY(t,r)===1)for(e.push([t,r]),this.getBitXY(t+1,r)!==1?(e.push([t+1,r]),e.push([t+1,r+1]),this.getBitXY(t,r+1)!==1&&e.push([t,r+1])):this.getBitXY(t,r+1)!==1&&(e.push([t,r+1]),e.push([t+1,r+1]));t<this.width-2&&this.getBitXY(t+1,r)===1&&this.getBitXY(t+2,r)===1;)t++;return e}function getRelativePosition(e,r={}){if(this===e)return[0,0];let t=[0,0],i=this;for(;i;){if(i===e)return t;i.position&&(t[0]+=i.position[0],t[1]+=i.position[1]),i=i.parent}return r.defaultFurther?t:!1}function countAlphaPixels(e={}){let{alpha:r=1}=e;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let t=0;if(r!==void 0){for(let i=this.components;i<this.data.length;i+=this.channels)this.data[i]===r&&t++;return t}else return this.size}function monotoneChainConvexHull$1(e,r={}){const{sorted:t}=r;t||(e=e.slice().sort(byXThenY));const i=e.length,n=new Array(i*2);let s=0;for(let h=0;h<i;h++){const d=e[h];for(;s>=2&&cw(n[s-2],n[s-1],d)<=0;)s--;n[s++]=d}const a=s+1;for(let h=i-2;h>=0;h--){const d=e[h];for(;s>=a&&cw(n[s-2],n[s-1],d)<=0;)s--;n[s++]=d}return n.slice(0,s-1)}function cw(e,r,t){return(r[1]-e[1])*(t[0]-e[0])-(r[0]-e[0])*(t[1]-e[1])}function byXThenY(e,r){return e[0]===r[0]?e[1]-r[1]:e[0]-r[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(e){for(let r=0;r<e.length;r++)e[r][0]=Math.round(e[r][0]),e[r][1]=Math.round(e[r][1]);return e}function difference(e,r){return[e[0]-r[0],e[1]-r[1]]}function normalize(e){let r=Math.sqrt(e[0]**2+e[1]**2);return[e[0]/r,e[1]/r]}function rotate(e,r,t){t===void 0&&(t=new Array(r.length));let i=Math.cos(e),n=Math.sin(e);for(let s=0;s<t.length;++s)t[s]=[i*r[s][0]-n*r[s][1],n*r[s][0]+i*r[s][1]];return t}function perimeter(e){let r=0;for(let t=0;t<e.length;t++){let i=e[t][0],n=e[t][1],s=e[t===e.length-1?0:t+1][0],a=e[t===e.length-1?0:t+1][1];r+=Math.sqrt((s-i)**2+(a-n)**2)}return r}function surface(e){let r=0;for(let t=0;t<e.length;t++){let i=e[t][0],n=e[t===e.length-1?0:t+1][1],s=e[t===e.length-1?0:t+1][0],a=e[t][1];r+=i*n*.5,r-=s*a*.5}return Math.abs(r)}function minMax(e){let r=1/0,t=1/0,i=-1/0,n=-1/0;for(let s=0;s<e.length;s++)e[s][0]<r&&(r=e[s][0]),e[s][0]>i&&(i=e[s][0]),e[s][1]<t&&(t=e[s][1]),e[s][1]>n&&(n=e[s][1]);return[[r,t],[i,n]]}function moveToZeroZero(e,r){r===void 0&&(r=new Array(e.length).fill(0).map(()=>[]));let t=minMax(e),i=t[0][0],n=t[0][1];for(let s=0;s<e.length;s++)r[s][0]=e[s][0]-i,r[s][1]=e[s][1]-n;return r}function minimalBoundingRectangle(e={}){const{originalPoints:r=monotoneChainConvexHull.call(this)}=e;if(r.length===0)return[];if(r.length===1)return[r[0],r[0],r[0],r[0]];const t=new Array(r.length);let i=1/0,n=0,s;for(let a=0;a<t.length;a++){let h=getAngle$1(r[a],r[(a+1)%t.length]);rotate(-h,r,t);let d=t[a][0],u=t[a][1],g=t[(a+1)%t.length][0],_=t[(a+1)%t.length][1],w=!0,p=0,b=0,y=0;for(let v=0;v<t.length;v++){let E=t[v][0],R=t[v][1],$=(E-d)/(g-d);w===!0?(w=!1,p=$,b=$):($<p&&(p=$),$>b&&(b=$));let L=(-(g-d)*R+g*u-_*d)/(g-d);Math.abs(L)>Math.abs(y)&&(y=L)}let M=[d+p*(g-d),u],A=[d+b*(g-d),u],C=Math.abs(y*(p-b)*(g-d));C<i&&(n=h,i=C,s=[M,A,[A[0],A[1]-y],[M[0],M[1]-y]])}return rotate(n,s,s),s}function getAngle$1(e,r){let t=difference(r,e),i=normalize(t),n=Math.acos(i[0]);return i[1]<0?-n:n}function extend$1(e){let r={inPlace:!0};e.extendMethod("invert",invert),e.extendMethod("abs",abs),e.extendMethod("level",level,r),e.extendMethod("add",add,r),e.extendMethod("subtract",subtract,r),e.extendMethod("subtractImage",subtractImage),e.extendMethod("multiply",multiply,r),e.extendMethod("divide",divide,r),e.extendMethod("hypotenuse",hypotenuse),e.extendMethod("background",background$1),e.extendMethod("flipX",flipX),e.extendMethod("flipY",flipY),e.extendMethod("blurFilter",blurFilter),e.extendMethod("medianFilter",medianFilter),e.extendMethod("gaussianFilter",gaussianFilter),e.extendMethod("sobelFilter",sobelFilter),e.extendMethod("gradientFilter",gradientFilter),e.extendMethod("scharrFilter",scharrFilter),e.extendMethod("dilate",dilate),e.extendMethod("erode",erode),e.extendMethod("open",open),e.extendMethod("close",close),e.extendMethod("topHat",topHat),e.extendMethod("blackHat",blackHat),e.extendMethod("morphologicalGradient",morphologicalGradient),e.extendMethod("warpingFourPoints",warpingFourPoints),e.extendMethod("crop",crop),e.extendMethod("cropAlpha",cropAlpha),e.extendMethod("resize",resize).extendMethod("scale",resize),e.extendMethod("hsv",hsv),e.extendMethod("hsl",hsl$1),e.extendMethod("cmyk",cmyk),e.extendMethod("rgba8",rgba8),e.extendMethod("grey",grey).extendMethod("gray",grey),e.extendMethod("mask",mask),e.extendMethod("pad",pad),e.extendMethod("colorDepth",colorDepth),e.extendMethod("setBorder",setBorder,r),e.extendMethod("rotate",rotate$1),e.extendMethod("rotateLeft",rotateLeft),e.extendMethod("rotateRight",rotateRight),e.extendMethod("insert",insert),e.extendMethod("getRow",getRow),e.extendMethod("getColumn",getColumn),e.extendMethod("getMatrix",getMatrix),e.extendMethod("setMatrix",setMatrix),e.extendMethod("getPixelsArray",getPixelsArray),e.extendMethod("getIntersection",getIntersection),e.extendMethod("getClosestCommonParent",getClosestCommonParent),e.extendMethod("getThreshold",getThreshold),e.extendMethod("split",split),e.extendMethod("getChannel",getChannel),e.extendMethod("combineChannels",combineChannels),e.extendMethod("setChannel",setChannel),e.extendMethod("getSimilarity",getSimilarity),e.extendMethod("getPixelsGrid",getPixelsGrid),e.extendMethod("getBestMatch",getBestMatch),e.extendMethod("cannyEdge",cannyEdge),e.extendMethod("convolution",convolution),e.extendMethod("extract",extract),e.extendMethod("floodFill",floodFill),e.extendMethod("paintLabels",paintLabels,r),e.extendMethod("paintMasks",paintMasks,r),e.extendMethod("paintPoints",paintPoints,r),e.extendMethod("paintPolyline",paintPolyline,r),e.extendMethod("paintPolylines",paintPolylines,r),e.extendMethod("paintPolygon",paintPolygon,r),e.extendMethod("paintPolygons",paintPolygons,r),e.extendMethod("countAlphaPixels",countAlphaPixels),e.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),e.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),e.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),e.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),e.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),e.extendMethod("getMin",min).extendProperty("min",min),e.extendMethod("getMax",max).extendProperty("max",max),e.extendMethod("getSum",sum).extendProperty("sum",sum),e.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),e.extendMethod("getLocalMaxima",localMaxima),e.extendMethod("getMedian",median).extendProperty("median",median),e.extendMethod("getMean",mean).extendProperty("mean",mean),e.extendMethod("getPoints",points).extendProperty("points",points),e.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),e.extendMethod("getRelativePosition",getRelativePosition)}var quantities$1={exports:{}},quantities=quantities$1.exports,hasRequiredQuantities;function requireQuantities(){return hasRequiredQuantities||(hasRequiredQuantities=1,function(e,r){(function(t,i){e.exports=i()})(quantities,function(){function t(x){return typeof x=="string"||x instanceof String}var i=Number.isFinite||window.isFinite;function n(x){return i(x)}function s(x){return x}function a(x){var f={};return x.filter(function(l){return f.hasOwnProperty(l)?!1:f[l]=!0})}function h(x,f){if(f.length!==x.length)return!1;for(var l=0;l<x.length;l++)if(f[l].compareArray&&!f[l].compareArray(x[l])||f[l]!==x[l])return!1;return!0}function d(x,f){Object.keys(f).forEach(function(l){x[l]=f[l]})}function u(){for(var x=1,f=0,l=0;l<arguments.length;l++){var o=arguments[l];f=f+w(o),x*=o}return f!==0?_(x,f):x}function g(x,f){if(f===0)throw new Error("Divide by zero");var l=Math.pow(10,w(f)),o=l/(l*f);return u(x,o)}function _(x,f){return Math.round(x*Math.pow(10,f))/Math.pow(10,f)}function w(x){if(!isFinite(x))return 0;for(var f=0;x%1!==0;)x*=10,f++;return f}function p(){var x;if(!this)return x=Object.create(p.prototype),p.apply(x,arguments),x;x=Error.apply(this,arguments),this.name="QtyError",this.message=x.message,this.stack=x.stack}p.prototype=Object.create(Error.prototype,{constructor:{value:p}});function b(x,f){throw new p("Incompatible units: "+x+" and "+f)}var y={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","μ","µ","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["t","tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"molar_concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"molar_concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","Ω","Ω"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules","Joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<electronvolt>":[["eV","electronvolt","electronvolts"],1602176634e-28,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<arcminute>":[["arcmin","arcminute","arcminutes"],Math.PI/10800,"angle",["<radian>"]],"<arcsecond>":[["arcsec","arcsecond","arcseconds"],Math.PI/648e3,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppb>":[["ppb"],1e-9,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-12,"prefix_only",["<1>"]],"<ppq>":[["ppq"],1e-15,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},M=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],A="<1>",C=[A];function v(x,f){var l=f[1],o=f[3]||[],c=f[4]||[];if(!n(l))throw new p(x+": Invalid unit definition. 'scalar' must be a number");o.forEach(function(m){if(y[m]===void 0)throw new p(x+": Invalid unit definition. Unit "+m+" in 'numerator' is not recognized")}),c.forEach(function(m){if(y[m]===void 0)throw new p(x+": Invalid unit definition. Unit "+m+" in 'denominator' is not recognized")})}var E={},R={},$={},L={},D={};for(var B in y)if(y.hasOwnProperty(B)){var P=y[B];if(P[2]==="prefix"){E[B]=P[1];for(var O=0;O<P[0].length;O++)R[P[0][O]]=B}else{v(B,P),$[B]={scalar:P[1],numerator:P[3],denominator:P[4]};for(var Y=0;Y<P[0].length;Y++)L[P[0][Y]]=B}D[B]=P[0][0]}function te(x){var f,l=[],o=Object.keys(y);if(typeof x>"u")for(f=0;f<o.length;f++)["","prefix"].indexOf(y[o[f]][2])===-1&&l.push(o[f].substr(1,o[f].length-2));else{if(this.getKinds().indexOf(x)===-1)throw new p("Kind not recognized");for(f=0;f<o.length;f++)y[o[f]][2]===x&&l.push(o[f].substr(1,o[f].length-2))}return l.sort(function(c,m){return c.toLowerCase()<m.toLowerCase()?-1:c.toLowerCase()>m.toLowerCase()?1:0})}function H(x){if(!L[x])throw new p("Unit not recognized");return y[L[x]][0]}var J=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function Ce(){if(this.signature)return this.signature;for(var x=Pe.call(this),f=0;f<x.length;f++)x[f]*=Math.pow(20,f);return x.reduce(function(l,o){return l+o},0)}function Pe(){if(!this.isBase())return Pe.call(this.toBase());for(var x=new Array(J.length),f=0;f<x.length;f++)x[f]=0;for(var l,o,c=0;c<this.numerator.length;c++)(l=y[this.numerator[c]])&&(o=J.indexOf(l[2]),o>=0&&(x[o]=x[o]+1));for(var m=0;m<this.denominator.length;m++)(l=y[this.denominator[m]])&&(o=J.indexOf(l[2]),o>=0&&(x[o]=x[o]-1));return x}var le="[+-]",ye="\\d+",xe=le+"?"+ye,Ie="\\."+ye,ie="(?:"+ye+"(?:"+Ie+")?)|(?:"+Ie+")",Ee="[Ee]"+xe,he="(?:"+ie+")(?:"+Ee+")?",z=le+"?\\s*"+he,de="("+z+")?\\s*([^/]*)(?:/(.+))?",ke=new RegExp("^"+de+"$"),ve="\\^|\\*{2}",Me="[01234]",Fe=new RegExp("([^ \\*\\d]+?)(?:"+ve+")?(-?"+Me+"(?![a-zA-Z]))"),$e=new RegExp("([^ \\*\\d]+?)(?:"+ve+")?("+Me+"(?![a-zA-Z]))");function je(x){t(x)||(x=x.toString()),x=x.trim();var f=ke.exec(x);if(!f)throw new p(x+": Quantity not recognized");var l=f[1];l?(l=l.replace(/\s/g,""),this.scalar=parseFloat(l)):this.scalar=1;for(var o=f[2],c=f[3],m,S,k;f=Fe.exec(o);){if(m=parseFloat(f[2]),isNaN(m))throw new p("Unit exponent is not a number");if(m===0&&!Se.test(f[1]))throw new p("Unit not recognized");S=f[1]+" ",k="";for(var T=0;T<Math.abs(m);T++)k+=S;m>=0?o=o.replace(f[0],k):(c=c?c+k:k,o=o.replace(f[0],""))}for(;f=$e.exec(c);){if(m=parseFloat(f[2]),isNaN(m))throw new p("Unit exponent is not a number");if(m===0&&!Se.test(f[1]))throw new p("Unit not recognized");S=f[1]+" ",k="";for(var I=0;I<m;I++)k+=S;c=c.replace(f[0],k)}o&&(this.numerator=me(o.trim())),c&&(this.denominator=me(c.trim()))}var Oe=Object.keys(R).sort(function(x,f){return f.length-x.length}).join("|"),fe=Object.keys(L).sort(function(x,f){return f.length-x.length}).join("|"),re="\\b|$",Le="("+Oe+")??("+fe+")(?:"+re+")",Se=new RegExp("^\\s*("+Le+"[\\s\\*]*)+$"),Te=new RegExp(Le,"g"),X={};function me(x){var f=X[x];if(f)return f;var l,o=[];if(!Se.test(x))throw new p("Unit not recognized");for(;l=Te.exec(x);)o.push(l.slice(1));return o=o.map(function(c){return R[c[0]]?[R[c[0]],L[c[1]]]:[L[c[1]]]}),o=o.reduce(function(c,m){return c.concat(m)},[]),o=o.filter(function(c){return c}),X[x]=o,o}function ge(x){if(!t(x))throw new p("Argument should be a string");try{return this(x)}catch{return null}}function pe(x){return x instanceof Q}function Q(x,f){if(Ne.apply(null,arguments),!pe(this))return new Q(x,f);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=C,this.denominator=C,Ue(x)?(this.scalar=x.scalar,this.numerator=x.numerator&&x.numerator.length!==0?x.numerator:C,this.denominator=x.denominator&&x.denominator.length!==0?x.denominator:C):f?(je.call(this,f),this.scalar=x):je.call(this,x),this.denominator.join("*").indexOf("temp")>=0)throw new p("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new p("Cannot multiply by temperatures");if(!h(this.denominator,C))throw new p("Cannot divide with temperatures")}if(this.initValue=x,oe.call(this),this.isTemperature()&&this.baseScalar<0)throw new p("Temperatures must not be less than absolute zero")}Q.prototype={constructor:Q};function Ne(x,f){if(f){if(!(n(x)&&t(f)))throw new p("Only number accepted as initialization value when units are explicitly provided")}else if(!(t(x)||n(x)||pe(x)||Ue(x)))throw new p("Only string, number or quantity accepted as single initialization value")}function Ue(x){return x&&typeof x=="object"&&x.hasOwnProperty("scalar")}function oe(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=Ce.call(this);else{var x=this.toBase();this.baseScalar=x.scalar,this.signature=x.signature}}var ue={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function be(){return a(Object.keys(ue).map(function(x){return ue[x]}))}Q.prototype.kind=function(){return ue[this.signature.toString()]},d(Q.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&h(this.denominator,C)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function ce(x,f){var l=x.units(),o=f.to(l),c=Q(Ae(l));return Q({scalar:x.scalar-o.scalar,numerator:c.numerator,denominator:c.denominator})}function Re(x,f){var l=f.to(Ae(x.units()));return Q({scalar:x.scalar-l.scalar,numerator:x.numerator,denominator:x.denominator})}function Ye(x,f){var l=f.to(Ae(x.units()));return Q({scalar:x.scalar+l.scalar,numerator:x.numerator,denominator:x.denominator})}function Ae(x){if(x==="tempK")return"degK";if(x==="tempC")return"degC";if(x==="tempF")return"degF";if(x==="tempR")return"degR";throw new p("Unknown type for temp conversion from: "+x)}function ze(x,f){var l=qe(x),o=f.units(),c;if(o==="degK")c=l.scalar;else if(o==="degC")c=l.scalar;else if(o==="degF")c=l.scalar*9/5;else if(o==="degR")c=l.scalar*9/5;else throw new p("Unknown type for degree conversion to: "+o);return Q({scalar:c,numerator:f.numerator,denominator:f.denominator})}function qe(x){var f=x.units(),l;if(f.match(/(deg)[CFRK]/))l=x.baseScalar;else if(f==="tempK")l=x.scalar;else if(f==="tempC")l=x.scalar;else if(f==="tempF")l=x.scalar*5/9;else if(f==="tempR")l=x.scalar*5/9;else throw new p("Unknown type for temp conversion from: "+f);return Q({scalar:l,numerator:["<kelvin>"],denominator:C})}function Ge(x,f){var l=f.units(),o;if(l==="tempK")o=x.baseScalar;else if(l==="tempC")o=x.baseScalar-273.15;else if(l==="tempF")o=x.baseScalar*9/5-459.67;else if(l==="tempR")o=x.baseScalar*9/5;else throw new p("Unknown type for temp conversion to: "+l);return Q({scalar:o,numerator:f.numerator,denominator:f.denominator})}function rt(x){var f=x.units(),l;if(f.match(/(deg)[CFRK]/))l=x.baseScalar;else if(f==="tempK")l=x.scalar;else if(f==="tempC")l=x.scalar+273.15;else if(f==="tempF")l=(x.scalar+459.67)*5/9;else if(f==="tempR")l=x.scalar*5/9;else throw new p("Unknown type for temp conversion from: "+f);return Q({scalar:l,numerator:["<temp-K>"],denominator:C})}d(Q.prototype,{to:function(x){var f,l;if(x==null)return this;if(!t(x))return this.to(x.units());if(f=this._conversionCache[x],f)return f;if(l=Q(x),l.units()===this.units())return this;if(!this.isCompatible(l))this.isInverse(l)?l=this.inverse().to(x):b(this.units(),l.units());else if(l.isTemperature())l=Ge(this,l);else if(l.isDegrees())l=ze(this,l);else{var o=g(this.baseScalar,l.baseScalar);l=Q({scalar:o,numerator:l.numerator,denominator:l.denominator})}return this._conversionCache[x]=l,l},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return rt(this);var x=st[this.units()];return x||(x=gt(this.numerator,this.denominator),st[this.units()]=x),x.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new p("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(x){if(t(x)&&(x=Q(x)),n(x)&&(x=Q(x+" "+this.units())),this.isUnitless()?x.isUnitless()||b(this.units(),x.units()):x=x.to(this.units()),x.scalar===0)throw new p("Divide by zero");var f=u(Math.round(this.scalar/x.scalar),x.scalar);return Q(f+this.units())}});function Qe(x,f){var l=Q(x),o=Q(f);if(l.eq(o))return s;var c;return l.isTemperature()?c=function(m){return l.mul(m).to(o).scalar}:c=function(m){return m*l.baseScalar/o.baseScalar},function(S){var k,T,I;if(Array.isArray(S)){for(T=S.length,I=[],k=0;k<T;k++)I.push(c(S[k]));return I}else return c(S)}}var st={};function gt(x,f){for(var l=[],o=[],c=1,m,S=0;S<x.length;S++)m=x[S],E[m]?c=u(c,E[m]):$[m]&&(c*=$[m].scalar,$[m].numerator&&l.push($[m].numerator),$[m].denominator&&o.push($[m].denominator));for(var k=0;k<f.length;k++)m=f[k],E[m]?c/=E[m]:$[m]&&(c/=$[m].scalar,$[m].numerator&&o.push($[m].numerator),$[m].denominator&&l.push($[m].denominator));return l=l.reduce(function(T,I){return T.concat(I)},[]),o=o.reduce(function(T,I){return T.concat(I)},[]),Q({scalar:c,numerator:l,denominator:o})}Q.parse=ge,Q.getUnits=te,Q.getAliases=H,Q.mulSafe=u,Q.divSafe=g,Q.getKinds=be,Q.swiftConverter=Qe,Q.Error=p,d(Q.prototype,{add:function(x){if(t(x)&&(x=Q(x)),this.isCompatible(x)||b(this.units(),x.units()),this.isTemperature()&&x.isTemperature())throw new p("Cannot add two temperatures");return this.isTemperature()?Ye(this,x):x.isTemperature()?Ye(x,this):Q({scalar:this.scalar+x.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(x){if(t(x)&&(x=Q(x)),this.isCompatible(x)||b(this.units(),x.units()),this.isTemperature()&&x.isTemperature())return ce(this,x);if(this.isTemperature())return Re(this,x);if(x.isTemperature())throw new p("Cannot subtract a temperature from a differential degree unit");return Q({scalar:this.scalar-x.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(x){if(n(x))return Q({scalar:u(this.scalar,x),numerator:this.numerator,denominator:this.denominator});if(t(x)&&(x=Q(x)),(this.isTemperature()||x.isTemperature())&&!(this.isUnitless()||x.isUnitless()))throw new p("Cannot multiply by temperatures");var f=this,l=x;f.isCompatible(l)&&f.signature!==400&&(l=l.to(f));var o=wt(f.numerator,f.denominator,l.numerator,l.denominator);return Q({scalar:u(f.scalar,l.scalar,o[2]),numerator:o[0],denominator:o[1]})},div:function(x){if(n(x)){if(x===0)throw new p("Divide by zero");return Q({scalar:this.scalar/x,numerator:this.numerator,denominator:this.denominator})}else t(x)&&(x=Q(x));if(x.scalar===0)throw new p("Divide by zero");if(x.isTemperature())throw new p("Cannot divide with temperatures");if(this.isTemperature()&&!x.isUnitless())throw new p("Cannot divide with temperatures");var f=this,l=x;f.isCompatible(l)&&f.signature!==400&&(l=l.to(f));var o=wt(f.numerator,f.denominator,l.denominator,l.numerator);return Q({scalar:u(f.scalar,o[2])/l.scalar,numerator:o[0],denominator:o[1]})},inverse:function(){if(this.isTemperature())throw new p("Cannot divide with temperatures");if(this.scalar===0)throw new p("Divide by zero");return Q({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function wt(x,f,l,o){function c(K){return K!==A}x=x.filter(c),l=l.filter(c),f=f.filter(c),o=o.filter(c);var m={};function S(K,j){for(var V,ne,N,W=0;W<K.length;W++)if(E[K[W]]?(V=K[W+1],ne=K[W],N=E[ne],W++):(V=K[W],ne=null,N=1),V&&V!==A)if(m[V]){m[V][0]+=j;var se=m[V][2]?E[m[V][2]]:1;m[V][j===1?3:4]*=g(N,se)}else m[V]=[j,V,ne,1,1]}S(x,1),S(f,-1),S(l,1),S(o,-1);var k=[],T=[],I=1;for(var q in m)if(m.hasOwnProperty(q)){var F=m[q],G;if(F[0]>0)for(G=0;G<F[0];G++)k.push(F[2]===null?F[1]:[F[2],F[1]]);else if(F[0]<0)for(G=0;G<-F[0];G++)T.push(F[2]===null?F[1]:[F[2],F[1]]);I*=g(F[3],F[4])}return k.length===0&&(k=C),T.length===0&&(T=C),k=k.reduce(function(K,j){return K.concat(j)},[]),T=T.reduce(function(K,j){return K.concat(j)},[]),[k,T,I]}d(Q.prototype,{eq:function(x){return this.compareTo(x)===0},lt:function(x){return this.compareTo(x)===-1},lte:function(x){return this.eq(x)||this.lt(x)},gt:function(x){return this.compareTo(x)===1},gte:function(x){return this.eq(x)||this.gt(x)},compareTo:function(x){if(t(x))return this.compareTo(Q(x));if(this.isCompatible(x)||b(this.units(),x.units()),this.baseScalar<x.baseScalar)return-1;if(this.baseScalar===x.baseScalar)return 0;if(this.baseScalar>x.baseScalar)return 1},same:function(x){return this.scalar===x.scalar&&this.units()===x.units()}}),d(Q.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(x){return h(x,C)})},isCompatible:function(x){return t(x)?this.isCompatible(Q(x)):pe(x)&&x.signature!==void 0?this.signature===x.signature:!1},isInverse:function(x){return this.inverse().isCompatible(x)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(x){x!==A&&M.indexOf(x)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function lt(){}lt.prototype.get=function(x){return arguments.length>1&&(x=Array.apply(null,arguments)),x.reduce(function(f,l,o){if(f){var c=f[l];return o===x.length-1?c?c.data:void 0:c}},this)},lt.prototype.set=function(x,f){return arguments.length>2&&(x=Array.prototype.slice.call(arguments,0,-1),f=arguments[arguments.length-1]),x.reduce(function(l,o,c){var m=l[o];return m===void 0&&(m=l[o]={}),c===x.length-1?(m.data=f,f):m},this)};function ft(x,f){return(x+" "+f).trim()}Q.formatter=ft,d(Q.prototype,{units:function(){if(this._units!==void 0)return this._units;var x=h(this.numerator,C),f=h(this.denominator,C);if(x&&f)return this._units="",this._units;var l=ht(this.numerator),o=ht(this.denominator);return this._units=l+(f?"":"/"+o),this._units},toString:function(x,f){var l;if(n(x))l=this.units(),f=x;else if(t(x))l=x;else if(pe(x))return this.toPrec(x).toString(f);var o=this.to(l),c=f!==void 0?_(o.scalar,f):o.scalar;return o=(c+" "+o.units()).trim(),o},format:function(x,f){arguments.length===1&&typeof x=="function"&&(f=x,x=void 0),f=f||Q.formatter;var l=this.to(x);return f.call(this,l.scalar,l.units())}});var _t=new lt;function ht(x){var f=_t.get(x);if(f)return f;var l=h(x,C);return l?f="1":f=dt(Je(x)).join("*"),_t.set(x,f),f}function Je(x){for(var f=[],l,o,c=0;c<x.length;c++)l=x[c],o=x[c+1],E[l]?(f.push(D[l]+D[o]),c++):f.push(D[l]);return f}function dt(x){var f=x.reduce(function(l,o){var c=l[o];return c||l.push(c=l[o]=[o,0]),c[1]++,l},[]);return f.map(function(l){return l[0]+(l[1]>1?l[1]:"")})}return Q.version="1.8.0",Q})}(quantities$1)),quantities$1.exports}var quantitiesExports=requireQuantities();const Qty=getDefaultExportFromCjs(quantitiesExports);function deepValue(e,r=""){let t=r.split(".");for(let i of t){if(e[i]===void 0)return;e=e[i]}return e}var orientation={exports:{}},twoProduct_1,hasRequiredTwoProduct;function requireTwoProduct(){if(hasRequiredTwoProduct)return twoProduct_1;hasRequiredTwoProduct=1,twoProduct_1=r;var e=+(Math.pow(2,27)+1);function r(t,i,n){var s=t*i,a=e*t,h=a-t,d=a-h,u=t-d,g=e*i,_=g-i,w=g-_,p=i-w,b=s-d*w,y=b-u*w,M=y-d*p,A=u*p-M;return n?(n[0]=A,n[1]=s,n):[A,s]}return twoProduct_1}var robustSum,hasRequiredRobustSum;function requireRobustSum(){if(hasRequiredRobustSum)return robustSum;hasRequiredRobustSum=1,robustSum=r;function e(t,i){var n=t+i,s=n-t,a=n-s,h=i-s,d=t-a,u=d+h;return u?[u,n]:[n]}function r(t,i){var n=t.length|0,s=i.length|0;if(n===1&&s===1)return e(t[0],i[0]);var a=n+s,h=new Array(a),d=0,u=0,g=0,_=Math.abs,w=t[u],p=_(w),b=i[g],y=_(b),M,A;p<y?(A=w,u+=1,u<n&&(w=t[u],p=_(w))):(A=b,g+=1,g<s&&(b=i[g],y=_(b))),u<n&&p<y||g>=s?(M=w,u+=1,u<n&&(w=t[u],p=_(w))):(M=b,g+=1,g<s&&(b=i[g],y=_(b)));for(var C=M+A,v=C-M,E=A-v,R=E,$=C,L,D,B,P,O;u<n&&g<s;)p<y?(M=w,u+=1,u<n&&(w=t[u],p=_(w))):(M=b,g+=1,g<s&&(b=i[g],y=_(b))),A=R,C=M+A,v=C-M,E=A-v,E&&(h[d++]=E),L=$+C,D=L-$,B=L-D,P=C-D,O=$-B,R=O+P,$=L;for(;u<n;)M=w,A=R,C=M+A,v=C-M,E=A-v,E&&(h[d++]=E),L=$+C,D=L-$,B=L-D,P=C-D,O=$-B,R=O+P,$=L,u+=1,u<n&&(w=t[u]);for(;g<s;)M=b,A=R,C=M+A,v=C-M,E=A-v,E&&(h[d++]=E),L=$+C,D=L-$,B=L-D,P=C-D,O=$-B,R=O+P,$=L,g+=1,g<s&&(b=i[g]);return R&&(h[d++]=R),$&&(h[d++]=$),d||(h[d++]=0),h.length=d,h}return robustSum}var twoSum,hasRequiredTwoSum;function requireTwoSum(){if(hasRequiredTwoSum)return twoSum;hasRequiredTwoSum=1,twoSum=e;function e(r,t,i){var n=r+t,s=n-r,a=n-s,h=t-s,d=r-a;return i?(i[0]=d+h,i[1]=n,i):[d+h,n]}return twoSum}var robustScale,hasRequiredRobustScale;function requireRobustScale(){if(hasRequiredRobustScale)return robustScale;hasRequiredRobustScale=1;var e=requireTwoProduct(),r=requireTwoSum();robustScale=t;function t(i,n){var s=i.length;if(s===1){var a=e(i[0],n);return a[0]?a:[a[1]]}var h=new Array(2*s),d=[.1,.1],u=[.1,.1],g=0;e(i[0],n,d),d[0]&&(h[g++]=d[0]);for(var _=1;_<s;++_){e(i[_],n,u);var w=d[1];r(w,u[0],d),d[0]&&(h[g++]=d[0]);var p=u[1],b=d[1],y=p+b,M=y-p,A=b-M;d[1]=y,A&&(h[g++]=A)}return d[1]&&(h[g++]=d[1]),g===0&&(h[g++]=0),h.length=g,h}return robustScale}var robustDiff,hasRequiredRobustDiff;function requireRobustDiff(){if(hasRequiredRobustDiff)return robustDiff;hasRequiredRobustDiff=1,robustDiff=r;function e(t,i){var n=t+i,s=n-t,a=n-s,h=i-s,d=t-a,u=d+h;return u?[u,n]:[n]}function r(t,i){var n=t.length|0,s=i.length|0;if(n===1&&s===1)return e(t[0],-i[0]);var a=n+s,h=new Array(a),d=0,u=0,g=0,_=Math.abs,w=t[u],p=_(w),b=-i[g],y=_(b),M,A;p<y?(A=w,u+=1,u<n&&(w=t[u],p=_(w))):(A=b,g+=1,g<s&&(b=-i[g],y=_(b))),u<n&&p<y||g>=s?(M=w,u+=1,u<n&&(w=t[u],p=_(w))):(M=b,g+=1,g<s&&(b=-i[g],y=_(b)));for(var C=M+A,v=C-M,E=A-v,R=E,$=C,L,D,B,P,O;u<n&&g<s;)p<y?(M=w,u+=1,u<n&&(w=t[u],p=_(w))):(M=b,g+=1,g<s&&(b=-i[g],y=_(b))),A=R,C=M+A,v=C-M,E=A-v,E&&(h[d++]=E),L=$+C,D=L-$,B=L-D,P=C-D,O=$-B,R=O+P,$=L;for(;u<n;)M=w,A=R,C=M+A,v=C-M,E=A-v,E&&(h[d++]=E),L=$+C,D=L-$,B=L-D,P=C-D,O=$-B,R=O+P,$=L,u+=1,u<n&&(w=t[u]);for(;g<s;)M=b,A=R,C=M+A,v=C-M,E=A-v,E&&(h[d++]=E),L=$+C,D=L-$,B=L-D,P=C-D,O=$-B,R=O+P,$=L,g+=1,g<s&&(b=-i[g]);return R&&(h[d++]=R),$&&(h[d++]=$),d||(h[d++]=0),h.length=d,h}return robustDiff}var hasRequiredOrientation;function requireOrientation(){return hasRequiredOrientation||(hasRequiredOrientation=1,function(e){var r=requireTwoProduct(),t=requireRobustSum(),i=requireRobustScale(),n=requireRobustDiff(),s=5,a=11102230246251565e-32,h=(3+16*a)*a,d=(7+56*a)*a;function u(v,E,R,$){return function(D,B,P){var O=v(v(E(B[1],P[0]),E(-P[1],B[0])),v(E(D[1],B[0]),E(-B[1],D[0]))),Y=v(E(D[1],P[0]),E(-P[1],D[0])),te=$(O,Y);return te[te.length-1]}}function g(v,E,R,$){return function(D,B,P,O){var Y=v(v(R(v(E(P[1],O[0]),E(-O[1],P[0])),B[2]),v(R(v(E(B[1],O[0]),E(-O[1],B[0])),-P[2]),R(v(E(B[1],P[0]),E(-P[1],B[0])),O[2]))),v(R(v(E(B[1],O[0]),E(-O[1],B[0])),D[2]),v(R(v(E(D[1],O[0]),E(-O[1],D[0])),-B[2]),R(v(E(D[1],B[0]),E(-B[1],D[0])),O[2])))),te=v(v(R(v(E(P[1],O[0]),E(-O[1],P[0])),D[2]),v(R(v(E(D[1],O[0]),E(-O[1],D[0])),-P[2]),R(v(E(D[1],P[0]),E(-P[1],D[0])),O[2]))),v(R(v(E(B[1],P[0]),E(-P[1],B[0])),D[2]),v(R(v(E(D[1],P[0]),E(-P[1],D[0])),-B[2]),R(v(E(D[1],B[0]),E(-B[1],D[0])),P[2])))),H=$(Y,te);return H[H.length-1]}}function _(v,E,R,$){return function(D,B,P,O,Y){var te=v(v(v(R(v(R(v(E(O[1],Y[0]),E(-Y[1],O[0])),P[2]),v(R(v(E(P[1],Y[0]),E(-Y[1],P[0])),-O[2]),R(v(E(P[1],O[0]),E(-O[1],P[0])),Y[2]))),B[3]),v(R(v(R(v(E(O[1],Y[0]),E(-Y[1],O[0])),B[2]),v(R(v(E(B[1],Y[0]),E(-Y[1],B[0])),-O[2]),R(v(E(B[1],O[0]),E(-O[1],B[0])),Y[2]))),-P[3]),R(v(R(v(E(P[1],Y[0]),E(-Y[1],P[0])),B[2]),v(R(v(E(B[1],Y[0]),E(-Y[1],B[0])),-P[2]),R(v(E(B[1],P[0]),E(-P[1],B[0])),Y[2]))),O[3]))),v(R(v(R(v(E(P[1],O[0]),E(-O[1],P[0])),B[2]),v(R(v(E(B[1],O[0]),E(-O[1],B[0])),-P[2]),R(v(E(B[1],P[0]),E(-P[1],B[0])),O[2]))),-Y[3]),v(R(v(R(v(E(O[1],Y[0]),E(-Y[1],O[0])),B[2]),v(R(v(E(B[1],Y[0]),E(-Y[1],B[0])),-O[2]),R(v(E(B[1],O[0]),E(-O[1],B[0])),Y[2]))),D[3]),R(v(R(v(E(O[1],Y[0]),E(-Y[1],O[0])),D[2]),v(R(v(E(D[1],Y[0]),E(-Y[1],D[0])),-O[2]),R(v(E(D[1],O[0]),E(-O[1],D[0])),Y[2]))),-B[3])))),v(v(R(v(R(v(E(B[1],Y[0]),E(-Y[1],B[0])),D[2]),v(R(v(E(D[1],Y[0]),E(-Y[1],D[0])),-B[2]),R(v(E(D[1],B[0]),E(-B[1],D[0])),Y[2]))),O[3]),v(R(v(R(v(E(B[1],O[0]),E(-O[1],B[0])),D[2]),v(R(v(E(D[1],O[0]),E(-O[1],D[0])),-B[2]),R(v(E(D[1],B[0]),E(-B[1],D[0])),O[2]))),-Y[3]),R(v(R(v(E(P[1],O[0]),E(-O[1],P[0])),B[2]),v(R(v(E(B[1],O[0]),E(-O[1],B[0])),-P[2]),R(v(E(B[1],P[0]),E(-P[1],B[0])),O[2]))),D[3]))),v(R(v(R(v(E(P[1],O[0]),E(-O[1],P[0])),D[2]),v(R(v(E(D[1],O[0]),E(-O[1],D[0])),-P[2]),R(v(E(D[1],P[0]),E(-P[1],D[0])),O[2]))),-B[3]),v(R(v(R(v(E(B[1],O[0]),E(-O[1],B[0])),D[2]),v(R(v(E(D[1],O[0]),E(-O[1],D[0])),-B[2]),R(v(E(D[1],B[0]),E(-B[1],D[0])),O[2]))),P[3]),R(v(R(v(E(B[1],P[0]),E(-P[1],B[0])),D[2]),v(R(v(E(D[1],P[0]),E(-P[1],D[0])),-B[2]),R(v(E(D[1],B[0]),E(-B[1],D[0])),P[2]))),-O[3]))))),H=v(v(v(R(v(R(v(E(O[1],Y[0]),E(-Y[1],O[0])),P[2]),v(R(v(E(P[1],Y[0]),E(-Y[1],P[0])),-O[2]),R(v(E(P[1],O[0]),E(-O[1],P[0])),Y[2]))),D[3]),R(v(R(v(E(O[1],Y[0]),E(-Y[1],O[0])),D[2]),v(R(v(E(D[1],Y[0]),E(-Y[1],D[0])),-O[2]),R(v(E(D[1],O[0]),E(-O[1],D[0])),Y[2]))),-P[3])),v(R(v(R(v(E(P[1],Y[0]),E(-Y[1],P[0])),D[2]),v(R(v(E(D[1],Y[0]),E(-Y[1],D[0])),-P[2]),R(v(E(D[1],P[0]),E(-P[1],D[0])),Y[2]))),O[3]),R(v(R(v(E(P[1],O[0]),E(-O[1],P[0])),D[2]),v(R(v(E(D[1],O[0]),E(-O[1],D[0])),-P[2]),R(v(E(D[1],P[0]),E(-P[1],D[0])),O[2]))),-Y[3]))),v(v(R(v(R(v(E(P[1],Y[0]),E(-Y[1],P[0])),B[2]),v(R(v(E(B[1],Y[0]),E(-Y[1],B[0])),-P[2]),R(v(E(B[1],P[0]),E(-P[1],B[0])),Y[2]))),D[3]),R(v(R(v(E(P[1],Y[0]),E(-Y[1],P[0])),D[2]),v(R(v(E(D[1],Y[0]),E(-Y[1],D[0])),-P[2]),R(v(E(D[1],P[0]),E(-P[1],D[0])),Y[2]))),-B[3])),v(R(v(R(v(E(B[1],Y[0]),E(-Y[1],B[0])),D[2]),v(R(v(E(D[1],Y[0]),E(-Y[1],D[0])),-B[2]),R(v(E(D[1],B[0]),E(-B[1],D[0])),Y[2]))),P[3]),R(v(R(v(E(B[1],P[0]),E(-P[1],B[0])),D[2]),v(R(v(E(D[1],P[0]),E(-P[1],D[0])),-B[2]),R(v(E(D[1],B[0]),E(-B[1],D[0])),P[2]))),-Y[3])))),J=$(te,H);return J[J.length-1]}}function w(v){var E=v===3?u:v===4?g:_;return E(t,r,i,n)}var p=w(3),b=w(4),y=[function(){return 0},function(){return 0},function(E,R){return R[0]-E[0]},function(E,R,$){var L=(E[1]-$[1])*(R[0]-$[0]),D=(E[0]-$[0])*(R[1]-$[1]),B=L-D,P;if(L>0){if(D<=0)return B;P=L+D}else if(L<0){if(D>=0)return B;P=-(L+D)}else return B;var O=h*P;return B>=O||B<=-O?B:p(E,R,$)},function(E,R,$,L){var D=E[0]-L[0],B=R[0]-L[0],P=$[0]-L[0],O=E[1]-L[1],Y=R[1]-L[1],te=$[1]-L[1],H=E[2]-L[2],J=R[2]-L[2],Ce=$[2]-L[2],Pe=B*te,le=P*Y,ye=P*O,xe=D*te,Ie=D*Y,ie=B*O,Ee=H*(Pe-le)+J*(ye-xe)+Ce*(Ie-ie),he=(Math.abs(Pe)+Math.abs(le))*Math.abs(H)+(Math.abs(ye)+Math.abs(xe))*Math.abs(J)+(Math.abs(Ie)+Math.abs(ie))*Math.abs(Ce),z=d*he;return Ee>z||-Ee>z?Ee:b(E,R,$,L)}];function M(v){var E=y[v.length];return E||(E=y[v.length]=w(v.length)),E.apply(void 0,v)}function A(v,E,R,$,L,D,B){return function(O,Y,te,H,J){switch(arguments.length){case 0:case 1:return 0;case 2:return $(O,Y);case 3:return L(O,Y,te);case 4:return D(O,Y,te,H);case 5:return B(O,Y,te,H,J)}for(var Ce=new Array(arguments.length),Pe=0;Pe<arguments.length;++Pe)Ce[Pe]=arguments[Pe];return v(Ce)}}function C(){for(;y.length<=s;)y.push(w(y.length));e.exports=A.apply(void 0,[M].concat(y));for(var v=0;v<=s;++v)e.exports[v]=y[v]}C()}(orientation)),orientation.exports}var robustPnp,hasRequiredRobustPnp;function requireRobustPnp(){if(hasRequiredRobustPnp)return robustPnp;hasRequiredRobustPnp=1,robustPnp=r;var e=requireOrientation();function r(t,i){for(var n=i[0],s=i[1],a=t.length,h=1,d=a,u=0,g=a-1;u<d;g=u++){var _=t[u],w=t[g],p=_[1],b=w[1];if(b<p){if(b<s&&s<p){var y=e(_,w,i);if(y===0)return 0;h^=0<y|0}else if(s===p){var M=t[(u+1)%a],A=M[1];if(p<A){var y=e(_,w,i);if(y===0)return 0;h^=0<y|0}}}else if(p<b){if(p<s&&s<b){var y=e(_,w,i);if(y===0)return 0;h^=y<0|0}else if(s===p){var M=t[(u+1)%a],A=M[1];if(A<p){var y=e(_,w,i);if(y===0)return 0;h^=y<0|0}}}else if(s===p){var C=Math.min(_[0],w[0]),v=Math.max(_[0],w[0]);if(u===0){for(;g>0;){var E=(g+a-1)%a,R=t[E];if(R[1]!==s)break;var $=R[0];C=Math.min(C,$),v=Math.max(v,$),g=E}if(g===0)return C<=n&&n<=v?0:1;d=g+1}for(var L=t[(g+a-1)%a][1];u+1<d;){var R=t[u+1];if(R[1]!==s)break;var $=R[0];C=Math.min(C,$),v=Math.max(v,$),u+=1}if(C<=n&&n<=v)return 0;var D=t[(u+1)%a][1];n<C&&L<s!=D<s&&(h^=1)}}return 2*h-1}return robustPnp}var robustPnpExports=requireRobustPnp();const robustPointInPolygon=getDefaultExportFromCjs(robustPnpExports);function feretDiameters(e={}){const{originalPoints:r=monotoneChainConvexHull.call(this)}=e;if(r.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(r.length===1)return{min:1,max:1,minLine:[r[0],r[0]],maxLine:[r[0],r[0]],aspectRatio:1};const t=new Array(r.length);let i=1/0,n=0,s=[];for(let u=0;u<r.length;u++){let g=getAngle(r[u],r[(u+1)%r.length]);rotate(-g,r,t);let _=0,w=[];for(let p=0;p<r.length;p++){let b=Math.abs(t[u][1]-t[p][1]);b>_&&(_=b,w=[],w.push([t[p][0],t[u][1]],[t[p][0],t[p][1]]))}_<i&&(i=_,n=g,s=w)}rotate(n,s,s);let a=0,h=[],d=0;for(let u=0;u<r.length-1;u++)for(let g=u+1;g<r.length;g++){let _=(r[u][0]-r[g][0])**2+(r[u][1]-r[g][1])**2;_>d&&(d=_,a=Math.sqrt(_),h=[r[u],r[g]])}return{min:i,minLine:s,max:a,maxLine:h,aspectRatio:i/a}}function getAngle(e,r){let t=difference(r,e),i=normalize(t),n=Math.acos(i[0]);return i[1]<0?-n:n}class Roi{constructor(r,t){this.map=r,this.id=t,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(r={}){const{scale:t=1,kind:i=""}=r;let n;switch(i){case"contour":n=this.contourMask;break;case"box":n=this.boxMask;break;case"filled":n=this.filledMask;break;case"center":n=this.centerMask;break;case"mbr":n=this.mbrFilledMask;break;case"hull":n=this.convexHullFilledMask;break;case"hullContour":n=this.convexHullMask;break;case"mbrContour":n=this.mbrMask;break;case"feret":n=this.feretMask;break;default:n=this.mask}return t<1&&(n=n.resize({factor:t}),n.parent=this.mask.parent,n.position[0]+=this.minX,n.position[1]+=this.minY),n}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let r=this.borderIDs,t=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let i=this.internalIDs;for(let n=0;n<r.length;n++)i.includes(r[n])||(this.computed.externalIDs.push(r[n]),this.computed.externalLengths.push(t[n]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let r=getBorders(this);this.computed.borderIDs=r.ids,this.computed.borderLengths=r.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let r=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let t=0;t<this.width;t++)for(let i=0;i<this.height;i++)this.map.data[t+this.minX+(i+this.minY)*this.map.width]===this.id&&(t>0&&t<this.width-1&&i>0&&i<this.height-1?(this.map.data[t-1+this.minX+(i+this.minY)*this.map.width]!==this.id||this.map.data[t+1+this.minX+(i+this.minY)*this.map.width]!==this.id||this.map.data[t+this.minX+(i-1+this.minY)*this.map.width]!==this.id||this.map.data[t+this.minX+(i+1+this.minY)*this.map.width]!==this.id)&&r.setBitXY(t,i):r.setBitXY(t,i));this.computed.contourMask=r}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let r=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let t=0;t<this.width;t++)r.setBitXY(t,0),r.setBitXY(t,this.height-1);for(let t=0;t<this.height;t++)r.setBitXY(0,t),r.setBitXY(this.width-1,t);this.computed.boxMask=r}return this.computed.boxMask}get mask(){if(!this.computed.mask){let r=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let t=0;t<this.width;t++)for(let i=0;i<this.height;i++)this.map.data[t+this.minX+(i+this.minY)*this.map.width]===this.id&&r.setBitXY(t,i);this.computed.mask=r}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let r=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let t=0;t<this.width;t++)for(let i=0;i<this.height;i++){let n=t+this.minX+(i+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[n])&&r.setBitXY(t,i)}this.computed.filledMask=r}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let r=new Shape({kind:"smallCross"}).getMask();r.parent=this.map.parent,r.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=r}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const r=[];for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++)this.map.data[i+this.minX+(n+this.minY)*this.map.width]===this.id&&(i>0&&i<this.width-1&&n>0&&n<this.height-1?(this.map.data[i-1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[i+1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[i+this.minX+(n-1+this.minY)*this.map.width]!==this.id||this.map.data[i+this.minX+(n+1+this.minY)*this.map.width]!==this.id)&&(r.push([i,n]),r.push([i+1,n]),r.push([i,n+1]),r.push([i+1,n+1])):(r.push([i,n]),r.push([i+1,n]),r.push([i,n+1]),r.push([i+1,n+1])));const t=monotoneChainConvexHull$1(r);this.computed.convexHull={polyline:t,surface:surface(t),perimeter:perimeter(t)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const r=this.convexHull,t=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});t.paintPolyline(r.polyline,{closed:!0}),this.computed.convexHullMask=t}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const r=this.convexHull,t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++)robustPointInPolygon(r.polyline,[i,n])!==1&&t.setBitXY(i,n);this.computed.convexHullFilledMask=t}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let r=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(r.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:r};else{let t=r[0],i=r[1],n=r[2],s=Math.sqrt((t[0]-i[0])**2+(t[1]-i[1])**2),a=Math.sqrt((n[0]-i[0])**2+(n[1]-i[1])**2);this.computed.mbr={width:s,height:a,elongation:1-s/a,aspectRatio:s/a,surface:s*a,perimeter:(s+a)*2,rectangle:r}}}return this.computed.mbr}get filledSurface(){return this.surface+this.holesInfo.surface}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let r=this.perimeterInfo,t=2-Math.sqrt(2);return r.one+r.two*2+r.three*3+r.four*4-t*(r.two+r.three*2+r.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const r=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});r.paintPolyline(this.feretDiameters.minLine),r.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=r}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let r=round(this.mbr.rectangle);if(r.length>0){const t=minMax(r),i=new Image(t[1][0]-t[0][0]+1,t[1][1]-t[0][1]+1,{kind:BINARY,position:[this.minX+t[0][0],this.minY+t[0][1]],parent:this.map.parent});r=moveToZeroZero(r),i.paintPolyline(r,{closed:!0}),this.computed.mbrMask=i}else this.computed.mbrMask=new Image(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const r=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),t=this.mask.minimalBoundingRectangle();for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++)robustPointInPolygon(t,[i,n])!==1&&r.setBitXY(i,n);this.computed.mbrFilledMask=r}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let r=[];for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){let n=(t+this.minY)*this.map.width+i+this.minX;this.map.data[n]===this.id&&r.push([i,t])}this.computed.points=r}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let r=0,t;const i=this.points;for(let n=0;n<i.length;n++)for(let s=n+1;s<i.length;s++){let a=Math.pow(i[n][0]-i[s][0],2)+Math.pow(i[n][1]-i[s][1],2);a>=r&&(r=a,t=[i[n],i[s]])}this.computed.maxLengthPoints=t}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let r=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=r}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let r=this.maxLengthPoints,t=-Math.atan2(r[0][1]-r[1][1],r[0][0]-r[1][0])*180/Math.PI;this.computed.angle=t}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,filledSurface:this.filledSurface,surface:this.surface,hullSurface:this.convexHull.surface,hullPerimeter:this.convexHull.perimeter,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(e){let r=e.map,t=r.data,i=new Set,n=new Map,s=new Set,a=[1,0,-1,0],h=[0,1,0,-1];for(let g=e.minX;g<=e.maxX;g++)for(let _=e.minY;_<=e.maxY;_++){let w=g+_*r.width;if(t[w]===e.id)for(let p=0;p<4;p++){let b=g+a[p],y=_+h[p];if(b>=0&&y>=0&&b<r.width&&y<r.height){let M=b+y*r.width;if(t[M]!==e.id&&!s.has(M)){s.add(M),i.add(t[M]);let A=n.get(t[M]);A?n.set(t[M],++A):n.set(t[M],1)}}}}let d=Array.from(i),u=d.map(function(g){return n.get(g)});return{ids:d,lengths:u}}function getBoxIDs(e){let r=new Set,t=e.map,i=t.data;for(let n of[0,e.height-1])for(let s=0;s<e.width;s++){let a=(n+e.minY)*t.width+s+e.minX;if(s-e.minX>0&&i[a]===e.id&&i[a-1]!==e.id){let h=i[a-1];r.add(h)}if(t.width-s-e.minX>1&&i[a]===e.id&&i[a+1]!==e.id){let h=i[a+1];r.add(h)}}for(let n of[0,e.width-1])for(let s=0;s<e.height;s++){let a=(s+e.minY)*t.width+n+e.minX;if(s-e.minY>0&&i[a]===e.id&&i[a-t.width]!==e.id){let h=i[a-t.width];r.add(h)}if(t.height-s-e.minY>1&&i[a]===e.id&&i[a+t.width]!==e.id){let h=i[a+t.width];r.add(h)}}return Array.from(r)}function getBox(e){let r=0,t=e.map,i=t.data,n=[0];e.height>1&&(n[1]=e.height-1);for(let a of n)for(let h=1;h<e.width-1;h++){let d=(a+e.minY)*t.width+h+e.minX;i[d]===e.id&&r++}let s=[0];e.width>1&&(s[1]=e.width-1);for(let a of s)for(let h=0;h<e.height;h++){let d=(h+e.minY)*t.width+a+e.minX;i[d]===e.id&&r++}return r}function getBorder(e){let r=0,t=e.map,i=t.data;for(let n=1;n<e.width-1;n++)for(let s=1;s<e.height-1;s++){let a=(s+e.minY)*t.width+n+e.minX;i[a]===e.id&&(i[a-1]!==e.id||i[a+1]!==e.id||i[a-t.width]!==e.id||i[a+t.width]!==e.id)&&r++}return r+e.box}function getPerimeterInfo(e){let r=e.map,t=r.data,i=0,n=0,s=0,a=0;for(let h=0;h<e.width;h++)for(let d=0;d<e.height;d++){let u=(d+e.minY)*r.width+h+e.minX;if(t[u]===e.id){let g=0;switch((h===0||e.externalIDs.includes(t[u-1]))&&g++,(h===e.width-1||e.externalIDs.includes(t[u+1]))&&g++,(d===0||e.externalIDs.includes(t[u-r.width]))&&g++,(d===e.height-1||e.externalIDs.includes(t[u+r.width]))&&g++,g){case 1:i++;break;case 2:n++;break;case 3:s++;break;case 4:a++;break}}}return{one:i,two:n,three:s,four:a}}function getExternal(e){let r=0,t=e.map,i=t.data;for(let n=1;n<e.width-1;n++)for(let s=1;s<e.height-1;s++){let a=(s+e.minY)*t.width+n+e.minX;i[a]===e.id&&(e.externalIDs.includes(i[a-1])||e.externalIDs.includes(i[a+1])||e.externalIDs.includes(i[a-t.width])||e.externalIDs.includes(i[a+t.width]))&&r++}return r+e.box}function getHolesInfo(e){let r=0,t=e.map.width,i=e.map.data;for(let n=1;n<e.width-1;n++)for(let s=1;s<e.height-1;s++){let a=(s+e.minY)*t+n+e.minX;e.internalIDs.includes(i[a])&&i[a]!==e.id&&r++}return{number:e.internalIDs.length-1,surface:r}}function getInternalIDs(e){let r=[e.id],t=e.map,i=t.data;if(e.height>2)for(let s=0;s<e.width;s++){let a=e.minY*t.width+s+e.minX;if(r.includes(i[a])){let h=i[a+t.width];!r.includes(h)&&!e.boxIDs.includes(h)&&r.push(h)}}let n=new Array(4);for(let s=1;s<e.width-1;s++)for(let a=1;a<e.height-1;a++){let h=(a+e.minY)*t.width+s+e.minX;if(r.includes(i[h])){n[0]=i[h-1],n[1]=i[h+1],n[2]=i[h-t.width],n[3]=i[h+t.width];for(let d=0;d<4;d++){let u=n[d];!r.includes(u)&&!e.boxIDs.includes(u)&&r.push(u)}}}return r}class RoiLayer{constructor(r,t){this.roiMap=r,this.options=t,this.roi=this.createRoi()}createRoi(){let r=this.roiMap.data,t={};this.roiMap.positive=0,this.roiMap.negative=0;for(let h=0;h<r.length;h++)r[h]&&!t[r[h]]&&(t[r[h]]=!0,r[h]>0?this.roiMap.positive++:this.roiMap.negative++);let i={};for(let h in t)i[h]=new Roi(this.roiMap,h*1);let n=this.roiMap.width,s=this.roiMap.height;for(let h=0;h<s;h++)for(let d=0;d<n;d++){let u=h*n+d;if(r[u]!==0){const g=r[u],_=i[g];d<_.minX&&(_.minX=d),d>_.maxX&&(_.maxX=d),h<_.minY&&(_.minY=h),h>_.maxY&&(_.maxY=h),_.meanX+=d,_.meanY+=h,_.surface++}}let a=[];for(let h in t)i[h].meanX/=i[h].surface,i[h].meanY/=i[h].surface,a.push(i[h]);return a}}function commonBorderLength(e){let r=e.data,t=[1,0,-1,0],i=[0,1,0,-1],n=e.minMax,s=-n.min,a=n.max+s,h=[];for(let u=0;u<=a;u++)h.push(Object.create(null));for(let u=0;u<e.width;u++)for(let g=0;g<e.height;g++){let _=u+g*e.width,w=r[_];if(w!==0){let p=Object.create(null),b=!1;for(let y=0;y<4;y++){let M=u+t[y],A=g+i[y];if(M>=0&&A>=0&&M<e.width&&A<e.height){let C=r[M+A*e.width];w!==C&&(b=!0,C!==0&&p[C]===void 0&&(p[C]=!0,h[C+s][w]?h[C+s][w]++:h[C+s][w]=1))}else b=!0}b&&(h[w+s][w]?h[w+s][w]++:h[w+s][w]=1)}}let d={};for(let u=0;u<h.length;u++)Object.keys(h[u]).length>0&&(d[u-s]=h[u]);return d}function mergeRoi(e={}){const{algorithm:r="commonBorderLength",minCommonBorderLength:t=5,maxCommonBorderLength:i=100,minCommonBorderRatio:n=.3,maxCommonBorderRatio:s=1}=e;let a=function(M,A,C){return M[C]>=t&&M[C]<=i};typeof r=="function"&&(a=r),r.toLowerCase()==="commonborderratio"&&(a=function(M,A,C){let v=Math.min(M[C]/M[A],1);return v>=n&&v<=s});const h=this,d=h.commonBorderLength;let u={},g={};for(let M of Object.keys(d)){let A=d[M],C=Object.keys(A);for(let v of C)if(v!==M&&a(A,M,v)){let E=v;g[v]&&(E=g[v]);let R=M;if(g[M]&&(R=g[M]),Number(E)!==R){let $=Math.min(E,R),L=Math.max(E,R);if(u[$]||(u[$]={}),u[$][L]=!0,g[L]=$,u[L]){for(let D of Object.keys(u[L]))u[$][D]=!0,g[D]=$;delete u[L]}}}}let _=h.minMax,w=-_.min,p=_.max+w,b=new Array(p+1).fill(0);for(let M of Object.keys(g))b[Number(M)+w]=g[M];let y=h.data;for(let M=0;M<y.length;M++){let A=y[M];if(A!==0){let C=b[A+w];C!==0&&(y[M]=C)}}return h.computed={},h}class RoiMap{constructor(r,t){this.parent=r,this.width=r.width,this.height=r.height,this.data=t,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let r=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER;for(let i=0;i<this.data.length;i++)this.data[i]<r&&(r=this.data[i]),this.data[i]>t&&(t=this.data[i]);return{min:r,max:t}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(r={}){return mergeRoi.call(this,r)}mergeRois(r){const t=r[0],i=r.slice(1);for(let n=0;n<this.data.length;n++)i.includes(this.data[n])&&(this.data[n]=t)}rowsInfo(){let r=new Array(this.height),t=0;for(let i=0;i<this.data.length;i+=this.width){let n={row:t,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};r[t++]=n;let s={},a={},h=[],d=this.data[i],u=0;for(let g=i;g<i+this.width;g++){let _=this.data[g];d!==_&&(d=_,h.push(u),u=0),u++,_>0?(n.positivePixel++,s[_]||(s[_]=!0)):_<0?(n.negativePixel++,a[_]||(a[_]=!0)):n.zeroPixel++}h.push(u),n.medianChange=h.sort((g,_)=>g-_)[Math.floor(h.length/2)],n.positiveRoiIDs=Object.keys(s),n.negativeRoiIDs=Object.keys(a),n.positiveRoi=n.positiveRoiIDs.length,n.negativeRoi=n.negativeRoiIDs.length}return r}colsInfo(){let r=new Array(this.width),t=0;for(let i=0;i<this.width;i++){let n={col:t,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};r[t++]=n;let s={},a={},h=[],d=this.data[i],u=0;for(let g=i;g<i+this.data.length;g+=this.width){let _=this.data[g];d!==_&&(d=_,h.push(u),u=0),u++,_>0?(n.positivePixel++,s[_]||(s[_]=!0)):_<0?(n.negativePixel++,a[_]||(a[_]=!0)):n.zeroPixel++}h.push(u),n.medianChange=h.sort((g,_)=>g-_)[Math.floor(h.length/2)],n.positiveRoiIDs=Object.keys(s),n.negativeRoiIDs=Object.keys(a),n.positiveRoi=n.positiveRoiIDs.length,n.negativeRoi=n.negativeRoiIDs.length}return r}}function fromMask(e,r={}){const{allowCorners:t=!1}=r,i=65535;let n=new Int16Array(e.size),s=0,a=0,h=new Uint16Array(i+1),d=new Uint16Array(i+1);for(let g=0;g<e.width;g++)for(let _=0;_<e.height;_++)n[_*e.width+g]===0&&u(g,_);function u(g,_){let w=0,p=0,b=e.getBitXY(g,_),y=b?++s:--a;if(s>32767||a<-32768)throw new Error("Too many regions of interest");for(h[0]=g,d[0]=_;w<=p;){let M=h[w&i],A=d[w&i];if(n[A*e.width+M]=y,M>0&&n[A*e.width+M-1]===0&&e.getBitXY(M-1,A)===b&&(p++,h[p&i]=M-1,d[p&i]=A,n[A*e.width+M-1]=-32768),A>0&&n[(A-1)*e.width+M]===0&&e.getBitXY(M,A-1)===b&&(p++,h[p&i]=M,d[p&i]=A-1,n[(A-1)*e.width+M]=-32768),M<e.width-1&&n[A*e.width+M+1]===0&&e.getBitXY(M+1,A)===b&&(p++,h[p&i]=M+1,d[p&i]=A,n[A*e.width+M+1]=-32768),A<e.height-1&&n[(A+1)*e.width+M]===0&&e.getBitXY(M,A+1)===b&&(p++,h[p&i]=M,d[p&i]=A+1,n[(A+1)*e.width+M]=-32768),t&&(M>0&&A>0&&n[(A-1)*e.width+M-1]===0&&e.getBitXY(M-1,A-1)===b&&(p++,h[p&i]=M-1,d[p&i]=A-1,n[(A-1)*e.width+M-1]=-32768),M<e.width-1&&A>0&&n[(A-1)*e.width+M+1]===0&&e.getBitXY(M+1,A-1)===b&&(p++,h[p&i]=M+1,d[p&i]=A-1,n[(A-1)*e.width+M+1]=-32768),M>0&&A<e.height-1&&n[(A+1)*e.width+M-1]===0&&e.getBitXY(M-1,A+1)===b&&(p++,h[p&i]=M-1,d[p&i]=A+1,n[(A+1)*e.width+M-1]=-32768),M<e.width-1&&A<e.height-1&&n[(A+1)*e.width+M+1]===0&&e.getBitXY(M+1,A+1)===b&&(p++,h[p&i]=M+1,d[p&i]=A+1,n[(A+1)*e.width+M+1]=-32768)),w++,p-w>i)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(e,n)}var DisjointSet_1,hasRequiredDisjointSet;function requireDisjointSet(){if(hasRequiredDisjointSet)return DisjointSet_1;hasRequiredDisjointSet=1;class e{constructor(){this.nodes=new Map}add(i){var n=this.nodes.get(i);return n||(n=new r(i),this.nodes.set(i,n)),n}union(i,n){const s=this.find(i),a=this.find(n);s!==a&&(s.rank<a.rank?s.parent=a:s.rank>a.rank?a.parent=s:(a.parent=s,s.rank++))}find(i){for(var n=i;n.parent!==null;)n=n.parent;for(var s=i;s.parent!==null;){var a=s;s=s.parent,a.parent=n}return n}connected(i,n){return this.find(i)===this.find(n)}}DisjointSet_1=e;function r(t){this.value=t,this.parent=null,this.rank=0}return DisjointSet_1}var DisjointSetExports=requireDisjointSet();const DisjointSet=getDefaultExportFromCjs(DisjointSetExports),direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(e,r={}){const{allowCorners:t=!1}=r;let i=4;t&&(i=8);let n,s,a;if(i===8)n=direction8X,s=direction8Y,a=neighbours8;else if(i===4)n=direction4X,s=direction4Y,a=neighbours4;else throw new RangeError(`unsupported neighbours count: ${i}`);const h=e.size,d=e.width,u=e.height,g=new Array(h),_=new Uint32Array(h),w=new DisjointSet;let p=1;for(let b=0;b<u;b++)for(let y=0;y<d;y++){const M=y+b*d;if(e.getBit(M)){let A=null;for(let C=0;C<a.length;C++){const v=y+n[C],E=b+s[C];if(v>=0&&E>=0&&v<d&&E<u){const R=v+E*d;let $=g[R];$?(a[C]=$,(!A||a[C].value<A.value)&&(A=a[C])):a[C]=null}}if(!A)g[M]=w.add(p++);else{g[M]=A;for(let C=0;C<a.length;C++)a[C]&&a[C]!==A&&w.union(A,a[C])}}}for(let b=0;b<u;b++)for(let y=0;y<d;y++){const M=y+b*d;e.getBit(M)&&(_[M]=w.find(g[M]).value)}return new RoiMap(e,_)}function fromMaxima(e={}){let{allowCorner:r=!0,onlyTop:t=!1,invert:i=!1}=e,n=this;n.checkProcessable("fromMaxima",{components:[1]});const s=1,a=2;let h=0,d=0,u=new Int16Array(n.size),g=new Int8Array(n.size),_=new Float32Array(n.size),w=1048575,p=new Uint16Array(w+1),b=new Uint16Array(w+1),y=0,M=0,A=new Uint16Array(w+1),C=new Uint16Array(w+1),v=0,E=0;for(R(n);y<M;){let D=p[y&w],B=b[y&w];L(D,B,a),y++}return new RoiMap(n,u);function R({maxima:D=!0}){for(let B=1;B<n.height-1;B++)for(let P=1;P<n.width-1;P++){let O=P+B*n.width;if(g[O]===0){let Y=D?n.data[O]:-n.data[P+B*n.width];if(n.data[B*n.width+P-1]>Y||n.data[B*n.width+P+1]>Y||n.data[(B-1)*n.width+P]>Y||n.data[(B+1)*n.width+P]>Y||r&&(n.data[(B-1)*n.width+P-1]>Y||n.data[(B-1)*n.width+P+1]>Y||n.data[(B+1)*n.width+P-1]>Y||n.data[(B+1)*n.width+P+1]>Y))continue;u[O]=D?++h:--d,$(P,B)||(D?--h:++d)}}}function $(D,B){let P=M;v=0,E=1,A[0]=D,C[0]=B;let O=!0;for(;v<E;){let Y=A[v&w],te=C[v&w];O&=L(Y,te,s),v++}if(!O){for(let Y=0;Y<E;Y++){let te=A[Y&w],J=C[Y&w]*n.width+te;u[J]=0}M=P}return O}function L(D,B,P){let O=u[B*n.width+D],Y=n.data[B*n.width+D];for(let te=B-1;te<=B+1;te++)for(let H=D-1;H<=D+1;H++){let J=te*n.width+H;if(g[J]===0)switch(g[J]=1,_[J]=n.data[J]-Y,P){case s:if(_[J]===0){if(H===0||te===0||H===n.width-1||te===n.height-1)return!1;u[J]=O,A[E&w]=H,C[E&w]=te,E++}else{if(_[J]>0)return!1;t||(u[J]=O,p[M&w]=H,b[M&w]=te,M++)}break;case a:_[J]<=0&&(u[J]=O,p[M&w]=H,b[M&w]=te,M++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(e,r={}){let t=new Shape(r),i=new Int16Array(this.size),n=0,s=t.getPoints();for(let a=0;a<e.length;a++){n++;let h=e[a][0],d=e[a][1];for(let u=0;u<s.length;u++){let g=s[u][0],_=s[u][1];h+g>=0&&d+_>=0&&h+g<this.width&&d+_<this.height&&(i[h+g+(d+_)*this.width]=n)}}return new RoiMap(this,i)}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var priorityQueue={exports:{}},hasRequiredPriorityQueue;function requirePriorityQueue(){return hasRequiredPriorityQueue||(hasRequiredPriorityQueue=1,function(e,r){(function(t){e.exports=t()})(function(){return function t(i,n,s){function a(u,g){if(!n[u]){if(!i[u]){var _=typeof commonjsRequire=="function"&&commonjsRequire;if(!g&&_)return _(u,!0);if(h)return h(u,!0);var w=new Error("Cannot find module '"+u+"'");throw w.code="MODULE_NOT_FOUND",w}var p=n[u]={exports:{}};i[u][0].call(p.exports,function(b){var y=i[u][1][b];return a(y||b)},p,p.exports,t,i,n,s)}return n[u].exports}for(var h=typeof commonjsRequire=="function"&&commonjsRequire,d=0;d<s.length;d++)a(s[d]);return a}({1:[function(t,i,n){var s,a,h,d,u,g=function(w,p){for(var b in p)_.call(p,b)&&(w[b]=p[b]);function y(){this.constructor=w}return y.prototype=p.prototype,w.prototype=new y,w.__super__=p.prototype,w},_={}.hasOwnProperty;s=t("./PriorityQueue/AbstractPriorityQueue"),a=t("./PriorityQueue/ArrayStrategy"),d=t("./PriorityQueue/BinaryHeapStrategy"),h=t("./PriorityQueue/BHeapStrategy"),u=function(w){g(p,w);function p(b){b||(b={}),b.strategy||(b.strategy=d),b.comparator||(b.comparator=function(y,M){return(y||0)-(M||0)}),p.__super__.constructor.call(this,b)}return p}(s),u.ArrayStrategy=a,u.BinaryHeapStrategy=d,u.BHeapStrategy=h,i.exports=u},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(t,i,n){i.exports=function(){function s(a){var h;if((a!=null?a.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((a!=null?a.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new a.strategy(a),this.length=(a!=null&&(h=a.initialValues)!=null?h.length:void 0)||0}return s.prototype.queue=function(a){this.length++,this.priv.queue(a)},s.prototype.dequeue=function(a){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},s.prototype.peek=function(a){if(!this.length)throw"Empty queue";return this.priv.peek()},s.prototype.clear=function(){return this.length=0,this.priv.clear()},s}()},{}],3:[function(t,i,n){var s;s=function(a,h,d){var u,g,_;for(g=0,u=a.length;g<u;)_=g+u>>>1,d(a[_],h)>=0?g=_+1:u=_;return g},i.exports=function(){function a(h){var d;this.options=h,this.comparator=this.options.comparator,this.data=((d=this.options.initialValues)!=null?d.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return a.prototype.queue=function(h){var d;d=s(this.data,h,this.comparator),this.data.splice(d,0,h)},a.prototype.dequeue=function(){return this.data.pop()},a.prototype.peek=function(){return this.data[this.data.length-1]},a.prototype.clear=function(){this.data.length=0},a}()},{}],4:[function(t,i,n){i.exports=function(){function s(a){var h,d,u,g,_,w,p,b;for(this.comparator=(a!=null?a.comparator:void 0)||function(y,M){return y-M},this.pageSize=(a!=null?a.pageSize:void 0)||512,this.length=0,p=0;1<<p<this.pageSize;)p+=1;if(1<<p!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=p,this._emptyMemoryPageTemplate=h=[],d=0,_=this.pageSize;0<=_?d<_:d>_;0<=_?++d:--d)h.push(null);if(this._memory=[],this._mask=this.pageSize-1,a.initialValues)for(w=a.initialValues,u=0,g=w.length;u<g;u++)b=w[u],this.queue(b)}return s.prototype.queue=function(a){this.length+=1,this._write(this.length,a),this._bubbleUp(this.length,a)},s.prototype.dequeue=function(){var a,h;return a=this._read(1),h=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,h),this._bubbleDown(1,h)),a},s.prototype.peek=function(){return this._read(1)},s.prototype.clear=function(){this.length=0,this._memory.length=0},s.prototype._write=function(a,h){var d;for(d=a>>this._shift;d>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[d][a&this._mask]=h},s.prototype._read=function(a){return this._memory[a>>this._shift][a&this._mask]},s.prototype._bubbleUp=function(a,h){var d,u,g,_;for(d=this.comparator;a>1&&(u=a&this._mask,a<this.pageSize||u>3?g=a&~this._mask|u>>1:u<2?(g=a-this.pageSize>>this._shift,g+=g&~(this._mask>>1),g|=this.pageSize>>1):g=a-2,_=this._read(g),!(d(_,h)<0));)this._write(g,h),this._write(a,_),a=g},s.prototype._bubbleDown=function(a,h){var d,u,g,_,w;for(w=this.comparator;a<this.length;)if(a>this._mask&&!(a&this._mask-1)?d=u=a+2:a&this.pageSize>>1?(d=(a&~this._mask)>>1,d|=a&this._mask>>1,d=d+1<<this._shift,u=d+1):(d=a+(a&this._mask),u=d+1),d!==u&&u<=this.length)if(g=this._read(d),_=this._read(u),w(g,h)<0&&w(g,_)<=0)this._write(d,h),this._write(a,g),a=d;else if(w(_,h)<0)this._write(u,h),this._write(a,_),a=u;else break;else if(d<=this.length)if(g=this._read(d),w(g,h)<0)this._write(d,h),this._write(a,g),a=d;else break;else break},s}()},{}],5:[function(t,i,n){i.exports=function(){function s(a){var h;this.comparator=(a!=null?a.comparator:void 0)||function(d,u){return d-u},this.length=0,this.data=((h=a.initialValues)!=null?h.slice(0):void 0)||[],this._heapify()}return s.prototype._heapify=function(){var a,h,d;if(this.data.length>0)for(a=h=1,d=this.data.length;1<=d?h<d:h>d;a=1<=d?++h:--h)this._bubbleUp(a)},s.prototype.queue=function(a){this.data.push(a),this._bubbleUp(this.data.length-1)},s.prototype.dequeue=function(){var a,h;return h=this.data[0],a=this.data.pop(),this.data.length>0&&(this.data[0]=a,this._bubbleDown(0)),h},s.prototype.peek=function(){return this.data[0]},s.prototype.clear=function(){this.length=0,this.data.length=0},s.prototype._bubbleUp=function(a){for(var h,d;a>0&&(h=a-1>>>1,this.comparator(this.data[a],this.data[h])<0);)d=this.data[h],this.data[h]=this.data[a],this.data[a]=d,a=h},s.prototype._bubbleDown=function(a){var h,d,u,g,_;for(h=this.data.length-1;d=(a<<1)+1,g=d+1,u=a,d<=h&&this.comparator(this.data[d],this.data[u])<0&&(u=d),g<=h&&this.comparator(this.data[g],this.data[u])<0&&(u=g),u!==a;)_=this.data[u],this.data[u]=this.data[a],this.data[a]=_,a=u},s}()},{}]},{},[1])(1)})}(priorityQueue)),priorityQueue.exports}var priorityQueueExports=requirePriorityQueue();const PriorityQueue=getDefaultExportFromCjs(priorityQueueExports),dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(e={}){let{points:r,mask:t,image:i,fillMaxValue:n=this.maxValue,invert:s=!1}=e,a=i||this;a.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),s=!s,r||(r=a.getLocalMaxima({invert:s,mask:t}));let h=s?0:1,d=new Int16Array(a.size),u=a.width,g=a.height,_=new PriorityQueue({comparator:(w,p)=>w[2]-p[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let w=0;w<r.length;w++){let p=r[w][0]+r[w][1]*u;d[p]=w+1;let b=a.data[p];(s&&b<=n||!s&&b>=n)&&_.queue([r[w][0],r[w][1],b])}for(;_.length>0;){let w=_.dequeue(),p=w[0]+w[1]*u;for(let b=0;b<4;b++){let y=w[0]+dxs[b],M=w[1]+dys[b];if(y>=0&&M>=0&&y<u&&M<g){let A=y+M*u;if(!t||t.getBit(A)===h){let C=a.data[A];(s&&C<=n||!s&&C>=n)&&d[A]===0&&(d[A]=d[p],_.queue([w[0]+dxs[b],w[1]+dys[b],C]))}}}}return new RoiMap(a,d)}class RoiManager{constructor(r,t={}){this._image=r,this._options=t,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(r={}){let t=Object.assign({},this._options,r),i=fromMaxima.call(this._image,r);this._layers[t.label]=new RoiLayer(i,t)}fromPoints(r,t={}){let i=Object.assign({},this._options,t),n=fromPoints.call(this._image,r,t);return this._layers[i.label]=new RoiLayer(n,i),this}putMap(r,t={}){let i=new RoiMap(this._image,r),n=Object.assign({},this._options,t);return this._layers[n.label]=new RoiLayer(i,n),this}fromWaterShed(r={}){let t=Object.assign({},this._options,r),i=fromWaterShed.call(this._image,r);this._layers[t.label]=new RoiLayer(i,t)}fromMask(r,t={}){let i=Object.assign({},this._options,t),n=fromMask.call(this._image,r,t);return this._layers[i.label]=new RoiLayer(n,i),this}fromMaskConnectedComponentLabelingAlgorithm(r,t={}){let i=Object.assign({},this._options,t),n=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,r,t);return this._layers[i.label]=new RoiLayer(n,i),this}getMap(r={}){let t=Object.assign({},this._options,r);return this._assertLayerWithLabel(t.label),this._layers[t.label].roiMap}rowsInfo(r={}){return this.getMap(r).rowsInfo()}colsInfo(r={}){return this.getMap(r).rowsInfo()}getRoiIds(r={}){let t=this.getRois(r);if(t){let i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=t[n].id;return i}throw new Error("ROIs not found")}getRois(r={}){let{label:t=this._options.label,positive:i=!0,negative:n=!0,minSurface:s=0,maxSurface:a=Number.POSITIVE_INFINITY,minWidth:h=0,maxWidth:d=Number.POSITIVE_INFINITY,minHeight:u=0,maxHeight:g=Number.POSITIVE_INFINITY,minRatio:_=0,maxRatio:w=Number.POSITIVE_INFINITY}=r;if(!this._layers[t])throw new Error(`this Roi layer (${t}) does not exist`);const p=this._layers[t].roi,b=[];for(const y of p)(y.id<0&&n||y.id>0&&i)&&y.surface>=s&&y.surface<=a&&y.width>=h&&y.width<=d&&y.height>=u&&y.height<=g&&y.ratio>=_&&y.ratio<=w&&b.push(y);return b}getRoi(r,t={}){const{label:i=this._options.label}=t;if(!this._layers[i])throw new Error(`this Roi layer (${i}) does not exist`);const n=this._layers[i].roi.find(s=>s.id===r);if(!n)throw new Error(`found no Roi with id ${r}`);return n}getMasks(r={}){let t=this.getRois(r),i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=t[n].getMask(r);return i}getAnalysisMasks(r={}){const{analysisProperty:t}=r;let i=`${t}Mask`,n=this.getRois(r);return n.length===0||!n[0][i]?[]:n.map(s=>s[i])}getData(r={}){let t=Object.assign({},this._options,r);return this._assertLayerWithLabel(t.label),this._layers[t.label].roiMap.data}paint(r={}){let{labelProperty:t,analysisProperty:i}=r;this._painted||(this._painted=this._image.rgba8());let n=this.getMasks(r);if(t){const s=this.getRois(r);r.labels=s.map(u=>deepValue(u,t));const a=Math.max(...r.labels);let h=!1,d=!1;if(t.includes("surface")?h=!0:/(?:perimeter|min|max|external|width|height|length)/.test(t)&&(d=!0),isFinite(a)){let u="";if(r.unit!=="pixel"&&r.pixelSize&&(d||h)){u=h?`${r.unit}^2`:r.unit;let g=h?"m^2":"m",_=h?r.pixelSize**2:r.pixelSize;const w=Qty.swiftConverter(g,u);r.labels=r.labels.map(p=>w(_*p))}a>50?r.labels=r.labels.map(g=>Math.round(g)+u):a>10?r.labels=r.labels.map(g=>g.toFixed(1)+u):r.labels=r.labels.map(g=>g.toFixed(2)+u)}r.labelsPosition=s.map(u=>[u.meanX,u.meanY])}if(this._painted.paintMasks(n,r),i){let s=this.getAnalysisMasks(r);this._painted.paintMasks(s,{color:r.analysisColor,alpha:r.analysisAlpha})}return this._painted}getMask(r={}){let t=new Image(this._image.width,this._image.height,{kind:"BINARY"}),i=this.getMasks(r);for(let n=0;n<i.length;n++){let s=i[n];for(let a=0;a<s.width;a++)for(let h=0;h<s.height;h++)s.getBitXY(a,h)&&t.setBitXY(a+s.position[0],h+s.position[1])}return t}resetPainted(r={}){const{image:t}=r;t?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(r={}){const t=this.getMap(r);return t.mergeRoi(r),this.putMap(t.data,r),this}mergeRois(r,t={}){if(!Array.isArray(r)||r.some(n=>!Number.isInteger(n)))throw new Error("Roi ids must be an array of integers");if(r.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(r).size!==r.length)throw new Error("Roi ids must be all different");r.forEach(n=>this.getRoi(n));const i=this.getMap(t);return i.mergeRois(r),this.putMap(i.data,t),this}findCorrespondingRoi(r,t={}){let i=this.getRois(t),n=[];for(let s=0;s<i.length;s++){let a=i[s],h=a.minX,d=a.minY,u=a.points,g=Math.sign(a.id),_=correspondingRoisInformation(h,d,u,r,g);n.push(_)}return n}_assertLayerWithLabel(r){if(!this._layers[r])throw new Error(`no layer with label ${r}`)}}function correspondingRoisInformation(e,r,t,i,n){let s={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let a=0;a<t.length;a++){let h=t[a],d=h[0],u=h[1],g=d+e+(u+r)*i.width,_=i.data[g];(_>0||_<0)&&(s.id.includes(_)?s.surface[s.id.indexOf(_)]+=1:(s.id.push(_),s.surface.push(1)))}for(let a=0;a<s.id.length;a++)Math.sign(s.id[a])===n?s.same+=s.surface[a]:s.opposite+=s.surface[a],s.roiSurfaceCovered[a]=s.surface[a]/t.length;return s.total=s.opposite+s.same,s}const objectToString=Object.prototype.toString;class Image{constructor(r,t,i,n){if(arguments.length===1?(n=r,{width:r,height:t,data:i}=n):i&&!i.length&&(n=i,{data:i}=n),r===void 0&&(r=1),t===void 0&&(t=1),n===void 0&&(n={}),typeof n!="object"||n===null)throw new TypeError("options must be an object");if(!Number.isInteger(r)||r<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new RangeError("height must be a positive integer");const{kind:s=RGBA}=n;if(typeof s!="string")throw new TypeError("kind must be a string");const a=getKind(s),h=Object.assign({},n);for(const y in a)h[y]===void 0&&(h[y]=a[y]);verifyKindDefinition(h);const{components:d,bitDepth:u,colorModel:g}=h,_=h.alpha+0,w=r*t,p=d+_,b=u===32?Number.MAX_VALUE:2**u-1;if(i===void 0)i=createPixelArray(w,d,_,p,u,b);else{const y=getTheoreticalPixelArraySize(w,p,u);if(i.length!==y)throw new RangeError(`incorrect data size: ${i.length}. Should be ${y}`)}this.width=r,this.height=t,this.data=i,this.size=w,this.components=d,this.alpha=_,this.bitDepth=u,this.maxValue=b,this.colorModel=g,this.channels=p,this.meta=n.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:n.parent||null}),this.position=n.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(r){return objectToString.call(r)==="[object IJSImage]"}static fromCanvas(r){const i=r.getContext("2d").getImageData(0,0,r.width,r.height);return new Image(i.width,i.height,i.data)}static createFrom(r,t){const i=getImageParameters(r);return Object.assign(i,{parent:r,position:[0,0]},t),new Image(i)}getRoiManager(r){return new RoiManager(this,r)}clone(){const r=this.data.slice();return new Image(this.width,this.height,r,this)}apply(r){for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){let n=(t*this.width+i)*this.channels;r.call(this,n)}}}setValueMethods(Image);setBitMethods(Image);setExportMethods(Image);Image.prototype.checkProcessable=checkProcessable;Image.prototype.getRGBAData=getRGBAData;Image.load=load;Image.extendMethod=extendMethod;Image.extendProperty=extendProperty;extend$1(Image);var workerTemplate={},hasRequiredWorkerTemplate;function requireWorkerTemplate(){if(hasRequiredWorkerTemplate)return workerTemplate;hasRequiredWorkerTemplate=1;var e=function(){self.window=self;function t(){this._listeners={}}t.prototype.on=function(n,s){if(this._listeners[n])throw new RangeError("there is already a listener for "+n);if(typeof s!="function")throw new TypeError("callback argument must be a function");this._listeners[n]=s},t.prototype._send=function(n,s,a){a===void 0?a=[]:Array.isArray(a)||(a=[a]),self.postMessage({id:n,data:s},a)},t.prototype._trigger=function(n,s){if(!this._listeners[n])throw new Error("event "+n+" is not defined");this._listeners[n].apply(null,s)};var i=new t;self.onmessage=function(n){switch(n.data.action){case"exec":n.data.args.unshift(function(s,a){i._send(n.data.id,s,a)}),i._trigger(n.data.event,n.data.args);break;case"ping":i._send(n.data.id,"pong");break;default:throw new Error("unexpected action: "+n.data.action)}}},r=e.toString().split('"CODE";');return workerTemplate.newWorkerURL=function(i,n){var s=new Blob(["(",r[0],"importScripts.apply(self, "+JSON.stringify(n)+`);
`,"(",i,")();",r[1],")();"],{type:"application/javascript"});return URL.createObjectURL(s)},workerTemplate}var src,hasRequiredSrc;function requireSrc(){if(hasRequiredSrc)return src;hasRequiredSrc=1;var e=requireWorkerTemplate(),r=navigator.hardwareConcurrency||1;function t(i,n){if(typeof i!="string"&&typeof i!="function")throw new TypeError("func argument must be a function");if(n===void 0&&(n={}),typeof n!="object"||n===null)throw new TypeError("options argument must be an object");this._workerCode=i.toString(),n.maxWorkers===void 0||n.maxWorkers==="auto"?this._numWorkers=Math.min(r-1,1):n.maxWorkers>0?this._numWorkers=Math.min(n.maxWorkers,r):this._numWorkers=r,this._workers=new Map,this._timeout=n.timeout||0,this._terminateOnError=!!n.terminateOnError;var s=n.deps;typeof s=="string"&&(s=[s]),Array.isArray(s)||(s=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(s)}return t.prototype._init=function(i){for(var n=e.newWorkerURL(this._workerCode,i),s=0;s<this._numWorkers;s++){var a=new Worker(n);a.onmessage=this._onmessage.bind(this,a),a.onerror=this._onerror.bind(this,a),a.running=!1,a.id=s,this._workers.set(a,null)}URL.revokeObjectURL(n)},t.prototype._onerror=function(i,n){if(!this._terminated){this._working--,i.running=!1;var s=this._workers.get(i);s&&s[1](n.message),this._workers.set(i,null),this._terminateOnError?this.terminate():this._exec()}},t.prototype._onmessage=function(i,n){if(!this._terminated){this._working--,i.running=!1;var s=this._workers.get(i);s&&s[0](n.data.data),this._workers.set(i,null),this._exec()}},t.prototype._exec=function(){for(var i of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!i.running)for(var n=0;n<this._waiting.length;n++){var s=this._waiting[n];if(!(typeof s[4]=="number"&&s[4]!==i.id)){this._waiting.splice(n,1),i.postMessage({action:"exec",event:s[0],args:s[1]},s[2]),i.running=!0,i.time=Date.now(),this._workers.set(i,s[3]),this._working++;break}}}},t.prototype.terminate=function(){if(!this._terminated){for(var i of this._workers)i[0].terminate(),i[1]&&i[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}},t.prototype.postAll=function(i,n){if(this._terminated)throw new Error("Cannot post (terminated)");var s=[];for(var a of this._workers.keys())s.push(this.post(i,n,[],a.id));return Promise.all(s)},t.prototype.post=function(i,n,s,a){n===void 0&&(n=[]),s===void 0&&(s=[]),Array.isArray(n)||(n=[n]),Array.isArray(s)||(s=[s]);var h=this;return new Promise(function(d,u){if(h._terminated)throw new Error("Cannot post (terminated)");h._waiting.push([i,n,s,[d,u],a]),h._exec()})},src=t,src}var srcExports=requireSrc();const WorkerManager=getDefaultExportFromCjs(srcExports),defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(e,r,t){r=Object.assign({},defaultOptions,r);const i=this.manager;return Array.isArray(e)?Promise.all(e.map(function(n){const s=runOnce(i,n,r);return typeof t=="function"&&s.then(t),s})):runOnce(i,e,r)}function runOnce(e,r,t){return e.post("data",[r,t]).then(function(i){for(let n in i)i[n]=new Image(i[n]);return i})}function work(){worker.on("data",function(e,r,t){r=new IJS(r);const i={},n=[],s=r.grey(),a=s.sobelFilter();p("sobel",a);const h=a.level().mask({threshold:t.threshold});p("mask",h);const d=a.getRoiManager();d.fromMask(h);const u=d.getMask(t.roi);p("realMask",u);const g=s.getPixelsGrid({sampling:t.sampling,mask:u}),_=r.getBackground(g.xyS,g.zS,t.regression);p("background",_);const w=r.subtract(_);i.result=w,n.push(w.data.buffer),e(i,n);function p(b,y){t.include.includes(b)&&(i[b]=y,n.push(y.data.buffer))}})}const background={run,work};function extend(e){e.extendMethod("background",background)}let Worker$1=class kt{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(r){if(typeof r!="string")throw new TypeError("worker URL must be a string");this._url=r,this._deps[0]=r}static extendMethod(r,t){let i,n,s={};function a(...h){return i||(this.checkUrl(),n=this.url,i=new WorkerManager(t.work,{deps:n}),s.manager=i),t.run.call(s,...h)}a.reset=function(){i&&(i.terminate(),i=new WorkerManager(t.work,{deps:n}),s.manager=i)},kt.prototype[r]=a}};extend(Worker$1);const DENSITIES={LOW:" .:-=+*#%@",HIGH:" .'`^\",:;Il!i><~+_-?][}{1)(|\\/tfjrxnumbowqLCJUYYXZO0QPDVEKGHBSA&EW#%$@"};async function convertToAsciiHTML(e){let{_image:r,gridSize:t,density:i,customValue:n,resize_height:s,resize_width:a}=e,h="";i==="custom"?h=n:h=DENSITIES[i];const d=(h.length-1)/255;let u=[];r=r.resize({height:s,width:a});const{width:g,height:_,data:w,channels:p}=r,b=w;let y=0,M=0,A=0,C=0,v=0;for(let R=0;R<_;R+=t){let $=[];for(let L=0;L<g;L+=t){const D=(R*g+L)*p;p>=3?(M=b[D],A=b[D+1],C=b[D+2]):p===1||p===2?(M=b[D],A=b[D],C=b[D]):(console.warn(`Unsupported channels(${p}) in color mode.Defaulting to black.`),M=A=C=0),v=(M+A+C)/3,y=Math.floor(v*d),y=Math.max(0,Math.min(h.length-1,y)),$.push(`<span style="color :rgb(${M}, ${A}, ${C})">${h[y]}</span>`)}u.push($)}let E=`<pre style='font-family: monospace; line-height: 1;'>
`;return u.forEach(R=>{R.forEach($=>{E+=$}),E+="<br>"}),E+="</pre>",E}const _outputDiv=document.querySelector("div#output"),_gridSizeTextElm=document.querySelector("p#gridsizetxt"),_gridSizeSliderElm=document.getElementById("gridsize"),_custDensityInputElm=document.getElementById("custom-density"),_heightInputElm=document.querySelector('input[name="height"]'),_widthInputELm=document.querySelector('input[name="width"]'),_imageSelectButton=document.querySelector("button#select-image"),_imageNameTextElm=document.querySelector("p#image-name"),_generateButton=document.getElementById("generate"),_copyAsciiButton=document.getElementById("copy-ascii"),_copyHtmlButton=document.getElementById("copy-html");_imageSelectButton==null||_imageSelectButton.addEventListener("click",getImage);_gridSizeSliderElm.addEventListener("input",changeGridSizeText);_generateButton.addEventListener("click",generateAscii);_copyAsciiButton.addEventListener("click",copyToClipboard);_copyHtmlButton.addEventListener("click",copyToClipboard);let lastImage;async function changeGridSizeText(){_gridSizeTextElm.textContent=`Sample Size ${_gridSizeSliderElm.value}`}async function getImage(){_copyAsciiButton.hidden=!0,_copyHtmlButton.hidden=!0;const e=document.createElement("input");e.type="file",e.accept="image/png, image/jpeg",e.click(),e.onchange=async function(){let r=e.files[0];r&&["image/png","image/jpeg"].includes(r.type)?(_imageNameTextElm.innerText=`Selected Image → ${r.name}`,lastImage=await Image.load(await r.arrayBuffer())):alert("Choose a valid image!")}}async function generateAscii(){var i;let e=lastImage;e=e.resize({height:400,width:600});const r=parseInt(_gridSizeSliderElm.value),t=((i=document.querySelector("input[name='density']:checked"))==null?void 0:i.value)||"HIGH";t==="custom"?_outputDiv.innerHTML=await convertToAsciiHTML({_image:e,density:"custom",gridSize:r,customValue:_custDensityInputElm.value.toString(),resize_height:parseInt(_heightInputElm.value),resize_width:parseInt(_widthInputELm.value)}):_outputDiv.innerHTML=await convertToAsciiHTML({_image:e,density:t,gridSize:r,resize_height:parseInt(_heightInputElm.value),resize_width:parseInt(_widthInputELm.value)}),_copyAsciiButton.hidden=!1,_copyHtmlButton.hidden=!1}async function copyToClipboard(e){switch(e.target.getAttribute("id")){case"copy-ascii":{await navigator.clipboard.writeText(_outputDiv.innerText),alert("Copied ascii to clipboard");break}case"copy-html":{await navigator.clipboard.writeText(_outputDiv.innerHTML),alert("Copied html to clipboard");break}default:alert("?????????????")}}
